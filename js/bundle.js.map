{"version":3,"file":"bundle.js","sources":["../../node_modules/svelte/internal/index.mjs","../../src/components/utils.js","../../node_modules/svelte/easing/index.mjs","../../node_modules/svelte/transition/index.mjs","../../node_modules/svelte/store/index.mjs","../../src/constants.js","../../src/stores.js","../../src/components/LidoRoute.svelte","../../src/components/kml.js","../../src/components/mapSettings/ColorPinCombo.svelte","../../src/components/mapSettings/storage.js","../../src/components/ShortcutsLink.svelte","../../src/actions/blurAction.js","../../src/components/DownloadButton.svelte","../../src/components/mapSettings/CheckboxColorCombo.svelte","../../src/components/mapSettings/AirportSelector.svelte","../../src/components/mapSettings/ZoomLevel.svelte","../../src/actions/clickOutsideAction.js","../../src/components/mapSettings/Form.svelte","../../src/components/ExportSettings.svelte","../../src/components/Export.svelte","../../src/components/Logo.svelte","../../src/components/Home.svelte","../../src/components/mapboxgl/json.js","../../src/components/mapboxgl/utils.js","../../src/components/mapboxgl/layers/airport.js","../../src/components/mapboxgl/layers/etops.js","../../src/components/mapboxgl/layers/fir-reg.js","../../src/components/mapboxgl/layers/great-circle.js","../../src/components/mapboxgl/layers/ogimet.js","../../src/components/mapboxgl/layers/ralt.js","../../src/components/mapboxgl/layers/tracks.js","../../src/components/mapboxgl/layers/rmain.js","../../src/components/mapboxgl/layersManagement.js","../../src/components/mapboxgl/pj_times.js","../../src/components/mapboxgl/pj_eqearth.js","../../src/components/mapboxgl/mapManagement.js","../../src/tilesCache.js","../../src/components/CircleProgress.svelte","../../src/components/AircraftType.svelte","../../src/components/MapPlane.svelte","../../src/components/mapboxgl/blankStyle.js","../../src/components/mapboxgl/mapOptions.js","../../src/components/MapProjectionSelect.svelte","../../src/components/SimulatorPlayer.svelte","../../src/actions/grametAction.js","../../src/components/Gramet.svelte","../../src/actions/mapResizeAction.js","../../src/components/Map.svelte","../../node_modules/svelte-overlay/src/components/positions.js","../../node_modules/svelte-overlay/src/components/helpers.js","../../node_modules/svelte-overlay/src/components/Overlay.svelte","../../src/components/Link.svelte","../../src/components/GrametTrigger.svelte","../../src/components/pairingParser.js","../../src/components/OfpInfos.svelte","../../src/components/TakeOffInput.svelte","../../src/components/suncalc.js","../../src/components/solarstore.js","../../src/components/KpUpdater.svelte","../../src/components/SunTimeLine.svelte","../../src/components/KpTimeLine.svelte","../../src/components/Moon.svelte","../../src/components/SunPopOver.svelte","../../src/components/Sun.svelte","../../src/components/Navbar.svelte","../../src/components/OfpInput.svelte","../../src/components/async-script-loader.js","../../src/components/Page.svelte","../../src/components/Help.md","../../src/components/ChangeLog.svelte","../../src/components/ChangeLogModal.svelte","../../src/components/Help.svelte","../../src/components/SWUpdate.svelte","../../src/components/HomePwaInstall.svelte","../../src/App.svelte","../../node_modules/workbox-window/build/workbox-window.prod.es5.mjs","../../src/main.js"],"sourcesContent":["function noop() { }\nconst identity = x => x;\nfunction assign(tar, src) {\n    // @ts-ignore\n    for (const k in src)\n        tar[k] = src[k];\n    return tar;\n}\nfunction is_promise(value) {\n    return value && typeof value === 'object' && typeof value.then === 'function';\n}\nfunction add_location(element, file, line, column, char) {\n    element.__svelte_meta = {\n        loc: { file, line, column, char }\n    };\n}\nfunction run(fn) {\n    return fn();\n}\nfunction blank_object() {\n    return Object.create(null);\n}\nfunction run_all(fns) {\n    fns.forEach(run);\n}\nfunction is_function(thing) {\n    return typeof thing === 'function';\n}\nfunction safe_not_equal(a, b) {\n    return a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\nlet src_url_equal_anchor;\nfunction src_url_equal(element_src, url) {\n    if (!src_url_equal_anchor) {\n        src_url_equal_anchor = document.createElement('a');\n    }\n    src_url_equal_anchor.href = url;\n    return element_src === src_url_equal_anchor.href;\n}\nfunction not_equal(a, b) {\n    return a != a ? b == b : a !== b;\n}\nfunction is_empty(obj) {\n    return Object.keys(obj).length === 0;\n}\nfunction validate_store(store, name) {\n    if (store != null && typeof store.subscribe !== 'function') {\n        throw new Error(`'${name}' is not a store with a 'subscribe' method`);\n    }\n}\nfunction subscribe(store, ...callbacks) {\n    if (store == null) {\n        return noop;\n    }\n    const unsub = store.subscribe(...callbacks);\n    return unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\n}\nfunction get_store_value(store) {\n    let value;\n    subscribe(store, _ => value = _)();\n    return value;\n}\nfunction component_subscribe(component, store, callback) {\n    component.$$.on_destroy.push(subscribe(store, callback));\n}\nfunction create_slot(definition, ctx, $$scope, fn) {\n    if (definition) {\n        const slot_ctx = get_slot_context(definition, ctx, $$scope, fn);\n        return definition[0](slot_ctx);\n    }\n}\nfunction get_slot_context(definition, ctx, $$scope, fn) {\n    return definition[1] && fn\n        ? assign($$scope.ctx.slice(), definition[1](fn(ctx)))\n        : $$scope.ctx;\n}\nfunction get_slot_changes(definition, $$scope, dirty, fn) {\n    if (definition[2] && fn) {\n        const lets = definition[2](fn(dirty));\n        if ($$scope.dirty === undefined) {\n            return lets;\n        }\n        if (typeof lets === 'object') {\n            const merged = [];\n            const len = Math.max($$scope.dirty.length, lets.length);\n            for (let i = 0; i < len; i += 1) {\n                merged[i] = $$scope.dirty[i] | lets[i];\n            }\n            return merged;\n        }\n        return $$scope.dirty | lets;\n    }\n    return $$scope.dirty;\n}\nfunction update_slot_base(slot, slot_definition, ctx, $$scope, slot_changes, get_slot_context_fn) {\n    if (slot_changes) {\n        const slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n        slot.p(slot_context, slot_changes);\n    }\n}\nfunction update_slot(slot, slot_definition, ctx, $$scope, dirty, get_slot_changes_fn, get_slot_context_fn) {\n    const slot_changes = get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n    update_slot_base(slot, slot_definition, ctx, $$scope, slot_changes, get_slot_context_fn);\n}\nfunction get_all_dirty_from_scope($$scope) {\n    if ($$scope.ctx.length > 32) {\n        const dirty = [];\n        const length = $$scope.ctx.length / 32;\n        for (let i = 0; i < length; i++) {\n            dirty[i] = -1;\n        }\n        return dirty;\n    }\n    return -1;\n}\nfunction exclude_internal_props(props) {\n    const result = {};\n    for (const k in props)\n        if (k[0] !== '$')\n            result[k] = props[k];\n    return result;\n}\nfunction compute_rest_props(props, keys) {\n    const rest = {};\n    keys = new Set(keys);\n    for (const k in props)\n        if (!keys.has(k) && k[0] !== '$')\n            rest[k] = props[k];\n    return rest;\n}\nfunction compute_slots(slots) {\n    const result = {};\n    for (const key in slots) {\n        result[key] = true;\n    }\n    return result;\n}\nfunction once(fn) {\n    let ran = false;\n    return function (...args) {\n        if (ran)\n            return;\n        ran = true;\n        fn.call(this, ...args);\n    };\n}\nfunction null_to_empty(value) {\n    return value == null ? '' : value;\n}\nfunction set_store_value(store, ret, value) {\n    store.set(value);\n    return ret;\n}\nconst has_prop = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);\nfunction action_destroyer(action_result) {\n    return action_result && is_function(action_result.destroy) ? action_result.destroy : noop;\n}\n\nconst is_client = typeof window !== 'undefined';\nlet now = is_client\n    ? () => window.performance.now()\n    : () => Date.now();\nlet raf = is_client ? cb => requestAnimationFrame(cb) : noop;\n// used internally for testing\nfunction set_now(fn) {\n    now = fn;\n}\nfunction set_raf(fn) {\n    raf = fn;\n}\n\nconst tasks = new Set();\nfunction run_tasks(now) {\n    tasks.forEach(task => {\n        if (!task.c(now)) {\n            tasks.delete(task);\n            task.f();\n        }\n    });\n    if (tasks.size !== 0)\n        raf(run_tasks);\n}\n/**\n * For testing purposes only!\n */\nfunction clear_loops() {\n    tasks.clear();\n}\n/**\n * Creates a new task that runs on each raf frame\n * until it returns a falsy value or is aborted\n */\nfunction loop(callback) {\n    let task;\n    if (tasks.size === 0)\n        raf(run_tasks);\n    return {\n        promise: new Promise(fulfill => {\n            tasks.add(task = { c: callback, f: fulfill });\n        }),\n        abort() {\n            tasks.delete(task);\n        }\n    };\n}\n\n// Track which nodes are claimed during hydration. Unclaimed nodes can then be removed from the DOM\n// at the end of hydration without touching the remaining nodes.\nlet is_hydrating = false;\nfunction start_hydrating() {\n    is_hydrating = true;\n}\nfunction end_hydrating() {\n    is_hydrating = false;\n}\nfunction upper_bound(low, high, key, value) {\n    // Return first index of value larger than input value in the range [low, high)\n    while (low < high) {\n        const mid = low + ((high - low) >> 1);\n        if (key(mid) <= value) {\n            low = mid + 1;\n        }\n        else {\n            high = mid;\n        }\n    }\n    return low;\n}\nfunction init_hydrate(target) {\n    if (target.hydrate_init)\n        return;\n    target.hydrate_init = true;\n    // We know that all children have claim_order values since the unclaimed have been detached if target is not <head>\n    let children = target.childNodes;\n    // If target is <head>, there may be children without claim_order\n    if (target.nodeName === 'HEAD') {\n        const myChildren = [];\n        for (let i = 0; i < children.length; i++) {\n            const node = children[i];\n            if (node.claim_order !== undefined) {\n                myChildren.push(node);\n            }\n        }\n        children = myChildren;\n    }\n    /*\n    * Reorder claimed children optimally.\n    * We can reorder claimed children optimally by finding the longest subsequence of\n    * nodes that are already claimed in order and only moving the rest. The longest\n    * subsequence subsequence of nodes that are claimed in order can be found by\n    * computing the longest increasing subsequence of .claim_order values.\n    *\n    * This algorithm is optimal in generating the least amount of reorder operations\n    * possible.\n    *\n    * Proof:\n    * We know that, given a set of reordering operations, the nodes that do not move\n    * always form an increasing subsequence, since they do not move among each other\n    * meaning that they must be already ordered among each other. Thus, the maximal\n    * set of nodes that do not move form a longest increasing subsequence.\n    */\n    // Compute longest increasing subsequence\n    // m: subsequence length j => index k of smallest value that ends an increasing subsequence of length j\n    const m = new Int32Array(children.length + 1);\n    // Predecessor indices + 1\n    const p = new Int32Array(children.length);\n    m[0] = -1;\n    let longest = 0;\n    for (let i = 0; i < children.length; i++) {\n        const current = children[i].claim_order;\n        // Find the largest subsequence length such that it ends in a value less than our current value\n        // upper_bound returns first greater value, so we subtract one\n        // with fast path for when we are on the current longest subsequence\n        const seqLen = ((longest > 0 && children[m[longest]].claim_order <= current) ? longest + 1 : upper_bound(1, longest, idx => children[m[idx]].claim_order, current)) - 1;\n        p[i] = m[seqLen] + 1;\n        const newLen = seqLen + 1;\n        // We can guarantee that current is the smallest value. Otherwise, we would have generated a longer sequence.\n        m[newLen] = i;\n        longest = Math.max(newLen, longest);\n    }\n    // The longest increasing subsequence of nodes (initially reversed)\n    const lis = [];\n    // The rest of the nodes, nodes that will be moved\n    const toMove = [];\n    let last = children.length - 1;\n    for (let cur = m[longest] + 1; cur != 0; cur = p[cur - 1]) {\n        lis.push(children[cur - 1]);\n        for (; last >= cur; last--) {\n            toMove.push(children[last]);\n        }\n        last--;\n    }\n    for (; last >= 0; last--) {\n        toMove.push(children[last]);\n    }\n    lis.reverse();\n    // We sort the nodes being moved to guarantee that their insertion order matches the claim order\n    toMove.sort((a, b) => a.claim_order - b.claim_order);\n    // Finally, we move the nodes\n    for (let i = 0, j = 0; i < toMove.length; i++) {\n        while (j < lis.length && toMove[i].claim_order >= lis[j].claim_order) {\n            j++;\n        }\n        const anchor = j < lis.length ? lis[j] : null;\n        target.insertBefore(toMove[i], anchor);\n    }\n}\nfunction append(target, node) {\n    target.appendChild(node);\n}\nfunction append_styles(target, style_sheet_id, styles) {\n    const append_styles_to = get_root_for_style(target);\n    if (!append_styles_to.getElementById(style_sheet_id)) {\n        const style = element('style');\n        style.id = style_sheet_id;\n        style.textContent = styles;\n        append_stylesheet(append_styles_to, style);\n    }\n}\nfunction get_root_for_style(node) {\n    if (!node)\n        return document;\n    const root = node.getRootNode ? node.getRootNode() : node.ownerDocument;\n    if (root.host) {\n        return root;\n    }\n    return document;\n}\nfunction append_empty_stylesheet(node) {\n    const style_element = element('style');\n    append_stylesheet(get_root_for_style(node), style_element);\n    return style_element;\n}\nfunction append_stylesheet(node, style) {\n    append(node.head || node, style);\n}\nfunction append_hydration(target, node) {\n    if (is_hydrating) {\n        init_hydrate(target);\n        if ((target.actual_end_child === undefined) || ((target.actual_end_child !== null) && (target.actual_end_child.parentElement !== target))) {\n            target.actual_end_child = target.firstChild;\n        }\n        // Skip nodes of undefined ordering\n        while ((target.actual_end_child !== null) && (target.actual_end_child.claim_order === undefined)) {\n            target.actual_end_child = target.actual_end_child.nextSibling;\n        }\n        if (node !== target.actual_end_child) {\n            // We only insert if the ordering of this node should be modified or the parent node is not target\n            if (node.claim_order !== undefined || node.parentNode !== target) {\n                target.insertBefore(node, target.actual_end_child);\n            }\n        }\n        else {\n            target.actual_end_child = node.nextSibling;\n        }\n    }\n    else if (node.parentNode !== target || node.nextSibling !== null) {\n        target.appendChild(node);\n    }\n}\nfunction insert(target, node, anchor) {\n    target.insertBefore(node, anchor || null);\n}\nfunction insert_hydration(target, node, anchor) {\n    if (is_hydrating && !anchor) {\n        append_hydration(target, node);\n    }\n    else if (node.parentNode !== target || node.nextSibling != anchor) {\n        target.insertBefore(node, anchor || null);\n    }\n}\nfunction detach(node) {\n    node.parentNode.removeChild(node);\n}\nfunction destroy_each(iterations, detaching) {\n    for (let i = 0; i < iterations.length; i += 1) {\n        if (iterations[i])\n            iterations[i].d(detaching);\n    }\n}\nfunction element(name) {\n    return document.createElement(name);\n}\nfunction element_is(name, is) {\n    return document.createElement(name, { is });\n}\nfunction object_without_properties(obj, exclude) {\n    const target = {};\n    for (const k in obj) {\n        if (has_prop(obj, k)\n            // @ts-ignore\n            && exclude.indexOf(k) === -1) {\n            // @ts-ignore\n            target[k] = obj[k];\n        }\n    }\n    return target;\n}\nfunction svg_element(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\nfunction text(data) {\n    return document.createTextNode(data);\n}\nfunction space() {\n    return text(' ');\n}\nfunction empty() {\n    return text('');\n}\nfunction listen(node, event, handler, options) {\n    node.addEventListener(event, handler, options);\n    return () => node.removeEventListener(event, handler, options);\n}\nfunction prevent_default(fn) {\n    return function (event) {\n        event.preventDefault();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction stop_propagation(fn) {\n    return function (event) {\n        event.stopPropagation();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction self(fn) {\n    return function (event) {\n        // @ts-ignore\n        if (event.target === this)\n            fn.call(this, event);\n    };\n}\nfunction trusted(fn) {\n    return function (event) {\n        // @ts-ignore\n        if (event.isTrusted)\n            fn.call(this, event);\n    };\n}\nfunction attr(node, attribute, value) {\n    if (value == null)\n        node.removeAttribute(attribute);\n    else if (node.getAttribute(attribute) !== value)\n        node.setAttribute(attribute, value);\n}\nfunction set_attributes(node, attributes) {\n    // @ts-ignore\n    const descriptors = Object.getOwnPropertyDescriptors(node.__proto__);\n    for (const key in attributes) {\n        if (attributes[key] == null) {\n            node.removeAttribute(key);\n        }\n        else if (key === 'style') {\n            node.style.cssText = attributes[key];\n        }\n        else if (key === '__value') {\n            node.value = node[key] = attributes[key];\n        }\n        else if (descriptors[key] && descriptors[key].set) {\n            node[key] = attributes[key];\n        }\n        else {\n            attr(node, key, attributes[key]);\n        }\n    }\n}\nfunction set_svg_attributes(node, attributes) {\n    for (const key in attributes) {\n        attr(node, key, attributes[key]);\n    }\n}\nfunction set_custom_element_data(node, prop, value) {\n    if (prop in node) {\n        node[prop] = typeof node[prop] === 'boolean' && value === '' ? true : value;\n    }\n    else {\n        attr(node, prop, value);\n    }\n}\nfunction xlink_attr(node, attribute, value) {\n    node.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\nfunction get_binding_group_value(group, __value, checked) {\n    const value = new Set();\n    for (let i = 0; i < group.length; i += 1) {\n        if (group[i].checked)\n            value.add(group[i].__value);\n    }\n    if (!checked) {\n        value.delete(__value);\n    }\n    return Array.from(value);\n}\nfunction to_number(value) {\n    return value === '' ? null : +value;\n}\nfunction time_ranges_to_array(ranges) {\n    const array = [];\n    for (let i = 0; i < ranges.length; i += 1) {\n        array.push({ start: ranges.start(i), end: ranges.end(i) });\n    }\n    return array;\n}\nfunction children(element) {\n    return Array.from(element.childNodes);\n}\nfunction init_claim_info(nodes) {\n    if (nodes.claim_info === undefined) {\n        nodes.claim_info = { last_index: 0, total_claimed: 0 };\n    }\n}\nfunction claim_node(nodes, predicate, processNode, createNode, dontUpdateLastIndex = false) {\n    // Try to find nodes in an order such that we lengthen the longest increasing subsequence\n    init_claim_info(nodes);\n    const resultNode = (() => {\n        // We first try to find an element after the previous one\n        for (let i = nodes.claim_info.last_index; i < nodes.length; i++) {\n            const node = nodes[i];\n            if (predicate(node)) {\n                const replacement = processNode(node);\n                if (replacement === undefined) {\n                    nodes.splice(i, 1);\n                }\n                else {\n                    nodes[i] = replacement;\n                }\n                if (!dontUpdateLastIndex) {\n                    nodes.claim_info.last_index = i;\n                }\n                return node;\n            }\n        }\n        // Otherwise, we try to find one before\n        // We iterate in reverse so that we don't go too far back\n        for (let i = nodes.claim_info.last_index - 1; i >= 0; i--) {\n            const node = nodes[i];\n            if (predicate(node)) {\n                const replacement = processNode(node);\n                if (replacement === undefined) {\n                    nodes.splice(i, 1);\n                }\n                else {\n                    nodes[i] = replacement;\n                }\n                if (!dontUpdateLastIndex) {\n                    nodes.claim_info.last_index = i;\n                }\n                else if (replacement === undefined) {\n                    // Since we spliced before the last_index, we decrease it\n                    nodes.claim_info.last_index--;\n                }\n                return node;\n            }\n        }\n        // If we can't find any matching node, we create a new one\n        return createNode();\n    })();\n    resultNode.claim_order = nodes.claim_info.total_claimed;\n    nodes.claim_info.total_claimed += 1;\n    return resultNode;\n}\nfunction claim_element(nodes, name, attributes, svg) {\n    return claim_node(nodes, (node) => node.nodeName === name, (node) => {\n        const remove = [];\n        for (let j = 0; j < node.attributes.length; j++) {\n            const attribute = node.attributes[j];\n            if (!attributes[attribute.name]) {\n                remove.push(attribute.name);\n            }\n        }\n        remove.forEach(v => node.removeAttribute(v));\n        return undefined;\n    }, () => svg ? svg_element(name) : element(name));\n}\nfunction claim_text(nodes, data) {\n    return claim_node(nodes, (node) => node.nodeType === 3, (node) => {\n        const dataStr = '' + data;\n        if (node.data.startsWith(dataStr)) {\n            if (node.data.length !== dataStr.length) {\n                return node.splitText(dataStr.length);\n            }\n        }\n        else {\n            node.data = dataStr;\n        }\n    }, () => text(data), true // Text nodes should not update last index since it is likely not worth it to eliminate an increasing subsequence of actual elements\n    );\n}\nfunction claim_space(nodes) {\n    return claim_text(nodes, ' ');\n}\nfunction find_comment(nodes, text, start) {\n    for (let i = start; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeType === 8 /* comment node */ && node.textContent.trim() === text) {\n            return i;\n        }\n    }\n    return nodes.length;\n}\nfunction claim_html_tag(nodes) {\n    // find html opening tag\n    const start_index = find_comment(nodes, 'HTML_TAG_START', 0);\n    const end_index = find_comment(nodes, 'HTML_TAG_END', start_index);\n    if (start_index === end_index) {\n        return new HtmlTagHydration();\n    }\n    init_claim_info(nodes);\n    const html_tag_nodes = nodes.splice(start_index, end_index + 1);\n    detach(html_tag_nodes[0]);\n    detach(html_tag_nodes[html_tag_nodes.length - 1]);\n    const claimed_nodes = html_tag_nodes.slice(1, html_tag_nodes.length - 1);\n    for (const n of claimed_nodes) {\n        n.claim_order = nodes.claim_info.total_claimed;\n        nodes.claim_info.total_claimed += 1;\n    }\n    return new HtmlTagHydration(claimed_nodes);\n}\nfunction set_data(text, data) {\n    data = '' + data;\n    if (text.wholeText !== data)\n        text.data = data;\n}\nfunction set_input_value(input, value) {\n    input.value = value == null ? '' : value;\n}\nfunction set_input_type(input, type) {\n    try {\n        input.type = type;\n    }\n    catch (e) {\n        // do nothing\n    }\n}\nfunction set_style(node, key, value, important) {\n    node.style.setProperty(key, value, important ? 'important' : '');\n}\nfunction select_option(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        if (option.__value === value) {\n            option.selected = true;\n            return;\n        }\n    }\n}\nfunction select_options(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        option.selected = ~value.indexOf(option.__value);\n    }\n}\nfunction select_value(select) {\n    const selected_option = select.querySelector(':checked') || select.options[0];\n    return selected_option && selected_option.__value;\n}\nfunction select_multiple_value(select) {\n    return [].map.call(select.querySelectorAll(':checked'), option => option.__value);\n}\n// unfortunately this can't be a constant as that wouldn't be tree-shakeable\n// so we cache the result instead\nlet crossorigin;\nfunction is_crossorigin() {\n    if (crossorigin === undefined) {\n        crossorigin = false;\n        try {\n            if (typeof window !== 'undefined' && window.parent) {\n                void window.parent.document;\n            }\n        }\n        catch (error) {\n            crossorigin = true;\n        }\n    }\n    return crossorigin;\n}\nfunction add_resize_listener(node, fn) {\n    const computed_style = getComputedStyle(node);\n    if (computed_style.position === 'static') {\n        node.style.position = 'relative';\n    }\n    const iframe = element('iframe');\n    iframe.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; ' +\n        'overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;');\n    iframe.setAttribute('aria-hidden', 'true');\n    iframe.tabIndex = -1;\n    const crossorigin = is_crossorigin();\n    let unsubscribe;\n    if (crossorigin) {\n        iframe.src = \"data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}</script>\";\n        unsubscribe = listen(window, 'message', (event) => {\n            if (event.source === iframe.contentWindow)\n                fn();\n        });\n    }\n    else {\n        iframe.src = 'about:blank';\n        iframe.onload = () => {\n            unsubscribe = listen(iframe.contentWindow, 'resize', fn);\n        };\n    }\n    append(node, iframe);\n    return () => {\n        if (crossorigin) {\n            unsubscribe();\n        }\n        else if (unsubscribe && iframe.contentWindow) {\n            unsubscribe();\n        }\n        detach(iframe);\n    };\n}\nfunction toggle_class(element, name, toggle) {\n    element.classList[toggle ? 'add' : 'remove'](name);\n}\nfunction custom_event(type, detail, bubbles = false) {\n    const e = document.createEvent('CustomEvent');\n    e.initCustomEvent(type, bubbles, false, detail);\n    return e;\n}\nfunction query_selector_all(selector, parent = document.body) {\n    return Array.from(parent.querySelectorAll(selector));\n}\nclass HtmlTag {\n    constructor() {\n        this.e = this.n = null;\n    }\n    c(html) {\n        this.h(html);\n    }\n    m(html, target, anchor = null) {\n        if (!this.e) {\n            this.e = element(target.nodeName);\n            this.t = target;\n            this.c(html);\n        }\n        this.i(anchor);\n    }\n    h(html) {\n        this.e.innerHTML = html;\n        this.n = Array.from(this.e.childNodes);\n    }\n    i(anchor) {\n        for (let i = 0; i < this.n.length; i += 1) {\n            insert(this.t, this.n[i], anchor);\n        }\n    }\n    p(html) {\n        this.d();\n        this.h(html);\n        this.i(this.a);\n    }\n    d() {\n        this.n.forEach(detach);\n    }\n}\nclass HtmlTagHydration extends HtmlTag {\n    constructor(claimed_nodes) {\n        super();\n        this.e = this.n = null;\n        this.l = claimed_nodes;\n    }\n    c(html) {\n        if (this.l) {\n            this.n = this.l;\n        }\n        else {\n            super.c(html);\n        }\n    }\n    i(anchor) {\n        for (let i = 0; i < this.n.length; i += 1) {\n            insert_hydration(this.t, this.n[i], anchor);\n        }\n    }\n}\nfunction attribute_to_object(attributes) {\n    const result = {};\n    for (const attribute of attributes) {\n        result[attribute.name] = attribute.value;\n    }\n    return result;\n}\nfunction get_custom_elements_slots(element) {\n    const result = {};\n    element.childNodes.forEach((node) => {\n        result[node.slot || 'default'] = true;\n    });\n    return result;\n}\n\nconst active_docs = new Set();\nlet active = 0;\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n    let hash = 5381;\n    let i = str.length;\n    while (i--)\n        hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\n    const step = 16.666 / duration;\n    let keyframes = '{\\n';\n    for (let p = 0; p <= 1; p += step) {\n        const t = a + (b - a) * ease(p);\n        keyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n    }\n    const rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n    const name = `__svelte_${hash(rule)}_${uid}`;\n    const doc = get_root_for_style(node);\n    active_docs.add(doc);\n    const stylesheet = doc.__svelte_stylesheet || (doc.__svelte_stylesheet = append_empty_stylesheet(node).sheet);\n    const current_rules = doc.__svelte_rules || (doc.__svelte_rules = {});\n    if (!current_rules[name]) {\n        current_rules[name] = true;\n        stylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\n    }\n    const animation = node.style.animation || '';\n    node.style.animation = `${animation ? `${animation}, ` : ''}${name} ${duration}ms linear ${delay}ms 1 both`;\n    active += 1;\n    return name;\n}\nfunction delete_rule(node, name) {\n    const previous = (node.style.animation || '').split(', ');\n    const next = previous.filter(name\n        ? anim => anim.indexOf(name) < 0 // remove specific animation\n        : anim => anim.indexOf('__svelte') === -1 // remove all Svelte animations\n    );\n    const deleted = previous.length - next.length;\n    if (deleted) {\n        node.style.animation = next.join(', ');\n        active -= deleted;\n        if (!active)\n            clear_rules();\n    }\n}\nfunction clear_rules() {\n    raf(() => {\n        if (active)\n            return;\n        active_docs.forEach(doc => {\n            const stylesheet = doc.__svelte_stylesheet;\n            let i = stylesheet.cssRules.length;\n            while (i--)\n                stylesheet.deleteRule(i);\n            doc.__svelte_rules = {};\n        });\n        active_docs.clear();\n    });\n}\n\nfunction create_animation(node, from, fn, params) {\n    if (!from)\n        return noop;\n    const to = node.getBoundingClientRect();\n    if (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom)\n        return noop;\n    const { delay = 0, duration = 300, easing = identity, \n    // @ts-ignore todo: should this be separated from destructuring? Or start/end added to public api and documentation?\n    start: start_time = now() + delay, \n    // @ts-ignore todo:\n    end = start_time + duration, tick = noop, css } = fn(node, { from, to }, params);\n    let running = true;\n    let started = false;\n    let name;\n    function start() {\n        if (css) {\n            name = create_rule(node, 0, 1, duration, delay, easing, css);\n        }\n        if (!delay) {\n            started = true;\n        }\n    }\n    function stop() {\n        if (css)\n            delete_rule(node, name);\n        running = false;\n    }\n    loop(now => {\n        if (!started && now >= start_time) {\n            started = true;\n        }\n        if (started && now >= end) {\n            tick(1, 0);\n            stop();\n        }\n        if (!running) {\n            return false;\n        }\n        if (started) {\n            const p = now - start_time;\n            const t = 0 + 1 * easing(p / duration);\n            tick(t, 1 - t);\n        }\n        return true;\n    });\n    start();\n    tick(0, 1);\n    return stop;\n}\nfunction fix_position(node) {\n    const style = getComputedStyle(node);\n    if (style.position !== 'absolute' && style.position !== 'fixed') {\n        const { width, height } = style;\n        const a = node.getBoundingClientRect();\n        node.style.position = 'absolute';\n        node.style.width = width;\n        node.style.height = height;\n        add_transform(node, a);\n    }\n}\nfunction add_transform(node, a) {\n    const b = node.getBoundingClientRect();\n    if (a.left !== b.left || a.top !== b.top) {\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        node.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n    }\n}\n\nlet current_component;\nfunction set_current_component(component) {\n    current_component = component;\n}\nfunction get_current_component() {\n    if (!current_component)\n        throw new Error('Function called outside component initialization');\n    return current_component;\n}\nfunction beforeUpdate(fn) {\n    get_current_component().$$.before_update.push(fn);\n}\nfunction onMount(fn) {\n    get_current_component().$$.on_mount.push(fn);\n}\nfunction afterUpdate(fn) {\n    get_current_component().$$.after_update.push(fn);\n}\nfunction onDestroy(fn) {\n    get_current_component().$$.on_destroy.push(fn);\n}\nfunction createEventDispatcher() {\n    const component = get_current_component();\n    return (type, detail) => {\n        const callbacks = component.$$.callbacks[type];\n        if (callbacks) {\n            // TODO are there situations where events could be dispatched\n            // in a server (non-DOM) environment?\n            const event = custom_event(type, detail);\n            callbacks.slice().forEach(fn => {\n                fn.call(component, event);\n            });\n        }\n    };\n}\nfunction setContext(key, context) {\n    get_current_component().$$.context.set(key, context);\n}\nfunction getContext(key) {\n    return get_current_component().$$.context.get(key);\n}\nfunction getAllContexts() {\n    return get_current_component().$$.context;\n}\nfunction hasContext(key) {\n    return get_current_component().$$.context.has(key);\n}\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\nfunction bubble(component, event) {\n    const callbacks = component.$$.callbacks[event.type];\n    if (callbacks) {\n        // @ts-ignore\n        callbacks.slice().forEach(fn => fn.call(this, event));\n    }\n}\n\nconst dirty_components = [];\nconst intros = { enabled: false };\nconst binding_callbacks = [];\nconst render_callbacks = [];\nconst flush_callbacks = [];\nconst resolved_promise = Promise.resolve();\nlet update_scheduled = false;\nfunction schedule_update() {\n    if (!update_scheduled) {\n        update_scheduled = true;\n        resolved_promise.then(flush);\n    }\n}\nfunction tick() {\n    schedule_update();\n    return resolved_promise;\n}\nfunction add_render_callback(fn) {\n    render_callbacks.push(fn);\n}\nfunction add_flush_callback(fn) {\n    flush_callbacks.push(fn);\n}\nlet flushing = false;\nconst seen_callbacks = new Set();\nfunction flush() {\n    if (flushing)\n        return;\n    flushing = true;\n    do {\n        // first, call beforeUpdate functions\n        // and update components\n        for (let i = 0; i < dirty_components.length; i += 1) {\n            const component = dirty_components[i];\n            set_current_component(component);\n            update(component.$$);\n        }\n        set_current_component(null);\n        dirty_components.length = 0;\n        while (binding_callbacks.length)\n            binding_callbacks.pop()();\n        // then, once components are updated, call\n        // afterUpdate functions. This may cause\n        // subsequent updates...\n        for (let i = 0; i < render_callbacks.length; i += 1) {\n            const callback = render_callbacks[i];\n            if (!seen_callbacks.has(callback)) {\n                // ...so guard against infinite loops\n                seen_callbacks.add(callback);\n                callback();\n            }\n        }\n        render_callbacks.length = 0;\n    } while (dirty_components.length);\n    while (flush_callbacks.length) {\n        flush_callbacks.pop()();\n    }\n    update_scheduled = false;\n    flushing = false;\n    seen_callbacks.clear();\n}\nfunction update($$) {\n    if ($$.fragment !== null) {\n        $$.update();\n        run_all($$.before_update);\n        const dirty = $$.dirty;\n        $$.dirty = [-1];\n        $$.fragment && $$.fragment.p($$.ctx, dirty);\n        $$.after_update.forEach(add_render_callback);\n    }\n}\n\nlet promise;\nfunction wait() {\n    if (!promise) {\n        promise = Promise.resolve();\n        promise.then(() => {\n            promise = null;\n        });\n    }\n    return promise;\n}\nfunction dispatch(node, direction, kind) {\n    node.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\nconst outroing = new Set();\nlet outros;\nfunction group_outros() {\n    outros = {\n        r: 0,\n        c: [],\n        p: outros // parent group\n    };\n}\nfunction check_outros() {\n    if (!outros.r) {\n        run_all(outros.c);\n    }\n    outros = outros.p;\n}\nfunction transition_in(block, local) {\n    if (block && block.i) {\n        outroing.delete(block);\n        block.i(local);\n    }\n}\nfunction transition_out(block, local, detach, callback) {\n    if (block && block.o) {\n        if (outroing.has(block))\n            return;\n        outroing.add(block);\n        outros.c.push(() => {\n            outroing.delete(block);\n            if (callback) {\n                if (detach)\n                    block.d(1);\n                callback();\n            }\n        });\n        block.o(local);\n    }\n}\nconst null_transition = { duration: 0 };\nfunction create_in_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = false;\n    let animation_name;\n    let task;\n    let uid = 0;\n    function cleanup() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n        tick(0, 1);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        if (task)\n            task.abort();\n        running = true;\n        add_render_callback(() => dispatch(node, true, 'start'));\n        task = loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(1, 0);\n                    dispatch(node, true, 'end');\n                    cleanup();\n                    return running = false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(t, 1 - t);\n                }\n            }\n            return running;\n        });\n    }\n    let started = false;\n    return {\n        start() {\n            if (started)\n                return;\n            started = true;\n            delete_rule(node);\n            if (is_function(config)) {\n                config = config();\n                wait().then(go);\n            }\n            else {\n                go();\n            }\n        },\n        invalidate() {\n            started = false;\n        },\n        end() {\n            if (running) {\n                cleanup();\n                running = false;\n            }\n        }\n    };\n}\nfunction create_out_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = true;\n    let animation_name;\n    const group = outros;\n    group.r += 1;\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        add_render_callback(() => dispatch(node, false, 'start'));\n        loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(0, 1);\n                    dispatch(node, false, 'end');\n                    if (!--group.r) {\n                        // this will result in `end()` being called,\n                        // so we don't need to clean up here\n                        run_all(group.c);\n                    }\n                    return false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(1 - t, t);\n                }\n            }\n            return running;\n        });\n    }\n    if (is_function(config)) {\n        wait().then(() => {\n            // @ts-ignore\n            config = config();\n            go();\n        });\n    }\n    else {\n        go();\n    }\n    return {\n        end(reset) {\n            if (reset && config.tick) {\n                config.tick(1, 0);\n            }\n            if (running) {\n                if (animation_name)\n                    delete_rule(node, animation_name);\n                running = false;\n            }\n        }\n    };\n}\nfunction create_bidirectional_transition(node, fn, params, intro) {\n    let config = fn(node, params);\n    let t = intro ? 0 : 1;\n    let running_program = null;\n    let pending_program = null;\n    let animation_name = null;\n    function clear_animation() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function init(program, duration) {\n        const d = (program.b - t);\n        duration *= Math.abs(d);\n        return {\n            a: t,\n            b: program.b,\n            d,\n            duration,\n            start: program.start,\n            end: program.start + duration,\n            group: program.group\n        };\n    }\n    function go(b) {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        const program = {\n            start: now() + delay,\n            b\n        };\n        if (!b) {\n            // @ts-ignore todo: improve typings\n            program.group = outros;\n            outros.r += 1;\n        }\n        if (running_program || pending_program) {\n            pending_program = program;\n        }\n        else {\n            // if this is an intro, and there's a delay, we need to do\n            // an initial tick and/or apply CSS animation immediately\n            if (css) {\n                clear_animation();\n                animation_name = create_rule(node, t, b, duration, delay, easing, css);\n            }\n            if (b)\n                tick(0, 1);\n            running_program = init(program, duration);\n            add_render_callback(() => dispatch(node, b, 'start'));\n            loop(now => {\n                if (pending_program && now > pending_program.start) {\n                    running_program = init(pending_program, duration);\n                    pending_program = null;\n                    dispatch(node, running_program.b, 'start');\n                    if (css) {\n                        clear_animation();\n                        animation_name = create_rule(node, t, running_program.b, running_program.duration, 0, easing, config.css);\n                    }\n                }\n                if (running_program) {\n                    if (now >= running_program.end) {\n                        tick(t = running_program.b, 1 - t);\n                        dispatch(node, running_program.b, 'end');\n                        if (!pending_program) {\n                            // we're done\n                            if (running_program.b) {\n                                // intro — we can tidy up immediately\n                                clear_animation();\n                            }\n                            else {\n                                // outro — needs to be coordinated\n                                if (!--running_program.group.r)\n                                    run_all(running_program.group.c);\n                            }\n                        }\n                        running_program = null;\n                    }\n                    else if (now >= running_program.start) {\n                        const p = now - running_program.start;\n                        t = running_program.a + running_program.d * easing(p / running_program.duration);\n                        tick(t, 1 - t);\n                    }\n                }\n                return !!(running_program || pending_program);\n            });\n        }\n    }\n    return {\n        run(b) {\n            if (is_function(config)) {\n                wait().then(() => {\n                    // @ts-ignore\n                    config = config();\n                    go(b);\n                });\n            }\n            else {\n                go(b);\n            }\n        },\n        end() {\n            clear_animation();\n            running_program = pending_program = null;\n        }\n    };\n}\n\nfunction handle_promise(promise, info) {\n    const token = info.token = {};\n    function update(type, index, key, value) {\n        if (info.token !== token)\n            return;\n        info.resolved = value;\n        let child_ctx = info.ctx;\n        if (key !== undefined) {\n            child_ctx = child_ctx.slice();\n            child_ctx[key] = value;\n        }\n        const block = type && (info.current = type)(child_ctx);\n        let needs_flush = false;\n        if (info.block) {\n            if (info.blocks) {\n                info.blocks.forEach((block, i) => {\n                    if (i !== index && block) {\n                        group_outros();\n                        transition_out(block, 1, 1, () => {\n                            if (info.blocks[i] === block) {\n                                info.blocks[i] = null;\n                            }\n                        });\n                        check_outros();\n                    }\n                });\n            }\n            else {\n                info.block.d(1);\n            }\n            block.c();\n            transition_in(block, 1);\n            block.m(info.mount(), info.anchor);\n            needs_flush = true;\n        }\n        info.block = block;\n        if (info.blocks)\n            info.blocks[index] = block;\n        if (needs_flush) {\n            flush();\n        }\n    }\n    if (is_promise(promise)) {\n        const current_component = get_current_component();\n        promise.then(value => {\n            set_current_component(current_component);\n            update(info.then, 1, info.value, value);\n            set_current_component(null);\n        }, error => {\n            set_current_component(current_component);\n            update(info.catch, 2, info.error, error);\n            set_current_component(null);\n            if (!info.hasCatch) {\n                throw error;\n            }\n        });\n        // if we previously had a then/catch block, destroy it\n        if (info.current !== info.pending) {\n            update(info.pending, 0);\n            return true;\n        }\n    }\n    else {\n        if (info.current !== info.then) {\n            update(info.then, 1, info.value, promise);\n            return true;\n        }\n        info.resolved = promise;\n    }\n}\nfunction update_await_block_branch(info, ctx, dirty) {\n    const child_ctx = ctx.slice();\n    const { resolved } = info;\n    if (info.current === info.then) {\n        child_ctx[info.value] = resolved;\n    }\n    if (info.current === info.catch) {\n        child_ctx[info.error] = resolved;\n    }\n    info.block.p(child_ctx, dirty);\n}\n\nconst globals = (typeof window !== 'undefined'\n    ? window\n    : typeof globalThis !== 'undefined'\n        ? globalThis\n        : global);\n\nfunction destroy_block(block, lookup) {\n    block.d(1);\n    lookup.delete(block.key);\n}\nfunction outro_and_destroy_block(block, lookup) {\n    transition_out(block, 1, 1, () => {\n        lookup.delete(block.key);\n    });\n}\nfunction fix_and_destroy_block(block, lookup) {\n    block.f();\n    destroy_block(block, lookup);\n}\nfunction fix_and_outro_and_destroy_block(block, lookup) {\n    block.f();\n    outro_and_destroy_block(block, lookup);\n}\nfunction update_keyed_each(old_blocks, dirty, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, next, get_context) {\n    let o = old_blocks.length;\n    let n = list.length;\n    let i = o;\n    const old_indexes = {};\n    while (i--)\n        old_indexes[old_blocks[i].key] = i;\n    const new_blocks = [];\n    const new_lookup = new Map();\n    const deltas = new Map();\n    i = n;\n    while (i--) {\n        const child_ctx = get_context(ctx, list, i);\n        const key = get_key(child_ctx);\n        let block = lookup.get(key);\n        if (!block) {\n            block = create_each_block(key, child_ctx);\n            block.c();\n        }\n        else if (dynamic) {\n            block.p(child_ctx, dirty);\n        }\n        new_lookup.set(key, new_blocks[i] = block);\n        if (key in old_indexes)\n            deltas.set(key, Math.abs(i - old_indexes[key]));\n    }\n    const will_move = new Set();\n    const did_move = new Set();\n    function insert(block) {\n        transition_in(block, 1);\n        block.m(node, next);\n        lookup.set(block.key, block);\n        next = block.first;\n        n--;\n    }\n    while (o && n) {\n        const new_block = new_blocks[n - 1];\n        const old_block = old_blocks[o - 1];\n        const new_key = new_block.key;\n        const old_key = old_block.key;\n        if (new_block === old_block) {\n            // do nothing\n            next = new_block.first;\n            o--;\n            n--;\n        }\n        else if (!new_lookup.has(old_key)) {\n            // remove old block\n            destroy(old_block, lookup);\n            o--;\n        }\n        else if (!lookup.has(new_key) || will_move.has(new_key)) {\n            insert(new_block);\n        }\n        else if (did_move.has(old_key)) {\n            o--;\n        }\n        else if (deltas.get(new_key) > deltas.get(old_key)) {\n            did_move.add(new_key);\n            insert(new_block);\n        }\n        else {\n            will_move.add(old_key);\n            o--;\n        }\n    }\n    while (o--) {\n        const old_block = old_blocks[o];\n        if (!new_lookup.has(old_block.key))\n            destroy(old_block, lookup);\n    }\n    while (n)\n        insert(new_blocks[n - 1]);\n    return new_blocks;\n}\nfunction validate_each_keys(ctx, list, get_context, get_key) {\n    const keys = new Set();\n    for (let i = 0; i < list.length; i++) {\n        const key = get_key(get_context(ctx, list, i));\n        if (keys.has(key)) {\n            throw new Error('Cannot have duplicate keys in a keyed each');\n        }\n        keys.add(key);\n    }\n}\n\nfunction get_spread_update(levels, updates) {\n    const update = {};\n    const to_null_out = {};\n    const accounted_for = { $$scope: 1 };\n    let i = levels.length;\n    while (i--) {\n        const o = levels[i];\n        const n = updates[i];\n        if (n) {\n            for (const key in o) {\n                if (!(key in n))\n                    to_null_out[key] = 1;\n            }\n            for (const key in n) {\n                if (!accounted_for[key]) {\n                    update[key] = n[key];\n                    accounted_for[key] = 1;\n                }\n            }\n            levels[i] = n;\n        }\n        else {\n            for (const key in o) {\n                accounted_for[key] = 1;\n            }\n        }\n    }\n    for (const key in to_null_out) {\n        if (!(key in update))\n            update[key] = undefined;\n    }\n    return update;\n}\nfunction get_spread_object(spread_props) {\n    return typeof spread_props === 'object' && spread_props !== null ? spread_props : {};\n}\n\n// source: https://html.spec.whatwg.org/multipage/indices.html\nconst boolean_attributes = new Set([\n    'allowfullscreen',\n    'allowpaymentrequest',\n    'async',\n    'autofocus',\n    'autoplay',\n    'checked',\n    'controls',\n    'default',\n    'defer',\n    'disabled',\n    'formnovalidate',\n    'hidden',\n    'ismap',\n    'loop',\n    'multiple',\n    'muted',\n    'nomodule',\n    'novalidate',\n    'open',\n    'playsinline',\n    'readonly',\n    'required',\n    'reversed',\n    'selected'\n]);\n\nconst invalid_attribute_name_character = /[\\s'\">/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nfunction spread(args, classes_to_add) {\n    const attributes = Object.assign({}, ...args);\n    if (classes_to_add) {\n        if (attributes.class == null) {\n            attributes.class = classes_to_add;\n        }\n        else {\n            attributes.class += ' ' + classes_to_add;\n        }\n    }\n    let str = '';\n    Object.keys(attributes).forEach(name => {\n        if (invalid_attribute_name_character.test(name))\n            return;\n        const value = attributes[name];\n        if (value === true)\n            str += ' ' + name;\n        else if (boolean_attributes.has(name.toLowerCase())) {\n            if (value)\n                str += ' ' + name;\n        }\n        else if (value != null) {\n            str += ` ${name}=\"${value}\"`;\n        }\n    });\n    return str;\n}\nconst escaped = {\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;'\n};\nfunction escape(html) {\n    return String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\nfunction escape_attribute_value(value) {\n    return typeof value === 'string' ? escape(value) : value;\n}\nfunction escape_object(obj) {\n    const result = {};\n    for (const key in obj) {\n        result[key] = escape_attribute_value(obj[key]);\n    }\n    return result;\n}\nfunction each(items, fn) {\n    let str = '';\n    for (let i = 0; i < items.length; i += 1) {\n        str += fn(items[i], i);\n    }\n    return str;\n}\nconst missing_component = {\n    $$render: () => ''\n};\nfunction validate_component(component, name) {\n    if (!component || !component.$$render) {\n        if (name === 'svelte:component')\n            name += ' this={...}';\n        throw new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n    }\n    return component;\n}\nfunction debug(file, line, column, values) {\n    console.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`); // eslint-disable-line no-console\n    console.log(values); // eslint-disable-line no-console\n    return '';\n}\nlet on_destroy;\nfunction create_ssr_component(fn) {\n    function $$render(result, props, bindings, slots, context) {\n        const parent_component = current_component;\n        const $$ = {\n            on_destroy,\n            context: new Map(parent_component ? parent_component.$$.context : context || []),\n            // these will be immediately discarded\n            on_mount: [],\n            before_update: [],\n            after_update: [],\n            callbacks: blank_object()\n        };\n        set_current_component({ $$ });\n        const html = fn(result, props, bindings, slots);\n        set_current_component(parent_component);\n        return html;\n    }\n    return {\n        render: (props = {}, { $$slots = {}, context = new Map() } = {}) => {\n            on_destroy = [];\n            const result = { title: '', head: '', css: new Set() };\n            const html = $$render(result, props, {}, $$slots, context);\n            run_all(on_destroy);\n            return {\n                html,\n                css: {\n                    code: Array.from(result.css).map(css => css.code).join('\\n'),\n                    map: null // TODO\n                },\n                head: result.title + result.head\n            };\n        },\n        $$render\n    };\n}\nfunction add_attribute(name, value, boolean) {\n    if (value == null || (boolean && !value))\n        return '';\n    return ` ${name}${value === true ? '' : `=${typeof value === 'string' ? JSON.stringify(escape(value)) : `\"${value}\"`}`}`;\n}\nfunction add_classes(classes) {\n    return classes ? ` class=\"${classes}\"` : '';\n}\n\nfunction bind(component, name, callback) {\n    const index = component.$$.props[name];\n    if (index !== undefined) {\n        component.$$.bound[index] = callback;\n        callback(component.$$.ctx[index]);\n    }\n}\nfunction create_component(block) {\n    block && block.c();\n}\nfunction claim_component(block, parent_nodes) {\n    block && block.l(parent_nodes);\n}\nfunction mount_component(component, target, anchor, customElement) {\n    const { fragment, on_mount, on_destroy, after_update } = component.$$;\n    fragment && fragment.m(target, anchor);\n    if (!customElement) {\n        // onMount happens before the initial afterUpdate\n        add_render_callback(() => {\n            const new_on_destroy = on_mount.map(run).filter(is_function);\n            if (on_destroy) {\n                on_destroy.push(...new_on_destroy);\n            }\n            else {\n                // Edge case - component was destroyed immediately,\n                // most likely as a result of a binding initialising\n                run_all(new_on_destroy);\n            }\n            component.$$.on_mount = [];\n        });\n    }\n    after_update.forEach(add_render_callback);\n}\nfunction destroy_component(component, detaching) {\n    const $$ = component.$$;\n    if ($$.fragment !== null) {\n        run_all($$.on_destroy);\n        $$.fragment && $$.fragment.d(detaching);\n        // TODO null out other refs, including component.$$ (but need to\n        // preserve final state?)\n        $$.on_destroy = $$.fragment = null;\n        $$.ctx = [];\n    }\n}\nfunction make_dirty(component, i) {\n    if (component.$$.dirty[0] === -1) {\n        dirty_components.push(component);\n        schedule_update();\n        component.$$.dirty.fill(0);\n    }\n    component.$$.dirty[(i / 31) | 0] |= (1 << (i % 31));\n}\nfunction init(component, options, instance, create_fragment, not_equal, props, append_styles, dirty = [-1]) {\n    const parent_component = current_component;\n    set_current_component(component);\n    const $$ = component.$$ = {\n        fragment: null,\n        ctx: null,\n        // state\n        props,\n        update: noop,\n        not_equal,\n        bound: blank_object(),\n        // lifecycle\n        on_mount: [],\n        on_destroy: [],\n        on_disconnect: [],\n        before_update: [],\n        after_update: [],\n        context: new Map(parent_component ? parent_component.$$.context : options.context || []),\n        // everything else\n        callbacks: blank_object(),\n        dirty,\n        skip_bound: false,\n        root: options.target || parent_component.$$.root\n    };\n    append_styles && append_styles($$.root);\n    let ready = false;\n    $$.ctx = instance\n        ? instance(component, options.props || {}, (i, ret, ...rest) => {\n            const value = rest.length ? rest[0] : ret;\n            if ($$.ctx && not_equal($$.ctx[i], $$.ctx[i] = value)) {\n                if (!$$.skip_bound && $$.bound[i])\n                    $$.bound[i](value);\n                if (ready)\n                    make_dirty(component, i);\n            }\n            return ret;\n        })\n        : [];\n    $$.update();\n    ready = true;\n    run_all($$.before_update);\n    // `false` as a special case of no DOM component\n    $$.fragment = create_fragment ? create_fragment($$.ctx) : false;\n    if (options.target) {\n        if (options.hydrate) {\n            start_hydrating();\n            const nodes = children(options.target);\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.l(nodes);\n            nodes.forEach(detach);\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.c();\n        }\n        if (options.intro)\n            transition_in(component.$$.fragment);\n        mount_component(component, options.target, options.anchor, options.customElement);\n        end_hydrating();\n        flush();\n    }\n    set_current_component(parent_component);\n}\nlet SvelteElement;\nif (typeof HTMLElement === 'function') {\n    SvelteElement = class extends HTMLElement {\n        constructor() {\n            super();\n            this.attachShadow({ mode: 'open' });\n        }\n        connectedCallback() {\n            const { on_mount } = this.$$;\n            this.$$.on_disconnect = on_mount.map(run).filter(is_function);\n            // @ts-ignore todo: improve typings\n            for (const key in this.$$.slotted) {\n                // @ts-ignore todo: improve typings\n                this.appendChild(this.$$.slotted[key]);\n            }\n        }\n        attributeChangedCallback(attr, _oldValue, newValue) {\n            this[attr] = newValue;\n        }\n        disconnectedCallback() {\n            run_all(this.$$.on_disconnect);\n        }\n        $destroy() {\n            destroy_component(this, 1);\n            this.$destroy = noop;\n        }\n        $on(type, callback) {\n            // TODO should this delegate to addEventListener?\n            const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n            callbacks.push(callback);\n            return () => {\n                const index = callbacks.indexOf(callback);\n                if (index !== -1)\n                    callbacks.splice(index, 1);\n            };\n        }\n        $set($$props) {\n            if (this.$$set && !is_empty($$props)) {\n                this.$$.skip_bound = true;\n                this.$$set($$props);\n                this.$$.skip_bound = false;\n            }\n        }\n    };\n}\n/**\n * Base class for Svelte components. Used when dev=false.\n */\nclass SvelteComponent {\n    $destroy() {\n        destroy_component(this, 1);\n        this.$destroy = noop;\n    }\n    $on(type, callback) {\n        const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n        callbacks.push(callback);\n        return () => {\n            const index = callbacks.indexOf(callback);\n            if (index !== -1)\n                callbacks.splice(index, 1);\n        };\n    }\n    $set($$props) {\n        if (this.$$set && !is_empty($$props)) {\n            this.$$.skip_bound = true;\n            this.$$set($$props);\n            this.$$.skip_bound = false;\n        }\n    }\n}\n\nfunction dispatch_dev(type, detail) {\n    document.dispatchEvent(custom_event(type, Object.assign({ version: '3.42.1' }, detail), true));\n}\nfunction append_dev(target, node) {\n    dispatch_dev('SvelteDOMInsert', { target, node });\n    append(target, node);\n}\nfunction append_hydration_dev(target, node) {\n    dispatch_dev('SvelteDOMInsert', { target, node });\n    append_hydration(target, node);\n}\nfunction insert_dev(target, node, anchor) {\n    dispatch_dev('SvelteDOMInsert', { target, node, anchor });\n    insert(target, node, anchor);\n}\nfunction insert_hydration_dev(target, node, anchor) {\n    dispatch_dev('SvelteDOMInsert', { target, node, anchor });\n    insert_hydration(target, node, anchor);\n}\nfunction detach_dev(node) {\n    dispatch_dev('SvelteDOMRemove', { node });\n    detach(node);\n}\nfunction detach_between_dev(before, after) {\n    while (before.nextSibling && before.nextSibling !== after) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction detach_before_dev(after) {\n    while (after.previousSibling) {\n        detach_dev(after.previousSibling);\n    }\n}\nfunction detach_after_dev(before) {\n    while (before.nextSibling) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction listen_dev(node, event, handler, options, has_prevent_default, has_stop_propagation) {\n    const modifiers = options === true ? ['capture'] : options ? Array.from(Object.keys(options)) : [];\n    if (has_prevent_default)\n        modifiers.push('preventDefault');\n    if (has_stop_propagation)\n        modifiers.push('stopPropagation');\n    dispatch_dev('SvelteDOMAddEventListener', { node, event, handler, modifiers });\n    const dispose = listen(node, event, handler, options);\n    return () => {\n        dispatch_dev('SvelteDOMRemoveEventListener', { node, event, handler, modifiers });\n        dispose();\n    };\n}\nfunction attr_dev(node, attribute, value) {\n    attr(node, attribute, value);\n    if (value == null)\n        dispatch_dev('SvelteDOMRemoveAttribute', { node, attribute });\n    else\n        dispatch_dev('SvelteDOMSetAttribute', { node, attribute, value });\n}\nfunction prop_dev(node, property, value) {\n    node[property] = value;\n    dispatch_dev('SvelteDOMSetProperty', { node, property, value });\n}\nfunction dataset_dev(node, property, value) {\n    node.dataset[property] = value;\n    dispatch_dev('SvelteDOMSetDataset', { node, property, value });\n}\nfunction set_data_dev(text, data) {\n    data = '' + data;\n    if (text.wholeText === data)\n        return;\n    dispatch_dev('SvelteDOMSetData', { node: text, data });\n    text.data = data;\n}\nfunction validate_each_argument(arg) {\n    if (typeof arg !== 'string' && !(arg && typeof arg === 'object' && 'length' in arg)) {\n        let msg = '{#each} only iterates over array-like objects.';\n        if (typeof Symbol === 'function' && arg && Symbol.iterator in arg) {\n            msg += ' You can use a spread to convert this iterable into an array.';\n        }\n        throw new Error(msg);\n    }\n}\nfunction validate_slots(name, slot, keys) {\n    for (const slot_key of Object.keys(slot)) {\n        if (!~keys.indexOf(slot_key)) {\n            console.warn(`<${name}> received an unexpected slot \"${slot_key}\".`);\n        }\n    }\n}\n/**\n * Base class for Svelte components with some minor dev-enhancements. Used when dev=true.\n */\nclass SvelteComponentDev extends SvelteComponent {\n    constructor(options) {\n        if (!options || (!options.target && !options.$$inline)) {\n            throw new Error(\"'target' is a required option\");\n        }\n        super();\n    }\n    $destroy() {\n        super.$destroy();\n        this.$destroy = () => {\n            console.warn('Component was already destroyed'); // eslint-disable-line no-console\n        };\n    }\n    $capture_state() { }\n    $inject_state() { }\n}\n/**\n * Base class to create strongly typed Svelte components.\n * This only exists for typing purposes and should be used in `.d.ts` files.\n *\n * ### Example:\n *\n * You have component library on npm called `component-library`, from which\n * you export a component called `MyComponent`. For Svelte+TypeScript users,\n * you want to provide typings. Therefore you create a `index.d.ts`:\n * ```ts\n * import { SvelteComponentTyped } from \"svelte\";\n * export class MyComponent extends SvelteComponentTyped<{foo: string}> {}\n * ```\n * Typing this makes it possible for IDEs like VS Code with the Svelte extension\n * to provide intellisense and to use the component like this in a Svelte file\n * with TypeScript:\n * ```svelte\n * <script lang=\"ts\">\n * \timport { MyComponent } from \"component-library\";\n * </script>\n * <MyComponent foo={'bar'} />\n * ```\n *\n * #### Why not make this part of `SvelteComponent(Dev)`?\n * Because\n * ```ts\n * class ASubclassOfSvelteComponent extends SvelteComponent<{foo: string}> {}\n * const component: typeof SvelteComponent = ASubclassOfSvelteComponent;\n * ```\n * will throw a type error, so we need to separate the more strictly typed class.\n */\nclass SvelteComponentTyped extends SvelteComponentDev {\n    constructor(options) {\n        super(options);\n    }\n}\nfunction loop_guard(timeout) {\n    const start = Date.now();\n    return () => {\n        if (Date.now() - start > timeout) {\n            throw new Error('Infinite loop detected');\n        }\n    };\n}\n\nexport { HtmlTag, HtmlTagHydration, SvelteComponent, SvelteComponentDev, SvelteComponentTyped, SvelteElement, action_destroyer, add_attribute, add_classes, add_flush_callback, add_location, add_render_callback, add_resize_listener, add_transform, afterUpdate, append, append_dev, append_empty_stylesheet, append_hydration, append_hydration_dev, append_styles, assign, attr, attr_dev, attribute_to_object, beforeUpdate, bind, binding_callbacks, blank_object, bubble, check_outros, children, claim_component, claim_element, claim_html_tag, claim_space, claim_text, clear_loops, component_subscribe, compute_rest_props, compute_slots, createEventDispatcher, create_animation, create_bidirectional_transition, create_component, create_in_transition, create_out_transition, create_slot, create_ssr_component, current_component, custom_event, dataset_dev, debug, destroy_block, destroy_component, destroy_each, detach, detach_after_dev, detach_before_dev, detach_between_dev, detach_dev, dirty_components, dispatch_dev, each, element, element_is, empty, end_hydrating, escape, escape_attribute_value, escape_object, escaped, exclude_internal_props, fix_and_destroy_block, fix_and_outro_and_destroy_block, fix_position, flush, getAllContexts, getContext, get_all_dirty_from_scope, get_binding_group_value, get_current_component, get_custom_elements_slots, get_root_for_style, get_slot_changes, get_spread_object, get_spread_update, get_store_value, globals, group_outros, handle_promise, hasContext, has_prop, identity, init, insert, insert_dev, insert_hydration, insert_hydration_dev, intros, invalid_attribute_name_character, is_client, is_crossorigin, is_empty, is_function, is_promise, listen, listen_dev, loop, loop_guard, missing_component, mount_component, noop, not_equal, now, null_to_empty, object_without_properties, onDestroy, onMount, once, outro_and_destroy_block, prevent_default, prop_dev, query_selector_all, raf, run, run_all, safe_not_equal, schedule_update, select_multiple_value, select_option, select_options, select_value, self, setContext, set_attributes, set_current_component, set_custom_element_data, set_data, set_data_dev, set_input_type, set_input_value, set_now, set_raf, set_store_value, set_style, set_svg_attributes, space, spread, src_url_equal, start_hydrating, stop_propagation, subscribe, svg_element, text, tick, time_ranges_to_array, to_number, toggle_class, transition_in, transition_out, trusted, update_await_block_branch, update_keyed_each, update_slot, update_slot_base, validate_component, validate_each_argument, validate_each_keys, validate_slots, validate_store, xlink_attr };\n","export class Deferred {\n    constructor() {\n        this.promise = new Promise((resolve, reject)=> {\n            this.reject = reject\n            this.resolve = resolve\n        })\n    }\n}\nexport const runningOnIpad = (navigator.platform === \"iPad\")||(navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);\nexport const usingChromeOnIOS = /CriOS/i.test(navigator.userAgent) && /iphone|ipod|ipad/i.test(navigator.userAgent);\nexport const usingSafari = /Safari\\//i.test(navigator.userAgent) && !(/(Chrome\\/|Chromium\\/)/i.test(navigator.userAgent));\nexport const supportsHover = matchMedia('(hover: hover)').matches;\n\nexport function debounce(func, wait, immediate) {\n    let timeout;\n    return function() {\n        const context = this, args = arguments;\n        const later = function() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n        };\n        const callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(context, args);\n    };\n}\n\nexport function folderName(str) {\n    const a = str.split('-');\n    const name = a.slice(0, -1).join('');\n    switch (name) {\n        case \"route\":\n            return \"rmain\";\n        case \"alternate\":\n            return \"ralt\";\n        case \"nat\":\n            return \"rnat\";\n        default:\n            return name;\n    }\n}\nexport function folder2prefix(str){\n    switch (str) {\n        case \"rmain\":\n            return \"route\";\n        case \"ralt\":\n            return \"alternate\";\n        case \"rnat\":\n            return \"nat\";\n        default:\n            return str;\n    }\n}\n\nexport function clamp(num, min, max) {\n    return num <= min ? min : num >= max ? max : num;\n}\n\nexport function isInside(num, min, max) {\n    return num < min ? false : num > max ? false : true;\n}\n\nexport async function addToSWCache(urls, cacheName) {\n    if (window.caches) {\n        try {\n            const myCache = await window.caches.open(cacheName);\n            await myCache.addAll(urls);\n        } catch (err) {\n            //console.log('could not cache', err);\n        }\n    }\n}\n\n// intersect a segment against one of the 4 lines that make up the bbox\n\nfunction intersect(a, b, edge, bbox) {\n    return edge & 8 ? [a[0] + (b[0] - a[0]) * (bbox[3] - a[1]) / (b[1] - a[1]), bbox[3]] : // top\n        edge & 4 ? [a[0] + (b[0] - a[0]) * (bbox[1] - a[1]) / (b[1] - a[1]), bbox[1]] : // bottom\n        edge & 2 ? [bbox[2], a[1] + (b[1] - a[1]) * (bbox[2] - a[0]) / (b[0] - a[0])] : // right\n        edge & 1 ? [bbox[0], a[1] + (b[1] - a[1]) * (bbox[0] - a[0]) / (b[0] - a[0])] : null; // left\n}\n\n// bit code reflects the point position relative to the bbox:\n\n//         left  mid  right\n//    top  1001  1000  1010\n//    mid  0001  0000  0010\n// bottom  0101  0100  0110\n\nfunction bitCode(p, bbox) {\n    var code = 0;\n\n    if (p[0] < bbox[0]) code |= 1; // left\n    else if (p[0] > bbox[2]) code |= 2; // right\n\n    if (p[1] < bbox[1]) code |= 4; // bottom\n    else if (p[1] > bbox[3]) code |= 8; // top\n\n    return code;\n}\n\nexport function lineclip(points, bbox, result) {\n\n    var len = points.length,\n        codeA = bitCode(points[0], bbox),\n        part = [],\n        i, a, b, codeB, lastCode;\n\n    if (!result) result = [];\n\n    for (i = 1; i < len; i++) {\n        a = points[i - 1];\n        b = points[i];\n        codeB = lastCode = bitCode(b, bbox);\n\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n\n            if (!(codeA | codeB)) { // accept\n                part.push(a);\n\n                if (codeB !== lastCode) { // segment went outside\n                    part.push(b);\n\n                    if (i < len - 1) { // start a new line\n                        result.push(part);\n                        part = [];\n                    }\n                } else if (i === len - 1) {\n                    part.push(b);\n                }\n                break;\n\n            } else if (codeA & codeB) { // trivial reject\n                break;\n\n            } else if (codeA) { // a outside, intersect with clip edge\n                a = intersect(a, b, codeA, bbox);\n                codeA = bitCode(a, bbox);\n\n            } else { // b outside\n                b = intersect(a, b, codeB, bbox);\n                codeB = bitCode(b, bbox);\n            }\n        }\n\n        codeA = lastCode;\n    }\n\n    if (part.length) result.push(part);\n\n    return result;\n}\n\nexport function promiseTimeout(ms, promise){\n    // Create a promise that rejects in <ms> milliseconds\n    let timeout = new Promise((resolve, reject) => {\n        let id = setTimeout(() => {\n            clearTimeout(id);\n            reject('Timed out in '+ ms + 'ms.')\n        }, ms)\n    });\n    // Returns a race between our timeout and the passed in promise\n    return Promise.race([\n        promise,\n        timeout\n    ]);\n}\n\n\nexport const getBounds = (points, affineAndClamp, result=[Infinity, Infinity, -Infinity, -Infinity]) => {\n    for (const [lng, lat] of points.map(g => (affineAndClamp) ? affineAndClamp([g.longitude, g.latitude]) : [g.longitude, g.latitude])) {\n        if (result[0] > lng) { result[0] = lng; }\n        if (result[1] > lat) { result[1] = lat; }\n        if (result[2] < lng) { result[2] = lng; }\n        if (result[3] < lat) { result[3] = lat; }\n    }\n    result[0] -= 1;\n    result[1] -= 1;\n    result[2] += 1;\n    result[3] += 1;\n    return result;\n}\n\nexport async function fetchSimultaneously(urls, fetchCallback) {\n    const queue = urls;\n    const maxSimultaneouslyRequests = 5;\n    let currentRequests = 0;\n    let i = 0;\n\n    return await new Promise(resolve => {\n\n        const fetcher = setInterval(async () => {\n            if (queue.filter(url => url).length === 0) {\n                clearInterval(fetcher);\n                resolve();\n            }\n\n            if (currentRequests >= maxSimultaneouslyRequests || i > queue.length - 1) {\n                return;\n            }\n\n            // Get current index and increase i\n            const index = i++;\n            const url = queue[index];\n\n            currentRequests++;\n            try {\n                await fetch(url);\n                if (fetchCallback) fetchCallback();\n            } catch(err) {console.error(err)}\n            currentRequests--;\n\n            // Set value of index to empty (undefined)\n            delete queue[index];\n        }, 100);\n    });\n}\n\nexport const isPatchUpdate = (current, next) => {\n    const cParts = current.split('.');\n    const nParts = next.split('.');\n    return cParts.slice(0, -1).join('.') === nParts.slice(0, -1).join('.');\n}\n//semver-compare\nexport const semverCompare = (a, b) => {\n    let pa = a.split('.');\n    let pb = b.split('.');\n    for (var i = 0; i < 3; i++) {\n        let na = Number(pa[i]);\n        let nb = Number(pb[i]);\n        if (na > nb) return 1;\n        if (nb > na) return -1;\n        if (!isNaN(na) && isNaN(nb)) return 1;\n        if (isNaN(na) && !isNaN(nb)) return -1;\n    }\n    return 0;\n};\n\nexport const shareAppLink = async () => {\n    const shareData = {\n        'title': 'OFP2MAP',\n        'url': window.location.pathname\n    };\n    try {\n        await navigator.share(shareData)\n    } catch(err) {\n        console.log(err);\n    }\n    return false;\n};\n\n// search for condition in array, returns the index, -1 if no match (-1 also for empty array)\n// condition might be > or >= for ascending order array, < or < = for descending order array\nexport const binarysearch = (sortedArray, condition) => {\n    let start = 0, end = sortedArray.length - 1;\n    let ans = -1;\n    while (start <= end)\n    {\n        let mid = Math.trunc((start + end) / 2);\n        if (!condition(sortedArray[mid]))\n        {\n            start = mid + 1;\n        }\n        else\n        {\n            ans = mid;\n            end = mid - 1;\n        }\n    }\n    return (ans === -1 || !condition(sortedArray[ans])) ? -1 : ans;\n};","export { identity as linear } from '../internal/index.mjs';\n\n/*\nAdapted from https://github.com/mattdesl\nDistributed under MIT License https://github.com/mattdesl/eases/blob/master/LICENSE.md\n*/\nfunction backInOut(t) {\n    const s = 1.70158 * 1.525;\n    if ((t *= 2) < 1)\n        return 0.5 * (t * t * ((s + 1) * t - s));\n    return 0.5 * ((t -= 2) * t * ((s + 1) * t + s) + 2);\n}\nfunction backIn(t) {\n    const s = 1.70158;\n    return t * t * ((s + 1) * t - s);\n}\nfunction backOut(t) {\n    const s = 1.70158;\n    return --t * t * ((s + 1) * t + s) + 1;\n}\nfunction bounceOut(t) {\n    const a = 4.0 / 11.0;\n    const b = 8.0 / 11.0;\n    const c = 9.0 / 10.0;\n    const ca = 4356.0 / 361.0;\n    const cb = 35442.0 / 1805.0;\n    const cc = 16061.0 / 1805.0;\n    const t2 = t * t;\n    return t < a\n        ? 7.5625 * t2\n        : t < b\n            ? 9.075 * t2 - 9.9 * t + 3.4\n            : t < c\n                ? ca * t2 - cb * t + cc\n                : 10.8 * t * t - 20.52 * t + 10.72;\n}\nfunction bounceInOut(t) {\n    return t < 0.5\n        ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0))\n        : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;\n}\nfunction bounceIn(t) {\n    return 1.0 - bounceOut(1.0 - t);\n}\nfunction circInOut(t) {\n    if ((t *= 2) < 1)\n        return -0.5 * (Math.sqrt(1 - t * t) - 1);\n    return 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1);\n}\nfunction circIn(t) {\n    return 1.0 - Math.sqrt(1.0 - t * t);\n}\nfunction circOut(t) {\n    return Math.sqrt(1 - --t * t);\n}\nfunction cubicInOut(t) {\n    return t < 0.5 ? 4.0 * t * t * t : 0.5 * Math.pow(2.0 * t - 2.0, 3.0) + 1.0;\n}\nfunction cubicIn(t) {\n    return t * t * t;\n}\nfunction cubicOut(t) {\n    const f = t - 1.0;\n    return f * f * f + 1.0;\n}\nfunction elasticInOut(t) {\n    return t < 0.5\n        ? 0.5 *\n            Math.sin(((+13.0 * Math.PI) / 2) * 2.0 * t) *\n            Math.pow(2.0, 10.0 * (2.0 * t - 1.0))\n        : 0.5 *\n            Math.sin(((-13.0 * Math.PI) / 2) * (2.0 * t - 1.0 + 1.0)) *\n            Math.pow(2.0, -10.0 * (2.0 * t - 1.0)) +\n            1.0;\n}\nfunction elasticIn(t) {\n    return Math.sin((13.0 * t * Math.PI) / 2) * Math.pow(2.0, 10.0 * (t - 1.0));\n}\nfunction elasticOut(t) {\n    return (Math.sin((-13.0 * (t + 1.0) * Math.PI) / 2) * Math.pow(2.0, -10.0 * t) + 1.0);\n}\nfunction expoInOut(t) {\n    return t === 0.0 || t === 1.0\n        ? t\n        : t < 0.5\n            ? +0.5 * Math.pow(2.0, 20.0 * t - 10.0)\n            : -0.5 * Math.pow(2.0, 10.0 - t * 20.0) + 1.0;\n}\nfunction expoIn(t) {\n    return t === 0.0 ? t : Math.pow(2.0, 10.0 * (t - 1.0));\n}\nfunction expoOut(t) {\n    return t === 1.0 ? t : 1.0 - Math.pow(2.0, -10.0 * t);\n}\nfunction quadInOut(t) {\n    t /= 0.5;\n    if (t < 1)\n        return 0.5 * t * t;\n    t--;\n    return -0.5 * (t * (t - 2) - 1);\n}\nfunction quadIn(t) {\n    return t * t;\n}\nfunction quadOut(t) {\n    return -t * (t - 2.0);\n}\nfunction quartInOut(t) {\n    return t < 0.5\n        ? +8.0 * Math.pow(t, 4.0)\n        : -8.0 * Math.pow(t - 1.0, 4.0) + 1.0;\n}\nfunction quartIn(t) {\n    return Math.pow(t, 4.0);\n}\nfunction quartOut(t) {\n    return Math.pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\nfunction quintInOut(t) {\n    if ((t *= 2) < 1)\n        return 0.5 * t * t * t * t * t;\n    return 0.5 * ((t -= 2) * t * t * t * t + 2);\n}\nfunction quintIn(t) {\n    return t * t * t * t * t;\n}\nfunction quintOut(t) {\n    return --t * t * t * t * t + 1;\n}\nfunction sineInOut(t) {\n    return -0.5 * (Math.cos(Math.PI * t) - 1);\n}\nfunction sineIn(t) {\n    const v = Math.cos(t * Math.PI * 0.5);\n    if (Math.abs(v) < 1e-14)\n        return 1;\n    else\n        return 1 - v;\n}\nfunction sineOut(t) {\n    return Math.sin((t * Math.PI) / 2);\n}\n\nexport { backIn, backInOut, backOut, bounceIn, bounceInOut, bounceOut, circIn, circInOut, circOut, cubicIn, cubicInOut, cubicOut, elasticIn, elasticInOut, elasticOut, expoIn, expoInOut, expoOut, quadIn, quadInOut, quadOut, quartIn, quartInOut, quartOut, quintIn, quintInOut, quintOut, sineIn, sineInOut, sineOut };\n","import { cubicInOut, linear, cubicOut } from '../easing/index.mjs';\nimport { is_function, assign } from '../internal/index.mjs';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nfunction blur(node, { delay = 0, duration = 400, easing = cubicInOut, amount = 5, opacity = 0 } = {}) {\n    const style = getComputedStyle(node);\n    const target_opacity = +style.opacity;\n    const f = style.filter === 'none' ? '' : style.filter;\n    const od = target_opacity * (1 - opacity);\n    return {\n        delay,\n        duration,\n        easing,\n        css: (_t, u) => `opacity: ${target_opacity - (od * u)}; filter: ${f} blur(${u * amount}px);`\n    };\n}\nfunction fade(node, { delay = 0, duration = 400, easing = linear } = {}) {\n    const o = +getComputedStyle(node).opacity;\n    return {\n        delay,\n        duration,\n        easing,\n        css: t => `opacity: ${t * o}`\n    };\n}\nfunction fly(node, { delay = 0, duration = 400, easing = cubicOut, x = 0, y = 0, opacity = 0 } = {}) {\n    const style = getComputedStyle(node);\n    const target_opacity = +style.opacity;\n    const transform = style.transform === 'none' ? '' : style.transform;\n    const od = target_opacity * (1 - opacity);\n    return {\n        delay,\n        duration,\n        easing,\n        css: (t, u) => `\n\t\t\ttransform: ${transform} translate(${(1 - t) * x}px, ${(1 - t) * y}px);\n\t\t\topacity: ${target_opacity - (od * u)}`\n    };\n}\nfunction slide(node, { delay = 0, duration = 400, easing = cubicOut } = {}) {\n    const style = getComputedStyle(node);\n    const opacity = +style.opacity;\n    const height = parseFloat(style.height);\n    const padding_top = parseFloat(style.paddingTop);\n    const padding_bottom = parseFloat(style.paddingBottom);\n    const margin_top = parseFloat(style.marginTop);\n    const margin_bottom = parseFloat(style.marginBottom);\n    const border_top_width = parseFloat(style.borderTopWidth);\n    const border_bottom_width = parseFloat(style.borderBottomWidth);\n    return {\n        delay,\n        duration,\n        easing,\n        css: t => 'overflow: hidden;' +\n            `opacity: ${Math.min(t * 20, 1) * opacity};` +\n            `height: ${t * height}px;` +\n            `padding-top: ${t * padding_top}px;` +\n            `padding-bottom: ${t * padding_bottom}px;` +\n            `margin-top: ${t * margin_top}px;` +\n            `margin-bottom: ${t * margin_bottom}px;` +\n            `border-top-width: ${t * border_top_width}px;` +\n            `border-bottom-width: ${t * border_bottom_width}px;`\n    };\n}\nfunction scale(node, { delay = 0, duration = 400, easing = cubicOut, start = 0, opacity = 0 } = {}) {\n    const style = getComputedStyle(node);\n    const target_opacity = +style.opacity;\n    const transform = style.transform === 'none' ? '' : style.transform;\n    const sd = 1 - start;\n    const od = target_opacity * (1 - opacity);\n    return {\n        delay,\n        duration,\n        easing,\n        css: (_t, u) => `\n\t\t\ttransform: ${transform} scale(${1 - (sd * u)});\n\t\t\topacity: ${target_opacity - (od * u)}\n\t\t`\n    };\n}\nfunction draw(node, { delay = 0, speed, duration, easing = cubicInOut } = {}) {\n    const len = node.getTotalLength();\n    if (duration === undefined) {\n        if (speed === undefined) {\n            duration = 800;\n        }\n        else {\n            duration = len / speed;\n        }\n    }\n    else if (typeof duration === 'function') {\n        duration = duration(len);\n    }\n    return {\n        delay,\n        duration,\n        easing,\n        css: (t, u) => `stroke-dasharray: ${t * len} ${u * len}`\n    };\n}\nfunction crossfade(_a) {\n    var { fallback } = _a, defaults = __rest(_a, [\"fallback\"]);\n    const to_receive = new Map();\n    const to_send = new Map();\n    function crossfade(from, node, params) {\n        const { delay = 0, duration = d => Math.sqrt(d) * 30, easing = cubicOut } = assign(assign({}, defaults), params);\n        const to = node.getBoundingClientRect();\n        const dx = from.left - to.left;\n        const dy = from.top - to.top;\n        const dw = from.width / to.width;\n        const dh = from.height / to.height;\n        const d = Math.sqrt(dx * dx + dy * dy);\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        const opacity = +style.opacity;\n        return {\n            delay,\n            duration: is_function(duration) ? duration(d) : duration,\n            easing,\n            css: (t, u) => `\n\t\t\t\topacity: ${t * opacity};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${transform} translate(${u * dx}px,${u * dy}px) scale(${t + (1 - t) * dw}, ${t + (1 - t) * dh});\n\t\t\t`\n        };\n    }\n    function transition(items, counterparts, intro) {\n        return (node, params) => {\n            items.set(params.key, {\n                rect: node.getBoundingClientRect()\n            });\n            return () => {\n                if (counterparts.has(params.key)) {\n                    const { rect } = counterparts.get(params.key);\n                    counterparts.delete(params.key);\n                    return crossfade(rect, node, params);\n                }\n                // if the node is disappearing altogether\n                // (i.e. wasn't claimed by the other list)\n                // then we need to supply an outro\n                items.delete(params.key);\n                return fallback && fallback(node, params, intro);\n            };\n        };\n    }\n    return [\n        transition(to_send, to_receive, false),\n        transition(to_receive, to_send, true)\n    ];\n}\n\nexport { blur, crossfade, draw, fade, fly, scale, slide };\n","import { noop, safe_not_equal, subscribe, run_all, is_function } from '../internal/index.mjs';\nexport { get_store_value as get } from '../internal/index.mjs';\n\nconst subscriber_queue = [];\n/**\n * Creates a `Readable` store that allows reading by subscription.\n * @param value initial value\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\n */\nfunction readable(value, start) {\n    return {\n        subscribe: writable(value, start).subscribe\n    };\n}\n/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n * @param {*=}value initial value\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\n */\nfunction writable(value, start = noop) {\n    let stop;\n    const subscribers = new Set();\n    function set(new_value) {\n        if (safe_not_equal(value, new_value)) {\n            value = new_value;\n            if (stop) { // store is ready\n                const run_queue = !subscriber_queue.length;\n                for (const subscriber of subscribers) {\n                    subscriber[1]();\n                    subscriber_queue.push(subscriber, value);\n                }\n                if (run_queue) {\n                    for (let i = 0; i < subscriber_queue.length; i += 2) {\n                        subscriber_queue[i][0](subscriber_queue[i + 1]);\n                    }\n                    subscriber_queue.length = 0;\n                }\n            }\n        }\n    }\n    function update(fn) {\n        set(fn(value));\n    }\n    function subscribe(run, invalidate = noop) {\n        const subscriber = [run, invalidate];\n        subscribers.add(subscriber);\n        if (subscribers.size === 1) {\n            stop = start(set) || noop;\n        }\n        run(value);\n        return () => {\n            subscribers.delete(subscriber);\n            if (subscribers.size === 0) {\n                stop();\n                stop = null;\n            }\n        };\n    }\n    return { set, update, subscribe };\n}\nfunction derived(stores, fn, initial_value) {\n    const single = !Array.isArray(stores);\n    const stores_array = single\n        ? [stores]\n        : stores;\n    const auto = fn.length < 2;\n    return readable(initial_value, (set) => {\n        let inited = false;\n        const values = [];\n        let pending = 0;\n        let cleanup = noop;\n        const sync = () => {\n            if (pending) {\n                return;\n            }\n            cleanup();\n            const result = fn(single ? values[0] : values, set);\n            if (auto) {\n                set(result);\n            }\n            else {\n                cleanup = is_function(result) ? result : noop;\n            }\n        };\n        const unsubscribers = stores_array.map((store, i) => subscribe(store, (value) => {\n            values[i] = value;\n            pending &= ~(1 << i);\n            if (inited) {\n                sync();\n            }\n        }, () => {\n            pending |= (1 << i);\n        }));\n        inited = true;\n        sync();\n        return function stop() {\n            run_all(unsubscribers);\n            cleanup();\n        };\n    });\n}\n\nexport { derived, readable, writable };\n","export const aircraftTypes = [\"220\", \"318\", \"319\", \"320\", \"321\", \"330\", \"340\", \"350\", \"380\", \"787\", \"772\", \"773\", \"77F\"];\nexport const discontinuatedAircraftTypes = [\"340\", \"380\"];","import { writable, readable, derived } from 'svelte/store';\nimport {aircraftTypes} from \"./constants\";\nimport {binarysearch} from \"./components/utils\";\n\nexport function resetable(resetValue) {\n    const { subscribe, set, update } = writable(resetValue);\n    return {\n        subscribe,\n        set,\n        update,\n        reset: () => set((typeof resetValue === 'object') ? {...resetValue} : Array.isArray(resetValue) ? [...resetValue] : resetValue)\n    };\n}\n\nexport const wb = writable();\nexport const swDismiss = writable(false);\nexport const swUpdated = writable(false);\nexport const majorUpdate = writable(false);\nexport const sidebar = writable(false);\nexport const focusMode = writable(false);\n\nexport const showGramet = writable(false);\nexport const showPlaneOnMap = resetable(false);\nexport const grametPosition = writable(100);\nexport const simulate = writable(-1);\nexport const ofp = writable();\nexport const ofpStatus = writable();\nexport const takeOffTime = writable();\nexport const landingTime = derived([ofp, takeOffTime], ([$ofp, $takeOffTime]) => {\n    if ($ofp && $takeOffTime) {\n        if ($ofp.timeMatrix.length > 0) {\n            return new Date($takeOffTime.getTime() + (60000 * $ofp.timeMatrix[$ofp.timeMatrix.length - 1][1]));\n        }\n        const landing = new Date($takeOffTime.getTime() + $ofp.infos.flightTime * 60000);\n        return landing;\n    }\n    return undefined;\n});\nexport const fl = writable();\n\nexport const selectedAircraftType = writable();\nexport const aircraftType = derived([ofp, selectedAircraftType], ([$ofp, $selectedAircraftType]) => {\n    let aircraft;\n    if ($selectedAircraftType) {\n        aircraft = $selectedAircraftType;\n    }else if ($ofp){\n        aircraft = $ofp.infos.aircraftType;\n    }\n    if (!aircraft || aircraftTypes.indexOf(aircraft) === -1) return undefined;\n    return aircraft;\n});\n\nlet swLastUpdateDate = new Date();\nexport const checkSWUpdate = () => {\n    if ('serviceWorker' in navigator) {\n        // eslint-disable-next-line no-constant-condition\n        const timeout = ('process.env.NODE_ENV' !== '\"development\"') ? 1800000 /* 30 mn */ : 2000;\n        if ((new Date() - swLastUpdateDate) > timeout) {\n            navigator.serviceWorker.getRegistration().then(reg => {\n                if (reg) {\n                    if (!reg.waiting) {\n                        reg.update();\n                    } else {\n                        // service worker quit while in background ?\n                        swUpdated.set(true);\n                        majorUpdate.set(true); // show immediatly\n                    }\n                    swDismiss.set(false);\n                    swLastUpdateDate = new Date();\n                }\n            }, console.error);\n        }\n    }\n}\n\nexport const checkSwOnVisibilityChange = () =>{\n    if (document && document.visibilityState && document.visibilityState === 'visible') {\n        checkSWUpdate();\n    }\n}\nexport const visible = readable(true, set => {\n    const changeVisibleState = () => {\n        if (document && document.visibilityState) {\n            if (document.visibilityState === 'visible'){\n                //console.log('visibility visible')\n                set(true);\n            } else {\n                //console.log('visibility not visible')\n                set(false);\n            }\n        } else {\n            //console.log('visibility not supported, visible')\n            set(true);\n        }\n    };\n    document.addEventListener(\"visibilitychange\", changeVisibleState);\n    changeVisibleState();\n    return () => {\n        document.removeEventListener(\"visibilitychange\", changeVisibleState);\n    }\n});\n\nexport const online = readable({}, set => {\n    const update_network_status = () => {\n        set(navigator.onLine);\n    };\n\n    if (\n        (typeof navigator !== \"undefined\") &&\n        'onLine' in navigator\n    ) {\n        update_network_status();\n        window.addEventListener('offline', update_network_status);\n        window.addEventListener('online', update_network_status);\n    } else {\n        set(undefined);\n    }\n\n    return () => {\n        if (\n            (typeof navigator !== \"undefined\") &&\n            'onLine' in navigator\n        ) {\n            window.removeEventListener('offline', update_network_status);\n            window.removeEventListener('online', update_network_status);\n        }\n    };\n});\n\nexport const route = readable('/', set => {\n    const hashchange = () => {\n        const meta = document.querySelector( \"meta[name=viewport]\" );\n        const metaContent = (meta) ? meta.getAttribute( \"content\" ) : '';\n        let route = window.location.hash.substr(1) || \"/\";\n        if (route === '/map') {\n            sidebar.set(false);\n            if (metaContent) meta.setAttribute('content', metaContent + ',maximum-scale=1'); \n        } else {\n            if (metaContent) meta.setAttribute('content', metaContent.replace(',maximum-scale=1', ''));\n        }\n        set(route);\n        checkSWUpdate();\n    };\n    hashchange();\n    window.addEventListener('hashchange', hashchange);\n\n    return () => {\n        window.removeEventListener('hashchange', hashchange);\n    };\n});\n\nexport const flightProgress = derived(\n    [ofp, simulate, takeOffTime, showPlaneOnMap, visible],\n    ([$ofp, $simulate, $takeOffTime, $showPlaneOnMap, $visible], set) => {\n        //console.log('fp init')\n        let interval;\n        const frequency = ($showPlaneOnMap) ? 10 * 1000 : 60 * 1000;\n        const simulatorFrequency = 100;\n        if($ofp && $takeOffTime){\n            const setValue = (value) => {\n                if (value < 100) {\n                    set(value);\n                }else {\n                    set(100);\n                    clearInterval(interval);\n                    interval = undefined;\n                    //console.log('fp: last update', value);\n                    simulate.set(-1); \n                }\n            };\n            \n            if ($simulate >= 0) {\n                //console.log('start of simulated session');\n                let value = $simulate;\n                interval = setInterval(() => {\n                    setValue(value);\n                    value++;\n                }, simulatorFrequency);\n            } else {\n                const takeOff = $takeOffTime;\n                const landing = new Date(takeOff.getTime() + $ofp.infos.flightTime * 60000);\n                const computePosition = () => {\n                    let now = new Date();\n                    if (now <= takeOff) {\n                        return 0;\n                    } else if (now >= landing) {\n                        return  100;\n                    } else {\n                        return (now - takeOff) / ($ofp.infos.flightTime * 60) / 10;\n                    }\n                };\n                const pos = computePosition();\n                if (pos < 100) {\n                    if ($visible) {\n                        interval = setInterval(() => {\n                            const value = computePosition();\n                            setValue(value);\n                        }, frequency);\n                    }\n                    set(pos);\n                }else{\n                    set(100);\n                    //console.log('set to max, no interval set', 100);\n                }\n            }\n        } else {\n            set(0);\n            //console.log('set to zero (no ofp of fakeOfp), no interval set', 0)\n        }\n        return () => {\n            if (interval) clearInterval(interval);\n            //console.log('closing flight progress')\n        }\n    },\n    0 // initial value\n);\nexport const position = derived([ofp, flightProgress], ([$ofp, $flightProgress]) => {\n    if (!$ofp) return { map: {latitude: 0, longitude: 0}, gramet: $flightProgress, fl: 300, reltime: 0};\n    const timeMatrix = $ofp.timeMatrix;\n    const distanceMatrix = $ofp.distanceMatrix;\n    const firstPoint = distanceMatrix[0][0];\n    const lastPoint = distanceMatrix[distanceMatrix.length - 1][0];\n    const routeDistance = distanceMatrix[distanceMatrix.length - 1][1];\n    const firstFL = (timeMatrix.length !== 0) ? timeMatrix[0][2] : distanceMatrix[0][2];\n    const lastFL = (timeMatrix.length !== 0) ? timeMatrix[timeMatrix.length - 1][2] : distanceMatrix[distanceMatrix.length - 1][2];\n    const routeTime = (timeMatrix.length !== 0) ? timeMatrix[timeMatrix.length - 1][1] : $ofp.infos.flightTime;\n    const posTime = ($flightProgress * routeTime) / 100;\n    if ($flightProgress <= 0) return {map: firstPoint, gramet: 0, fl: firstFL, reltime: posTime};\n    if ($flightProgress >= 100) return {map: lastPoint, gramet: 100, fl: lastFL, reltime: posTime};\n\n    if (timeMatrix.length !== 0) {\n        const i = binarysearch(timeMatrix, a => a[1] >= posTime);\n        const [p, sum, fl] = timeMatrix[i];\n        if (posTime - sum === 0) {\n            return {\n                reltime: posTime,\n                map: p,\n                gramet: 100 * distanceMatrix[i][1] / routeDistance,\n                fl\n            };\n        }\n        const previous = timeMatrix[i - 1];\n        if (previous) {\n            const segmentLength = distanceMatrix[i][1] - distanceMatrix[i - 1][1];\n            const fraction = (sum - posTime) / (sum - previous[1]);\n            return {\n                reltime: posTime,\n                map: p.atFraction(previous[0], fraction, segmentLength),\n                gramet: 100 * ((distanceMatrix[i][1] - (fraction * segmentLength))) / routeDistance,\n                fl: previous[2]\n            }\n        }\n        return {\n            reltime: posTime,\n            map: firstPoint,\n            gramet: 0,\n            fl: firstFL\n        };\n    } else if(distanceMatrix.length !== 0){\n        const routeDistance = distanceMatrix[distanceMatrix.length - 1][1];\n        const posDistance = ($flightProgress * routeDistance) / 100;\n        const i = binarysearch(distanceMatrix, a => a[1] >= posDistance);\n        const [p, sum, fl] = distanceMatrix[i];\n        if (posDistance - sum === 0) return {\n            map: p,\n            gramet: $flightProgress,\n            fl,\n            reltime: posTime\n        };\n        const previous = distanceMatrix[i - 1];\n        if (previous) {\n            const segmentLength = sum - previous[1];\n            return {\n                map: p.atFraction(previous[0], (sum - posDistance) / segmentLength, segmentLength),\n                gramet: $flightProgress,\n                fl: previous[2],\n                reltime: posTime\n            }\n        }\n        return {\n            map: firstPoint,\n            gramet: 0,\n            fl: firstFL,\n            reltime: posTime\n        };\n    }\n    return {\n        map: lastPoint,\n        gramet: 100,\n        fl: lastFL,\n        reltime: posTime\n    };\n\n}, { map: {latitude: 0, longitude: 0}, gramet: 0, fl: 300, reltime: 0});","<script context=\"module\">\n    import {runningOnIpad} from \"./utils.js\";\n    let copyPermission = false;\n    if (navigator.permissions) {\n        try {\n            navigator.permissions.query({name: \"clipboard-write\"}).then((result) => {\n                if (result.state == \"granted\" || result.state == \"prompt\") {\n                    copyPermission = true;\n                }\n            });\n        }catch(err) {\n            console.log(err);\n        }\n    }\n</script>\n<script>\n    import { tick, onDestroy } from 'svelte';\n    import { fade } from 'svelte/transition';\n    import {ofp} from '../stores';\n    let valueCopy = null;\n    let areaDom;\n    const lidoRoute = (!!$ofp) ? $ofp.lidoRoute(false).join(' ') : '';\n    let copied = false;\n    let timeOut;\n    const click = (e) => {\n        const success = copyText(lidoRoute);\n        if (!runningOnIpad) {\n            copied = success;\n            timeOut = setTimeout(function () {\n                copied = false;\n                if (timeOut) clearTimeout(timeOut);\n            }, 3000);\n            e.preventDefault();\n        }\n    };\n\n    async function copyText(text) {\n        let success = true;\n        if (copyPermission) {\n            navigator.clipboard.writeText(text).then(() => success = true, () => success = false) ;\n        }\n        else {\n            valueCopy = text;\n            await tick();\n            areaDom.focus();\n            areaDom.select();\n            try {\n                success = document.execCommand('copy');\n                if (!success) {\n                    console.log('copy command failed');\n                }\n            } catch (err) {\n                success = false;\n                console.log('failed to copy');\n            }\n            valueCopy = null;\n        }\n        return success;\n    }\n    onDestroy(() => {\n        if (timeOut) clearTimeout(timeOut);\n    });\n</script>\n{#if valueCopy != null}\n    <textarea bind:this={areaDom}>{valueCopy}</textarea>\n{/if}\n<div class=\"card mb-3\">\n    <div class=\"card-body\">\n        <h5 class=\"card-title\">Route Lido</h5>\n        <div class=\"row mb-3\">\n            <div class=\"col-12 col-md-9\">\n                <p class=\"card-text\">Cette route est optimisée par rapport à celle de PilotMission car elle utilise les airways. Utiliser cette route permet\n                    d'avoir une application Lido plus réactive.</p>\n            </div>\n            <div class=\"text-md-end col align-self-center col-12 col-md-3 py-3 py-md-0\">\n                {#if runningOnIpad}\n                    <a role=\"button\" class=\"btn btn-primary\" on:click={click} href='lhs-mpilot://'>ouvrir mPilot <sup>*</sup></a>\n                {:else}\n                    <a role=\"button\" class=\"btn btn-primary\" on:click={click} href='lhs-mpilot://'>copier la route</a>\n                {/if}\n            </div>\n        </div>\n        {#if runningOnIpad}\n            <div class=\"card-text\">\n                <small class=\"text-muted\"><sup>*</sup> Une fois dans l'application mPilot,\n                il vous suffira de faire un coller (la route aura été copiée automatiquement).</small>\n            </div>\n        {/if}\n        <div class=\"text-monospace\">{lidoRoute}\n            {#if copied}\n                <span out:fade>copié!</span>\n            {/if}\n        </div>\n    </div>\n</div>\n\n\n<style>\n    .card {\n        flex: 0 1 auto;\n        min-height: 1px;\n        margin: 0.5rem 1rem;\n    }\n    span {\n        padding: 2px 2px;\n        color: #fff;\n        background-color: #1ea840;\n        border-radius: 3px;\n        position: absolute;\n        right: 0;\n        top: 0;\n    }\n    div.text-monospace {\n        text-align: left;\n        position: relative;\n        padding: 0.5em 1em 0.3em 1em;\n        border: 1px dashed #ccc;\n        max-height: 150px;\n        overflow-y: auto;\n    }\n    textarea {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 2em;\n        height: 2em;\n        padding: 0;\n        border: none;\n        outline: none;\n        box-shadow: none;\n        background: transparent;\n    }\n</style>","/* globals editolido */\nimport {folderName} from './utils';\n\nexport const kmlExportDefaultOptions = {\n  \"routeDisplay\": true,\n  \"routePin\": 0,\n  \"routeColor\": \"FFDA25A8\", /* #A825DAFF */\n  \"alternateDisplay\": true,\n  \"alternatePin\": 0,\n  \"alternateColor\": \"FFFF00FF\", /* #FF00FFFF */\n  \"natDisplay\": true,\n  \"natPin\": 8,\n  \"natColor\": \"80DA25A8\", /* #A825DA80 */\n  \"greatCircleDisplay\": true,\n  \"greatCircleColor\": \"5F1478FF\" /* #FF78145F */\n};\n\nfunction skeleton (kmlGen, kmlOptions) {\n  kmlGen.addFolders(\n    {\"name\": \"greatcircle\", \"enabled\": kmlOptions.greatCircleDisplay, \"color\": kmlOptions.greatCircleColor},\n    //{\"name\": \"ogimet\", \"enabled\": kmlOptions.ogimetDisplay, \"color\": kmlOptions.ogimetColor},\n    {\n        \"name\": \"ralt\",\n        \"enabled\": kmlOptions.alternateDisplay,\n        \"color\": kmlOptions.alternateColor,\n        \"pinId\": kmlOptions.alternatePin\n    },\n    {\"name\": \"rmain\", \"color\": kmlOptions.routeColor, \"pinId\": kmlOptions.routePin},\n    {\"name\": \"rnat\", \"enabled\": kmlOptions.natDisplay, \"color\": kmlOptions.natColor, \"pinId\": kmlOptions.natPin},\n    {\n        \"name\": \"rnat_incomplete\",\n        \"enabled\": kmlOptions.natDisplay,\n        \"color\": kmlOptions.natIncompleteColor,\n        \"pinId\": kmlOptions.natPin\n    }\n  );\n}\n\n/**\n * This is a singleton definition which can be imported  even without lidojs loaded\n */\nexport const KmlGenerator = () => {\n  if (!(window['kmlGen'])) {\n    window['kmlGen'] = new editolido.KMLGenerator();\n    skeleton(window['kmlGen'], kmlExportDefaultOptions);\n  }\n  return window['kmlGen'];\n}\n\n\nexport function updateKml(name, value) {\n  if (name.startsWith('etops-')\n    || name.startsWith('airport-')\n    || name.startsWith('fir-')\n    || name.endsWith('-change')\n    || name === 'nat-incomplete-color'\n    || name === 'nat-pin-position'\n    || name.startsWith('ogimet-')) return;\n  const kmlGen = KmlGenerator();\n  const folder = folderName(name);\n  if (name.endsWith('-display')) {\n      kmlGen.changeFolderState(folder, value);\n  }else if (name.endsWith('-pin')) {\n      kmlGen.changeFolderPin(folder, value);\n  }else if (name.endsWith('-color')) {\n      kmlGen.changeFolderColor(folder, value.toUpperCase());\n  }else{\n      console.error(`ignoring kml update for ${name}`);\n  }\n}\n/**\n * skeleton to generate kml for an OFP\n * @param ofp: Ofp\n * @param kmlGen: KmlGenerator\n * @param options: {}\n * @returns {string|Source|ConcatSource}\n */\nexport function generateKML(ofp, options) {\n    let kmlOptions = {...kmlExportDefaultOptions, ...options};\n    const kmlGen = KmlGenerator();\n    skeleton(kmlGen, kmlOptions); //perform reset also\n    const description = ofp.description;\n    kmlGen.setName(description);\n    if (!ofp) return;\n    const routeName = `${ofp.infos.depICAO}-${ofp.infos.destICAO}`;\n    const route = new editolido.Route(ofp.wptCoordinates(), {\"name\": routeName, \"description\": description});\n    const alternateRoute = new editolido.Route(ofp.wptCoordinatesAlternate(), {\"name\": \"Route Dégagement\"});\n    const greatCircle = new editolido.Route([route.points[0], route.points[route.points.length - 1]]).split(300, {\"name\": `Ortho ${routeName}`});\n    let natmarks = [];\n    for (let track of ofp.tracks) {\n      let folder = track.isComplete ? 'rnat' : 'rnat_incomplete';\n      kmlGen.addLine(folder, track);\n      let p = new editolido.GeoPoint(track.points[0], {\"name\": track.name, \"description\": track.description});\n      kmlGen.addPoint(folder, p);\n      if (track.isMine) {\n        natmarks.push(p);\n        p = new editolido.GeoPoint(track.points[track.points.length - 1], {\"name\": track.name, \"description\": track.description});\n        natmarks.push(p);\n        kmlGen.addPoint(folder, p);\n      }\n    }\n    kmlGen.addLine('greatcircle', greatCircle);\n    kmlGen.addLine('rmain', route);\n    kmlGen.addPoints('rmain', route, {'excluded': natmarks});\n    kmlGen.addLine('ralt', alternateRoute);\n    //kmlGen.addLine('ogimet', ofp.ogimetData.route);\n    kmlGen.addPoints('ralt', alternateRoute);\n}","<script context=\"module\">\n    import {debounce} from '../utils.js';\n    export const kmlRegex = /^[A-F0-9]{8}$/i;\n    export const splitKmlColor = (v) => {\n        return [v.slice(6,8), v.slice(4,6), v.slice(2, 4), v.slice(0, 2)]\n    }\n    export const kml2hexa = (v) => {\n        const [r, g, b, a] = splitKmlColor(v);\n        return \"#\" + r + g + b + a;\n    }\n    export const kml2rgba = (v) => {\n        let [r, g, b, a] = splitKmlColor(v).map((v) => parseInt(v, 16));\n        return `rgba(${r}, ${g}, ${b}, ${a / 255.0})`;\n    }\n    export const kml2mapColor = (v) => {\n        let [hex, range] = kml2swatch(v);\n        return [hex, range / 255.0];\n    }\n    export const defaultSwatch = [\"#FF0000\", 255];\n    export const kml2swatch = (v) => {\n        try{\n            const range = parseInt(v.slice(0,2), 16);\n            const hex = \"#\" + v.slice(6,8) + v.slice(4,6) + v.slice(2,4);\n            return [hex, range];\n        }catch(err){\n            console.error(`invalid KML color ${v}`);\n            return defaultSwatch;\n        }\n    };\n    export const pickerStyle = (hex) => {\n        const [r, g, b] = [hex.slice(1, 3), hex.slice(3, 5), hex.slice(5, 7)].map((v) => parseInt(v, 16));\n        return `--range-red: ${r}; --range-green: ${g}; --range-blue: ${b};`;\n    };\n    export const swatchStyle = (swatch) => {\n        return `background-color: ${swatch[0]}; opacity: ${swatch[1]/255.0}`\n    };\n    const options = [\n        {label: 'Aucun repère', color: '#FFFFFF'},\n        {label: 'Bleu', color: '#6699FF'},\n        {label: 'Jaune', color: '#FFFF00'},\n        {label: 'Marron* (Rouge pour Avenza/Earth)', color: '#CC9966'},\n        {label: 'Orange', color:'#FF9922'},\n        {label: 'Rose* (Rouge pour Avenza)', color: '#DD5599'},\n        {label: 'Rouge', color: '#FF0000'},\n        {label: 'Vert', color: '#22DD44'},\n        {label: 'Violet', color: '#BB11EE'}\n    ];\n</script>\n<script>\n    import { createEventDispatcher } from 'svelte';\n    const dispatch = createEventDispatcher();\n    export let kmlColor = \"FF0000FF\";\n    export let selected = 0;\n    export let name;\n    const colorName = name + '-color';\n    const pinName = name + '-pin';\n    const debounceDelay = 500;\n    let swatch = defaultSwatch;\n\n    const debounceDispatch = (debounceDelay > 0) ? debounce(dispatch, debounceDelay) : dispatch;\n    function changeKmlColor(node) {\n        return {\n            update(swatch) { /* color was changed */\n                const [hex, range] = swatch;\n                /* kmlColor is abgr */\n                kmlColor = (range.toString(16) + hex.slice(5,7) + hex.slice(3,5) + hex.slice(1, 3)).toUpperCase();\n                debounceDispatch(\"change\", {\"name\": colorName, \"value\": kmlColor});\n            }\n        }\n    }\n    function changeSwatch(node) {\n        swatch = kml2swatch(kmlColor);\n        return {\n            update(kmlColor) { /* kmlColor was changed */\n                swatch = kml2swatch(kmlColor);\n                debounceDispatch(\"change\", {\"name\": colorName, \"value\": kmlColor.toUpperCase()});\n            }\n        }\n    }\n</script>\n\n<kmlcolor class=\"input-group\" use:changeSwatch={kmlColor}>\n    <pin class=\"form-control\">\n        <svg>\n            <use xlink:href=\"#marker-symbol\" style=\"stroke: {(selected === 0) ? '#fff': options[selected].color }; fill: {options[selected].color};\"></use>\n        </svg>\n    </pin>\n    <!-- svelte-ignore a11y-no-onchange -->\n    <select name=\"{pinName}\" bind:value={selected} class=\"form-select\" on:change={(e) => {e.target.blur(); dispatch(\"change\", {name: pinName, 'value': selected})}}>\n        {#each options as option, index}\n        <option value=\"{index}\" selected={index === selected}>{option.label}</option>\n        {/each}\n    </select>\n    <picker class=\"form-control\" style=\"{pickerStyle(swatch[0])}\">\n        <label use:changeKmlColor={swatch} style=\"{swatchStyle(swatch)}\">\n            <input bind:value={swatch[0]} type=\"color\"/>\n        </label>\n        <input bind:value={swatch[1]} type=\"range\" min=\"30\" max=\"255\">\n    </picker>\n\n</kmlcolor>\n\n<style>\n    :global(picker input[type=\"color\"]) {\n        opacity: 0;\n        width: 0;\n        height: 0;\n    }\n    :global(picker input[type=\"range\"]) {\n        appearance: none;\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        width: var(--color-swatch-width);\n        padding: 0;\n        height: 14px;\n        align-self: center;\n    }\n    :global(picker input[type=range]:focus) {\n        outline: none;\n    }\n    :global(picker input[type=range]::-webkit-slider-runnable-track) {\n        width: 100%;\n        height: 4px;\n        cursor: pointer;\n        background: linear-gradient(90deg, rgba(var(--range-red), var(--range-green), var(--range-blue), 0.12), rgba(var(--range-red), var(--range-green), var(--range-blue), 1));\n    }\n    :global(picker input[type=range]::-webkit-slider-thumb) {\n        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;\n        border: 1px solid #cccccc;\n        height: 12px;\n        width: 15px;\n        border-radius: 3px;\n        background: transparent;\n        cursor: pointer;\n        -webkit-appearance: none;\n        margin-top: -4.5px;\n    }\n    :global(picker input[type=range]:focus::-webkit-slider-runnable-track) {\n        background: linear-gradient(90deg, rgba(var(--range-red), var(--range-green), var(--range-blue), 0.12), rgba(var(--range-red), var(--range-green), var(--range-blue), 1));\n    }\n    :global(picker input[type=range]::-moz-range-track){\n        width: 100%;\n        height: 4px;\n        cursor: pointer;\n        background: linear-gradient(90deg, rgba(var(--range-red), var(--range-green), var(--range-blue), 0.12), rgba(var(--range-red), var(--range-green), var(--range-blue), 1));\n    }\n    :global(picker input[type=range]::-moz-range-thumb) {\n        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;\n        border: 1px solid #cccccc;\n        height: 12px;\n        width: 15px;\n        border-radius: 3px;\n        background:transparent;\n        cursor: pointer;\n    }\n\n    :global(kmlcolor) {\n        --color-swatch-width: 3em;\n        --color-swatch-height: 1.1em;\n    }\n\n    :global(picker) {\n        --range-red: 255;\n        --range-green: 0;\n        --range-blue: 255;\n\n    }\n    :global(.input-group>picker.form-control) {\n        flex: 0 0 90px;\n        display: flex;\n        flex-direction: column;\n        padding: 0;\n        justify-content: space-between;\n    }\n    /* label is used because it triggers the color input everywhere */\n    :global(kmlcolor picker > label) {\n        align-self: center;\n        height: var(--color-swatch-height);\n        width: var(--color-swatch-width);\n        border: 1px solid #ccc;\n        border-radius: 2px;\n        margin-bottom: 0;\n    }\n    :global(kmlcolor select, kmlpin select) {\n        border-left: 20px solid #FFFFFF !important;\n        padding-left: 0.2rem !important;\n    }\n    :global(kmlcolor pin, kmlpin pin) {\n        background-color: white !important;\n        padding: 0 0 0 0.2rem !important;\n        border-right: 0px !important;\n    }\n    pin {\n        flex:0 0 20px !important;\n        padding: 0 2px !important;\n        margin-left: -2px;\n        align-items: center !important;\n        display: flex !important;\n        position: absolute !important;\n        width: 20px !important;\n        z-index: 4;\n        height: 100%;\n    }\n    :global(kmlcolor pin svg, kmlpin pin svg){\n        stroke: white;\n        fill: white;\n        height: 1.1rem;\n        width: 1.1rem;\n    }\n\n</style>\n","import {kmlRegex} from './ColorPinCombo.svelte';\n\nexport const kmlDefaultOptions = {\n    \"routeDisplay\": true,\n    \"routeColor\": \"FFDA25A8\", /* #A825DAFF */\n    \"alternateDisplay\": true,\n    \"alternateColor\": \"FFFF00FF\", /* #FF00FFFF */\n    \"natDisplay\": true,\n    \"natPinPosition\": 0,\n    \"natColor\": \"80858585\", /* \"80DA25A8\" */\n    \"natIncompleteColor\": \"FF0000FF\", /* #FF0000FF */\n    \"greatCircleDisplay\": true,\n    \"greatCircleColor\": \"5F1478FF\", /* #FF78145F */\n    \"ogimetDisplay\": true,\n    \"ogimetColor\": \"40FF0000\", /* #0000FF40 */\n    \"airportDisplay\": true,\n    \"airportPin\": 0,\n    \"airportLabel\": 0,\n    \"firDisplay\": true,\n    \"etopsDisplay\": true,\n    \"etopsColor\": \"FF0324FC\", /* #FC2403FF */\n    \"iconTextChange\": '1.0',\n    \"lineWidthChange\": '1.0',\n    \"iconSizeChange\": '1.0'\n};\n\nclass Storage {\n    constructor() {}\n    getItem(key) {\n        const value = localStorage.getItem(key);\n        if (value !== null) {\n            try {\n                return JSON.parse(value);\n            } catch (err) {\n                this.removeItem(key);\n                console.log(`invalid json in ${key}`);\n            }\n        }\n        return null;\n    }\n    setItem(key, value) {\n        const toSave = JSON.stringify(value);\n        if (toSave !== '{}') {\n            localStorage.setItem(key, toSave);\n        }\n    }\n    removeItem(key) {\n        localStorage.removeItem(key);\n    }\n    hasItem(key) {\n        return localStorage.getItem(key) !== null;\n    }\n}\nexport const stores = Object.freeze({\n    \"optionsKML\": \"optionsKML\",\n    \"shortcut\": \"shortcut\",\n    \"downloadType\": \"downloadType\",\n    \"exportKML\": \"exportKML\",\n    \"focusKML\": \"focusKML\",\n    \"changelogOnUpdate\": \"changelogOnUpdate\"\n});\n\nexport const storage = new Storage();\n\nexport const validate = (options, defaultOptions=kmlDefaultOptions) => {\n    const validated = {};\n    for (let [key, value] of Object.entries(options)) {\n        if (key in defaultOptions) { \n            if (key.endsWith('Pin')) {\n                value *= 1; // coalesce to number or NaN\n                if (!isNaN(value)) {\n                    validated[key] = value;\n                }\n            } else if (key.endsWith('Color') && value.match(kmlRegex)) {\n                validated[key] = value.toUpperCase();\n            } else if (key.endsWith('Display')) {\n                validated[key] = !!(value); //coerce to boolean\n            } else if (key.endsWith('Change')) {\n                value *= 1; // coalesce to number or NaN\n                if (!isNaN(value)) {\n                    validated[key] = value.toFixed(1);\n                }\n            }\n        }\n    }\n    return {...defaultOptions, ...validated};\n};\n\n\nexport const setHistory = (kmlOptions, route, name=\"Mon OFP2MAP\") => {\n    const options = {};\n    const includedStores = [\"optionsKML\", \"shortcut\", \"downloadType\"];\n    for (const [key, store] of Object.entries(stores)) {\n        if (!includedStores.includes(store)) continue;\n        let value = storage.getItem(store);\n        if (key === stores.optionsKML && kmlOptions) {\n            const diff = {};\n            for (const key of Object.keys(kmlOptions).filter(k => kmlOptions[k] !== kmlDefaultOptions[k])){\n                diff[key] = kmlOptions[key];\n            }\n            value = diff;\n        }\n        if (value !== null) {\n            if (key === stores.optionsKML) {\n                for (const[k, v] of Object.entries(value)) {\n                    options[k] = v;\n                }\n            } else {\n                options[key] = value;\n            }\n        }\n    }\n    const query = Object.entries(options)\n        .map(([k, v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n        .join(\"&\");\n    const permalink =\n        window.location.origin +\n        window.location.pathname +\n        (query ? \"?\" + query : \"\") +\n        '#' + route;\n    window.history.replaceState(options, name, permalink);\n};\n\nexport const storeSettingsFromURL = (url) => {\n    const rawData = {}\n    const validated = {}\n    if (url.length > 1) {\n        const query = url.substr(1) || \"\";\n        query.split(\"&\").forEach(function(part) {\n            const item = part.split(\"=\");\n            rawData[decodeURIComponent(item[0])] = decodeURIComponent(item[1]);\n        });\n    }\n    for (let [key, value] of Object.entries(rawData)) {\n        if (key in kmlDefaultOptions) {\n            let valid=undefined;\n            if (key.endsWith('Pin')) {\n                value *= 1; // coalesce to number or NaN\n                if (!isNaN(value)) {\n                    valid = value;\n                }\n            } else if (key.endsWith('Color') && value.match(kmlRegex)) {\n                valid = value.toUpperCase();\n            } else if (key.endsWith('Display')) {\n                valid = !!(value); //coerce to boolean\n            } else if (key.endsWith('Change')) {\n                value *= 1; // coalesce to number or NaN\n                if (!isNaN(value)) {\n                    valid = value.toFixed(1);\n                }\n            }\n            if (valid !== undefined) {\n                validated[key] = valid;\n            }\n        }else if (key === 'downloadType') {\n            value *= 1;\n            if (!isNaN(value)) {\n                storage.setItem(stores.downloadType, value);\n            }\n        }else if (key === 'shortcut') {\n            value = value.trim();\n            if (value) {\n                storage.setItem(stores.shortcut, value);\n            }\n        }\n    }\n    storage.setItem(stores.optionsKML, validated);\n}","<script>\n    import {KmlGenerator} from \"./kml.js\";\n    import {runningOnIpad} from \"./utils.js\";\n    import {storage, stores} from './mapSettings/storage.js';\n    import {ofp} from '../stores';\n    import { createEventDispatcher } from 'svelte';\n    const dispatch = createEventDispatcher();\n    const store = stores.shortcut;\n    const defaultValue = \"OFP2MAP\";\n    let shortcutName = storage.getItem(store) || defaultValue;\n    $: disabled = !(shortcutName.trim() && runningOnIpad)\n    let url;\n    const lidoRoute = (!!$ofp) ? $ofp.lidoRoute(false).join(' ') : '';\n    function click(e) {\n        const name = shortcutName.trim();\n        if (name && runningOnIpad) {\n            const kmlGen = KmlGenerator();\n            const obj = {\n                \"lidoRoute\": lidoRoute,\n                \"kml\": kmlGen.render(),\n                \"kmlAvenza\": kmlGen.render({\n                    \"template\": editolido.avenzaTemplate,\n                    \"styleTemplate\": editolido.avenzaStyleTemplate,\n                    \"iconTemplate\": editolido.avenzaIconTemplate,\n                    \"icons\": editolido.AVENZAICONS\n                }),\n                \"kmlGoogleEarth\": kmlGen.render({\n                    \"styleTemplate\": editolido.googleEarthStyleTemplate\n                }),\n                \"grametProxyURL\": $ofp.ogimetData.proxyImg\n            };\n            url = \"shortcuts://run-shortcut?name=\" + encodeURIComponent(name) + \"&input=text&text=\" + encodeURIComponent(JSON.stringify(obj));\n        } else {\n            e.preventDefault();\n        }\n    };\n    function save() {\n        const name = shortcutName.trim();\n        if (name === defaultValue) {\n            storage.removeItem(store);\n        } else {\n            storage.setItem(store, name);\n        }\n        dispatch('save', [store, name]);\n    };\n</script>\n\n<div class=\"input-group\">\n    <span class=\"input-group-text\"></span>\n    <input class=\"form-control\" placeholder=\"Nom du raccourci\" type=\"text\" bind:value={shortcutName} on:change={save}>\n    <div class=\"input-group-text\" class:disabled>\n    <a class:disabled href={url} on:click={click} >Lancer</a>\n    </div>\n</div>\n\n<style>\nspan {\n    background-repeat: no-repeat;\n    background-size: contain;\n    background-position: center;\n    background-color: #1b1e5b;\n    border-color: #1b1e5b;\n    background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAABK9JREFUSMe1VjuPHEUQrkf3zM7ePm6958dhH2djwGBkIyHeQoiIH0EAIiQg4wcQkTogIoMIRICEQEIgQQASCAJbxsIW+M68hM/n85ndmd2dnemuKgKDEHdrn0FHqYNSd6s+ler7qgqXlp8DQAAzAIQ/bUd/1uXsIPSX//fD7fizLmcHIfifzd3+VzENqgDgiBzSbgIoWFC5a27hxPwiApwbrK2Or3lkQtwFgGjqkV8++viLhx/tpS1D2gjjt3765o3Vr4LKjqlwd/7ELZ6nKouN1qnjzzx/6ASZ1VpPNTiCR/p3Hm3tOf375TxM+ZYYNwUwgFL0iV7/jQeefKy7t5RaIAqIWKw0TGR6R7PzUG9xZXT98rRgJPxXAGIQzF44uP/UfccPJH6qtYKoiUCMFmsNldZFrDzzyd7+PFQ/jYeIgIC3BRANGoSv3tN/5cg+Ro0WDcTgRvRQW6g0lBomUuWxKjUebs8z48+jXExxW9m3FlkN2g5ffyB7ts+l5AYpYGqWKCQCLpqrjSrFUmGsNhYZiuYS7+32BeyLtV+iKd4aoFJ46ZA9u68uwwgwAQhmtWIq4KO5Gl2tXCpMBMdihVghkseYi3TTZKndXh0O+J9JbKcpLmYRSIAULJpFxaAQxHzERsC0YiojjmM1iqEQy6MVIkWUUmWmKrYyjNHeu0yDGL2rlGqlqeJEcBKpClRVHEqWspGMu/OF46KeFLEswnQk1bAu18dj2lbnrUVmhF9K/Danx/vSS7QGE4KIVCNMESZII+Qcfe6bg/beoUKeXx9L/L2OK4PhKMTtbJ3BIoewOqJPN+hYW5fntEKqESvEEnmMnJMfcjqgbOhag95SkbbXr/x6cXNzIjpTC7N1wGAD8J/5fa2GO5ZUFeIEeUJuRElB6ZCzgWsOea7g5sX5+3/o3K1XL3E5AOKZACe3aljNdbL2XXut0/zcetc4O86lEuXsC05zzgaumXN2ndtn+eCPOG/dg7r8MOVXaLgGRDtkYGauk3XuP+BaCTU8Z/6c653383diSBBy1yhco+DsN7fwdbq85nvICSBBoyvLD9P69zTagH+2Jre9NTcPdRsLmQKoc8qOmc/zntdo4TEt+mAD6qz4Axf80gQzDyBACg4MLG3Fe57mtQtbiLkVwMzANO03VE2IhVnJMVNJjU+oB5gKNCPOGZAHFVA1Q0M1Ngc43tx5HhDTaHWzdWS+fd9CFIvIQixEgMBoAiagbCIgYgImZhFMDFP+4Yz/7mNgv9PAQdBa1j5ZkSh7nlpyALURAiICgRIYmqIKWESNqAEhQRH+5kP/xbsQw85FBgBENIXRxc04Du0H+77jzCMmCAmhJ/SMjv48iYe6ho/e5S8/BLDt0W+qA0RAwvLn4eTSYO54L1nMjAw8oEN0SI7IEaZe1zfC2+/AhbPgPdxkPs/Qwd8wTPW1sjh9NT2YZcfawAAMyIAJUYPDmZXJmx/Y+lXw/r/PZGTUMhZfr1uU7N4Wdx161HFVvH+ueOcrmNbg+NZDH5eWn9t5bzHQoMlis3G0Y4bVpTxcGaEj2JW15Qa1KKGwUYa1yY12iJ53f7NDQkgQ/qX9v7upAZBtXZZ30xDwD7OghDZGs+a6AAAAAElFTkSuQmCC\");\n}\n\ndiv.input-group-text {\n    border-color: #1b1e5b;\n    background-color: #1b1e5b;\n}\na {\n    color: var(--bs-white);\n    text-decoration: none;\n    display: inline-block;\n    text-align: center;\n    font-variant-caps: all-small-caps;\n    min-width:122px;\n    cursor:pointer;\n}\na.disabled {\n    cursor: not-allowed;\n}\ninput {\n    border-color: #1b1e5b;\n}\n</style>","export default function blurAction(node) {\n    // const observer = new IntersectionObserver((entries) => { \n    //     entries.forEach(entry => {\n    //     if(entry.intersectionRatio!==1){\n    //         node.blur();\n    //     }\n    // });\n    // }, {threshold: 1});\n    // observer.observe(node);\n    const handleVisibilityChange = () =>{\n        if (document && document.visibilityState && document.visibilityState !== 'visible') {\n            if(node && node.blur) node.blur();\n        }\n    };\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);\n\n    return {\n        destroy() {\n            // observer.unobserve(node);\n            // observer.disconnect();\n            document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n        }\n    }\n}","<script context=\"module\">\n    const options = ['KML Mapsme', 'KML Avenza', 'KML Google Earth'];\n    const optionColors = ['bs-green', 'bs-purple', 'bs4-cyan']\n</script>\n<script>\n    import {KmlGenerator} from './kml.js';\n    import {storage, stores} from './mapSettings/storage.js';\n    import { createEventDispatcher, onMount } from 'svelte';\n    import blurAction from \"../actions/blurAction\";\n    const dispatch = createEventDispatcher();\n\n    export let label;\n    const store = stores.downloadType;\n    const defaultValue = 1;\n    let selected = storage.getItem(store) || defaultValue;\n    if (typeof selected === 'string') selected = parseInt(selected, 10);\n    if (selected < 0 || selected >= options.length) selected = 0;\n    let url = \"\";\n    let filename = \"\";\n    let cssRoot;\n    const setCssColor = (value) => {\n        cssRoot.style.setProperty('--color', `var(--${optionColors[selected]})`);\n    }\n    const blobURL = (data, type=\"application/vnd.google-earth.kml+xml\")  => {\n        const blob = new Blob( data, { type });\n        return URL.createObjectURL(blob);\n    }\n\n    const download = function (e) {\n        const kmlGen = KmlGenerator();\n        const extensions = ['_mapsme.kml', '_avenza.kml', '_googleearth.kml']\n        const extension = extensions[selected];\n        let str = kmlGen.name;\n        if (!str) {\n            console.log(\"can not compute filename\");\n            filename = \"editolido\" + extension;\n        } else {\n            str = str.trim();\n            filename = str.replace(/[ \\/]/g, \"_\").replace(/:/g, '') + extension;\n        }\n        if (url && url.startsWith('blob:')) URL.revokeObjectURL(url);\n        if (selected === 0) {\n            url = blobURL([kmlGen.render()]);\n        } else if (selected === 1) {\n            url = blobURL([kmlGen.render({\n                \"template\": editolido.avenzaTemplate,\n                \"styleTemplate\": editolido.avenzaStyleTemplate,\n                \"iconTemplate\": editolido.avenzaIconTemplate,\n                \"icons\": editolido.AVENZAICONS\n            })]);\n        } else if (selected === 2) {\n            url = blobURL([kmlGen.render({\n                \"styleTemplate\": editolido.googleEarthStyleTemplate\n            })]);\n        } else {\n            e.preventDefault();\n            return false;\n        }\n        //This will be interesting with navigator.canShare (Web Share API level 2)\n        // if (navigator.share && (selected === 0 || selected === 1)) {\n        //     navigator.share({\n        //         \"title\": options[selected],\n        //         url\n        //     });\n        //     e.preventDefault();\n        // }\n    };\n    function save(e) {\n        e.target.blur();\n        if (selected === defaultValue){\n            storage.removeItem(store);\n        } else {\n            storage.setItem(store, selected);\n        }\n        dispatch(\"save\", [store, selected]);\n        setCssColor();\n    }\n    onMount(() => {\n        setCssColor();\n        return () => {\n            if (url && url.startsWith('blob:')) URL.revokeObjectURL(url);\n        };\n    });\n</script>\n\n<div bind:this={cssRoot} class=\"input-group\">\n  <!-- svelte-ignore a11y-no-onchange -->\n  <select bind:value={selected} class=\"form-select choice{selected}\"aria-label=\"Example select with button addon\" on:change={save} use:blurAction>\n    <option selected={selected === 0} value=\"{0}\">{options[0]}</option>\n    <option selected={selected === 1} value=\"{1}\">{options[1]}</option>\n    <option selected={selected === 2} value=\"{2}\">{options[2]}</option>\n  </select>\n  <div class=\"input-group-text\">\n      <!-- Using the download attribute in standalone mode makes the app to lost the ofp on return (last check on iPadOS 14.4)-->\n    <a class=\"\" download={filename} href={url} on:click={download}>{label}</a>\n  </div>\n</div>\n<style>\n    div.input-group {\n        --color: var(--bs-green);\n    }\n    select {\n        border-color: var(--color);\n    }\n    a, .input-group-text {\n        background-color: var(--color);\n        border-color: var(--color);\n    }\n    a {\n        color: var(--bs-white);\n        text-decoration: none;\n        display: inline-block;\n        text-align: center;\n        font-variant-caps: all-small-caps;\n        min-width:122px;\n    }\n</style>","<script context=\"module\">\n    import {debounce} from '../utils.js';\n    import {kml2swatch, pickerStyle, swatchStyle, defaultSwatch} from './ColorPinCombo.svelte';\n\n</script>\n<script>\n    import { createEventDispatcher } from 'svelte';\n    const dispatch = createEventDispatcher();\n    export let kmlColor = \"FF0000FF\";\n    export let checked;\n    export let name;\n    const colorName = name + '-color';\n    const displayName = name + '-display';\n    const debounceDelay = 500;\n    let swatch = defaultSwatch;\n    const debounceDispatch = (debounceDelay > 0) ? debounce(dispatch, debounceDelay) : dispatch;\n    function changeKmlColor(node) {\n        return {\n            update(swatch) { /* color was changed */\n                const [hex, range] = swatch;\n                /* kmlColor is abgr */\n                kmlColor = (range.toString(16) + hex.slice(5,7) + hex.slice(3,5) + hex.slice(1, 3)).toUpperCase();\n                debounceDispatch(\"change\", {\"name\": colorName, \"value\": kmlColor});\n            }\n        }\n    }\n    function changeSwatch(node) {\n        swatch = kml2swatch(kmlColor);\n        return {\n            update(kmlColor) { /* kmlColor was changed */\n                swatch = kml2swatch(kmlColor);\n                debounceDispatch(\"change\", {\"name\": colorName, \"value\": kmlColor.toUpperCase()});\n            }\n        }\n    }\n</script>\n\n<kmlcolor class=\"input-group checkbox-combo\" use:changeSwatch={kmlColor}>\n    <label for=\"{displayName}\" class=\"form-control\"><input name=\"{displayName}\" checked={checked} type=\"checkbox\" on:change/><slot>Couleur</slot></label>\n    <picker class=\"form-control\" style=\"{pickerStyle(swatch[0])}\">\n        <label use:changeKmlColor={swatch} style=\"{swatchStyle(swatch)}\">\n            <input bind:value={swatch[0]} type=\"color\" />\n        </label>\n        <input bind:value={swatch[1]} type=\"range\" min=\"30\" max=\"255\">\n    </picker>\n</kmlcolor>\n\n<style>\n:global(.checkbox-combo label.form-control){\n    display:flex;\n    align-items: center;\n    flex: 1;\n    padding-left: 0rem;\n    flex-grow: 1;\n    background-color: white;\n    width:auto;\n}\n:global(.checkbox-combo input[type=checkbox]) {\n    margin-left: -1px;\n}\n</style>","<script context=\"module\">\n    const options = [\n        {label: 'statuts'},\n        {label: 'vert/rouge'},\n        {label: 'médical'},\n    ];\n    const labels = [\n        {label: 'ICAO'},\n        {label: 'IATA'},\n    ]\n    export const isStatusStyle = (style) => style === 0;\n    export const isMedicalStyle = (style) => style === 2;\n</script>\n<script>\n    import { createEventDispatcher } from 'svelte';\n    import blurAction from '../../actions/blurAction';\n    const dispatch = createEventDispatcher();\n    export let selectedPin = 0;\n    export let selectedLabel = 0;\n</script>\n\n<div class=\"row g-2\">\n    <div class=\"col\">\n        <div class=\"form-floating\">\n            <!-- svelte-ignore a11y-no-onchange -->\n            <select use:blurAction name=\"airport-pin\" bind:value={selectedPin} class=\"form-select\" on:change={(e) => {e.target.blur(); dispatch(\"change\", {name: 'airport-pin', 'value': selectedPin})}}>\n                {#each options as option, index}\n                <option value=\"{index}\" selected={index === selectedPin}>{option.label}</option>\n                {/each}\n            </select>\n            <label for=\"airport-pin\">Style</label>\n        </div>\n    </div>\n    <div class=\"col\">\n        <div class=\"form-floating\">\n            <!-- svelte-ignore a11y-no-onchange -->\n            <select use:blurAction name=\"airport-label\" bind:value={selectedLabel} class=\"form-select\" on:change={(e) => {e.target.blur(); dispatch(\"change\", {name: \"airport-label\", 'value': selectedLabel})}}>\n                {#each labels as option, index}\n                <option value=\"{index}\" selected={index === selectedLabel}>{option.label}</option>\n                {/each}\n            </select>\n            <label for=\"airport-label\">Noms</label>\n        </div>\n    </div>\n</div>\n\n<style>\n    /* select {\n        border-left: 1px;\n        padding-left: 0.2rem;\n    } */\n    .col, .row {\n        margin-top: 0;\n    }\n    label {\n        width: 5em;\n    }\n</style>","<script context=\"module\">\n    import {debounce} from '../utils.js';\n</script>\n<script>\n    import { createEventDispatcher} from 'svelte';\n    const dispatch = createEventDispatcher();\n    export let name;\n    export let label;\n    export let value;\n    export let min = 0.6;\n    export let max = 2.0;\n    export let step = 0.1;\n    export let decimals = 1;\n\n    const debounceDispatch = debounce(dispatch, 100);\n\n    const increment = () => {\n        const previousValue = value;\n        value = Math.min(Math.max(parseFloat(value) + step, min), max).toFixed(decimals);\n        if (value !== previousValue) {\n            debounceDispatch('change', {name, value});\n        }\n    };\n    const decrement = () => {\n        const previousValue = value;\n        value = Math.min(Math.max(parseFloat(value) - step, min), max).toFixed(decimals);\n        if (value !== previousValue) {\n            debounceDispatch('change', {name, value});\n        }\n    };\n\n</script>\n\n<div class=\"input-group input-group-sm mb-2\">\n    <label for=\"{name}\" class=\"input-group-text\">{label}</label>\n    <button class=\"form-control\" type=\"button\" on:click={decrement}><small>&#10134;</small></button>\n    <div class=\"form-control\">{value}</div>\n    <button class=\"form-control\" type=\"button\" on:click={increment}>&#10133;</button>\n</div>\n<style>\n    div.form-control {\n        text-align: center;\n        padding-left: 0;\n        padding-right: 0;\n        flex: 1;\n    }\n    button.form-control{\n        flex: 0 0 3em;\n    }\n    label {\n        width: 5em;\n    }\n</style>\n","/** Dispatch event on click outside of node */\nexport default function clickOutside(node) {\n    //console.log('click outside installed')\n    const handleClick = event => {\n        if (node && !node.contains(event.target) && !event.defaultPrevented) {\n            node.dispatchEvent(\n                new CustomEvent('click_outside', node)\n            )\n            //console.log('click outside')\n        }\n    }\n\n    document.addEventListener('click', handleClick, true);\n\n    return {\n        destroy() {\n            document.removeEventListener('click', handleClick, true);\n            //console.log('click outside removed')\n        }\n    }\n}","<script context=\"module\">\n    export function dashToCamelCase(str) {\n        return str.replace(/-([a-z])/g, function (g) {\n            return g[1].toUpperCase();\n        });\n    }\n    export function camelCaseToDash(str) {\n        return str.replace(/([a-zA-Z])(?=[A-Z])/g, '$1-').toLowerCase()\n    }\n</script>\n\n<script>\n    import { createEventDispatcher } from 'svelte';\n    import { fly } from 'svelte/transition';\n    import CheckboxColorCombo from './CheckboxColorCombo.svelte';\n    import AirportSelector from './AirportSelector.svelte';\n    import ZoomLevel from './ZoomLevel.svelte';\n    import {storage, stores, kmlDefaultOptions, validate} from './storage.js';\n    import {sidebar, ofp, focusMode} from \"../../stores.js\";\n    import clickOutside from '../../actions/clickOutsideAction';\n    const dispatch = createEventDispatcher();\n    const store = stores.optionsKML;\n    export let kmlOptions;\n    let focusOptions;\n    let focusBackup;\n    const focusStore = stores.focusKML;\n    let storedOptions = validate({...(storage.getItem(store) ||{})});\n    const focusOptionsDefault = (options) => Object.keys(options)\n        .reduce((obj, key) => {\n            obj[key] = (key !== 'routeDisplay' && key.endsWith('Display'))  ? false : options[key];\n            return obj;\n        }, {});\n\n    $: isDefault = compare(kmlOptions, kmlDefaultOptions);\n    $: isChanged = !compare(storedOptions, kmlOptions);\n    $: $focusMode = (focusOptions !== undefined);\n    $: isFocusDefault = (focusBackup) ? compare(focusOptionsDefault(focusBackup), kmlOptions) : false;\n\n    /**\n     * e is a component event or a dom checkbox event\n     */\n    function update(e) {\n        const name = (e.detail) ? e.detail.name : e.target.name;\n        const value = (e.detail) ? e.detail.value : e.target.checked;\n        const key = dashToCamelCase(name);\n        if ( kmlOptions[key] !== value) {\n            kmlOptions[key] = value;\n            dispatch('change', {name, value});\n        }\n    }\n    function updateAll(options) {\n        let hasChange = false;\n        for (const [key, value] of Object.entries(options)) {\n            if (kmlOptions[key] !== value){\n                kmlOptions[key] = value;\n                dispatch('change', { 'name': camelCaseToDash(key), value});\n                hasChange = true;\n            }\n        }\n        if (hasChange) {\n            kmlOptions = {...options};\n        }\n    }\n    function compare(obj1, obj2){\n        return JSON.stringify(obj1) === JSON.stringify(obj2);\n    }\n    function reset() {\n        updateAll(kmlDefaultOptions);\n    }\n    function restore() {\n        updateAll(storedOptions);\n    }\n    function save() {\n        if (isDefault) {\n            storage.removeItem(store);\n        } else {\n            const options = {};\n            for (const key of Object.keys(kmlOptions).filter(k => kmlOptions[k] !== kmlDefaultOptions[k])){\n                options[key] = kmlOptions[key];\n            }\n            storage.setItem(store, options);\n        }\n        dispatch('save');\n        storedOptions = {...kmlOptions};\n    }\n\n    function toggleFocus(e) {\n        e.target.blur();\n        if (focusOptions !== undefined) {\n            endFocusMode();\n        }else{\n            focusBackup = {...kmlOptions};\n            focusOptions = validate({...(storage.getItem(focusStore) ||focusOptionsDefault(kmlOptions))});\n            updateAll(focusOptions);\n        }\n        $sidebar = false;\n    }\n    export function endFocusMode() {\n        if (focusOptions !== undefined){\n            storage.setItem(focusStore, kmlOptions);\n            if (focusBackup) {\n                updateAll(focusBackup);\n            } else {\n                console.error('the focus backup should never be undefined');\n            }\n            focusOptions = undefined;\n        }\n    }\n    function resetFocus() {\n        storage.removeItem(focusStore);\n        if (focusBackup) {\n            focusOptions = focusOptionsDefault(focusBackup);\n            updateAll(focusOptions);\n        } else {\n            console.error('the focus backup should never be undefined');\n        }\n    }\n</script>\n\n{#if $sidebar}\n<div class:sidebar={$sidebar} class:focusmode={$focusMode} class=\"settings\"  use:clickOutside on:click_outside={() => $sidebar=false} transition:fly=\"{{duration: 300, x: 200, y: 0}}\">\n    <!-- svelte-ignore a11y-missing-content -->\n    <a class=\"btn-close float-end\" role=\"button\" href=\".\" on:click|preventDefault={() =>  {$sidebar = !$sidebar}}></a>\n    <form on:submit|preventDefault class:mt-5={!$ofp}>\n        {#if $ofp}\n        <fieldset class=\"form-group mb-4\">\n            <legend class=\"d-flex align-items-center\">\n                <input name=\"fir-display\" checked={kmlOptions['firDisplay']} type=\"checkbox\" on:change={update}/>FIR REG</legend>\n        </fieldset>\n        <fieldset class=\"form-group\">\n            <CheckboxColorCombo name=\"route\" kmlColor={kmlOptions['routeColor']} checked={kmlOptions['routeDisplay']} on:change={update}>\n                Route\n                <button class=\"getfocus btn btn-sm btn-outline-info\" class:active={$focusMode} on:click|preventDefault={toggleFocus}>\n                    {#if $focusMode}<svg><use xlink:href=\"#checkmark-symbol\"/></svg>{/if}FOCUS</button>\n            </CheckboxColorCombo>\n            {#if $focusMode}<small class=\"text-center mt-0\">Cliquez sur FOCUS pour sortir du mode</small>{/if}\n        </fieldset>\n        <fieldset class=\"form-group\">\n            <CheckboxColorCombo name=\"alternate\" kmlColor={kmlOptions['alternateColor']} checked={kmlOptions['alternateDisplay']} on:change={update}>Dégagement</CheckboxColorCombo>\n        </fieldset>\n        <fieldset class=\"form-group\">\n            <CheckboxColorCombo name=\"nat\" kmlColor={kmlOptions['natColor']} checked={kmlOptions['natDisplay']} on:change={update}>Tracks</CheckboxColorCombo>\n            <small class=\"form-text text-muted\">Un track incomplet sera rouge</small>\n        </fieldset>\n        <fieldset class=\"form-group\">\n            <CheckboxColorCombo name=\"great-circle\" kmlColor={kmlOptions['greatCircleColor']} checked={kmlOptions['greatCircleDisplay']} on:change={update}>Orthodromie</CheckboxColorCombo>\n        </fieldset>\n        <fieldset class=\"form-group\">\n            <CheckboxColorCombo name=\"ogimet\" kmlColor={kmlOptions['ogimetColor']} checked={kmlOptions['ogimetDisplay']} on:change={update}>Route GRAMET</CheckboxColorCombo>\n        </fieldset>\n        <fieldset class=\"form-group\">\n            <CheckboxColorCombo name=\"etops\" kmlColor={kmlOptions['etopsColor']} checked={kmlOptions['etopsDisplay']} on:change={update}>ETOPS</CheckboxColorCombo>\n        </fieldset>\n        <fieldset class=\"form-group\">\n            <legend class=\"d-flex align-items-center\">\n                <input name=\"airport-display\" checked={kmlOptions['airportDisplay']} type=\"checkbox\" on:change={update}/>Aéroports</legend>\n            <AirportSelector selectedPin={kmlOptions['airportPin']} selectedLabel={kmlOptions['airportLabel']} on:change={update} />\n        </fieldset>\n        {/if}\n        <fieldset class=\"form-group\">\n            <legend>Aspect général</legend>\n            <ZoomLevel name=\"icon-text-change\" label=\"Labels\" value={kmlOptions['iconTextChange']} min={0.9} max={1.4} on:change={update}/>\n            {#if $ofp}\n            <ZoomLevel name=\"line-width-change\" label=\"Lignes\" value={kmlOptions['lineWidthChange']} on:change={update}/>\n            {/if}\n            <ZoomLevel name=\"icon-size-change\" label=\"Icônes\" value={kmlOptions['iconSizeChange']} on:change={update}/>\n        </fieldset>\n        <div>\n        {#if (!$focusMode)}\n            <button disabled={!isChanged} class=\"btn btn-primary btn-sm\"type=\"button\" on:click={save}>Mémoriser</button>\n            <button disabled={!isChanged} class=\"btn btn-secondary btn-sm\" type=\"button\" on:click={restore}>Restaurer</button>\n            {#if !isDefault}<button class=\"btn btn-outline-dark btn-sm ms-auto\" type=\"button\" on:click={reset}>Reset</button>{/if}\n        {:else}\n            <button disabled={isFocusDefault} class=\"resetfocus btn btn-danger btn-sm\" type=\"button\" on:click={resetFocus}>RESET Réglages mode FOCUS</button>\n        {/if}\n        </div>\n    </form>\n</div>\n{/if}\n\n<style>\n    :global(.settings input[type=\"checkbox\"]) {\n        margin-right: 0.5ch;\n    }\n    .btn:disabled {\n        opacity: .3;\n    }\n    fieldset small {\n        line-height: 1;\n        width: var(--formwidth);\n        display: block;\n        margin-top: -0.05rem;\n        font-size: 70%;\n        position: absolute;\n        font-variant: all-small-caps\n    }\n    :global(.settings legend, .checkbox-combo label.form-control) {\n        font-size: 1rem;\n        font-weight: bold;\n        font-variant-caps: all-small-caps;\n        margin-bottom: 0;\n    }\n    form {\n        --formwidth: 250px;\n        width: var(--formwidth);\n        margin-top: 5px;\n        user-select: none; /* supported by Chrome and Opera */\n        -webkit-user-select: none; /* Safari */\n        -moz-user-select: none; /* Firefox */\n        touch-action: manipulation;\n    }\n    .form-group{\n        margin-bottom: 1.25rem;\n    }\n    .settings {\n        position: absolute;\n        right: 0px;\n        transition: right 0.15s ease-out;\n        background-color: #eee;\n        border-left: 1px solid rgba(255,255,255,0.2);\n        padding: 5px;\n        z-index: 2;\n    }\n    @supports ( backdrop-filter: blur(4px) ) or ( -webkit-backdrop-filter: blur(4px) ) {\n        .settings {\n            background-color: rgba(254,254,254,0.6);\n            backdrop-filter: blur(4px);\n            -webkit-backdrop-filter: blur(4px);\n        }\n        .settings.focusmode {\n            background-color: rgba(23, 162, 184, 0.1);\n        }\n    }\n\n    .getfocus{\n        line-height: 1;\n        margin-left: auto;\n        font-size: 0.8rem;\n        font-weight: 500;\n        display: flex;\n        align-items: center;\n        color: var(--bs-info);\n        border-color: var(--bs-info);\n    }\n    .getfocus.active, .getfocus:active {\n        color: var(--bs-dark);\n        background-color: var(--bs-info);\n        border-color: var(--bs-info);\n    }\n    .getfocus svg {\n        width: 0.7rem;\n        height: 0.7rem;\n        stroke: transparent;\n        stroke-width: 8px;\n        margin-right: 5px;\n        border: 1px solid var(--bs-info);\n        padding: 2px;\n        border-radius: 2px;\n    }\n    .getfocus.active svg {\n        stroke: var(--bs-dark);\n        border: 1px solid var(--bs-dark);\n    }\n    .getfocus:not(.active):hover{\n        background-color: transparent;\n        color: var(--bs-info);\n    }\n    .resetfocus{\n        margin-left: auto;\n        margin-right: auto;\n    }\n    .btn-sm{\n        font-variant-caps: all-small-caps;\n    }\n    form>:last-child {\n        margin-top: 24px;\n        margin-bottom: 0.5rem;\n        display: flex;\n        column-gap: 0.5rem;\n    }\n    .settings :global(select[name=airport-pin]), .settings :global(select[name=airport-label]) {\n        font-size: 0.9rem;\n    }\n</style>\n","<script>\n    import ColorPinCombo from './mapSettings/ColorPinCombo.svelte';\n    import CheckboxColorCombo from './mapSettings/CheckboxColorCombo.svelte';\n    import {storage, stores, validate} from './mapSettings/storage.js';\n    import {dashToCamelCase, camelCaseToDash} from './mapSettings/Form.svelte';\n    import {kmlExportDefaultOptions, updateKml} from './kml.js';\n\n    const store = stores.exportKML;\n    let storedOptions = validate({...(storage.getItem(store) ||{})}, kmlExportDefaultOptions);\n    let exportOptions = {...kmlExportDefaultOptions, ...storedOptions};\n    const allowedOptions = [\n        'routeDisplay', 'routeColor',\n        'alternateDisplay', 'alternateColor',\n        'natDisplay', 'natColor',\n        'greatCircleDisplay', 'greatCircleColor'];\n    export let mapOptions;\n    const allowedMapOptions = Object.keys(mapOptions)\n        .filter(key => allowedOptions.includes(key))\n        .reduce((obj, key) => {\n            obj[key] = (key === 'routeDisplay')  ? true : mapOptions[key];\n            return obj;\n        }, {});\n\n    function updateAll(options) {\n        let hasChange = false;\n        for (const [key, value] of Object.entries(options)) {\n            if (exportOptions[key] !== value){\n                exportOptions[key] = value;\n                const name = camelCaseToDash(key);\n                updateKml(name, value);\n                hasChange = true;\n            }\n        }\n        if (hasChange) {\n            exportOptions = {...exportOptions}; // notify svelte\n        }\n    }\n    for (const [key, value] of Object.entries(exportOptions)) {\n        if (kmlExportDefaultOptions[key] !== value){\n            const name = camelCaseToDash(key);\n            updateKml(name, value);\n        }\n    }\n\n    function compare(obj1, obj2){\n        return JSON.stringify(obj1) === JSON.stringify(obj2);\n    }\n\n    $: isDefault = compare(kmlExportDefaultOptions, exportOptions);\n    $: isChanged = !compare(storedOptions, exportOptions);\n    $: isLikeMap = compare({...exportOptions, ...allowedMapOptions}, exportOptions);\n\n\n    function update(e) {\n        const name = (e.detail) ? e.detail.name : e.target.name;\n        const value = (e.detail) ? e.detail.value : e.target.checked;\n        const key = dashToCamelCase(name);\n        if ( exportOptions[key] !== value) {\n            exportOptions[key] = value;\n            updateKml(name, value);\n        }\n    }\n    const restore = () => updateAll(storedOptions);\n    const reset = () => updateAll(kmlExportDefaultOptions);\n    const asMap = () => updateAll({...exportOptions, ...allowedMapOptions});\n    function save() {\n        if (isDefault) {\n            storage.removeItem(store);\n        } else {\n            const options = {};\n            for (const key of Object.keys(exportOptions).filter(k => exportOptions[k] !== kmlExportDefaultOptions[k])){\n                options[key] = exportOptions[key];\n            }\n            storage.setItem(store, options);\n        }\n        storedOptions = {...exportOptions};\n    }\n</script>\n\n<div>\n    <fieldset class=\"form-group\">\n        <legend>Route</legend>\n            <ColorPinCombo name=\"route\" kmlColor={exportOptions['routeColor']} selected={exportOptions['routePin']} on:change={update} />\n    </fieldset>\n    <fieldset class=\"form-group\">\n        <legend><input name=\"alternate-display\" checked={exportOptions['alternateDisplay']} type=\"checkbox\" on:change={update} />Dégagement</legend>\n        <ColorPinCombo name=\"alternate\" kmlColor={exportOptions['alternateColor']} selected={exportOptions['alternatePin']} on:change={update} />\n    </fieldset>\n    <fieldset class=\"form-group\">\n        <legend><input name=\"nat-display\" checked={exportOptions['natDisplay']} type=\"checkbox\" on:change={update}/>Tracks</legend>\n        <ColorPinCombo name=\"nat\" kmlColor={exportOptions['natColor']} selected={exportOptions['natPin']} on:change={update} />\n        <small class=\"form-text text-muted\">Positionné à l'entrée des tracks, un track incomplet restera rouge.</small>\n    </fieldset>\n    <fieldset class=\"form-group\">\n        <CheckboxColorCombo name=\"great-circle\" kmlColor={exportOptions['greatCircleColor']} checked={exportOptions['greatCircleDisplay']} on:change={update}>Orthodromie</CheckboxColorCombo>\n    </fieldset>\n    <div class=\"mt-4 mb-2 d-flex\">\n        <button disabled={!isChanged} class=\"btn btn-primary btn-sm\"type=\"button\" on:click={save}>Mémoriser</button>\n        <button disabled={!isChanged} class=\"btn btn-secondary btn-sm ms-3\" type=\"button\" on:click={restore}>Restaurer</button>\n        <button disabled={isLikeMap} class=\"btn btn-outline-secondary btn-sm ms-auto\" type=\"button\" on:click={asMap}>Comme Carte</button>\n        <button disabled={isDefault} class=\"btn btn-outline-secondary btn-sm ms-auto\" type=\"button\" on:click={reset}>Reset</button>\n    </div>\n</div>\n\n<style>\n    fieldset.form-group {\n        margin-bottom: 0.5rem;\n    }\n    .btn-primary {\n        background-color: var(--blueaf);\n        border-color: var(--blueaf);\n    }\n    .btn:disabled {\n        opacity: 0.25;\n    }\n    div.d-flex{\n        font-variant-caps: all-small-caps;\n    }\n</style>","<script>\n  import ShortcutsLink from \"./ShortcutsLink.svelte\";\n  import DownloadButton from \"./DownloadButton.svelte\";\n  import ExportSettings from \"./ExportSettings.svelte\";\n  export let kmlOptions;\n</script>\n<div class=\"card mb-3\">\n  <div class=\"card-body\">\n    <div class=\"row\">\n        <div class=\"col-12 col-md-6 d-flex pt-2 pt-md-0\">\n            <form on:submit|preventDefault class=\"settings\">\n                <fieldset class=\"form\">\n                    <legend>Réglages pour l'export</legend>\n                    <ExportSettings mapOptions={kmlOptions}/>\n                </fieldset>\n            </form>\n        </div>\n        <div class=\"col-12 col-md-6 d-flex export\">\n            <form on:submit|preventDefault class=\"settings\">\n                <fieldset class=\"form\">\n                    <legend>Export</legend>\n                    <fieldset class=\"form-group\">\n                        <legend>KML</legend>\n                        <p>Choisissez un format (MapsMe, Avenza Maps ou Google Earth) et téléchargez le fichier KML.</p>\n                        <DownloadButton label=\"Télécharger\" on:save />\n                    </fieldset>\n                    <fieldset class=\"form-group mt-4\">\n                        <legend>Raccourcis</legend>\n                        <p>Sur iOS on peut lancer un raccourci.\n                            <a href=\"https://www.icloud.com/shortcuts/886cc07d24d74d83bb0859643242c2df\" target=\"_blank\">\n                                Exemple de raccourci à installer\n                            </a>. Le raccourci reçoit le KML, la route Lido et le GRAMET.\n                        </p>\n                    <ShortcutsLink on:save /> \n                </fieldset>\n            </form>\n        </div>\n    </div>\n  </div>\n</div>\n\n<style>\n    form {\n        width: 100%;\n    }\n\n    @media (max-width: 575px){\n        .col-12 {\n            padding-left: 0;\n            padding-right: 0;\n        }\n        .export{\n            margin-top: 1.5rem;\n        }\n    }\n\n    .card {\n        margin: 1.5rem 1rem;\n        background-color: rgba(255,255,255,0.89);\n    }\n    fieldset.form {\n        border: 1px solid var(--blueaf);\n        padding: 5px 10px;\n        width: 100%;\n        height: 100%;\n    }\n    fieldset.form > legend {\n        background-color: var(--blueaf);\n        color: #fff;\n        padding: 3px 6px;\n        width: auto;\n        font-variant: none;\n        border-radius: 0.2rem;\n        float:none;\n    }\n</style>","<script>\n    import {shareAppLink} from './utils';\n</script>\n<h1><strong class=\"d-none\">OFP2MAP </strong>Cartographie pour l'OFP \n    <img src=\"svg/Air_France_Logo.svg\" alt=\"logo Air France\">\n    {#if (navigator.standalone === true || 'process.env.NODE_ENV' === '\"development\"') && navigator.share}\n        <button class=\"btn btn-link\" on:click={shareAppLink}>Partager l'App</button>\n    {:else}\n        &nbsp;\n    {/if}\n</h1>\n<style>\n    h1 {\n        margin: 1.2em auto 1em auto;\n        font-variant-caps: all-small-caps;\n        color: white;\n        text-align: center;\n        background-color: rgba(0, 0, 0, 0.2);\n    }\n    h1 img{\n        width: 100%;\n    }\n</style>","<script>\n      import Logo from './Logo.svelte';\n</script>\n<Logo/>\n<div class=\"row\">\n  <div class=\" col-12 col-sm-6 col-md-6 col-xl-3\"><div class=\"card avenza\">\n    <div class=\"card-header\">COMPATIBLE OFFLINE</div>\n    <div class=\"card-body\">\n      <p class=\"card-text\">L'OFP ne quitte pas votre iPad ou votre ordinateur. Fonctionne avec les dernières technologies: PWA, Service Worker, fully responsive, cartes WebGL...</p>\n    </div>\n  </div></div>\n  <div class=\"col-12 col-sm-6 col-md-6 col-xl-3\"><div class=\"card mapsme\">\n    <div class=\"card-header\">Multiples Projections</div>\n    <div class=\"card-body\">\n      <p class=\"card-text\">Des cartes LAMBERT conformes, un ATLAS politique, un ATLAS physique, une carte VFR et une MERCATOR avec 12 niveaux de zoom. Export en format KML vers Mapsme, Avenza ou Google Earth</p>\n    </div>\n  </div></div>\n  <div class=\"col-12 col-sm-6 col-md-6 col-xl-3\"><div class=\"card ogimet\">\n    <div class=\"card-header\">Compatible avec Ogimet</div>\n    <div class=\"card-body\">\n      <p class=\"card-text\">Calcule une route pour ogimet et affiche le GRAMET qui est un météogramme combinant l'espace et le temps</p>\n    </div>\n  </div></div>\n  <div class=\"col-12 col-sm-6 col-md-6 col-xl-3\"><div class=\"card shortcuts\">\n    <div class=\"card-header\">Compatible Raccourcis</div>\n    <div class=\"card-body\">\n      <p class=\"card-text\">Avec l'app Raccourcis, automatisez en récupérant le KML, le Gramet, ou une route Lido optimisée</p>\n    </div>\n  </div></div>\n</div>\n<style>\n\n.card {\n  color: white;\n  background-color: rgba(0, 0, 0, 0.2);\n  margin: 15px;\n  height: 100%;\n}\n.card-header {\n  font-variant-caps: all-small-caps;\n  font-weight: bold;\n  color: white;\n}\n.shortcuts .card-header {\n  background-color: var(--bs-purple);\n}\n.mapsme .card-header {\n  background-color: var(--bs-green);\n}\n.avenza .card-header {\n  background-color: var(--bs-pink);\n}\n.ogimet .card-header {\n  background-color: var(--bs-yellow);\n}\n.row {\n  margin-bottom: 15px; /* for no ofp prompt */\n  padding: 0 10px 10px 10px;\n}\n@media (min-width: 576px) and (max-width: 1199.8px) {\n  .col-sm-6, .col-md-6 {\n      margin-bottom: 15px;\n  }\n} \n</style>","\nexport function jsonPoint(lngLat, properties={}) {\n    const json = {\n        'type': 'Feature',\n        'geometry': {\n            'type': 'Point',\n            'coordinates': [lngLat[0], lngLat[1]]\n        },\n        properties\n    };\n    return json;\n}\n\nexport function featureCollection(features) {\n    return {\n        'type': 'geojson',\n        'data': {\n            'type': 'FeatureCollection',\n            'features': features\n        }\n    };\n}\n\nexport function jsonLine(coordinates, properties={}) {\n    const json = {\n        'type': 'Feature',\n        'geometry': {\n            'type': 'LineString',\n            'coordinates': coordinates\n        },\n        properties\n    };\n    return json;\n}\n","import {jsonLine, jsonPoint, featureCollection} from './json';\nimport {folder2prefix} from '../utils';\nimport {kml2mapColor} from \"../mapSettings/ColorPinCombo.svelte\";\n\nexport const pinColors = [\n    '#FFFFFF', '#6699FF', '#FFFF00',\n    '#CC9966', '#FF9922', '#DD5599',\n    '#FF0000', '#22DD44', '#BB11EE', '#F56'\n];\nexport const iconTextSizeDefault = 10;\nexport const lineWidthDefault = 2;\nexport const iconSizeDefault = 1;\nexport const iconSizeDefaultNoPin = 0.2;\nexport const minTextOpacityDefault= 0.8;\n\nexport const geoPoints2LngLats = (data, affine, cb) => {\n    let lngLats = [];\n    const len = data.length;\n    for (let i = 0; i < len; i++) {\n        const newPair = (affine) ? affine([data[i].longitude, data[i].latitude]) : [data[i].longitude, data[i].latitude];\n        if (newPair) lngLats.push((cb) ? cb(newPair, data[i]) : newPair);\n    }\n    return lngLats;\n}\n\nexport const computeIconSize = (ratio, size=iconSizeDefault, extraFactor=1) => {\n    const result = ratio * size * ((ratio > 1) ? extraFactor : 1);\n    if (isNaN(result)) return 1;\n    return result;\n}\nexport const computeIconTextSize = (ratio, size=iconTextSizeDefault, extraFactor=1) => {\n    const result = ratio * size * ((ratio > 1) ? extraFactor : 1);\n    if (isNaN(result)) return iconTextSizeDefault;\n    return result;\n}\nexport const computeLineWidthSize = (ratio, size=lineWidthDefault) => {\n    const result = ratio * size;\n    if (isNaN(result)) return 1;\n    return result;\n}\n//to increase size of track entry/exit points\nexport const getIconSizeExpression = (iconSize) =>[\"case\", [\"==\", 1, [\"get\", \"overrideTextColor\"]], computeIconSize(iconSize/iconSizeDefault, iconSizeDefaultNoPin * 3), iconSizeDefaultNoPin];\nexport const getIconAnchorExpression = () => 'center';\nexport const getIconImageExpression = () => 'sdf-triangle';\nexport const getIconColorExpression = (color, overrideColor) => (overrideColor) ? [\"case\", [\"==\", 1, [\"get\", \"overrideIconColor\"]], overrideColor, color] : color;\nexport const getTextColorExpression = (color, overrideColor) => (overrideColor) ? [\"case\", [\"==\", 1, [\"get\", \"overrideTextColor\"]], overrideColor, color] : color;\nexport const getOpacityColorExpression = (opacity, overrideOpacity, minOpacity=minTextOpacityDefault) => {\n    if (overrideOpacity) {\n        return [\"case\", [\"==\", 1, [\"get\", \"overrideTextColor\"]], Math.max(overrideOpacity, minOpacity), Math.max(opacity, minOpacity)];\n    }\n    return Math.max(opacity, minOpacity);\n}\nexport const getTextKmlColorExpression = (kmlcolor, overrideKmlColor) => {\n    const [color,] = kml2mapColor(kmlcolor);\n    const [overrideColor,] = (overrideKmlColor) ? kml2mapColor(overrideKmlColor) : [null, null];\n    return getTextColorExpression(color, overrideColor);\n};\nexport const getOpacityKmlColorExpression= (kmlcolor, overrideKmlColor, minOpacity=minTextOpacityDefault) => {\n    const [, opacity] = kml2mapColor(kmlcolor);\n    const [,overrideOpacity] = (overrideKmlColor) ? kml2mapColor(overrideKmlColor) : [null, null];\n    return getOpacityColorExpression(opacity, overrideOpacity, minOpacity)\n};\nexport function addPoints(map, id, data, affine, kmlOptions) {\n    const prefix = folder2prefix(id);\n    const visibility = kmlOptions[`${prefix}Display`];\n    const kmlcolor = kmlOptions[`${prefix}Color`];\n    const textSize = computeIconTextSize(kmlOptions[`iconTextChange`]);\n    const iconSize = computeIconSize(kmlOptions[`iconSizeChange`]);\n    map.addSource(`${id}-marker-source`, featureCollection(\n        geoPoints2LngLats(data, affine, (lngLat, geoPoint) => jsonPoint(lngLat, {title: geoPoint.name.replace(/00\\.0/g,'')}))\n    ));\n    map.addLayer(markerLayer(id, kmlcolor, visibility, textSize, iconSize));\n}\n\nexport function addLine(map, id, data, affineLine, kmlcolor, visibility, lineWidth, dashes) {\n    if (affineLine) {\n        map.addSource(`${id}-line-source`, featureCollection(affineLine(data).map(l =>jsonLine(l))));\n    } else {\n        map.addSource(`${id}-line-source`, {\n            'type': 'geojson',\n            'data': jsonLine(data.map(g => [g.longitude, g.latitude]))\n        });\n    }\n    map.addLayer(lineLayer(id, kmlcolor, visibility, lineWidth, dashes));\n}\n\nexport function addLines(map, id, data, affineLine, kmlcolor, visibility, lineWidth, dashes) {\n    if (affineLine) {\n        const len = data.length;\n        const results = [];\n        for (let line=0; line<len; line++) {\n            const sublines = affineLine(data[line]);\n            const sublen = sublines.length;\n            for (let subline = 0; subline < sublen; subline++) {\n                results.push(jsonLine(sublines[subline]))\n            }\n        }\n        map.addSource(`${id}-line-source`, featureCollection(results));\n    }else{\n        map.addSource(`${id}-line-source`, featureCollection(data.map(ar => jsonLine(ar.map(g => [g.longitude, g.latitude])))));\n    }\n    map.addLayer(lineLayer(id, kmlcolor, visibility, lineWidth, dashes));\n}\nexport function markerLayer (folder, kmlcolor, visibility, textSize, iconSize) {\n    const [hexcolor, opacity] = kml2mapColor(kmlcolor);\n    const layer = {\n        'id': `${folder}-marker-layer`,\n        'type': 'symbol',\n        'source': `${folder}-marker-source`,\n        'layout': {\n            'icon-image': getIconImageExpression(),\n            'icon-size': getIconSizeExpression(iconSize),\n            'icon-anchor': getIconAnchorExpression(),\n            'icon-offset': [0, 0],\n            //'icon-rotate': ['get', 'orientation'],\n            'icon-allow-overlap': false,\n            'visibility': ( visibility) ? 'visible' : 'none',\n            'text-field': ['get', 'title'],\n            //'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],\n            'text-size': textSize,\n            'text-offset': [0, 0.7],\n            'text-anchor': 'top'\n        },\n        'paint': {\n            'icon-color': getIconColorExpression(hexcolor),\n            'icon-halo-width': 1,\n            'icon-halo-color': '#000',\n            'text-color': getTextColorExpression(hexcolor),\n            'text-opacity': getOpacityColorExpression(opacity)\n        }\n    };\n    return layer;\n}\nexport function lineLayer(folder, kmlcolor, visibility, lineWidth=lineWidthDefault, dashes=false) {\n    const [hexcolor, opacity] = kml2mapColor(kmlcolor);\n    const layer = {\n        'id': `${folder}-line-layer`,\n        'type': 'line',\n        'source': `${folder}-line-source`,\n        'layout': {\n            'line-join': 'round',\n            'line-cap': 'round',\n            'visibility': (visibility) ? 'visible' : 'none'\n        },\n        'paint': {\n            'line-color': hexcolor,\n            'line-opacity': opacity,\n            'line-width': lineWidth,\n            'line-dasharray': (dashes) ? [10, 10] : [1]\n        }\n    }\n    return layer;\n}\nexport function changeIconSizeGeneric(folder, data, iconSize=iconSizeDefault){\n    const {map, value} = data;\n    const markerLayer = `${folder}-marker-layer`;\n    if (map.getLayer(markerLayer)) {\n        map.setLayoutProperty(markerLayer, 'icon-size', getIconSizeExpression(computeIconSize(value, iconSize)));\n    }\n    return true; // allows chaining\n}\nexport function changeIconTextGeneric(folder, data, textSize=iconTextSizeDefault){\n    const {map, value} = data;\n    const markerLayer = `${folder}-marker-layer`;\n    if (map.getLayer(markerLayer)) {\n        map.setLayoutProperty(markerLayer, 'text-size', computeIconTextSize(value, textSize));\n    }\n    return true; // allows chaining\n}\nexport function changeLineWidthGeneric(folder, data, lineWidth=lineWidthDefault){\n    const {map, value} = data;\n    const lineLayer = `${folder}-line-layer`;\n    if (map.getLayer(lineLayer)) {\n        map.setPaintProperty(lineLayer, 'line-width', computeLineWidthSize(value, lineWidth));\n    }\n    return true; // allows chaining\n}\n\nexport function changeLineGeneric(folder, data){\n    const {map, value} = data;\n    const lineLayer = `${folder}-line-layer`;\n    const markerLayer = `${folder}-marker-layer`;\n    const [hexcolor, opacity] = kml2mapColor(value);\n    if (map.getLayer(lineLayer)) {\n        map.setPaintProperty(lineLayer, 'line-color', hexcolor);\n        map.setPaintProperty(lineLayer, 'line-opacity', opacity);\n    }\n    if (map.getLayer(markerLayer)) {\n        const iconImageExpression = map.getLayoutProperty(markerLayer, 'icon-image');\n        const iconImage = Array.isArray(iconImageExpression) ? iconImageExpression.slice(-1).pop() : iconImageExpression;\n        map.setPaintProperty(markerLayer, 'text-color', getTextColorExpression(hexcolor));\n        map.setPaintProperty(markerLayer, 'text-opacity', getOpacityColorExpression(opacity));\n        if (iconImage === 'sdf-triangle') map.setPaintProperty(markerLayer, 'icon-color', getIconColorExpression(hexcolor));\n    }\n    return true; // allows chaining\n}\nexport function changeDisplayGeneric(folder, visibility, data){\n    const {map} = data;\n    const lineLayer = `${folder}-line-layer`;\n    const markerLayer = `${folder}-marker-layer`;\n    if (map.getLayer(lineLayer)) {\n        map.setLayoutProperty(lineLayer, 'visibility', (visibility) ? 'visible' : 'none');\n    }\n    if (map.getLayer(markerLayer)) {\n        map.setLayoutProperty(markerLayer, 'visibility', (visibility) ? 'visible' : 'none');\n    }\n    return true; // allows chaining\n}\n\n","/* global mapboxgl editolido */\nimport {kml2mapColor} from \"../../mapSettings/ColorPinCombo.svelte\";\nimport {isMedicalStyle, isStatusStyle} from \"../../mapSettings/AirportSelector.svelte\";\nimport {computeIconTextSize, computeIconSize} from '../utils';\nimport {supportsHover} from \"../../utils\";\nimport {get} from \"svelte/store\";\nimport {aircraftType as aircraftTypeStore} from '../../../stores';\n\nconst folder = 'airport';\nconst adequateLayer = `${folder}-layer`;\nconst emergencyLayer = `${folder}-emer-layer`;\nconst source = `${folder}-source`;\nconst medicalColor = '#062DF8';\nconst medicalCondition = [\"==\", 1, [\"get\", \"h\"]];\n\n\nconst basicAirportIconColor = (raltNames, hexColor) => [\"case\",\n    [\"in\", [\"get\", \"name\"], [\"literal\", raltNames]], hexColor,\n    [\"==\", 0, [\"get\", \"level\"]], '#095','#C71'];\nconst medicalAirportIconColor = (raltNames, hexColor) => [\"case\",\n    [\"in\", [\"get\", \"name\"], [\"literal\", raltNames]], hexColor,\n    [\"==\", 0, [\"get\", \"level\"]], medicalColor,'#C71'];\nconst statusAirportIconColor = (aircraftType) => [\"case\",\n    [\"==\", 9, [\"get\", `${aircraftType}`]], '#ea80d8',\n    [\"==\", 8, [\"get\", `${aircraftType}`]], '#ea80d8',\n    [\"==\", 7, [\"get\", `${aircraftType}`]], '#dddddd',\n    [\"==\", 6, [\"get\", `${aircraftType}`]], '#dddddd',\n    [\"==\", 5, [\"get\", `${aircraftType}`]], '#fbfe98',\n    [\"==\", 4, [\"get\", `${aircraftType}`]], '#fbfe98',\n    [\"==\", 3, [\"get\", `${aircraftType}`]], '#00b0f1',\n    [\"==\", 2, [\"get\", `${aircraftType}`]], '#00b0f1',\n    '#000'];\n\nconst getIconColor = (style, aircraftType, raltNames, hexColor, ofpLoaded) => {\n    if (!ofpLoaded) return '#095';\n    if (isStatusStyle(style)) {\n        return statusAirportIconColor(aircraftType);\n    } else if (isMedicalStyle(style)) {\n        return medicalAirportIconColor(raltNames, hexColor);\n    }\n    return basicAirportIconColor(raltNames, hexColor);\n}\n\nconst filterByAircraftType = (aircraftType, is=true, medicalOnly=false) => {\n    const typeCondition = [\"<\", [\"get\", `${aircraftType}`], 10];\n    if (medicalOnly) {\n        if (is) {\n            return [\"all\", medicalCondition, typeCondition];\n        }else{\n            return [\"to-boolean\", false]; //none\n        }\n    }else{\n        if (is) {\n            return typeCondition;\n        }else{\n            return [\"!\", typeCondition];\n        }\n    }\n}\n\nconst symbolSortKey = (aircraftType, maxPriorityNames) => {\n    // maxPriority = 0\n    // medical = 1\n    // then by order field\n    return [\"case\",\n    [\"in\", [\"get\", \"name\"], [\"literal\", maxPriorityNames]], 0,\n    [\"case\", medicalCondition, 1, [\"get\", `${aircraftType}`]]]\n}\n\nconst getIconHaloWidth = (style, ofpLoaded) => (style === 0 && ofpLoaded) ? 3 : 0;\nconst getTextColor = (style, raltNames, hexColor, ofpLoaded) => {\n    const styleBasedColor = (!isMedicalStyle(style)) ? [\"case\", medicalCondition, medicalColor, '#000'] : '#000';\n    if (!ofpLoaded) return styleBasedColor;\n    return [\"case\",\n    [\"in\", [\"get\", \"name\"], [\"literal\", raltNames]], hexColor,\n    [\"==\", 0, [\"get\", \"level\"]], styleBasedColor,\n    '#C60'];\n};\nconst getAdequateTextField = (style, labelling) => {\n    const label = (labelling === 0) ? ['get', 'name'] : ['get', 'iata'];\n    if (!isMedicalStyle(style)) return [\"case\", [\"==\", 1, [\"get\", \"h\"]], [\"concat\", label, '\\u200A✚'], label];  //https://jkorpela.fi/chars/spaces.html\n    return label;\n};\nconst getEmergencyTextField = (labelling) => {\n    const label = (labelling === 0) ? ['get', 'name'] : ['get', 'iata'];\n    return label;\n};\nconst adequateTextSize = (etopsNames, textRatio) => {\n    return [\"case\",\n    [\"in\", [\"get\", \"name\"], [\"literal\", etopsNames]], computeIconTextSize(textRatio, 10),\n    computeIconTextSize(textRatio, 8, 1.15)]\n}\nconst emergencyTextSize = (textRatio) => {\n    return computeIconTextSize(textRatio, 8, 1.15)\n}\nconst adequateIconSize = (etopsNames, iconRatio) => {\n    return [\"case\",\n    [\"in\", [\"get\", \"name\"], [\"literal\", etopsNames]], computeIconSize(iconRatio, 1),\n    computeIconSize(iconRatio, 0.6)]\n}\nconst emergencyIconSize = (iconRatio, ofpLoaded) => {\n    return (ofpLoaded) ? [\"case\",\n    [\"==\", 2, [\"get\", \"level\"]], computeIconSize(iconRatio, 0.5, 1.2),\n    computeIconSize(iconRatio, 0.4, 1.2)] : computeIconSize(iconRatio, 0.4, 1.2);\n}\nexport const addAirports = (data) => {\n    const {map, mapData, ofp, kmlOptions, aircraftType} = data;\n    const {affineOrDrop} = mapData;\n    const affine = affineOrDrop;\n    let epPoints = [];\n    if (ofp && ofp.infos['EEP'] && ofp.infos['EXP'] && ofp.infos['raltPoints'].length > 0) {\n        epPoints = [ofp.infos['EEP'], ofp.infos['EXP']];\n    }\n    const raltPoints = (ofp) ? ofp.infos['raltPoints'] : [];\n    const etopsKmlColor = kmlOptions.etopsColor;\n    const style = kmlOptions.airportPin;\n    const visibility = kmlOptions.airportDisplay;\n    const [hexcolorEtops,] = kml2mapColor(etopsKmlColor);\n    const epNames = epPoints.map(g => g.name);\n    const raltNames = raltPoints.map(g => g.name);\n    const etopsNames = epNames.concat(raltNames);\n    const maxPriorityNames = (ofp) ? [ofp.departure.name, ofp.arrival.name].concat(etopsNames) : etopsNames;\n    fetch('data/airports.CONF_AIRAC.geojson')\n    .then(response => response.json())\n    .then(data => {\n        if (affine) {\n            const projFeatures = [];\n            for (let feature of data.features) {\n                feature.geometry.coordinates = affine(feature.geometry.coordinates);\n                if(feature.geometry.coordinates !== undefined) projFeatures.push(feature);\n            }\n            data.features = projFeatures;\n        }\n        map.addSource(source, {\n            type: 'geojson',\n            data: data\n        });\n        //<select style=\"background-color: transparent;border: none;\"><option>773</option></select>\n        map.addLayer({\n            'id': emergencyLayer,\n            'type': 'symbol',\n            'source': source,\n            'layout': {\n                'icon-image': (ofp) ? [\"case\",\n                    [\"==\", 2, [\"get\", \"level\"]], 'sdf-star',\n                    'sdf-airport'] : 'sdf-airport',\n                'icon-size': emergencyIconSize(kmlOptions['iconSizeChange'], !!ofp),\n                'icon-anchor': 'center',\n                'icon-offset': [0, 0],\n                //'icon-rotate': ['get', 'orientation'],\n                'icon-allow-overlap': true,\n                'icon-ignore-placement': true,\n                'visibility': (visibility) ? 'visible' : 'none',\n                'text-field': getEmergencyTextField(kmlOptions['airportLabel']),\n                //'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],\n                'text-size': emergencyTextSize(kmlOptions['iconTextChange']),\n                'text-offset': [0, 0.7],\n                'text-anchor': 'top',\n                'text-allow-overlap': false,\n                'text-ignore-placement': false\n                //'symbol-sort-key': [\"get\", `${ofp.infos.aircraftType}`]\n            },\n            'paint': {\n                'icon-color': (ofp) ? [\"case\",[\"==\", 1, [\"get\", \"level\"]], '#D70', '#B02'] : '#B02', // no ofp => all red\n                'icon-halo-width': 0,\n                'icon-halo-color': '#000',\n                'text-color': \"#000\",\n                'text-opacity': 0.8\n            },\n            'filter': filterByAircraftType(aircraftType, false, style===2)\n        });\n        map.addLayer({\n            'id': adequateLayer,\n            'type': 'symbol',\n            'source': source,\n            'layout': {\n                'icon-image': [\"case\",\n                    [\"in\", [\"get\", \"name\"], [\"literal\", etopsNames]], 'sdf-triangle',\n                    'sdf-airport'],\n                'icon-size': adequateIconSize(etopsNames, kmlOptions['iconSizeChange']),\n                'icon-anchor': 'center',\n                'icon-offset': [0, 0],\n                //'icon-rotate': ['get', 'orientation'],\n                'icon-allow-overlap': true,\n                'icon-ignore-placement': true,\n                'visibility': (visibility) ? 'visible' : 'none',\n                'text-field': getAdequateTextField(style, kmlOptions['airportLabel']),\n                //'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],\n                'text-size': adequateTextSize(etopsNames, kmlOptions['iconTextChange']),\n                'text-offset': [0, 0.7],\n                'text-anchor': 'top',\n                'text-allow-overlap': false,\n                'text-ignore-placement': false,\n                'symbol-sort-key':symbolSortKey(aircraftType, maxPriorityNames)\n            },\n            'paint': {\n                'icon-halo-color':(ofp) ? [\"case\", [\"==\", 0, [\"get\", \"level\"]], '#095','#D70'] : '#444',\n                'icon-halo-width': getIconHaloWidth(style, !!ofp),\n                'icon-color': getIconColor(style, aircraftType, raltNames, hexcolorEtops, !!ofp),\n                'text-color': getTextColor(style, raltNames, hexcolorEtops, !!ofp),\n                'text-halo-color': \"#000\",\n                'text-halo-width': [\"case\", [\"==\", 0, [\"get\", \"level\"]], 0, 0],\n                'text-opacity': 0.8\n            },\n            'filter': filterByAircraftType(aircraftType, true, style===2)\n        });\n        const popup = new mapboxgl.Popup({\n            closeButton: true,\n            // on touchscreen, this allows to show popup on each airport click\n            // whitout having to click on the map first to cancel the popup\n            // this setting has no effect on hover mode\n            closeOnClick: false,\n            // we need a way to close airport's popup: just move the map\n            // this is not needed for popup on hover mode\n            closeOnMove: !supportsHover\n        });\n        const addAirportPopup = function (e) {\n            const coordinates = e.features[0].geometry.coordinates.slice();\n            const title = e.features[0].properties.title;\n            const icao = e.features[0].properties.name;\n            const iata = editolido.icao2iata(icao);\n            const aircraftType = get(aircraftTypeStore); // important to re-read store value when adding popup\n            // Ensure that if the map is zoomed out such that multiple\n            // copies of the feature are visible, the popup appears\n            // over the copy being pointed to.\n            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n            }\n\n            const security = e.features[0].properties.level;\n            const order = e.features[0].properties[aircraftType];\n            //console.log(status, typeof status)\n            let statusText = \"\";\n            let statusNum = \"0\";\n            switch(order) {\n                case 2:\n                case 3:\n                    statusText = \"Destination & RCF\";\n                    statusNum = \"3\";\n                    break;\n                case 4:\n                case 5:\n                    statusText = \"Dégagement à destination\";\n                    statusNum = \"2\";\n                    break;\n                case 6:\n                case 7:\n                    statusText = \"Dégagement en route\";\n                    statusNum = \"2 ERA\";\n                    break;\n                case 8:\n                case 9:\n                    statusText = \"Appui ou adéquat en route\";\n                    statusNum = \"1\";\n                    break;\n            }\n            const isMedical = e.features[0].properties.h === 1 && statusNum !== \"0\";\n            let html = `<div class=\"airport\"><h1>${icao} / ${iata}</h1><h2>${title}${(isMedical) ? ' <b>🄷</b>' : ''}</h2>`;\n            if (ofp) {\n                html +=  `<p class=\"status status-${statusNum.charAt(0)}\">STATUT ${statusNum}</p>`;\n                if(security > 0) html += `<p class=\"security-${security}\">${(security==1) ? 'ORANGE' : 'RED'}</p>`;\n                if(statusText) html += `<p class=\"status-text\">${statusText}</p>`;\n            }\n            html += \"</div>\";\n            popup.setLngLat(coordinates).setHTML(html).addTo(map);\n        };\n        const setCursorPointer = () => map.getCanvas().style.cursor = 'pointer';\n        const resetCursor = () => map.getCanvas().style.cursor = '';\n        const removeAirportPopup = function () {\n            resetCursor();\n            popup.remove();\n        };\n        if (supportsHover) {\n            map.on('mouseenter', adequateLayer, (e) => {\n                setCursorPointer();\n                addAirportPopup(e);\n            });\n            map.on('mouseenter', emergencyLayer, (e) => {\n                setCursorPointer();\n                addAirportPopup(e);\n            });\n            map.on('mouseleave', adequateLayer, removeAirportPopup);\n            map.on('mouseleave', emergencyLayer, removeAirportPopup);\n        }else{\n            map.on('mouseenter', adequateLayer, setCursorPointer);\n            map.on('mouseenter', emergencyLayer, setCursorPointer);\n            map.on('click', adequateLayer, addAirportPopup);\n            map.on('click', emergencyLayer, addAirportPopup);\n            map.on('mouseleave', adequateLayer, resetCursor);\n            map.on('mouseleave', emergencyLayer, resetCursor);\n        }\n\n    })\n};\n\nexport function changeAirportDisplay(data, visible) {\n    const {map} = data;\n    if (map.getLayer(adequateLayer)) {\n        map.setLayoutProperty(adequateLayer, 'visibility', (visible) ? 'visible': 'none');\n    }\n    if (map.getLayer(emergencyLayer)) {\n        map.setLayoutProperty(emergencyLayer, 'visibility', (visible) ? 'visible': 'none');\n    }\n}\n\nexport function changeAirportStyle(data) {\n    const {map, kmlOptions, ofp, aircraftType} = data;\n    const style = kmlOptions.airportPin;\n    if (map.getLayer(adequateLayer)) {\n        changeAdequatesColor(data);\n        map.setPaintProperty(adequateLayer, 'icon-halo-width', getIconHaloWidth(style, !!ofp));\n        map.setLayoutProperty(adequateLayer, 'text-field', getAdequateTextField(style));\n        map.setFilter(adequateLayer, filterByAircraftType(aircraftType, true, style===2));\n    }\n    if (map.getLayer(emergencyLayer)) map.setFilter(emergencyLayer, filterByAircraftType(aircraftType, false, style===2));\n}\nconst getEtopsNames = (ofp) => {\n    const raltNames = (ofp) ? ofp.infos.ralts : [];\n    let epNames = [];\n    if (ofp && ofp.infos['EEP'] && ofp.infos['EXP'] && ofp.infos['raltPoints'].length > 0) {\n        epNames = [ofp.infos['EEP'].name, ofp.infos['EXP'].name];\n    }\n    return [raltNames, epNames.concat(raltNames)];\n}\nexport function changeAircraftType(data) {\n    const {map, kmlOptions, aircraftType, ofp} = data;\n    const [, etopsNames] = getEtopsNames(ofp);\n    const style = kmlOptions.airportPin;\n    const maxPriorityNames = (ofp) ? [ofp.departure.name, ofp.arrival.name].concat(etopsNames) : etopsNames;\n    map.setFilter(adequateLayer, filterByAircraftType(aircraftType, true, style===2));\n    changeAdequatesColor(data);\n    map.setLayoutProperty(adequateLayer, 'symbol-sort-key', symbolSortKey(aircraftType, maxPriorityNames));\n    map.setFilter(emergencyLayer, filterByAircraftType(aircraftType, false, style===2));\n}\nconst changeIconText = (data) => {\n    const {map, kmlOptions, ofp} = data;\n    const [, etopsNames] = getEtopsNames(ofp);\n    if (map.getLayer(adequateLayer)) {\n        map.setLayoutProperty(adequateLayer, 'text-size', adequateTextSize(etopsNames, kmlOptions['iconTextChange']));\n    }\n    if (map.getLayer(emergencyLayer)) {\n        map.setLayoutProperty(emergencyLayer, 'text-size', emergencyTextSize(kmlOptions['iconTextChange']));\n    }\n}\nconst changeIconSize = (data) => {\n    const {map, kmlOptions, ofp} = data;\n    const [, etopsNames] = getEtopsNames(ofp);\n    if (map.getLayer(adequateLayer)) {\n        map.setLayoutProperty(adequateLayer, 'icon-size', adequateIconSize(etopsNames, kmlOptions['iconSizeChange']));\n    }\n    if (map.getLayer(emergencyLayer)) {\n        map.setLayoutProperty(emergencyLayer, 'icon-size', emergencyIconSize(kmlOptions['iconSizeChange']));\n    }\n}\nexport const changeAdequatesColor = (data) => {\n    const {map, kmlOptions, ofp, aircraftType} = data;\n    const style = kmlOptions.airportPin;\n    const [hexcolorEtops,] = kml2mapColor(kmlOptions.etopsColor);\n    const [raltNames,] = getEtopsNames(ofp);\n    if (map.getLayer(adequateLayer)) {\n        map.setPaintProperty(adequateLayer, 'icon-color', getIconColor(style, aircraftType, raltNames, hexcolorEtops, !!ofp));\n        map.setPaintProperty(adequateLayer, 'text-color', getTextColor(style, raltNames, hexcolorEtops, !!ofp));\n    }\n}\nconst changeLabel = (data) => {\n    const {map, kmlOptions, value} = data;\n    if (map.getLayer(adequateLayer)) {\n        map.setLayoutProperty(adequateLayer, 'text-field', getAdequateTextField(kmlOptions.airportPin, value));\n    }\n    if (map.getLayer(emergencyLayer)) {\n        map.setLayoutProperty(emergencyLayer, 'text-field', getEmergencyTextField(value));\n    }\n};\nexport default {\n    show: (data) => changeAirportDisplay(data, true),\n    hide: (data) => changeAirportDisplay(data, false),\n    add: addAirports,\n    changeMarker: changeAirportStyle,\n    change: changeAircraftType,\n    changeIconText,\n    changeIconSize,\n    changeLabel\n}","import {addLines, computeLineWidthSize} from '../utils';\nimport {changeAdequatesColor} from './airport';\nimport {kml2mapColor} from \"../../mapSettings/ColorPinCombo.svelte\";\n\nconst folder = 'etops';\nconst lineWidthETOPS = 1;\nconst epCircleLayer = `${folder}-ep-circle-line-layer`;\nconst etopsCircleLayer = `${folder}-etops-circle-line-layer`;\nfunction addEtops(data) {\n    const {map, mapData, ofp, kmlOptions} = data;\n    if (!ofp) return;\n    const lineWidth = computeLineWidthSize(kmlOptions['lineWidthChange'], lineWidthETOPS);\n    if (ofp.infos['EEP'] && ofp.infos['EXP'] && ofp.infos['raltPoints'].length > 0) {\n        const {affineAndClip} = mapData;\n        const etopsTime = ofp.infos.maxETOPS;\n        const visibility = kmlOptions.etopsDisplay;\n        addLines(map, `${folder}-ep-circle`, [ofp.infos['EEP'].circle(420, 48), ofp.infos['EXP'].circle(420, 48)] , affineAndClip, kmlOptions.routeColor, visibility, lineWidth, true);\n        addLines(map, `${folder}-etops-circle`, ofp.infos['raltPoints'].map(d => d.circle(7 * etopsTime)), affineAndClip, kmlOptions.etopsColor, visibility, lineWidth, true);\n    }\n}\n\nexport function changeEPCircleColor(data) {\n    const {map, kmlOptions} = data;\n    const [hexcolor, opacity] = kml2mapColor(kmlOptions.routeColor);\n    if (map.getLayer(epCircleLayer)) {\n        map.setPaintProperty(epCircleLayer, 'line-color', hexcolor);\n        map.setPaintProperty(epCircleLayer, 'line-opacity', opacity);\n    }\n}\n\nfunction changeETOPSCircleColor(data) {\n    const {map} = data;\n    const [hexcolor, opacity] = kml2mapColor(data.value);\n    if (map.getLayer(etopsCircleLayer)) {\n        map.setPaintProperty(etopsCircleLayer, 'line-color', hexcolor);\n        map.setPaintProperty(etopsCircleLayer, 'line-opacity', opacity);\n    }\n    changeAdequatesColor(data);\n}\n\nfunction changeETOPSDisplay(data, visible) {\n    const {map} = data;\n    if (map.getLayer(etopsCircleLayer)) {\n        map.setLayoutProperty(etopsCircleLayer, 'visibility', (visible) ? 'visible': 'none');\n    }\n    if (map.getLayer(epCircleLayer)) {\n        map.setLayoutProperty(epCircleLayer, 'visibility', (visible) ? 'visible': 'none');\n    }\n}\nfunction changeLineWidth(data){\n    const {map, value} = data;\n    const lineWidth = computeLineWidthSize(value, lineWidthETOPS);\n    if (map.getLayer(etopsCircleLayer)) {\n        map.setPaintProperty(etopsCircleLayer, 'line-width', lineWidth);\n    }\n    if (map.getLayer(epCircleLayer)) {\n        map.setPaintProperty(epCircleLayer, 'line-width', lineWidth);\n    }\n    return true; // allows chaining\n}\nexport default {\n    show: (data) => changeETOPSDisplay(data, true),\n    hide: (data) => changeETOPSDisplay(data, false),\n    add: addEtops,\n    changeLine: (data) => changeETOPSCircleColor(data),\n    changeLineWidth\n}\n","const folder = 'fir-reg';\nconst lineLayer = `${folder}-line-layer`;\nconst fillLayer = `${folder}-layer`;\nconst source = `${folder}-source`;\n\nexport const addFirReg = (data) => {\n    const {ofp, map, mapData, kmlOptions, mapOptions} = data;\n    if (mapOptions.id === 'jb_pacific' || mapOptions.id.startsWith('vb_')) return; // displays badly on this map\n    if (!ofp) return;\n    const {affine} = mapData;\n    const visibility = kmlOptions.firDisplay;\n    fetch('data/fir-reg.CONF_AIRAC.geojson')\n    .then(response => response.json())\n    .then(data => {\n        if (affine) {\n            for (let i = 0; i<data.features.length; i++){\n                const points = data.features[i].geometry.coordinates[0];\n                data.features[i].geometry.coordinates = [points.map(v => affine(v))];\n            }\n        }\n        map.addSource(source, {\n            type: 'geojson',\n            data: data\n        });\n        map.addLayer({\n            'id': fillLayer,\n            'type': 'fill',\n            'source': source,\n            'layout': {'visibility': (visibility) ? 'visible' : 'none'},\n            'paint': {\n                'fill-color': ['case', ['==', 'FIR-RED', ['get', 'type']], \"rgba(255,0,0,0.2)\", \"rgba(255,127,0,0.25)\"]\n                //'fill-outline-color': ['case', ['==', 'FIR-RED', ['get', 'type']], \"rgb(255,0,0)\", \"rgb(255,127,0)\"]\n            }\n        });\n        map.addLayer({\n            'id': lineLayer,\n            'type': 'line',\n            'source': source,\n            'layout': {'visibility': (visibility) ? 'visible' : 'none'},\n            'paint': {\n                'line-color': ['case', ['==', 'FIR-RED', ['get', 'type']], \"rgb(255,0,0)\", \"rgb(255,127,0)\"],\n                'line-width': 1,\n                'line-opacity': ['case', ['==', 'FIR-RED', ['get', 'type']], 0.4, 0.6]\n            }\n        });\n    })\n};\n\nexport function changeFirDisplay(data, visible) {\n    const {map} = data;\n    if (map.getLayer(fillLayer)) {\n        map.setLayoutProperty(fillLayer, 'visibility', (visible) ? 'visible': 'none');\n    }\n    if (map.getLayer(lineLayer)) {\n        map.setLayoutProperty(lineLayer, 'visibility', (visible) ? 'visible': 'none');\n    }\n}\n\nexport default {\n    show: (data) => changeFirDisplay(data, true),\n    hide: (data) => changeFirDisplay(data, false),\n    add: addFirReg,\n}","/* global editolido */\nimport {addLine, changeDisplayGeneric, changeLineGeneric, changeLineWidthGeneric, computeLineWidthSize} from '../utils';\n\nconst folder = 'great-circle';\nconst lineWidthGreatCircle = 1.5;\n\nconst addGreatCircle = (data) => {\n    const {ofp, kmlOptions, mapData, map, mapOptions} = data;\n    if (mapOptions.id.startsWith('vb_')) return; // not relevant on this map\n    if (!ofp) return;\n    const {affineAndClip} = mapData;\n    const routeName = `${ofp.infos.depICAO}-${ofp.infos.destICAO}`;\n    const route = ofp.route;\n    const greatCircle = new editolido.Route([route.points[0], route.points[route.points.length - 1]]).split(300, {\"name\": `Ortho ${routeName}`});\n    const lineWidth = computeLineWidthSize(kmlOptions['lineWidthChange'], lineWidthGreatCircle);\n    addLine(map, folder, greatCircle.points, affineAndClip, kmlOptions.greatCircleColor, kmlOptions.greatCircleDisplay, lineWidth);\n}\n\nexport default {\n    show: changeDisplayGeneric.bind(null, folder, true),\n    hide: changeDisplayGeneric.bind(null, folder, false),\n    add: addGreatCircle,\n    changeLine: changeLineGeneric.bind(null, folder),\n    changeLineWidth: (data) => changeLineWidthGeneric(folder, data, lineWidthGreatCircle)\n}","import {addLine, changeDisplayGeneric, changeLineGeneric, changeLineWidthGeneric, computeLineWidthSize} from '../utils';\n\nconst folder = 'ogimet';\nconst lineWidthOgimet = 1.5;\n\nconst addOgimet = (data) => {\n    const {map, ofp, kmlOptions, mapData, mapOptions} = data;\n    if (mapOptions.id.startsWith('vb_')) return; // not relevant on this map\n    if (!ofp) return;\n    const {affineAndClip} = mapData;\n    const lineWidth = computeLineWidthSize(kmlOptions['lineWidthChange'], lineWidthOgimet);\n    addLine(map, folder, ofp.ogimetData.route.points, affineAndClip, kmlOptions.ogimetColor, kmlOptions.ogimetDisplay, lineWidth);\n}\n\nexport default {\n    show: changeDisplayGeneric.bind(null, folder, true),\n    hide: changeDisplayGeneric.bind(null, folder, false),\n    add: addOgimet,\n    changeLine: changeLineGeneric.bind(null, folder),\n    changeLineWidth: (data) => changeLineWidthGeneric(folder, data, lineWidthOgimet)\n}","/* global editolido */\nimport {addLine, addPoints, changeDisplayGeneric, changeLineGeneric, changeIconTextGeneric, changeLineWidthGeneric, changeIconSizeGeneric, computeLineWidthSize} from '../utils';\n\nconst folder = 'ralt';\n\nconst addRalt = (data) => {\n    const {map, ofp, kmlOptions, mapData} = data;\n    if (!ofp) return;\n    const {affineAndClip, affineOrDrop} = mapData;\n    const alternateRoute = new editolido.Route(ofp.wptCoordinatesAlternate(), {\"name\": \"Route Dégagement\"});\n    const lineWidth = computeLineWidthSize(kmlOptions['lineWidthChange']);\n    addLine(map, folder, alternateRoute.points, affineAndClip, kmlOptions.alternateColor, kmlOptions.alternateDisplay, lineWidth);\n    addPoints(map, folder, alternateRoute.points, affineOrDrop, kmlOptions);\n}\n\nexport default {\n    show: changeDisplayGeneric.bind(null, folder, true),\n    hide: changeDisplayGeneric.bind(null, folder, false),\n    add: addRalt,\n    changeLine: changeLineGeneric.bind(null, folder),\n    changeIconText: changeIconTextGeneric.bind(null, folder),\n    changeLineWidth: changeLineWidthGeneric.bind(null, folder),\n    changeIconSize: changeIconSizeGeneric.bind(null, folder)\n}","/* global mapboxgl, editolido */\nimport {jsonPoint, jsonLine, featureCollection} from '../json.js';\nimport {lineLayer, markerLayer, changeLineWidthGeneric, changeLineGeneric, changeDisplayGeneric, computeIconTextSize, computeLineWidthSize, computeIconSize, getTextKmlColorExpression, getOpacityKmlColorExpression, changeIconSizeGeneric, changeIconTextGeneric} from '../utils';\nimport {takeOffTime} from \"../../../stores\";\n\nconst folder = 'rnat';\nconst lineWidthTracks = 1;\nconst minTextOpacityTracks = 0.9;\n\nconst rnatLabelLayer = (id, kmlcolor, visibility, textSize) => {\n    return {\n        'id': `${id}-marker-layer`,\n        'type': 'symbol',\n        'source': `${id.replace('-labels', '')}-line-source`,\n        'layout': {\n            'visibility': ( visibility) ? 'visible' : 'none',\n            'text-field': ['get', 'title'],\n            'text-size': textSize,\n            'text-offset': [0, -0.1],\n            'text-anchor': 'bottom',\n            'text-ignore-placement': true,\n            'text-allow-overlap': true,\n            'symbol-placement': 'line-center'\n        },\n        'paint': {\n            'text-halo-color': '#000',\n            'text-color': getTextKmlColorExpression(kmlcolor),\n            'text-opacity': getOpacityKmlColorExpression(kmlcolor, null, minTextOpacityTracks)\n        }\n    };\n};\nexport function addTracks(data) {\n    const {map, ofp, mapData, kmlOptions} = data;\n    if (!ofp) return;\n    const {affineOrDrop, affineAndClip} = mapData;\n    const affine = affineOrDrop;\n    const affineLine = affineAndClip;\n    const kmlcolor = kmlOptions.natColor;\n    const visibility = kmlOptions.natDisplay;\n\n    const lines = {\n        'rnat': [],\n        'rnat-incomplete': []\n    };\n    const markers = {\n        'rnat': [],\n        'rnat-incomplete': []\n    };\n    for (let track of ofp.tracks) {\n        const folder = (track.isComplete) ? 'rnat' : 'rnat-incomplete';\n        const natLetter = track.name.slice(-1);\n        const natDirection = track.infos.direction;\n        const natLabel = (natDirection === 'WEST') ? `<\\u2009${natLetter}` : (natDirection === 'EAST') ? `${natLetter}\\u2009>` : natLetter;\n        if (affineLine) {\n            const sublines = affineLine(track.points);\n            const sublen = sublines.length;\n            for (let i=0; i<sublen;i++){\n                lines[folder].push(jsonLine(sublines[i], {title: natLabel}));\n            }\n        }else{\n            lines[folder].push(jsonLine(track.points.map(g => [g.longitude, g.latitude]), {title: track.name.slice(-1)}))\n        }\n        const firstPoint = track.points[0];\n        let lngLat = (affine) ? affine([firstPoint.longitude, firstPoint.latitude]) : [firstPoint.longitude, firstPoint.latitude];\n        if (lngLat) markers[folder].push(jsonPoint(lngLat, {\n            title: `${(track.isMine) ? track.name + '\\n' : ''}${firstPoint.name}`,\n            description: track.description,\n            track: track.name,\n            point: firstPoint.name,\n            isMine: track.isMine,\n            direction: natDirection,\n            overrideTextColor: (track.isMine) ? 1 : 0\n        }));\n        const lastPoint = track.points[track.points.length - 1];\n        lngLat = (affine) ? affine([lastPoint.longitude, lastPoint.latitude]) : [lastPoint.longitude, lastPoint.latitude];\n        if (lngLat) markers[folder].push(jsonPoint(lngLat,{\n            title: `${(track.isMine) ? track.name + '\\n' : ''}${lastPoint.name}`,\n            description:  track.description,\n            track: track.name,\n            point: lastPoint.name,\n            isMine: track.isMine,\n            direction: natDirection,\n            noPin: 1,\n            overrideTextColor: (track.isMine) ? 1 : 0\n        }));\n    }\n    map.addSource(`rnat-marker-source`, featureCollection(markers['rnat']));\n    map.addSource(`rnat-incomplete-marker-source`, featureCollection(markers['rnat-incomplete']));\n    map.addSource(`rnat-line-source`, featureCollection(lines['rnat']));\n    map.addSource(`rnat-incomplete-line-source`, featureCollection(lines['rnat-incomplete']));\n    const textSize = computeIconTextSize(kmlOptions[`iconTextChange`]);\n    const lineWidth = computeLineWidthSize(kmlOptions[`lineWidthChange`], lineWidthTracks);\n    const iconSize = computeIconSize(kmlOptions[`iconSizeChange`]);\n    map.addLayer(lineLayer('rnat', kmlcolor, visibility, lineWidth));\n    map.addLayer(lineLayer('rnat-incomplete', kmlOptions.natIncompleteColor, visibility, lineWidth));\n    map.addLayer(markerLayer(\"rnat\", kmlcolor, visibility, textSize, iconSize));\n    changeMyTrackLabels(data); // text-color & text-opacity for entry/exit point\n    map.setLayoutProperty(\"rnat-marker-layer\", 'symbol-sort-key', [\"case\", [\"==\", 1, [\"get\", \"overrideTextColor\"]], 0, 1]);\n    map.addLayer(markerLayer(\"rnat-incomplete\", kmlcolor, visibility, textSize, iconSize));\n    map.addLayer(rnatLabelLayer('rnat-labels', kmlcolor, visibility, textSize));\n    map.addLayer(rnatLabelLayer('rnat-incomplete-labels', kmlOptions.natIncompleteColor, visibility, textSize));\n\n    const popup = (e) => {\n        const coordinates = e.features[0].geometry.coordinates.slice();\n        // Ensure that if the map is zoomed out such that multiple\n        // copies of the feature are visible, the popup appears\n        // over the copy being pointed to.\n        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n        }\n        const props = e.features[0].properties; // WARNING properties created above or in addEntryPointPopup below\n        //console.log(props);\n        const trackPopup = new mapboxgl.Popup()\n            .setLngLat(coordinates)\n            .addTo(map);\n        const unsubscribe = takeOffTime.subscribe($takeOffTime => {\n            let description = props.description.replace(props.point, `<b>${props.point}</b>`);\n            let entry = [undefined, undefined, undefined];\n            if (props.isMine) entry = ofp.timeMatrix.filter(([p,]) => editolido.isARINC(props.point) ? editolido.arinc_normalizer(props.point).asDM === p.name: props.point === p.name).pop() || entry;\n            const [, eet, fl] = entry;\n            let flInTitle = (fl) ? ` - FL${fl}` : '';\n            const direction = (props.direction === 'WEST') ? 'WB' : (props.direction === 'EAST') ? 'EB' : '';\n            if (fl) {\n                if (direction) {\n                    const pattern = new RegExp(String.raw`(LVLS ${direction})([\\d\\s]*)( ${fl} )`, \"u\");\n                    const highlighted = description.replace(pattern, \"<strong>$1</strong>$2<strong><b>$3</b></strong>\");\n                    if (description != highlighted) {\n                        description = highlighted;\n                    }else{\n                        description = description.replace(`LVLS ${direction}`, `<strong class=\"error\">LVLS ${direction}</strong>`);\n                    }\n                }\n            }\n            const eto = (eet && $takeOffTime) ? ' - ETO: ' + (new Date($takeOffTime.getTime() + 60000 * eet)).toISOString().substring(11,16) + 'z' : '';\n            let html = `<div class=\"track\"><h1>${props.track}${eto}${flInTitle}</h1><p>${description}</p>`;\n            trackPopup.setHTML(html);\n        })\n        trackPopup.on('close', () => {\n            unsubscribe();\n        });\n    };\n    const activatePopup = (folder) => {\n        const layer = folder + '-marker-layer';\n        map.on('click', layer, popup);\n        map.on('mouseenter', layer, function() {\n            map.getCanvas().style.cursor = 'pointer';\n        });\n        map.on('mouseleave', layer, function() {\n            map.getCanvas().style.cursor = '';\n        });\n    }\n    activatePopup('rnat');\n    activatePopup('rnat-incomplete');\n    const addEntryPointPopup = () => {\n        const myTrack = ofp.tracks.filter(t => t.isMine).pop();\n        if (myTrack && myTrack.points.length > 0) {\n            const entryPoint = myTrack.points[0];\n            const affine = mapData.affineOrDrop;\n            const lngLat = (affine) ? affine([entryPoint.longitude, entryPoint.latitude]) : [entryPoint.longitude, entryPoint.latitude];\n            if (lngLat) {\n                const [longitude, latitude] = lngLat;\n                const popupData = {\n                    lngLat:{\n                        \"lng\": longitude,\n                        \"lat\": latitude\n                    },\n                    features: [\n                        {\n                            \"properties\": {\n                                \"track\": myTrack.name,\n                                \"point\": entryPoint.name,\n                                \"isMine\": true,\n                                \"description\": myTrack.description,\n                                \"direction\": myTrack.infos.direction\n                            },\n                            \"geometry\": {\n                                'coordinates': [longitude, latitude]\n                            }\n                        }\n                    ]\n                };\n                popup(popupData);\n            }\n        }\n    };\n    if (mapData.initialLoad) addEntryPointPopup();\n}\n\nfunction changeLine(data){\n    changeLineGeneric(folder, data) && changeLineGeneric('rnat-labels', data);\n    changeMyTrackLabels(data);\n    return true; // allows chaining\n}\nexport function changeMyTrackLabels(data) {\n    const {map, kmlOptions} = data;\n    const markerLayer = `rnat-marker-layer`;\n    if (map.getLayer(markerLayer)) {\n        map.setPaintProperty(markerLayer, 'text-color', getTextKmlColorExpression(kmlOptions[\"natColor\"], kmlOptions[\"routeColor\"]));\n        map.setPaintProperty(markerLayer, 'text-opacity', getOpacityKmlColorExpression(kmlOptions[\"natColor\"], kmlOptions[\"routeColor\"], minTextOpacityTracks));\n    }\n    return true; // allows chaining\n}\nexport default {\n    show: (data) => [folder, 'rnat-incomplete', 'rnat-labels', 'rnat-incomplete-labels'].forEach(folder => changeDisplayGeneric(folder, true, data)),\n    hide: (data) => [folder, 'rnat-incomplete', 'rnat-labels', 'rnat-incomplete-labels'].forEach(folder => changeDisplayGeneric(folder, false, data)),\n    add: addTracks,\n    changeLine,\n    changeIconText: (data) => [folder, 'rnat-incomplete', 'rnat-labels', 'rnat-incomplete-labels'].forEach(folder => changeIconTextGeneric(folder, data)),\n    changeLineWidth: (data) => [folder, 'rnat-incomplete'].forEach(folder => changeLineWidthGeneric(folder, data, lineWidthTracks)),\n    changeIconSize: (data) => [folder, 'rnat-incomplete'].forEach(folder => changeIconSizeGeneric(folder, data))\n}","import {addLine, addPoints, changeDisplayGeneric, changeLineGeneric, changeIconTextGeneric, changeLineWidthGeneric, changeIconSizeGeneric, computeLineWidthSize} from '../utils';\nimport {changeEPCircleColor} from './etops';\nimport {changeMyTrackLabels} from './tracks';\n\nconst folder = 'rmain';\n\nconst addRmain = (data) => {\n    const {map, ofp, kmlOptions, mapData} = data;\n    if (!ofp) return;\n    const {affineAndClip, affineOrDrop} = mapData;\n    const route = ofp.route;\n    route.name = `${ofp.infos.depICAO}-${ofp.infos.destICAO}`;\n    route.description = ofp.description;\n    const lineWidth = computeLineWidthSize(kmlOptions['lineWidthChange']);\n    addLine(map, folder, route.points, affineAndClip, kmlOptions.routeColor, true, lineWidth);\n    addPoints(map, folder, route.points, affineOrDrop, kmlOptions);\n}\n\nconst changeLine = (data) => {\n    changeLineGeneric(folder, data);\n    changeEPCircleColor(data);\n    changeMyTrackLabels(data);\n    return true; // allows chaining\n}\n\nexport default {\n    show: changeDisplayGeneric.bind(null, folder, true),\n    hide: changeDisplayGeneric.bind(null, folder, false),\n    add: addRmain,\n    changeLine,\n    changeIconText: changeIconTextGeneric.bind(null, folder),\n    changeLineWidth: changeLineWidthGeneric.bind(null, folder),\n    changeIconSize: changeIconSizeGeneric.bind(null, folder)\n}","import { folderName } from '../utils';\nimport airport from './layers/airport';\nimport etops from './layers/etops';\nimport fir from './layers/fir-reg';\nimport greatCircle from './layers/great-circle';\nimport ogimet from './layers/ogimet';\nimport ralt from './layers/ralt';\nimport rmain from './layers/rmain';\nimport tracks from './layers/tracks';\n\nconst layers = {\n    'airport': airport,\n    'etops': etops,\n    'fir': fir,\n    'greatcircle': greatCircle,\n    'ogimet': ogimet,\n    'ralt': ralt,\n    'rmain': rmain,\n    'rnat': tracks\n}\nexport const loadMapLayers = (data) => {\n    const {map, mapOptions} = data;\n    if (mapOptions.tiles) {\n        map.addSource('jb-raster',{\n            'type': 'raster',\n            'tiles': mapOptions.tiles,\n            'tileSize': mapOptions.tileSize,\n        });\n        map.addLayer({\n            'id': 'jb-layer',\n            'type': 'raster',\n            'source': 'jb-raster',\n            'minzoom': 0,\n            'maxzoom': 22,\n            paint:{\n                'raster-opacity': 1\n            }\n        });\n    }\n    Object.values(layers).forEach(layer => layer.add && layer.add(data));\n}\n\nexport const updateMapLayers = (data) => {\n    const {name, value} = data;\n    const folder = folderName(name);\n    if (folder === 'icontext') {\n        return Object.values(layers).forEach(layer => layer.changeIconText && layer.changeIconText(data));\n    }else if (folder === 'linewidth'){\n        return Object.values(layers).forEach(layer => layer.changeLineWidth && layer.changeLineWidth(data));\n    }else if (folder === 'iconsize'){\n        return Object.values(layers).forEach(layer => layer.changeIconSize && layer.changeIconSize(data));\n    }\n    const module = layers[folder];\n    if (module) {\n        if (name.endsWith('-display')){\n            (value) ? module.show && module.show(data) : module.hide && module.hide(data);\n        }else if (name.endsWith('-label')) {\n            module.changeLabel && module.changeLabel(data);\n        }else if (name.endsWith('-pin')) {\n            module.changeMarker && module.changeMarker(data);\n        }else if (name.endsWith('-color')) {\n            module.changeLine && module.changeLine(data);\n        }else if (name.endsWith('-change')) {\n            module.change && module.change(data);\n        }else{\n            console.error(`ignoring map layer update for ${name}`);\n        }\n    }else{\n        console.error(`unknown layer ${name} / folder ${folder}`);\n    }\n}\n\nexport default layers","const TWO_PI = Math.PI * 2;\nconst FORTPI = Math.PI / 4;\nconst SPI = 3.14159265359;\nconst sign = function(x) {\n    return x<0 ? -1 : 1;\n}\nconst adjust_lon = function(x) {\n  return (Math.abs(x) <= SPI) ? x : (x - (sign(x) * TWO_PI));\n}\n/*\n    reference\n    The Times projection\n    Flattening the Earth, Snyder, J.P., 1993, p.213-214.\n  */\n\n\n/* Initialize the Times projection\n    -------------------------------------------*/\nexport function init() {\n    //no-op\n}\n\n/* The Times forward equations--mapping lat,long to x,y\n    ------------------------------------------------------------*/\nexport function forward(p) {\n    var lon = p.x;\n    var lat = p.y;\n    var dlon = adjust_lon(lon - this.long0);\n    var T = Math.tan(lat/2.0);\n    var S = Math.sin(FORTPI * T);\n    var S2 = S*S;\n    var x = this.x0 + (this.a * dlon  * (0.74482 - 0.34588*S2));\n    var y = this.y0 + (this.a * 1.70711 *  T);\n    p.x = x;\n    p.y = y;\n    return p;\n}\n\n/* The Times inverse equations--mapping x,y to lat/long\n    ------------------------------------------------------------*/\nexport function inverse(p) {\n    p.x -= this.x0;\n    p.y -= this.y0;\n    var T = p.y / 1.70711 / this.a;\n    var S = Math.sin(FORTPI * T);\n    var S2 = S*S;\n    var lon = adjust_lon(this.long0 + (p.x / this.a / (0.74482 - 0.34588 * S2)));\n    var lat = 2 * Math.atan(T);\n\n    p.x = lon;\n    p.y = lat;\n    return p;\n}\n\nexport var names = [\"The Times\", \"times\"];\nexport default {\n    init: init,\n    forward: forward,\n    inverse: inverse,\n    names: names\n};","\nconst epsilon2 = 1e-12;\nconst abs = Math.abs;\nconst asin = Math.asin;\nconst cos = Math.cos;\nconst sin = Math.sin;\nconst sqrt = Math.sqrt;\n/*\n    reference\n    https://github.com/d3/d3-geo/blob/master/src/projection/equalEarth.js\n  */\n\n    const A1 = 1.340264,\n    A2 = -0.081106,\n    A3 = 0.000893,\n    A4 = 0.003796,\n    M = sqrt(3) / 2,\n    iterations = 12;\n\n\n/* Initialize the Equal Earth projection\n    -------------------------------------------*/\nexport function init() {\n    //lat=phi long=lambda\n    //equations considers x0=y0=long0=0\n}\n\n/* The Equal Earth forward equations--mapping lat,long to x,y \n    ------------------------------------------------------------*/\nexport function forward(p) {\n    const lambda = p.x;\n    const phi = p.y;\n    const l = asin(M * sin(phi)), l2 = l * l, l6 = l2 * l2 * l2;\n    p.x = this.a * lambda * cos(l) / (M * (A1 + 3 * A2 * l2 + l6 * (7 * A3 + 9 * A4 * l2)));\n    p.y = this.a * l * (A1 + A2 * l2 + l6 * (A3 + A4 * l2));\n    return p;\n}\n\n/* The Equal Earth inverse equations--mapping x,y to lat/long\n    ------------------------------------------------------------*/\nexport function inverse(p) {\n    const y = p.y / this.a;\n    const x = p.x / this.a;\n\n    let l = y, l2 = l * l, l6 = l2 * l2 * l2;\n    for (var i = 0, delta, fy, fpy; i < iterations; ++i) {\n        fy = l * (A1 + A2 * l2 + l6 * (A3 + A4 * l2)) - y;\n        fpy = A1 + 3 * A2 * l2 + l6 * (7 * A3 + 9 * A4 * l2);\n        l -= delta = fy / fpy, l2 = l * l, l6 = l2 * l2 * l2;\n        if (abs(delta) < epsilon2) break;\n    }\n\n    p.x =  M * x * (A1 + 3 * A2 * l2 + l6 * (7 * A3 + 9 * A4 * l2)) / cos(l);\n    p.y = asin(sin(l) / M);\n    return p;\n}\n\nexport var names = [\"Equal Earth\", \"eqearth\"];\nexport default {\n    init: init,\n    forward: forward,\n    inverse: inverse,\n    names: names\n};","/* global mapboxgl */\n\nimport {clamp, isInside, lineclip, getBounds} from '../utils';\nimport {loadMapLayers} from './layersManagement';\nimport {focusMode, sidebar} from '../../stores';\nimport times from './pj_times';\nimport eqearth from './pj_eqearth';\n\nexport const token = 'MAPBOX_TOKEN';\n\nexport const key = {};\n\nexport const mapControlHTML = focusMode => (\n    (focusMode) \n    ? '<svg><use xlink:href=\"#single-layer-symbol\"/></svg>'\n    : '<svg><use xlink:href=\"#layers-symbol\"/></svg>');\n\nexport function createMap(id, mapOptions, ofp, kmlOptions, aircraftType, onLoadCb, initialLoad=false) {\n    if (!window.proj4.Proj.projections.get('times')) window.proj4.Proj.projections.add(times);\n    if (!window.proj4.Proj.projections.get('eqearth')) window.proj4.Proj.projections.add(eqearth);\n    const customAttribution = () => {\n        const airportsAttribution = 'Airports/FIR © Olivier Ravet';\n        if (mapOptions.id.startsWith('ed_eqe')) {\n            return `© equal-earth.com - ${airportsAttribution}`;\n        } else if (mapOptions.id.startsWith('jb_') || mapOptions.id.startsWith('ed_')) {\n            return `Yammer/QGIS & Avenza maps - ${airportsAttribution}`;\n        } else if (mapOptions.id.startsWith('vb_')) {\n            return `© ${window.atob(\"Q2FydGFCb3NzeQ==\")}.com - Airports © Olivier Ravet`;\n        } else{\n            return `Yammer/Maps.me - ${airportsAttribution}`;\n        }\n    }\n    let mapboxOptions = {\n        'container':id,\n        'center': [0, 49],\n        'zoom': 2,\n        'attributionControl': true,\n        'customAttribution': customAttribution()\n    }\n    const map = new mapboxgl.Map({...mapOptions.mapboxOptions, ...mapboxOptions});\n    map._setCacheLimits(320, 32);\n    map.loadImage('sdf/maki-marker-sdf.png', function(error, image) {\n        if (error) {\n            console.log(error);\n        } else {\n            map.addImage('sdf-marker-15', image, { pixelRatio: 2, sdf: true});\n        }\n    });\n    map.loadImage('sdf/map-triangle-sdf.png', function(error, image) {\n        if (error) {\n            console.log(error);\n        } else {\n            map.addImage('sdf-triangle', image, { pixelRatio: 2, sdf: true});\n        }\n    });\n    map.loadImage('sdf/map-circle-sdf.png', function(error, image) {\n        if (error) {\n            console.log(error);\n        } else {\n            map.addImage('sdf-airport', image, { pixelRatio: 2, sdf: true});\n        }\n    });\n    map.loadImage('sdf/map-star-sdf.png', function(error, image) {\n        if (error) {\n            console.log(error);\n        } else {\n            map.addImage('sdf-star', image, { pixelRatio: 2, sdf: true});\n        }\n    });\n    // definitions from epsg.io\n    //https://epsg.io/4326\n    window.proj4.defs('WGS84', \"+proj=longlat +datum=WGS84\");\n    //https://epsg.io/3857\n    window.proj4.defs(\"EPSG:3857\",\"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs\");\n    let affine, affineAndClamp, affineOrDrop, affineAndClip;\n    let affine2xy = (lngLat) => window.proj4('WGS84', 'EPSG:3857', lngLat);\n    let xy2wgs84 = (xy) => window.proj4('EPSG:3857', 'WGS84', xy);\n    let reverseLngLat = (lngLat) => window.proj4('EPSG:3857', 'WGS84', window.proj4('WGS84', 'EPSG:3857', lngLat));\n    if (mapOptions.extent) {\n        window.proj4.defs('CUSTOM', mapOptions.proj4);\n        let a, b, c, d;\n        if (mapOptions.affineTransform) {\n            [a, b, c, d] = mapOptions.affineTransform;\n        }else{\n            const mercatorBounds = [-20026376.39, -20048966.10, 20026376.39, 20048966.10]; //EPSG:3857 bounds\n            const [x0, y0, x1, y1] = mapOptions.extent;\n            let [u0, v0, u1, v1] = mercatorBounds;\n            if (mapOptions.ratio) { /* this is not exact, still in progress */\n                const mercatorHeight = mercatorBounds[3] - mercatorBounds[1];\n                const [w, h] = mapOptions.ratio;\n                const dy = (h / w) * mercatorHeight;\n                [u0, v0, u1, v1] = [mercatorBounds[0], mercatorBounds[3] - dy, mercatorBounds[2],  mercatorBounds[3]];\n            }\n            a = (u1 - u0) / (x1 - x0);\n            b = u0 - (a * x0);\n            c = (v1 - v0) / (y1 - y0);\n            d = v0 - (c * y0);\n            //console.log(a,b,c,d)\n        }\n        const [minX, minY, maxX, maxY] = (mapOptions.viewport) ? mapOptions.viewport : mapOptions.extent;\n        const customXY = (lngLat) => window.proj4('WGS84', 'CUSTOM', lngLat);\n        const xy2customXY = ([x, y]) => [(x - b) / a, (y - d) / c];\n        const customXY2xy = (XY) => [(a * XY[0]) + b, (c * XY[1]) + d];\n        const customXY2wgs84 = (XY) => {/*console.log('XY2xy', customXY2xy(XY)); */return xy2wgs84(customXY2xy(XY));}\n        reverseLngLat = (lngLat) => window.proj4('CUSTOM', 'WGS84', xy2customXY(window.proj4('WGS84', 'EPSG:3857', lngLat)));\n        affine2xy = (lngLat) => {\n            return customXY2xy(customXY(lngLat));\n        }\n        affine = (lngLat) => {\n            return xy2wgs84(affine2xy(lngLat))\n        }\n        affineAndClamp = (lngLat) => {\n            let [X, Y] = customXY(lngLat);\n            X = clamp(X, minX, maxX);\n            Y = clamp(Y, minY, maxY);\n            return customXY2wgs84([X, Y]);\n        }\n        affineOrDrop = (lngLat) => {\n            let [X, Y] = customXY(lngLat);\n            if (isInside(X, minX, maxX) && isInside(Y, minY, maxY)) {\n                return customXY2wgs84([X, Y]);\n            }\n        }\n        affineAndClip = (data) => {\n            if (data.length === 0) return [];\n            const points = data.map(g => customXY([g.longitude, g.latitude]));\n            return lineclip(points, mapOptions.extent).map(l => l.map(XY => customXY2wgs84(XY)));\n        }\n    }\n    let bbox = undefined;\n    let points = [];\n    if (ofp) {\n        for (const track of ofp.tracks) {\n            points = points.concat(track.points);\n        }\n        points = points.concat(ofp.route.points, ofp.wptCoordinatesAlternate());\n        bbox = getBounds(points, affineAndClamp);\n\n        map.fitBounds(bbox, {padding: {top: 30, bottom:80, left: 30, right: 30}});\n    }\n    //map.addControl(new mapboxgl.FullscreenControl());\n    const geolocate = new mapboxgl.GeolocateControl({\n        positionOptions: {\n            enableHighAccuracy: false\n        },\n        fitBoundsOptions: {maxZoom: 3},\n        trackUserLocation: true\n    });\n    if (affine) {\n        const originalOnSuccess = geolocate._onSuccess;\n        geolocate._onSuccess = function(position) {\n            const [lng, lat] = affine([position.coords.longitude, position.coords.latitude]);\n            return originalOnSuccess.apply(this, [{'coords': {'longitude': lng, 'latitude': lat, 'accuracy': position.coords.accuracy}}]);\n        }\n    }\n\n    const mapData = {map, affine, affineAndClamp, affineAndClip, affineOrDrop, bbox, mapOptions, geolocate, initialLoad};\n\n    class LayersControl {\n        onAdd(map) {\n        this._map = map;\n        this._container = document.createElement('div');\n        this._container.className = 'mapboxgl-ctrl  mapboxgl-ctrl-group';\n        this._button = document.createElement('button');\n        this._button.className = 'mapboxgl-ctrl-layers';\n        this._button.setAttribute('type', \"button\");\n        this._button.setAttribute('title', \"Personnaliser la carte\");\n        this._focusModeUnsubscribe = focusMode.subscribe($focusMode => this._button.innerHTML = mapControlHTML($focusMode));\n        this._container.appendChild(this._button);\n        this._toggleSidebar = () => sidebar.update((value) => !value);\n        this._button.addEventListener('click', this._toggleSidebar);\n        return this._container;\n        }\n        onRemove() {\n        this._button.removeEventListener('click', this._toggleSidebar);\n        this._focusModeUnsubscribe();\n        this._container.parentNode.removeChild(this._container);\n        this._map = undefined;\n        }\n    }\n    map.addControl(new(LayersControl));\n    map.addControl(geolocate);\n    let calibrateMode = false;\n    let calibrateData = [];\n    const calibrate = (e) => {\n        console.log(reverseLngLat([e.lngLat.lng, e.lngLat.lat]));\n        const expectedLngLat = reverseLngLat([e.lngLat.lng, e.lngLat.lat]).map(v => Math.round(v));\n        const [X, Y] = window.proj4('WGS84', 'CUSTOM', expectedLngLat);\n        const [x, y] = window.proj4('WGS84', 'EPSG:3857', [e.lngLat.lng, e.lngLat.lat]);\n        // x1 = aX1+b\n        // y1 = cY1+d\n        // x2 = aX2+b\n        // y2 = cY2+d\n        calibrateData.push([X, Y, x, y]);\n        console.log(`point${calibrateData.length}: ${expectedLngLat}`);\n        if (calibrateData.length === 2) {\n            const [X1, Y1, x1, y1] = calibrateData[0];\n            const [X2, Y2, x2, y2] = calibrateData[1];\n            const a = (x1 - x2)/(X1 - X2);\n            const b = x1 - (a * X1);\n            const c = (y1 - y2)/(Y1 - Y2);\n            const d = y1 - (c * Y1);\n            console.log({a, b, c, d});\n            calibrateData = [];\n        }\n    };\n    const handleKeydown = (event) => {\n        if (event.ctrlKey) {\n            calibrateMode = !calibrateMode;\n            map.getCanvasContainer().style.cursor = (calibrateMode) ? \"crosshair\" : \"grab\";\n            calibrateData = [];\n            if (calibrateMode) {\n                map.on('click', calibrate);\n            } else {\n                map.off('click', calibrate);\n            }\n        }\n        \n    };\n    map.on('load', function() {\n\n        loadMapLayers({\n            ofp,\n            kmlOptions,\n            mapData,\n            map,\n            mapOptions,\n            aircraftType\n        });\n\n        // if (ofp) addToSWCache([ofp.ogimetData.proxyImg], 'lido-gramet2');\n        //fetch(ofp.ogimetData.proxyImg); // add to cache\n        if (onLoadCb) onLoadCb(map, mapOptions);\n        // eslint-disable-next-line no-constant-condition\n        if ('process.env.NODE_ENV' === '\"development\"') {\n            document.addEventListener('keydown', handleKeydown);\n            console.log(`map initial zoom: ${map.getZoom()}`);\n        }\n    });\n    map.on('remove', function() {\n        // eslint-disable-next-line no-constant-condition\n        if ('process.env.NODE_ENV' === '\"development\"') document.removeEventListener('keydown', handleKeydown);\n    });\n    // map.on('zoom', function() {\n    //     console.log(map.getZoom());\n    // });\n    return mapData;\n}\n","/* global mapboxgl */\nexport class TilesCache {\n    constructor(dbName, version, callback) {\n        this.dbName = dbName;\n        \n        this.dbPromise = new Promise((resolve, reject) => {\n            const open = indexedDB.open(dbName, version);\n            open.onsuccess = () => {\n                resolve(open);\n            };\n            open.onerror = () => {\n                reject('Error while opening DB');\n            };\n            open.onupgradeneeded = (callback) ? callback.bind(null, open): () => {};\n        });\n\n    }\n    getImageIdFromURL(url) {\n        return url.pathname.replace(/[/.]/g,'_');\n    }\n    async fetchImageFromDB (imageId, storeName) {\n        const open = await this.dbPromise;\n        return new Promise((resolve, reject) => {\n            const tx =  open.result.transaction(storeName, 'readonly');\n            const store = tx.objectStore(storeName);\n            const imageInStoreReq = store.get(imageId);\n            imageInStoreReq.onsuccess = () => {\n                resolve(imageInStoreReq.result);\n            };\n            imageInStoreReq.onerror = () => {\n                reject('Something went wrong while fetching image from DB ');\n            };\n        });\n    }\n    async putImageInDB(imageId, storeName, blob) {\n        const open = await this.dbPromise;\n        return new Promise((resolve, reject) => {\n            const tx = open.result.transaction(storeName, 'readwrite');\n            const store = tx.objectStore(storeName);\n            const imagePutReq = store.put(blob, imageId);\n            imagePutReq.onsuccess = () => {\n                const imageInStoreReq = store.get(imageId);\n                imageInStoreReq.onsuccess = () => {\n                    resolve(imageInStoreReq.result);\n                };\n            };\n            imagePutReq.onerror = () => {\n                reject('Something went wrong while putting image in DB ');\n            };\n        });\n    }\n    getCacheHandler(storeName) {\n        return this._cacheHandler.bind(this, storeName);\n    }\n    async isNotCached(storeName, url) {\n        const imageID = this.getImageIdFromURL(url);\n        const open = await this.dbPromise;\n        return new Promise((resolve, reject) => {\n            const tx =  open.result.transaction(storeName, 'readonly');\n            const store = tx.objectStore(storeName);\n            const imageInStoreReq = store.getKey(imageID);\n            imageInStoreReq.onsuccess = () => {\n                resolve((imageInStoreReq.result === undefined) ? url : null); //returns url if not in cache, null otherwise\n            };\n            imageInStoreReq.onerror = () => {\n                reject('Something went wrong while checking if cached from DB ');\n            };\n        });\n    }\n    async countTiles(storeName) {\n        const open = await this.dbPromise;\n        return new Promise((resolve, reject) => {\n            const tx =  open.result.transaction(storeName, 'readonly');\n            const store = tx.objectStore(storeName);\n            const countStoreReq = store.count();\n            countStoreReq.onsuccess = () => resolve(countStoreReq.result);\n            countStoreReq.onerror = () => reject('Something went wrong while counting entries from DB');\n        });\n    }\n    async close() {\n        const open = await this.dbPromise;\n        open.result.close();\n    }\n    async _cacheHandler(storeName, { request, url }) {\n        const imageID = this.getImageIdFromURL(url);\n        return this.fetchImageFromDB(imageID, storeName).then((blob) => {\n            if (blob) {\n                // If image is directly available in DB then return the blob as the response.\n                return new Response(blob);\n            } else {\n                // If the image is unavailable, fetch the image by resuming the intercepted request to the server.\n                return fetch(request).then(response => {\n                    const respClone = response.clone();\n                    return respClone.blob()\n                }).then(imageBlob => {\n                    if (imageBlob.type.startsWith('image/')||imageBlob.type === 'application/x-protobuf') {\n                        return this.putImageInDB(imageID, storeName, imageBlob).then((blob) => {\n                            return new Response(blob);\n                        });\n                    } else {\n                        return new Response('', { \"status\" : 404 , \"statusText\" : \"invalid image found (sw)\"})\n                    }\n                });\n            }\n        });\n    }\n}\nfunction lon2tile(lon,zoom) { return (Math.floor((lon+180)/360*Math.pow(2,zoom))); }\nfunction lat2tile(lat,zoom)  { return (Math.floor((1-Math.log(Math.tan(lat*Math.PI/180) + 1/Math.cos(lat*Math.PI/180))/Math.PI)/2 *Math.pow(2,zoom))); }\nexport const findMissingCacheTiles = async (ofp, mapData) => {\n    const {map, mapOptions, bbox} = mapData;\n    if (!map) return [];\n    const tilesCaches = new TilesCache('CONF_TILES_DB');\n\n    if (mapOptions.cacheAll) {\n        const tilesCount = await tilesCaches.countTiles(mapOptions.cacheName);\n        \n        let tilesMax;\n        if (mapOptions.matrix) {\n            tilesMax = mapOptions.matrix.map(([w, h]) => w * h);\n        } else {\n            tilesMax = [...Array(mapOptions.cacheZoom + 1).keys()].map(v => Math.pow(2, v) * Math.pow(2, v));\n        } \n        if (tilesCount >= tilesMax.reduce((a, b) => a + b, 0)) {\n            tilesCaches.close();\n            console.log('map is fully cached', tilesMax);\n            caches[mapOptions.id] = true;\n            return [];\n        }\n    }\n\n    const [sw, ne] = [[bbox[0], bbox[1]], [bbox[2], bbox[3]]];\n    const promises = [];\n    for (let zoom=0; zoom <= mapOptions.cacheZoom; zoom++) {\n        let swXY, neXY;\n        const max = Math.pow(2,zoom);\n        if (mapOptions.cacheAll) {\n            swXY={x: 0, y: max - 1};\n            neXY={x: max - 1, y: 0};\n        } else {\n            swXY={x: lon2tile(sw[0], zoom), y: lat2tile(sw[1], zoom)};\n            neXY={x: lon2tile(ne[0], zoom), y: lat2tile(ne[1], zoom)};\n        }\n        let maxX, maxY;\n        if (mapOptions.matrix) {\n            [maxX, maxY] = mapOptions.matrix[zoom];\n        }else{\n            [maxX, maxY] = [max, max];\n        }\n\n        for (let x=swXY.x; x<=neXY.x; x++) {\n            for (let y=neXY.y; y<=swXY.y; y++) {\n                if(x>=0 && y>=0 && x<maxX && y<maxY){\n                    let url;\n                    if(mapOptions.tiles) {\n                        url = new URL(mapOptions.tiles[0].replace('{z}', zoom).replace('{x}', x).replace('{y}', y));\n                        promises.push(tilesCaches.isNotCached(mapOptions.cacheName, url));\n                    } else {\n                        url = new URL(`https://api.mapbox.com/v4/denizotjb.6nts91f3/${zoom}/${x}/${y}@2x.webp?sku=${map._requestManager._skuToken}&access_token=${mapboxgl.accessToken}`);\n                        promises.push(tilesCaches.isNotCached(mapOptions.cacheName, url));\n                        url = new URL(`https://api.mapbox.com/v4/denizotjb.9001lcsf,denizotjb.494jxmoa,mapbox.mapbox-streets-v8,denizotjb.1x3i1g8r,denizotjb.bifqeinj,denizotjb.cz0kdfpx,denizotjb.aop85z8z,mapbox.mapbox-terrain-v2/${zoom}/${x}/${y}.vector.pbf?sku=${map._requestManager._skuToken}&access_token=${mapboxgl.accessToken}`);\n                        promises.push(tilesCaches.isNotCached(mapOptions.cacheName, url));\n                    }\n                }\n            }\n        }\n    }\n    const results = await Promise.all(promises);\n    tilesCaches.close();\n    return results.filter(url => url !== null);\n};\n","<script>\n    export let value = 0;\n    export let max = 100;\n    $: progressPath = () => {\n        if (value <= 0) {\n            return \"\";\n        } else if (value >= max) {\n            return \"M50,5A45 45 0 1 1 49.9999 5\";\n        } else {\n            const angle = Math.PI * 2 * (value / max);\n            const x = 50 + Math.cos(angle - Math.PI / 2) * 45;\n            const y = 50 + Math.sin(angle - Math.PI / 2) * 45;\n            let path = \"M50,5\";\n            if (angle > Math.PI) {\n                path += \"A45 45 0 0 1 50 95\";\n            }\n            path += `A45 45 0 0 1 ${x} ${y}`;\n            return path;\n        }\n    };\n</script>\n\n<svg viewBox=\"0 0 108 108\">\n    <circle cx=\"54\" cy=\"54\" r=\"50\"/>\n    <path d=\"M50,5A45 45 0 1 1 49.9999 5\" transform=\"translate(4,4)\"/>\n    <path d=\"{progressPath()}\" transform=\"translate(4,4)\"/>\n</svg>\n<slot></slot>\n\n<style>\n    svg {\n        fill: var(--progress-fill, transparent);\n        height: var(--progress-height, 24px);\n        stroke-linecap: var(--progress-linecap, round);\n        width: var(--progress-width, 24px);\n    }\n    circle {\n        fill: var(--progress-circlefill, transparent);\n        stroke: var(--progress-circlestroke, white);\n        stroke-width: 8px;\n    }\n    path:first-of-type {\n        stroke: var(--progress-trackcolor, var(--bs-gray-500));\n        stroke-width: var(--progress-trackwidth, 10px);\n    }\n    path:last-child {\n        stroke: var(--progress-color, yellow);\n        stroke-width: var(--progress-width, 12px);\n    }\n</style>","<script>\n    import {selectedAircraftType, aircraftType} from '../stores';\n    import {aircraftTypes, discontinuatedAircraftTypes} from '../constants';\n    import blurAction from '../actions/blurAction';\n    export let aircraftTypeSelectElement = null;\n</script>\n\n<!-- svelte-ignore a11y-no-onchange -->\n<select bind:this={aircraftTypeSelectElement} name=\"aircraftType\" bind:value={$selectedAircraftType} on:change use:blurAction>\n    {#if (!$aircraftType)}\n        <option value=\"{undefined}\" selected={true}>???</option>\n    {/if}\n    {#each aircraftTypes as type}\n        {#if (type === $aircraftType || !discontinuatedAircraftTypes.includes(type))}\n            <option value=\"{type}\" selected={type === $aircraftType}>{type}</option>\n        {/if}\n    {/each}\n</select>\n\n<style>\n    select[name=aircraftType] {\n        background-color: rgba(255,255,255,0.3);\n        border: none;\n        font-size: 12px;\n        display: none;\n        margin-right: 5px;\n        z-index: 2;\n        padding: 0px 10px;\n        appearance: none;\n        -webkit-appearance: none;\n        -moz-appearance: none;\n    }\n</style>","<script>\n    import { position } from \"../stores\";\n    import { onMount, onDestroy } from \"svelte\";\n\n    let planeMarker;\n    export let mapData;\n\n    const planeElement = window.document.createElement(\"div\");\n    planeElement.classList.add(\"mapboxgl-user-location-dot\", \"map-plane\");\n    const placePlane = (geoPoint) => {\n        if (planeMarker) {\n            const affine = mapData.affine;\n            const [lng, lat] = affine\n                ? affine([geoPoint.longitude, geoPoint.latitude])\n                : [geoPoint.longitude, geoPoint.latitude];\n            planeMarker.setLngLat([lng, lat]);\n        }\n    };\n\n    $: placePlane($position.map);\n\n    onMount(() => {\n        planeMarker = new mapboxgl.Marker(planeElement);\n        placePlane($position.map);\n        planeMarker.addTo(mapData.map);\n\n    });\n    onDestroy(() => {\n        if (planeMarker) {\n            planeMarker.remove();\n            planeMarker = undefined;\n        }\n    });\n</script>\n\n<style>\n    :global(.mapboxgl-user-location-dot.map-plane, .mapboxgl-user-location-dot.map-plane:before) {\n        background-color: var(--plane-color);\n    }\n    /* :global(.map-plane) {\n        width: 20px;\n        height:20px;\n        border: 2px solid var(--plane-color);\n        border-radius: 50%;\n    } */\n    :global(.mapboxgl-user-location-dot.map-plane:before) {\n        /* content: \"\"; */\n        /* position: absolute; */\n        -webkit-animation: mapboxgl-map-plane-dot-pulse 10s infinite;\n        -moz-animation: mapboxgl-map-plane-dot-pulse 10s infinite;\n        -ms-animation: mapboxgl-map-plane-dot-pulse 10s infinite;\n        animation: mapboxgl-map-plane-dot-pulse 10s infinite;\n        /* align-content: baseline; */\n    }\n    @keyframes -global-mapboxgl-map-plane-dot-pulse {\n        0%   { transform: scale(1); opacity: 1; background-color: var(--plane-color);}\n        14%  { transform: scale(3); opacity: 0; background-color: var(--plane-halo-color);}\n        20% { transform: scale(1); opacity: 0; background-color: var(--plane-color);}\n    }\n</style>\n","const blankStyle = {\n    \"version\": 8,\n    \"name\": \"Blank pour App\",\n    \"metadata\": {\n        \"mapbox:autocomposite\": true,\n        \"mapbox:type\": \"template\",\n        \"mapbox:sdk-support\": {\n            \"js\": \"1.9.0\",\n            \"android\": \"8.6.0\",\n            \"ios\": \"5.6.0\"\n        },\n        \"mapbox:groups\": {},\n        \"mapbox:uiParadigm\": \"layers\"\n    },\n    \"center\": [0, 0],\n    \"zoom\": 1.2946207284336362,\n    \"bearing\": 0,\n    \"pitch\": 0,\n    \"sources\": {},\n    \"sprite\": \"mapbox://sprites/flyingeek/ckbhlmwdm0mn51imw8t4dddqs/ck2u8j60r58fu0sgyxrigm3cu\",\n    \"glyphs\": \"mapbox://fonts/flyingeek/{fontstack}/{range}.pbf\",\n    \"layers\": [],\n    \"created\": \"2020-06-16T07:22:32.952Z\",\n    \"id\": \"ckbhlmwdm0mn51imw8t4dddqs\",\n    \"modified\": \"2020-06-16T07:23:29.539Z\",\n    \"owner\": \"flyingeek\",\n    \"visibility\": \"public\",\n    \"draft\": false\n}\nexport {blankStyle as default}","import blankStyle from './blankStyle';\n// Pour réaliser les tiles dans Map Tiler\n// - Choisir Andvanced Tiles -> Continue\n// - Choisir le TIF geo-référencé -> Continue\n// - choisir Custom dans presets\n// - choisir \"from output\" et 512px x 512px\n// - choisir Zoom: 0 à 4\n// - choisir \"Advanced Options\" -> séléctionner JPEG, laisser sur Sparse Output et OpenGIS -> Close\n// - choisir \"Folder\" -> Render\nconst query = \"(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)\";\nconst tilesResolution = (matchMedia(query).matches) ? 256 : 512;\nconst options = [\n    {\n        'label': 'Mercator',\n        'id': 'mercator',\n        'mapboxOptions': {\n            //'style': 'mapbox://styles/flyingeek/ckc4yge17166a1ip66rkf0zhr',\n            //'style': 'mapbox://styles/flyingeek/cklgh38ep0xsr17qsvlrhth1e',\n            'style': 'mapbox://styles/flyingeek/cknj4nmwu0t8117ny6rk7dwbg',\n            'renderWorldCopies': false,\n            'maxZoom': 12\n        },\n        'cacheName': 'CONF_MERCATOR',\n        'cacheZoom': 6\n    },\n    {\n        'label': 'Lambert North',\n        'id': 'jb_north',\n        'extent': [-7441575.32982940, -5719574.16449270, 7383398.17621086, 9105399.34154755],\n        //'affineTransform': [2.63206100208865, -323662.179369435, 2.63502996130431, -10626687.7639946],\n        'proj4': '+proj=lcc +lat_1=30 +lat_2=65 +lat_0=47.5 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',\n        'mapboxOptions': {\n            'style': blankStyle,\n            'renderWorldCopies': false,\n            'maxZoom': 5\n        },\n        'tiles': ['CONF_NORTH_TILES_BASE_URL/{z}/{x}/{y}.jpg'],\n        'cacheZoom': 4,\n        'cacheName': 'CONF_NORTH',\n        'cacheAll': true,\n        'tileSize': tilesResolution\n    },\n    {\n        'label': 'Lambert South',\n        'id': 'jb_south',\n        'extent': [-12613000.20107552, -12796118.19556621, 13437104.14597977, 13253986.15148908],\n        'validity': [-12613903.56963206, -9420000.1608799, 13437054.51836624, 5862747.38325809],\n        'proj4': '+proj=lcc +lat_1=-15 +lat_2=30 +lat_0=7.5 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',\n        'mapboxOptions': {\n            'style': blankStyle,\n            'renderWorldCopies': false,\n            'maxZoom': 5\n        },\n        'tiles': ['CONF_SOUTH_TILES_BASE_URL/{z}/{x}/{y}.jpg'],\n        'cacheZoom': 4,\n        'cacheName': 'CONF_SOUTH',\n        'cacheAll': true,\n        'tileSize': tilesResolution\n    },\n    {\n        'label': 'Lambert Pacific',\n        'id': 'jb_pacific',\n        'extent': [-8306365.14297095, -7788164.66141786, 6519185.45830619, 7037385.93985927],\n        'proj4': '+proj=lcc +lat_1=-15 +lat_2=30 +lat_0=7.5 +lon_0=-140 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',\n        'mapboxOptions': {\n            'style': blankStyle,\n            'renderWorldCopies': false,\n            'maxZoom': 5\n        },\n        'tiles': ['CONF_PACIFIC_TILES_BASE_URL/{z}/{x}/{y}.jpg'],\n        'cacheName': 'CONF_PACIFIC',\n        'cacheZoom': 4,\n        'cacheAll': true,\n        'tileSize': tilesResolution\n    },\n    {\n        'label': 'The World',\n        'id': 'jb_theworld',\n        // for wide map\n        //'ratio': [16358, 10084], /* width, height, but we use affineTransform instead */\n        // coefficients based on ratio\n        //'affineTransform': [1.314746085506463, -40260.546626176685, 1.3162291162962998, 6490582.670755925]\n        // coefficients adjusted manually\n        'affineTransform': [1.314746085506463, -45260.546626176685, 1.315 ,6480000],\n        \"extent\": [-15201502.45260082, -8478963.56607166, 15262747.04890729, 10300929.57326125],\n        //\n        // 10000x10000 px map adjust\n        //'affineTransform': [1.342031311736757, 1178.4237424843013, 1.3435451202037834, -1086726.777713921],\n        //'affineTransform': [1.342031311736757, 1178.4237424843013, 1.3425, -1095092],\n        //'affineTransform': [1.342031311736757, 1178.4237424843013, 1.3421, -1100000],\n        //\"extent\": [-14923314.11241390, -14113585.79413393, 14921557.93320679, 15731286.25148677],\n        \"proj4\": \"+proj=times +ellps=sphere +no_defs +wktext +lon_0=0 +x_0=0 +y_0=0\",\n        // zoom6 available on netlify but to reduce size we limit to 5\n        'mapboxOptions': {\n            'style': blankStyle,\n            'renderWorldCopies': false,\n            'maxZoom': 5\n        },\n        'tiles': ['CONF_THEWORLD_TILES_BASE_URL/{z}/{x}/{y}.webp'],\n        'matrix': [[1, 1], [2, 2], [4, 3], [8, 5], [16, 10], [32, 20], [64, 40]],\n        'cacheZoom': 5,\n        'cacheName': 'CONF_THEWORLD',\n        'cacheAll': true,\n        'tileSize': tilesResolution\n    },\n    {\n        'label': '=Physique=',\n        'id': 'ed_eqe_physical_fr',\n        // for wide map\n        //\"ratio\": [19268, 10630],\n        // coefficients based on ratio\n        //'affineTransform': [1.1037001869442906, 855.8520345054567, 1.1049451584091474, 9308847.034806727]\n        // coefficients adjusted manually\n        'affineTransform': [1.104, -855.8520345054567, 1.10, 9310000],\n        // coefficients using calibration\n        //'affineTransform': [1.1037, 855, 1.10, 9305000],\n        // coefficients using calibration zoom 9\n        //'affineTransform': [1.1036, -630, 1.09925, 9304530],\n        \"extent\": [-18145536.69460000, -10300589.33644032, 18143985.81684419, 9720047.17470000],\n        \"proj4\": \"+proj=eqearth +datum=WGS84 +wktext\",\n        // zoom6 available on netlify but to reduce size we limit to 5\n        'mapboxOptions': {\n            'style': blankStyle,\n            'renderWorldCopies': false,\n            'maxZoom': 5\n        },\n        'tiles': ['CONF_EQE_PHYSICAL_FR_TILES_BASE_URL/{z}/{x}/{y}.webp'],\n        'matrix': [[1, 1], [2, 2], [4, 3], [8, 5], [16, 9], [32, 18], [64, 36]],\n        'cacheZoom': 5,\n        'cacheName': 'CONF_EQE_PHYSICAL_FR',\n        'cacheAll': true,\n        'tileSize': tilesResolution\n    }\n    //,\n    // {\n    //     'label': '=Politique=',\n    //     'id': 'ed_eqe_political_fr',\n    //     // for wide map\n    //     //\"ratio\": [19268, 10630],\n    //     //'affineTransform': [1.1037001869442906, 855.8520345054567, 1.1049451584091474, 9308847.034806727]\n    //     'affineTransform': [1.104, -855.8520345054567, 1.10, 9310000],\n    //     \"extent\": [-18144998.39890000, -9405510.77770950, 18144670.32165249, 9729041.82040000],\n    //     \"proj4\": \"+proj=eqearth +datum=WGS84 +wktext\",\n    //     'mapboxOptions': {\n    //         'style': blankStyle,\n    //         'renderWorldCopies': false,\n    //         'maxZoom': 6\n    //     },\n    //     'tiles': ['CONF_EQE_POLITICAL_FR_TILES_BASE_URL/{z}/{x}/{y}.jpg'],\n    //     'matrix': [[1, 1], [2, 2], [4, 3], [8, 5], [16, 9], [32, 17], [64, 34]],\n    //     'cacheZoom': 6,\n    //     'cacheName': 'CONF_EQE_POLITICAL_FR',\n    //     'cacheAll': true,\n    //     'tileSize': tilesResolution\n    // }\n    // ,\n    // {\n    //     'label': 'JB Mercator',\n    //     'id': 'mapbox_jb_mercator',\n    //     'mapboxOptions': {\n    //         'style': 'mapbox://styles/denizotjb/ckbi1x4ae0vp11jqtfulbtll5'\n    //     }\n    // }\n    ,{\n        'label': atob(\"Q2FydGFCb3NzeQ==\") + ' 2020',\n        'id': 'vb_2020',\n        \"ratio\": [19449, 18352],\n        'extent': [26966.11818123, -430589.86447607, 1262485.62823696, 735241.49181695],\n        'proj4': \"+proj=lcc +lat_1=45.89893890000052 +lat_2=47.69601440000037 +lat_0=46.8 +lon_0=2.33722917 +x_0=600000 +y_0=200000 +datum=WGS84 +units=m +no_defs \",\n        //'proj4': '+proj=lcc +lat_0=46.8 +lon_0=2.33722917 +lat_1=45.8989389000005 +lat_2=47.6960144000004 +x_0=600000 +y_0=200000 +datum=WGS84 +units=m +no_defs +type=crs',\n        'mapboxOptions': {\n            'style': blankStyle,\n            'renderWorldCopies': false,\n            'maxZoom': 5\n        },\n        'tiles': ['CONF_CB_TILES_BASE_URL/{z}/{x}/{y}.webp'],\n        'matrix': [[1, 1], [2, 2], [4, 4], [8, 8], [16, 16], [32, 31], [64, 61]],\n        'cacheName': 'CONF_CB',\n        'cacheZoom': 5,\n        'cacheAll': true,\n        'tileSize': tilesResolution\n    }\n];\n\nexport { options as default};","<script>\n    /* global editolido */\n    import options from './mapboxgl/mapOptions';\n    import blurAction from '../actions/blurAction';\n    import {onMount} from 'svelte';\n    export let name = 'map-style';\n    export let ofp;\n    export let selected = options[0];\n    let autoSelectedId = selected.id;\n    const authorizedOptions = (ofp) ? options : options.filter(o => (!o.id.startsWith('vb_') && o.id !== 'jb_theworld'));\n\n    function isInBounds(option, dep, dest) {\n        if (!option.proj4) return false;\n        try{\n            const bounds = (option.validity) ? option.validity : option.extent;\n            for (let p of [dep, dest]) {\n                const [x, y] = window.proj4(option.proj4, [p.longitude, p.latitude]);\n                if (x < bounds[0] ||  x > bounds[2] || y < bounds[1] || y > bounds[3]) {\n                    return false;\n                }\n            }\n        }catch(err){\n            console.log(err);\n            return false;\n        }\n        return true;\n    }\n\n    onMount(() => {\n        if (selected.id === options[0].id && ofp) {\n            const dep = ofp.route.points[0];\n            const dest = ofp.route.points[ofp.route.points.length - 1];\n            const cbMapOption = options.find(o => o.id === 'vb_2020');\n            const northOption = options.find(o => o.id === 'jb_north');\n            if (isInBounds(cbMapOption, dep, dest)){\n                selected = cbMapOption;\n            }else if (dep.distanceTo(dest, editolido.rad_to_nm) <=1500){\n                //pass (mercator)\n            }else if (dest.latitude > 30 && dep.latitude > 30){\n                selected = northOption;\n            }else if (dest.longitude < -80 && dep.longitude < -80) {\n                selected = options.find(o => o.id === 'jb_pacific');\n            }else if ((dest.latitude > 30 || dep.latitude > 30) && (dep.atFraction(dest, 0.5)).latitude >= 30 && isInBounds(northOption, dep, dest)) {\n                selected = northOption;\n            }else{\n                selected = options.find(o => o.id === 'jb_south');\n            }\n        }\n        autoSelectedId = selected.id;\n    });\n</script>\n<div class=\"input-group\">\n<!-- svelte-ignore a11y-no-onchange -->\n<select name=\"{name}\" bind:value={selected} class=\"form-select form-select-sm\" on:change use:blurAction>\n    {#each authorizedOptions as option, index}\n    <option value=\"{option}\" selected={option.id === selected.id}>{(option.id === autoSelectedId) ? `${option.label.toUpperCase()}`: option.label}</option>\n    {/each}\n</select>\n</div>\n\n<style>\n    .form-select-sm {\n        font-size: small;\n        width: auto;\n        display: inline-block;\n        background-color: var(--bs-gray-100);\n    }\n</style>","<script>\n    import {simulate} from '../stores';\n    export let name = \"simulator\";\n    let input;\n    const toggle = () => {\n        input.checked = !input.checked\n        $simulate = (input.checked) ? 0 : -1;\n    }\n</script>\n\n<!-- <input bind:value={$fl} type=\"range\" min=200 max=450 step=1/>{$fl} -->\n<!-- <input bind:value={$grametPosition} type=\"range\" min=0 max=100 step=1/> -->\n<label for=\"{name}\" on:click={toggle}>{($simulate >= 0) ? '◼︎' :'▶︎'}\n<input bind:this={input} name=\"{name}\" type=\"checkbox\" checked={$simulate>=0} on:change={toggle}>\n</label>\n<style>\n    input{\n        display: none;\n    }\n    label{\n        margin-right: 1rem;\n        font-size: large;\n        font-family: monospace;\n    }\n</style>","import {writable} from 'svelte/store';\nimport {showGramet} from '../stores';\n\nexport const grametStatus = writable();\nexport const grametResponseStatus = writable({});\nconst grametMargin = 65; // left and right margin to the \"inner gramet\" image in px\nconst grametTop = 33;// top margin to the \"inner gramet\" image in px\n\nexport function grametThumbAction(container, {ofp, pos, fl}){\n    const plane = document.getElementById('gt-plane');\n    let objectURL;\n    let position = parseFloat(pos);\n    let currentOfp = ofp;\n    let img;\n    let clone;\n    let iWidth; // the image width (small size computed by browser)\n    let scale;\n    let level = fl;\n    const viewportHeight = container.clientHeight;\n    const viewportWidth = container.clientWidth;\n    const style = getComputedStyle(document.body);\n    const gInnerHeight = parseFloat(style.getPropertyValue('--gramet-inner-height', \"384px\").slice(0, -2)); //remove px\n    const position2pixel = (position) =>  {\n        return ((grametMargin * scale) + ((iWidth - (grametMargin * 2 * scale)) * position / 100));\n    }\n    const imageOffsetForPosition = (position) => {\n        const pixelPosX = position2pixel(position);\n        const margin = grametMargin * scale; // in the thubnail we hide the left and right margin\n        const iw = iWidth;\n        const lock = viewportWidth /3; // plane locked position when we scroll image\n        const min = margin + lock;\n        const max = (iw - margin) - (viewportWidth - lock)\n        if (pixelPosX > (min) && pixelPosX < max){\n            return lock - pixelPosX;\n        }else if(pixelPosX <= min){\n            return lock - min;\n        }else{\n            return lock -max;\n        }\n    }\n    const placePlane = (plane, planePosition, x, planeLevel) => {\n        if(plane){\n            plane.style.left = (x + (position2pixel(planePosition) - (plane.clientWidth / 2))) + 'px';\n            plane.style.top = (((gInnerHeight - Math.round((-0.0006 * planeLevel * planeLevel) + (0.8985 * planeLevel) + 46.264)) * scale) - (plane.clientHeight / 2)) + 'px';\n        }\n    }\n    const loadListener = () => {\n        const gHeight = img.height || 700;\n        clone = img.cloneNode();\n        clone.id = \"grametImg\";\n        clone.style.display = 'none';\n        clone.crossOrigin = \"anonymous\"; // otherwise sw does not cache\n        clone.addEventListener('load', cloneLoadListener); // Safari required the clone to be loaded before adding it to pinchzoom\n        clone.addEventListener('error', errorListener);\n        document.body.appendChild(clone);\n        img.style.height = `${(gHeight/gInnerHeight) * viewportHeight}px`; // 700 is the full gramet height, 380 is the real gramet height\n        img.style.objectFit = 'contain';\n        img.style.position =  'absolute';\n        img.style.opacity = 0.01;\n        container.appendChild(img);\n        iWidth= img.clientWidth;\n        const h = img.clientHeight;\n        const ratio = h / gHeight;\n        scale = ratio;\n        const offset = imageOffsetForPosition(position);\n        img.style.top = `-${grametTop * ratio}px`;\n        img.style.left = `${offset}px`;\n    };\n    const cloneLoadListener = () => {\n        grametStatus.set('success');\n        plane.style.display = 'block';\n        img.style.opacity = 1;\n        const offset = imageOffsetForPosition(position);\n        placePlane(plane, position, offset, level);\n    };\n    const errorListener = () => {\n        plane.style.display = 'none';\n        grametStatus.set('error');\n    };\n    const cleanup = () => {\n        if (img) img.removeEventListener('load', loadListener);\n        if (img) img.removeEventListener('error', errorListener);\n        if (img) img.remove();\n        showGramet.set(false);\n        if (clone) clone.removeEventListener('load', cloneLoadListener);\n        if (clone) clone.removeEventListener('error', errorListener);\n        if (clone) clone.remove();\n        clone = undefined;\n        img = undefined;\n        if(objectURL) URL.revokeObjectURL(objectURL);\n        objectURL = undefined;\n    }\n    const createImg = async (ofp) => {\n        img = document.createElement('img')\n        grametStatus.set('loading');\n        plane.style.display = 'none';\n        fetch(ofp.ogimetData.proxyImg).then(function(response) {\n            if(response.ok) {\n                grametResponseStatus.set({status: response.status, text: response.statusText || 'OK'});\n                response.blob().then((blob) => {\n                    if (img) { // img could be empty if grametTrigger was destroyed before receiving Gramet (page change)\n                        objectURL = URL.createObjectURL(blob);\n                        img.addEventListener('load', loadListener);\n                        img.addEventListener('error', errorListener);\n                        img.src = objectURL;\n                    }\n                });\n            } else {\n                errorListener();\n                if (response.headers) {\n                    grametResponseStatus.set({status: response.status, text:response.statusText ||response.headers.get('X-ofp2map-status')})\n                } else {\n                    grametResponseStatus.set({status: response.status, text:response.statusText || \"\"})\n                }\n            }\n        })\n        .catch(function(error) {\n                errorListener();\n                console.log('catch', error);\n                grametResponseStatus.set({status: 0, text: error.message});\n        });\n    };\n    createImg(ofp);\n\n    return {\n        update({ofp, pos, fl}){\n            position = parseFloat(pos);\n            if (ofp !== currentOfp) {\n                currentOfp = ofp;\n                cleanup();\n                createImg(ofp);\n            }else{\n                const offset = imageOffsetForPosition(position);\n                img.style.left = offset  + 'px';\n                level = fl;\n                placePlane(plane, position, offset, fl);\n            }\n        },\n        destroy(){\n            cleanup();\n        }\n    }\n}\n\n\n//To load Gramet Img im pinchzoom\n//due to problem with Safari, we keep a clone in the document\n//that way there is less reload and incomplete image appearing in the pinchzoom view\nexport const setGramet = (pinchZoom, {pos, fl}) => {\n    const plane = pinchZoom.parentNode.querySelector('svg');\n    const img = document.getElementById('grametImg');\n    const style = getComputedStyle(document.body);\n    const gInnerHeight = parseFloat(style.getPropertyValue('--gramet-inner-height', \"384px\").slice(0, -2)); //remove px\n    const maxHeight = parseFloat(pinchZoom.parentNode.dataset.maxHeight || \"370\");\n    const iWidth = img.width;\n    const iHeight = img.height;\n    const nav = document.querySelector('nav');\n    const viewportWidth = nav.clientWidth;\n    let cHeight;\n    if (iWidth !== 0){\n        cHeight = Math.min((viewportWidth / iWidth) * iHeight, maxHeight);\n    } else {\n        cHeight = Math.min(iHeight, maxHeight);\n    }\n    let position = parseFloat(pos);\n    let scale;\n    let x = 0;\n    let y = 0;\n    let allowImgScroll;\n    let level = fl;\n    const position2pixel = (position) =>  {\n        return (grametMargin + ((iWidth - (grametMargin * 2)) * position / 100)) * scale;\n    }\n    const placePlane = (plane, planePosition, planeLevel) => {\n        // before and after flight, displays the full gramet\n        plane.style.left = (x + (position2pixel(planePosition) - (plane.clientWidth/2) + 2)) + 'px';\n        plane.style.top = (((gInnerHeight  + grametTop - 2 - Math.round((-0.0006 * planeLevel * planeLevel) + (0.8985 * planeLevel) + 46.264)) * scale) - (plane.clientHeight / 2)) + y + 'px';//TODO\n    }\n    const imageOffsetForPosition = (position) => {\n        const pixelPosX = position2pixel(position);\n        const margin = 0; // we do not try to hide the left/right margin in this view\n        const lock = viewportWidth /3;\n        const min = margin + lock;\n        const iw = iWidth * scale; // the scale here is due to pinchzoom\n        const max = (iw - margin) - (viewportWidth - lock);\n        if (pixelPosX > min && pixelPosX < max){\n            return lock - pixelPosX;\n        }else if(pixelPosX <= min){\n            return lock - min;\n        }else{\n            return lock - max;\n        }\n    }\n    const pinchzoomChange = () => {\n        x = pinchZoom.x; // x offset\n        y = pinchZoom.y; // y offset\n        scale = pinchZoom.scale; // scale\n        allowImgScroll = (viewportWidth <= iWidth * scale);\n        placePlane(plane, position, level);\n    }\n    \n    if (position <= 0 || position >= 100) {\n        // flight is not yet progress or finished\n        if (iWidth === 0){\n            scale = maxHeight / (gInnerHeight + 70);\n        } else {\n            scale = Math.min(viewportWidth/iWidth, cHeight / (gInnerHeight + 70));\n        }\n        y = 0;\n    } else {\n        // flight is in progress\n        scale = cHeight / (gInnerHeight);\n        y = - grametTop * scale;\n    }\n    if (viewportWidth > iWidth * scale) {\n        x = (viewportWidth - (iWidth * scale)) / 2;\n        allowImgScroll = false;\n    } else {\n        x = imageOffsetForPosition(position);\n        allowImgScroll = true;\n    }\n    placePlane(plane, position, level);\n    img.style.display = \"block\";\n    pinchZoom.style.maxHeight = `${maxHeight}px`;\n    pinchZoom.appendChild(img);\n    pinchZoom.setTransform({scale, x, y});\n    pinchZoom.addEventListener(\"change\", pinchzoomChange);\n    return {\n        update({pos, fl}){\n            position = parseFloat(pos);\n            level = fl;\n            if (allowImgScroll) {\n                x = imageOffsetForPosition(position);\n                pinchZoom.setTransform({x});\n            }\n            placePlane(plane, position, fl);\n        },\n        destroy(){\n            img.style.display = 'none';\n            document.body.appendChild(img);\n            pinchZoom.removeEventListener(\"change\", pinchzoomChange);\n        }\n    }\n};\n\n//To set the pinchzoom drawer height\n// adjust the size of the parent (the larger the gramet, the less height)\nexport const setHeight = (container) => {\n    const img = document.getElementById('grametImg');\n    const gWidth = img.width;\n    const gHeight = img.height || 700;\n    const maxHeight = parseFloat(container.dataset.maxHeight || \"370\");\n    const nav = document.querySelector('nav');\n    const nWidth = nav.clientWidth;\n    let ratio = 1;\n    if (gWidth !== 0){\n        ratio = nWidth / gWidth;\n    }\n    const height = Math.min(ratio * gHeight, maxHeight);\n    container.style.height = `${height}px`;\n}\n","<script>\n    import {position, simulate} from '../stores';\n    import SimulatorPlayer from './SimulatorPlayer.svelte';\n    import { fly } from \"svelte/transition\";\n    import {setGramet, setHeight} from '../actions/grametAction';\n    const maxHeight = 370;\n</script>\n\n<div class=\"pinch-zoom-parent\" transition:fly=\"{{y: maxHeight}}\" data-max-height={maxHeight} use:setHeight>\n    <pinch-zoom use:setGramet={{pos: $position.gramet, fl: $position.fl}} min-scale=\"0.3\"></pinch-zoom>\n    <svg><use xlink:href=\"#plane-symbol\"/></svg>\n    <!-- {#if (($flightProgress === 0 || $flightProgress === 100) && ogimetParams.get('tref') * 1000 > $ofp.infos.ofpOFF.getTime())}\n        <div class=\"warning\">GRAMET pour décollage maintenant</div>\n    {/if} -->\n    {#if (($position.gramet === 0 || $position.gramet === 100 || $simulate>=0))}\n        <SimulatorPlayer/>\n    {/if}\n</div>\n\n<style>\n    .pinch-zoom-parent{\n        width: 100%;\n        position:absolute;\n        bottom: -10px;\n        left:50%;\n        transform: translateX(-50%);\n        background-color: rgba(255,255,255,0.6);\n        background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='120px' width='120px' ><text transform='rotate(45)' x='20' y='7' fill='lightblue' fill-opacity='0.7' font-size='14'>GRAMET</text></svg>\");\n    }\n    svg {\n        position:absolute;\n        width: 40px;\n        height: 40px;\n        top:60px;\n        left: 0;\n        fill: var(--plane-color);\n    }\n    /* .warning {\n        position: absolute;\n        z-index: 10;\n        top: 10px;\n        color: white;\n        background-color: var(--bs-warning);\n        padding: 5px;\n        left: 10px;\n    } */\n    div :global(label) {\n        position: absolute;\n        color: var(--plane-color);\n        top: 0px;\n        left: 5px;\n        font-size: 45px;\n        -webkit-text-stroke-width: 3px;\n        -webkit-text-stroke-color: black;\n    }\n</style>","export default function mapResizeAction(node, map) {\n    let currentMap = map;\n    const resizeMap = () => currentMap && currentMap.resize() /* && console.log('map resized') */;\n    const observer = new IntersectionObserver((entries, observer) => { \n        entries.forEach(entry => {\n        if(entry.intersectionRatio===1){\n            resizeMap();\n        }\n    });\n    }, {threshold: 1});\n    observer.observe(node);\n    const handleVisibilityChange = () =>{\n        if (document && document.visibilityState && document.visibilityState === 'visible') {\n            resizeMap();\n        }\n    };\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);\n    window.addEventListener(\"orientationchange\", resizeMap);\n\n    return {\n        update(map) {\n            currentMap = map;\n        },\n        destroy() {\n            observer.unobserve(node);\n            observer.disconnect();\n            window.removeEventListener(\"orientationchange\", resizeMap);\n            document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n            if (currentMap) currentMap.remove();\n            //console.log('map removed');\n        }\n    }\n}","<script context=\"module\">\n    import {showPlaneOnMap} from '../stores';\n\n    const showPlane = (e) => {\n        if('BACKGROUND' !== e.target._watchState) showPlaneOnMap.set(true);\n        //console.log('show plane', e.target._watchState);\n    };\n    const hidePlane = (e) => {\n        showPlaneOnMap.set(false);\n        //if (e) console.log('hide plane', e.target._watchState);\n    }\n</script>\n<script>\n    import FormSettings from \"./mapSettings/Form.svelte\";\n    import {createMap, token} from './mapboxgl/mapManagement';\n    import {updateMapLayers} from './mapboxgl/layersManagement';\n    import {online, showGramet, simulate, aircraftType} from \"../stores.js\";\n    import {promiseTimeout, fetchSimultaneously} from './utils';\n    import { createEventDispatcher, onMount, onDestroy, tick} from 'svelte';\n    import {get} from 'svelte/store';\n    import {findMissingCacheTiles} from '../tilesCache';\n    import CircleProgress from \"./CircleProgress.svelte\";\n    import AircraftType from \"./AircraftType.svelte\";\n    import MapPlane from \"./MapPlane.svelte\";\n    import MapProjectionSelect from \"./MapProjectionSelect.svelte\";\n    import Gramet from './Gramet.svelte';\n    import mapResizeAction from '../actions/mapResizeAction';\n\n    const dispatch = createEventDispatcher();\n    export let kmlOptions;\n    export let ofp;\n    let map;\n    let mapData;\n    let selectedProjection;\n    let aircraftTypeSelectElement;\n    let cacheMaxValue = 0;\n    let cacheValue = -1;\n    let cacheError = false;\n    let tilesMissing = [];\n    let settings;\n    $: mapIsCached = tilesMissing.length === 0;\n    const caches = {};\n\n\n    export let id = 'map';\n\n    async function afterMapLoad(){\n        if (!!ofp) {\n            try {\n                tilesMissing = await findMissingCacheTiles(ofp, mapData);\n            } catch (err){\n                tilesMissing = [];\n                console.error(`Could not find missing cache tiles`, err);\n            }\n        }else{\n            tilesMissing = [];\n        }\n        //console.log(tilesMissing);\n        const attribution = document.querySelector(`#${id} .mapboxgl-ctrl-attrib-inner`);\n        if (attribution) {\n            attribution.appendChild(document.createTextNode(' | '));\n            attribution.appendChild(aircraftTypeSelectElement);\n            attribution.appendChild(document.createTextNode(`${\"CONF_AIRAC\".substring(0,2)}.${\"CONF_AIRAC\".substring(2,4)}`));\n        }\n    }\n\n    function projectionChange(e) {\n        e.target.blur(); // to avoid zoom problem in standalone mode\n        if (map) map.remove();\n        cacheValue = -1;\n        cacheError = false;\n        tilesMissing = [];\n        cacheMaxValue = 0;\n        if (mapData && mapData.geolocate) {\n            mapData.geolocate.off('trackuserlocationstart', hidePlane);\n            //mapData.geolocate.off('trackuserlocationend', showPlane);\n        }\n        const showPlaneState = get(showPlaneOnMap);\n        hidePlane(); // dom element will be removed by createMap\n        mapData = createMap(id, selectedProjection, ofp, kmlOptions, $aircraftType, afterMapLoad);\n        map = mapData.map;\n        mapData.geolocate.on('trackuserlocationstart', hidePlane);\n        //mapData.geolocate.on('trackuserlocationend', showPlane);\n        setTimeout(async () => {\n            await tick;\n            showPlaneOnMap.set(showPlaneState);\n        }, 0);\n    }\n\n    function aircraftChange(e) {\n        e.target.blur(); // to avoid zoom problem in standalone mode\n        update({detail: {value: $aircraftType, name: \"airport-change\"}});\n    }\n\n    const update = (e) => {\n        updateMapLayers({\n            map,\n            mapData,\n            name: e.detail.name,\n            value: e.detail.value,\n            ofp: ofp,\n            kmlOptions,\n            aircraftType: $aircraftType\n        });\n        dispatch('save'); // set History\n    };\n\n    let cacheButtonDisabled = false;\n    const cacheMap = async (e) => {\n        if (cacheButtonDisabled) return false;\n        cacheButtonDisabled = true;\n        cacheValue = 0;\n        try {\n            cacheMaxValue = tilesMissing.length; // set the progress class\n            cacheError = false; //remove error class\n            try {\n                await promiseTimeout(4000, fetch(`./manifest.json?dummy=${Date.now()}`, {cache: \"no-store\"}));\n            } catch (err) {\n                console.error(err);\n                cacheButtonDisabled = false;\n                cacheError = true;\n                cacheValue = -1;\n                return false;\n            }\n            await fetchSimultaneously(tilesMissing, () => cacheValue++);\n            if (cacheValue>=cacheMaxValue){\n                caches[selectedProjection.id] = true;\n                caches=caches;\n                tilesMissing = [];\n                cacheMaxValue = 0;\n                cacheValue = -1;\n            }\n        }finally{\n            cacheButtonDisabled = false;\n            cacheValue = -1;\n        }\n    }\n    let supportWebP = true;\n    const canUseWebP = async () => {\n        const handler = (event) => {\n            supportWebP = event && event.type === 'load' ? image.width == 1 : false;\n        }\n        const image = new Image();\n        image.onerror = handler;\n        image.onload = handler;\n        image.src = 'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=';\n    };\n    canUseWebP();\n\n    onMount(() => {\n        mapboxgl.accessToken = token;\n        mapData = createMap(id, selectedProjection, ofp, kmlOptions, $aircraftType, afterMapLoad, true); //initialLoad = true\n        hidePlane(); // dom element was removed by createMap\n        showPlaneOnMap.reset();\n        map = mapData.map;\n        mapData.geolocate.on('trackuserlocationstart', hidePlane);\n        //mapData.geolocate.on('trackuserlocationend', showPlane);\n\n    });\n    onDestroy(() => {\n        mapData.geolocate.off('trackuserlocationstart', hidePlane);\n        //mapData.geolocate.off('trackuserlocationend', showPlane);\n        settings.endFocusMode();\n        map = undefined;\n        mapData = undefined;\n    });\n</script>\n\n<div id={id} use:mapResizeAction={map}></div>\n<div class=\"mapmenu\">\n    <div class=\"projection\">\n    <MapProjectionSelect bind:selected={selectedProjection} ofp={ofp} on:change={projectionChange}></MapProjectionSelect>\n    {#if (selectedProjection && window.indexedDB)}\n    <div class=\"cacheButton\"\n        class:cacheError={cacheError}\n        class:cacheProgress={cacheValue >= 0||cacheMaxValue > 0}\n        class:hidden={!ofp || mapIsCached|| !$online || caches[selectedProjection.id]===true}\n        on:click={(cacheButtonDisabled) ? () => false : cacheMap}>\n        <CircleProgress value={(cacheValue>=0) ? cacheValue : 0} max={cacheMaxValue}></CircleProgress>\n    </div>\n    {/if}\n    </div>\n    {#if (!supportWebP && mapData && mapData.mapOptions && mapData.mapOptions.tiles && mapData.mapOptions.tiles[0].endsWith('.webp'))}\n        <div class=\"nowebp\">Votre navigateur ne supporte pas l'affichage d'images au format .webp</div>\n    {/if}\n</div>\n{#if (mapData && !!ofp  && ($showPlaneOnMap || $simulate >= 0))}<MapPlane {mapData}/>{/if}\n<AircraftType bind:aircraftTypeSelectElement on:change={aircraftChange}/>\n<FormSettings bind:this={settings} bind:kmlOptions on:change={update} on:save />\n{#if $showGramet}<Gramet/>{/if}\n\n<style>\n\n    #map {\n        flex: 1 1 auto;\n        height: auto;\n    }\n    .mapmenu {\n        position: absolute;\n        top: 10px;\n        left: 10px;\n        width: 180px;\n        user-select: none; /* supported by Chrome and Opera */\n        -webkit-user-select: none; /* Safari */\n        -moz-user-select: none; /* Firefox */\n    }\n    .projection {\n        display:flex;\n        align-items: center;\n    }\n    :global(.mapboxgl-ctrl-attrib-inner select[name=aircraftType]){\n        display: inline-block !important;\n    }\n    @media (max-width: 330px), (max-height: 720px) {\n        #map {\n            width: 100%;\n            height: 90vh;\n            margin: 0;\n        }\n        :global(main.map page) {\n            position: relative;\n        }\n        .mapmenu {\n            top :5px;\n        }\n    }\n    .hidden {\n        visibility: hidden;\n    }\n    .cacheButton {\n        display: inline-block;\n        position: relative;\n        color: var(--bs-cyan);\n        margin-left: 10px;\n        cursor:pointer;\n        --progress-color: var(--bs-yellow);\n    }\n\n    .cacheButton.cacheError {\n        color: var(--bs-red) !important;\n        --progress-trackcolor: var(--bs-gray-500) !important;\n    }\n    .cacheButton.cacheProgress {\n        color: var(--bs-yellow);\n        --progress-trackcolor: black;\n    }\n    .cacheButton.cacheProgress, .cacheButton.cacheError{\n        --progress-circlefill: var(--bs-gray-100);\n    }\n    .cacheButton::after{\n        content: \"↓\";\n        display:inline-block;\n        text-align: center;\n        height: 24px;\n        width: 24px;\n        left: 50%;\n        position: absolute;\n        top: 50%;\n        transform: translate(-50%, -50%);\n    }\n    :global(.mapboxgl-ctrl button.mapboxgl-ctrl-layers){\n        display:flex;\n        align-items:center;\n        justify-content: center;\n    }\n    :global(.mapboxgl-ctrl button.mapboxgl-ctrl-layers svg){\n        width: 22px;\n        height: 22px;\n    }\n    :global(.map page) {\n        overflow: hidden;\n    }\n    :global(.mapboxgl-popup-content .airport p){\n        margin: 0 auto;\n        display: inline-block;\n        line-height: 1em;\n    }\n    :global(.mapboxgl-popup-content .track p strong){ /* LVLS EB highlight */\n        font-weight: normal;\n        background-color: #EEFAE3; /*very light green */\n    }\n    :global(.mapboxgl-popup-content .track p strong.error){ /* LVLS EB highlight if FL not found*/\n        background-color: #FAE3EE; /*very light pink */\n    }\n    :global(.mapboxgl-popup-content .security-1,\n            .mapboxgl-popup-content .security-2,\n            .mapboxgl-popup-content p.status) {\n        font-variant: all-small-caps;\n        font-weight: bold;\n        padding: 0.2em 0.4em;\n        border-radius: 2px;\n    }\n    :global(.mapboxgl-popup-content){\n        text-align: center;\n    }\n    :global(.mapboxgl-popup-content h2){\n        font-size: small;\n        font-weight: normal;\n    }\n    :global(.mapboxgl-popup-content h2 b){\n        color: #062DF8;\n        font-weight: 900;\n        margin-left: 0.25rem;\n    }\n    :global(.mapboxgl-popup-content h1){\n        font-size: small;\n        font-weight: bold;\n        margin-left: 1rem;\n        margin-right: 1rem;\n    }\n    :global(.mapboxgl-popup-content .track p){\n        text-align: left;\n        margin-bottom: 0;\n    }\n    :global(.mapboxgl-popup-content p.security-1){\n        color:black;\n        background-color: orange;\n        border: 1px solid orange;\n        margin-left: 1rem;\n    }\n    :global(.mapboxgl-popup-content p.security-2){\n        color:white;\n        background-color: red;\n        border: 1px solid red;\n        margin-left: 1rem;\n    }\n    :global(.mapboxgl-popup-content p.status){\n        color: black;\n        font-variant: all-small-caps;\n        font-weight: bold;\n        padding: 0.2em 0.4em;\n        border: 1px solid;\n    }\n    :global(.mapboxgl-popup-content p.status-1){\n        background-color: #ea80d8;\n        border-color: #ea80d8;\n    }\n    :global(.mapboxgl-popup-content p.status-2){\n        background-color:#fbfe98;\n        border-color:#fbfe98;\n    }\n    :global(.mapboxgl-popup-content p.status-3){\n        background-color:#00b0f1;\n        border-color:#00b0f1;\n    }\n    :global(.mapboxgl-popup-content p.status-0){\n        border:1px solid #ff0000;\n    }\n    :global(.mapboxgl-popup-content p.status-text){\n        color: #aaa;\n        display: block;\n        margin-top: 0.3em;\n    }\n    .nowebp {\n        background-color: #ff0000;\n        color:white;\n        max-width: 30vw;\n        font-size:small;\n        padding: 10px;\n        margin-top: 10px;\n    }\n</style>\n","export default [\n  \"bottom-right\",\n  \"bottom-center\",\n  \"bottom-left\",\n  \"top-right\",\n  \"top-center\",\n  \"top-left\",\n  \"right-bottom\",\n  \"right-center\",\n  \"right-top\",\n  \"left-bottom\",\n  \"left-center\",\n  \"left-top\"\n]\n","const RIGHT = \"right\";\nconst LEFT = \"left\";\nconst TOP = \"top\";\nconst CENTER = \"center\";\nconst BOTTOM = \"bottom\";\n\n// for SSR\nexport function isBrowser() {\n  return typeof window !== 'undefined' && typeof document !== 'undefined';\n}\n\nexport const getNextPosition = (position, dimensions) => {\n  const clientHeight = Math.min(document.body.clientHeight, document.documentElement.clientHeight);\n  const clientWidth = Math.min(document.body.clientWidth, document.documentElement.clientWidth);\n  Object.assign(dimensions, { clientWidth, clientHeight });\n\n  const [mainPosition, secondaryPosition] = position.split('-');\n  const nextMainPosition = getMainPosition(mainPosition, dimensions);\n  const nextSecondaryPosition = getSecondaryPosition(secondaryPosition, dimensions);\n\n  return `${nextMainPosition}-${nextSecondaryPosition}`;\n}\n\nconst getMainPosition = (\n  position,\n  {\n    top,\n    bottom,\n    left,\n    right,\n    height,\n    width,\n    clientWidth,\n    clientHeight,\n  },\n) => {\n\n  const fitsOnTop = top > height;\n  const fitsOnBottom = bottom + height < clientHeight;\n\n  const fitsOnLeft = left > width;\n  const fitsOnRight = right + width < clientWidth;\n\n  const positions = {\n    top: () => !fitsOnTop && fitsOnBottom ? BOTTOM : TOP,\n    bottom: () => fitsOnTop && !fitsOnBottom ? TOP : BOTTOM,\n    left: () => !fitsOnLeft && fitsOnRight ? RIGHT : LEFT,\n    right: () => !fitsOnRight && fitsOnLeft ? LEFT : RIGHT,\n  };\n\n  return positions[position]();\n};\n\nconst getSecondaryPosition = (\n  position,\n  {\n    top,\n    bottom,\n    left,\n    right,\n    height,\n    width,\n    clientWidth,\n    clientHeight,\n  }\n) => {\n  const parentHeight = bottom - top;\n  const parentCenter = top + parentHeight / 2;\n\n  const fitsOnTop = bottom > height;\n  const fitsOnBottom = top + height < clientHeight;\n  const fitsCenter = (parentCenter - height / 2) > 0 && (parentCenter + height / 2) < clientHeight;\n  const fitsOnLeft = right > width;\n  const fitsOnRight = left + width < clientWidth;\n\n  const positions = {\n    top: () => !fitsOnTop && fitsOnBottom ? BOTTOM : TOP,\n    center: () => fitsCenter ? CENTER : positions.top(),\n    bottom: () => !fitsOnBottom && fitsOnTop ? TOP : BOTTOM,\n    left: () => !fitsOnLeft && fitsOnRight ? RIGHT : LEFT,\n    right: () => !fitsOnRight && fitsOnLeft ? LEFT : RIGHT,\n  };\n\n  return positions[position]();\n};\n","<script>\n\timport {\n\t\tbeforeUpdate,\n\t\tonMount,\n\t\tonDestroy,\n\t\ttick,\n\t\tcreateEventDispatcher,\n\t} from 'svelte';\n\timport POSITIONS from './positions';\n\timport { isBrowser, getNextPosition } from './helpers';\n\tconst dispatch = createEventDispatcher();\n\n\tconst DEFAULT_POSITION = POSITIONS[0];\n\n\texport let isOpen = false;\n\texport let updateOnScroll = false;\n\texport let closeOnScroll = false;\n\texport let position = DEFAULT_POSITION;\n\texport let closeOnClickOutside = false;\n\texport let zIndex = 1;\n\texport let onWindowKeyDown = () => {};\n\texport let style = '';\n\n\t$: className = $$restProps['class'] || '';\n\n\tlet currentPosition = null;\n\tlet parent;\n\tlet content;\n\tlet target;\n\n\tlet topStyle = 0;\n\tlet leftStyle = 0;\n\tlet widthStyle = 0;\n\tlet heightStyle = 0;\n\n\t$: hasParent = !parent || !!parent.childNodes.length;\n\t$: hasContent = !content || !!content.childNodes.length;\n\n\t$: if(!hasParent) throw new Error('parent slot is required');\n\t$: if(!hasContent) throw new Error('content slot is required');\n\n\t$: openedState = isOpen && hasParent && hasContent;\n\n\tfunction addListeners() {\n\t\tif (!isBrowser()) return;\n\t\twindow.addEventListener('resize', updatePosition);\n\t\tif (closeOnScroll) window.addEventListener('scroll', close);\n\t\telse if (updateOnScroll) window.addEventListener('scroll', updatePosition);\n\t}\n\n\tfunction removeListeners() {\n\t\tif (!isBrowser()) return;\n\t\twindow.removeEventListener('resize', updatePosition);\n\t\twindow.removeEventListener('scroll', updatePosition);\n\t\twindow.removeEventListener('scroll', close);\n\t}\n\n\tonMount(() => {\n\t\tif (openedState) {\n\t\t\taddListeners();\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\tif (!isBrowser()) return;\n\t\tremoveListeners();\n\t});\n\n\n\tbeforeUpdate(updatePosition);\n\n\tfunction toggle(value) {\n\t\tconst prevOpen = isOpen;\n\t\tconst nextOpen = value === true || value === false ? value : !isOpen;\n\n\t\tif (nextOpen && hasParent && hasContent || !nextOpen) isOpen = nextOpen;\n\n\t\tif(prevOpen !== isOpen) {\n\t\t\tdispatch('toggle', isOpen);\n\t\t\tif (isOpen) {\n\t\t\t\taddListeners();\n\t\t\t\tdispatch('open');\n\t\t\t} else {\n\t\t\t\tdispatch('close');\n\t\t\t\tremoveListeners();\n\t\t\t}\n\t\t}\n\n\t}\n\n\tfunction open() {\n\t\tif (!openedState) toggle(true);\n\t}\n\n\tfunction close() {\n\t\tif (openedState) toggle(false);\n\t}\n\n\tfunction contains (event) {\n\t\tconst path = event.path || event.composedPath();\n\t\treturn path.includes(parent) || path.includes(content);\n\t}\n\n\tfunction handleWindowClick(event) {\n\t\tif (!closeOnClickOutside || !openedState || contains(event)) return;\n\t\tclose();\n\t}\n\n\tfunction handleWindowKeyDown(event) {\n\t\tif (!onWindowKeyDown || !openedState) return;\n\t\tonWindowKeyDown(event, { isOpen: openedState, open, close, toggle, contains });\n\t}\n\n\tasync function updatePosition() {\n\t\tawait tick();\n\t\tif (!openedState) return;\n\t\tif (!POSITIONS.includes(position)) position = DEFAULT_POSITION;\n\n\t\tconst {\n\t\t\ttop,\n\t\t\tbottom,\n\t\t\tleft,\n\t\t\tright,\n\t\t\twidth: parentWidth,\n\t\t\theight: parentHeight,\n\t\t} = parent.getBoundingClientRect();\n\t\tconst { height, width } = content.getBoundingClientRect();\n\n\t\tconst dimensions = { top, bottom, left, right, height, width };\n\t\tconst nextPosition = getNextPosition(position, dimensions);\n\n\t\tif (currentPosition !== nextPosition) {\n\t\t\tcurrentPosition = nextPosition;\n\t\t}\n\n\t\ttopStyle = top;\n\t\tleftStyle = left;\n\t\twidthStyle = parentWidth;\n\t\theightStyle = parentHeight;\n\t}\n</script>\n\n<svelte:window\n\ton:mousedown={handleWindowClick}\n\ton:keydown={handleWindowKeyDown} />\n\n<div bind:this={target} class={`overlay ${className}`} style={`z-index:${zIndex}; ${style}`}>\n\t<div bind:this={parent}>\n\t\t<slot name=\"parent\" {toggle} isOpen={openedState} {open} {close} />\n\t</div>\n\t<div\n\t\tclass=\"content-wrapper\"\n\t\tstyle={`top: ${topStyle}px; left: ${leftStyle}px; width: ${widthStyle}px; height: ${heightStyle}px; z-index:${zIndex};`}\n\t>\n\t\t{#if openedState}\n\t\t\t<div class={`content ${currentPosition || ''}`} bind:this={content}>\n\t\t\t\t\t<slot name=\"content\" {toggle} isOpen={openedState} {open} {close} />\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n  .overlay {\n    position: relative;\n\t\tdisplay: inline-block;\n\t\tbox-sizing: border-box;\n  }\n\n  .content-wrapper {\n    position: fixed;\n    pointer-events: none;\n    width: max-content;\n  }\n\n  .content-wrapper > * {\n    pointer-events: all;\n  }\n\n  .content {\n    position: absolute;\n    min-width: 100%;\n  }\n\n  .top-left,\n  .top-center,\n  .top-right {\n    bottom: 100%;\n  }\n\n  .bottom-left,\n  .bottom-center,\n  .bottom-right {\n    top: 100%;\n  }\n\n  .top-left,\n  .bottom-left {\n    right: 0;\n  }\n\n  .top-center,\n  .bottom-center {\n    left: 50%;\n    transform: translateX(-50%);\n  }\n\n  .top-right,\n  .bottom-right {\n    left: 0;\n  }\n\n  .left-top,\n  .left-bottom,\n  .left-center {\n    right: 100%;\n  }\n\n  .right-top,\n  .right-bottom,\n  .right-center {\n    left: 100%;\n  }\n\n  .left-center,\n  .right-center {\n    top: 50%;\n    transform: translateY(-50%);\n  }\n\n  .left-top,\n  .right-top {\n    bottom: 0;\n  }\n\n  .left-bottom,\n  .right-bottom {\n    top: 0;\n  }\n</style>\n","<script>\n    export let href;\n    const isExternal = href && !href.startsWith('#');\n    const props = (isExternal) ? Object.assign({rel: \"noreferrer\", target: \"_blank\"}, $$restProps): $$restProps;\n</script>\n<!-- svelte-ignore a11y-missing-attribute -->\n<a {href} {...props}><slot></slot></a>","<script>\n    import {onDestroy, tick} from 'svelte';\n    import Overlay from 'svelte-overlay';\n    import {grametThumbAction, grametStatus, grametResponseStatus} from '../actions/grametAction';\n    import Link from '../components/Link.svelte';\n    import {showGramet, ofp, position} from '../stores';\n    let grametUpdateAvailable = false;\n\n    const toggleGramet = () => {\n        if ($grametStatus === 'success') $showGramet = !$showGramet;\n    }\n    const reload = async () => {\n        $grametStatus = 'reload';\n        $showGramet = false;\n        grametUpdateAvailable = false;\n        await tick;\n        $grametStatus = 'loading';\n    };\n    const grametSourceUpdate = async (event) => {\n        if (event.data.meta === 'workbox-broadcast-update' && event.data.type === 'CACHE_UPDATED') {\n                const {updatedURL} = event.data.payload;\n                if (updatedURL === $ofp.ogimetData.proxyImg) {\n                    if ($showGramet) {\n                        grametUpdateAvailable = true;\n                    }else{\n                        reload();\n                    }\n                }\n            }\n    };\n    if (navigator && navigator.serviceWorker){\n            navigator.serviceWorker.addEventListener('message', grametSourceUpdate);\n    }\n    onDestroy(() => {\n        //console.log('destroy gramet trigger');\n        if (navigator && navigator.serviceWorker){\n            navigator.serviceWorker.removeEventListener('message', grametSourceUpdate);\n        }\n    });\n</script>\n{#if $grametStatus !== 'error' && $grametStatus !== 'reload'}\n    <div class=\"gramet-thumbnail\" class:open={$showGramet} use:grametThumbAction={{ofp: $ofp, pos: $position.gramet, fl: $position.fl}} on:click={toggleGramet}>\n        <svg id=\"gt-plane\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\">\n            <circle cx=\"50\" cy=\"50\" r=\"50\"/>\n        </svg>\n        {#if ($showGramet)}\n            <svg class=\"gramet-close\"><use xlink:href=\"#close-symbol\"/></svg>\n        {/if}\n    </div>\n    <Overlay  position=\"bottom-center\" style=\"margin-right: 0 !important;\" isOpen={grametUpdateAvailable}>\n        <div slot=\"parent\" class=\"d-none\"></div>\n        <div slot=\"content\" let:close style=\"width: 290px;\">\n            <div class=\"overlay card\" style=\"left: calc(-1rem - 35px); max-width: 290px; top: 20px;\">\n                <div class=\"card-header\">\n                    <span>Nouveau GRAMET disponible</span>\n                    <button type=\"button\" class=\"btn-close ms-auto\" aria-label=\"Close\" on:click={close}></button>\n                </div>\n                <div class=\"card-body\">\n                    <p class=\"text-center mt-3\"><button class=\"btn btn-primary\" on:click={reload}>Mettre à jour</button></p>\n                </div>\n            </div>\n        </div>\n    </Overlay>\n{:else if ($grametStatus !== 'reload')}\n    <Overlay  position=\"bottom-center\" >\n        <button slot=\"parent\" class=\"btn btn-light\" let:toggle on:click={toggle}>\n            <svg class=\"gramet-error\"><use xlink:href=\"#info-symbol\"/></svg>\n        </button>\n    \n        <div slot=\"content\" let:close style=\"width: 350px;\">\n            <div class=\"overlay card\" style=\"position: absolute\">\n                <div class=\"card-header\">\n                    <span>😱: Erreur de récupération du Gramet</span>\n                    <button type=\"button\" class=\"btn-close ms-auto\" aria-label=\"Close\" on:click={close}></button>\n                </div>\n                <div class=\"card-body\">\n                <p><a href=\".\" on:click|preventDefault={() => $grametStatus = 'loading'}>essayez à nouveau</a> ou allez sur <Link href={$ofp.ogimetData.url} target=\"_blank\">ogimet</Link>.</p>\n                {#if $grametResponseStatus.status === 409}\n                    <p>Erreur construction route GRAMET: Station \"<code>{$grametResponseStatus.text}</code>\" non reconnue par ogimet,\n                    merci de me remonter l'information pour que je corrige l'application. Inutile de réessayer.</p>\n                {:else if $grametResponseStatus.text === \"no grib data\"}\n                    <p>Le serveur ogimet indique qu'il est indisponible (no grib data). Sa mise à jour débute normalement à 00:00z et c'est long...</p>\n                {:else}\n                    <p>A certaines heures le site ogimet est saturé, il faut essayer 2 ou 3 fois en temporisant de 30 secondes à chaque essai.</p>\n                    {#if $grametResponseStatus.status !== 0}\n                        <p>Pour information, le proxy a retourné: <code>{$grametResponseStatus.text || $grametResponseStatus.status}</code></p>\n                    {/if}\n                {/if}\n                </div>\n            </div>\n        </div>\n    </Overlay>\n{:else if ($grametStatus === 'reload')}\n    <div class=\"gramet-thumbnail updating\"><p>↻</p><p>Mise à jour</p></div>\n{/if}\n\n\n<style>\n.gramet-thumbnail{\n    --gramet-thumb-height: 39px;\n    height: var(--gramet-thumb-height);\n    margin-right: 1rem;\n    overflow: hidden;\n    position: relative;\n    flex: 0 1 70px; /* a cdg-dub flight is 78px*/\n    border-radius: 3px;\n    align-self: baseline;\n    display: none;\n    cursor: pointer;\n}\n.gramet-thumbnail.updating p {\n    margin: 0;\n    font-size: small;\n    text-align: center;\n}\n@media (min-width: 576px){\n    .gramet-thumbnail {\n        display:block;\n    }\n}\n.gramet-error {\n    --height: 20px;\n    height: var(--height);\n    width: 20px;\n    stroke: red;\n    transform: rotate(180deg);\n    vertical-align: text-bottom;\n    /* margin-top: calc((var(--gramet-thumb-height) - var(--height)) / 2); */\n}\n.gramet-thumbnail .gramet-close{\n    stroke: var(--bs-light);\n    width: 100%;\n    height: 100%;\n    position: relative;\n    top: 0;\n    z-index: 2;\n}\n\nbutton[slot=parent]{\n    display: flex;\n    padding: 0;\n}\n.gramet-thumbnail :global(img){\n    transition: opacity 0.5s ease-in;\n}\n#gt-plane {\n    position: absolute;\n    z-index: 1;\n    display: none;\n    fill: var(--plane-color);\n    stroke: black;\n    width: 6px;\n    stroke-width: 10px;\n}\n</style>","/* globals editolido */\nconst parisBase = ['CDG', 'ORY'];\nconst getFlightTypePNC = (departure, destination) => {\n    if (departure.longitude >= -30 && departure.longitude <= 40 && departure.latitude >=25 \n        && destination.longitude >= -30 && destination.longitude <= 40 && destination.latitude >=25) {\n        return \"MC\";\n    }\n    return \"LC\";\n}\nconst getFlightTypePNT = (distance) => {\n    if (distance <= 2100) {\n        return \"MC1\";\n    } else if (distance <=3000) {\n        return \"MC2\";\n    }\n    return \"LC\"\n}\nconst isBase = (base, iata) => {\n    if (base === 'PAR') return parisBase.includes(iata);\n    return base === iata;\n}\n\nconst getMeridians = (base, baseTZ, duties) => {\n    const meridians = [];\n    for (const duty of duties) {\n        const lastLeg = duty.legs[duty.legs.length - 1];\n        console.log(lastLeg, parseFloat(lastLeg.destTZ) - baseTZ, isBase(lastLeg.destIATA), lastLeg.destIATA)\n        if (!isBase(base, lastLeg.destIATA)) {\n            meridians.push(Math.abs(parseFloat(lastLeg.destTZ) - baseTZ));\n        }\n    }\n    return Math.max(meridians);\n}\n\nconst addDutyMeta = (duty, {base}) => {\n    const lastLeg = duty.legs[duty.legs.length - 1];\n    if (lastLeg) {\n        duty.OUT = duty.legs[0].OUT;\n        duty.IN = lastLeg.IN;\n        duty.TVSV = duty.legs.reduce((a, v) => v.blockTime + a, 0);\n        if (!isBase(base, lastLeg.destIATA)) {\n            duty.layover = lastLeg.destIATA;\n            duty.layoverTZ = lastLeg.destTZ;\n        }\n    }\n    return duty;\n}\n\nexport const pairingData = (ofp) => {\n    const results = {};\n    if (!ofp) return results;\n    let pairing = {};\n    let duties = [];\n    let scheduledTSV;\n    let pattern, match;\n    try {\n        const pairingText = editolido.extract(ofp.text, 'CREW PAIRING', 'Generated');\n        pattern = /TSV\\s+-\\s+(\\d{2}):(\\d{2})/u;\n        match = pattern.exec(pairingText);\n        scheduledTSV = (match) ? parseInt(match[2], 10) + parseInt(match[1], 10) * 60 : 0; //in minutes\n        pattern = /DATE\\s:\\s(\\d+)\\.(\\S{3})\\.(\\d{4})/u;\n        match = pattern.exec(pairingText);\n        let month, year; // for pairing start\n        if (match) {\n            year = parseInt(match[3], 10);\n            month = editolido.months3.indexOf(match[2]) + 1; // 1-12\n            if (month <= 0) throw new Error('could not extract pairing month');\n        } else {\n            throw new Error('could not extract pairing month/year');\n        }\n        pattern = new RegExp(String.raw`>\\s${ofp.infos.depIATA}\\s\\(([-+.0-9]+)\\)`, \"u\");\n        match = pattern.exec(pairingText);\n        results.depTZ = (match) ? match[1] : '';\n        pattern = new RegExp(String.raw`>\\s${ofp.infos.destIATA}\\s\\(([-+.0-9]+)\\)`, \"u\");\n        match = pattern.exec(pairingText);\n        results.destTZ = (match) ? match[1] : '';\n        pattern = /OPERATION VERSION\\s(.+?)\\s\\d+\\sNB PAX/u;\n        match = pattern.exec(pairingText);\n        results.aircraftOpsVersion = (match) ? match[1] : '';\n        pattern = /(\\d{2})\\/(\\d{2})\\s\\S+\\s(\\S{3})\\s>\\s(\\S{3})\\s\\(([-+\\d.]+)\\)\\s(\\d{2}):(\\d{2})\\s(?:\\d{2}:\\d{2})\\s(\\d{2}):(\\d{2})/gu;\n        // eslint-disable-next-line init-declarations\n        let tz = 0;\n        let duty = {\"legs\": []};\n        let flightTypePNC = \"MC\";\n        let flightTypePNT = \"MC1\";\n        let base = undefined;\n        for (match of pairingText.matchAll(pattern)) {\n            const m = parseInt(match[2], 10); // 1-12\n            const d = parseInt(match[1], 10);\n            const y = (m < month) ? year + 1 : year;\n            const scheduledOut = new Date(Date.UTC(y, m - 1, d, parseInt(match[6], 10), parseInt(match[7], 10))); // month must be 0-11\n            const blockTime = parseInt(match[9], 10) + parseInt(match[8], 10) * 60;\n            const scheduledIN = new Date(scheduledOut.getTime() + 60000 * blockTime);\n            const depIATA = match[3];\n            const departure = editolido.iata2GeoPoint(depIATA);\n            if (!base) base = (parisBase.includes(depIATA)) ? 'PAR' : depIATA;\n            const arrival = editolido.iata2GeoPoint(match[4]);\n            const groundDistance = Math.round(departure.distanceTo(arrival, editolido.rad_to_nm));\n            if (flightTypePNC !== \"LC\" && getFlightTypePNC(departure, arrival) === \"LC\") {\n                flightTypePNC = \"LC\";\n            }\n            if (flightTypePNT !== \"LC\") {\n                const distanceType = getFlightTypePNT(groundDistance);\n                if (distanceType === \"LC\" || (distanceType === \"MC2\" && flightTypePNT === \"MC1\")){\n                    flightTypePNT = distanceType;\n                }\n            }\n            if (duty.legs.length !== 0 && scheduledOut - duty.legs[duty.legs.length - 1].IN > 36000000) { // more than 10 hours\n                duties.push(addDutyMeta(duty, {base}));\n                duty = {\"legs\": []};\n            }\n            duty.legs.push({\n                //\"depPoint\": {\"latitude\": departure.latitude.toFixed(6), \"longitude\": departure.longitude.toFixed(6)},\n                \"depICAO\": departure.name,\n                \"depIATA\": depIATA,\n                //\"destPoint\": {\"latitude\": arrival.latitude.toFixed(6), \"longitude\": arrival.longitude.toFixed(6)},\n                \"destIATA\": match[4],\n                \"destICAO\": arrival.name,\n                //\"groundDistance\": groundDistance,\n                \"destTZ\": match[5],\n                \"depTZ\": tz,\n                \"OUT\": scheduledOut,\n                \"IN\": scheduledIN,\n                \"blockTime\": blockTime,\n                \"isOFP\": (scheduledOut.toISOString() === ofp.infos.ofpOUT.toISOString())\n            });\n            tz = match[5];\n        }\n        if (duty.legs.length > 0) duties.push(addDutyMeta(duty, {base}));\n        pairing.baseTZ = tz;\n        pairing.base = base;\n        if (duties.length > 0) {\n            duties[0].legs[0].depTZ = tz;\n        }\n        pairing.flightTypePNT = (flightTypePNT === \"MC2\" && getMeridians(base, parseFloat(pairing.baseTZ), duties) >= 4) ? \"LC\" : flightTypePNT;\n        pairing.flightTypePNC = flightTypePNC;\n        //console.log(getMeridians(base, parseFloat(pairing.baseTZ), duties))\n\n    } catch (err) {\n        if (!(err instanceof editolido.StringExtractException)) {\n            console.error(err);\n        }\n        duties = [];\n    }\n    results.pairing = pairing;\n    results.pairing.duties = duties; \n    const duty = duties.filter(duty => duty.legs.reduce((a, v) => v.isOFP || a, false)).pop();\n    results.scheduledTSV = scheduledTSV; //deprecated\n    if (duty) {\n        duty.TSV = scheduledTSV;\n        if (duty.legs.length > 0) {\n            const lastLeg = duty.legs[duty.legs.length - 1];\n            if (!isBase(pairing.base, lastLeg.destIATA)) {\n                duty.layover = lastLeg.destIATA;\n                duty.layoverTZ = lastLeg.destTZ;\n            }\n        }\n    }\n    results.duty = duty;\n    return results;\n}","<script>\n    import {ofp, takeOffTime} from '../stores';\n    import plugins from \"../plugins.json\";\n    import {pairingData} from \"./pairingParser\";\n\n    function* etopsData(ofp, takeOff){\n        if (!ofp || !takeOff) return [];\n        let etopsSummary = '';\n        const ralts = ofp.infos['ralts'];\n        if(ralts.length > 0) {\n            try{\n                etopsSummary = ofp.text.extract('ETOPS SUMMARY', 'SUMMARY-').replace(ofp.removePageFooterRegex,'');\n            } catch(err){\n                console.error(err);\n            }\n        }\n        const pattern = String.raw`(EEP\\(\\S{4}\\)|ETP\\S+|EXP\\(\\S{4}\\))\\s+\\d{2}\\.\\d{2}\\s+(\\S+)\\s+(\\S+)\\s+EET (\\d{2})\\.(\\d{2}) .+? ([\\d.]+)\\/EFOB ([\\d.]+)(?:.+?(${ralts.join('|')})\\s(\\S+).+?\\sREQ\\s(\\d{2})(\\d{2})-(\\d{2})(\\d{2}))?`\n        const regex = new RegExp(pattern, 'gm');\n        const day = new Date(takeOff);\n        const delta = takeOff - ofp.infos.ofpOFF;\n        day.setUTCHours(0, 0);\n        const matches = etopsSummary.matchAll(regex);\n        for (let [,name, latString, lngString, hours, minutes, fuelRequired, efob, ralt, rwy, startHours, startMinutes, endHours, endMinutes] of matches) {\n            const latlng = editolido.dm_normalizer([latString, lngString]);\n            const eet = parseInt(hours, 10) * 60 + parseInt(minutes, 10);\n            const eto = new Date(takeOff.getTime() + eet * 60000);\n            const fuelMargin = Math.round((parseFloat(efob) - parseFloat(fuelRequired)) * 10) / 10;\n            const startWindow = (startHours !== undefined && startMinutes !== undefined) ? new Date(day.getTime() + (parseInt(startHours, 10) * 3600000) + (parseInt(startMinutes, 10) * 60000) + delta) : undefined;\n            const endWindow = (endHours !== undefined && endMinutes !== undefined) ? new Date(day.getTime() + (parseInt(endHours, 10) * 3600000) + (parseInt(endMinutes, 10) * 60000) + delta) : undefined;\n            yield([name, eto, parseFloat(fuelRequired), parseFloat(efob), fuelMargin, ralt, rwy, startWindow, endWindow, latlng, eet])\n        }\n    };\n    // note that if $ofp.infos.tripFuel = 0 (bad ofp parsing), fuelMarginTime will be infinity => no alert\n    $: fuelMarginTime = $ofp.infos.minFuelMarginETOPS / ($ofp.infos.tripFuel/$ofp.infos.flightTime);\n\n    const etopsMarkdown = (altnETOPSPoints) => {\n        const results = [];\n        const getHours = (data) => data.getUTCHours().toString().padStart(2, '0');\n        const getMinutes = (data) => data.getUTCMinutes().toString().padStart(2, '0');\n        for (const data of altnETOPSPoints) {\n            if (data.description === 'ETOPS') {\n                results.push(`\\n**Appui**: ${data.name} ${data.runway} - Plage: **${getHours(data.startWindow)}${getMinutes(data.startWindow)}-${getHours(data.endWindow)}${getMinutes(data.endWindow)}**`);\n            }else{\n                let myName;\n                if (data.description.startsWith('ETP')) {\n                    myName = `**${data.description}** ${data.name}`;\n                }else{\n                    myName = `**${data.description.substring(0,3)}**${data.description.substring(3)}`\n                }\n                results.push(`\\n${myName} ➔ ETO: **${getHours(data.ETO)}:${getMinutes(data.ETO)}** | ΔFUEL: **${data.fuelMargin}**\\n`);\n            } \n        }\n        return results;\n    };\n    const etopsList = (ofp, takeOff) => {\n        let currentRalt = '';\n        const results = [];\n        for(const [label, eto, , , fuelMargin, ralt, runway, startWindow, endWindow, latlng, eet] of etopsData(ofp, takeOff)) {\n            const res = {\n                \"latitude\": latlng.latitude,\n                \"longitude\": latlng.longitude,\n                \"EET\": eet,\n                \"ETO\": eto,\n                \"fuelMargin\": fuelMargin.toFixed(1)\n            };\n            if (label.startsWith('ETP')) {\n                res.name = `${currentRalt}/${ralt}`;\n                res.description = label;\n            }else{\n                res.name = label.substring(4,8);\n                res.description = label.substring(0,3);\n            }\n            results.push(res);\n            if(ralt) {\n                const raltPoint = ofp.infos['raltPoints'].filter(p => p.name === ralt).pop();\n                let latitude, longitude;\n                if (raltPoint) {\n                    latitude = raltPoint.latitude;\n                    longitude = raltPoint.longitude;\n                }\n                results.push({\n                    \"name\": ralt,\n                    \"description\": \"ETOPS\",\n                    latitude,\n                    longitude,\n                    runway,\n                    startWindow,\n                    endWindow\n                });\n                currentRalt = ralt;\n            }\n        }\n        return results;\n    };\n    const getOfpRouteExport = (ofp) => {\n        if (ofp.timeMatrix.length > 0) {\n            return ofp.timeMatrix.map(([p, sum, fl]) => ({\n                \"name\": p.name,\n                \"tte\": sum,\n                fl,\n                \"latitude\":  p.latitude.toFixed(6),\n                \"longitude\":  p.longitude.toFixed(6)}));\n        }\n        return ofp.route.points.map(p => ({\n            \"name\": p.name,\n            \"latitude\":  p.latitude.toFixed(6),\n            \"longitude\":  p.longitude.toFixed(6)}));\n    };\n    export const shareOFP = async () => {\n        const ofp = $ofp;\n        const takeOffTime = $takeOffTime;\n        const excluded = ['EEP', 'EXP', 'raltPoints', 'rawFPL', 'inFlightStart', 'inFlightReleased'];\n        const filteredInfos = Object.fromEntries(\n            Object.entries(ofp.infos).filter(([key, val])=> !excluded.includes(key))\n        );\n        const shareData = {\n            'title': 'OFP2MAP',\n            'text': JSON.stringify({\n                ...filteredInfos,\n                lidoFPL: ofp.lidoRoute(false).join(' '),\n                'realOFF': takeOffTime,\n                \"altnETOPS\": ofp.infos.ralts,\n                'route': getOfpRouteExport(ofp),\n                ...pairingData(ofp),\n                //deprecated from 07/08/21\n                'registration': ofp.infos.aircraftRegistration,\n                'ralts': ofp.infos.ralts,\n                'etopsOutput': etopsMarkdown(etopsList(ofp, takeOffTime)), //TODO when removing, delete ref to etopsMarkdown, etopsList, etopsData\n                'ofp2map-takeoff': takeOffTime,\n                //end of deprecated\n                plugins,\n                rawText: ofp.text\n            })//.replace(/\"(?:lati|longi)tude\":\"([0-9.]+)\"/gu, (_, p1) => p1)\n        }\n        try {\n            await navigator.share(shareData)\n        } catch(err) {\n            console.log(err);\n        }\n        return false;\n    };\n\n</script>\n\n<div class=\"infos\" class:cursor-pointer={(navigator && navigator.share)} on:click={(navigator && navigator.share) ? shareOFP : null}>\n    {#if (fuelMarginTime < 20)}<p class=\"etops\">ETOPS</p>{/if}\n    <div class=\"details\">\n    <p><b>{$ofp.infos.flightNo}</b> {$ofp.infos.depICAO}-{$ofp.infos.destICAO}</p>\n    <p>{$ofp.infos.ofpTextDate} {($ofp.infos.ofp.includes('/')) ? '' : 'ofp: '}{$ofp.infos.ofp}\n        {#if (navigator && navigator.share)}<svg><use xlink:href=\"#share-symbol\"/></svg>{/if}\n    </p>\n    </div>\n</div>\n\n<style>\n    .infos{\n        display: none;\n        margin-right: 1rem;\n        font-size: small;\n        flex-direction: row;\n        max-height: 38px;\n    }\n    .details{\n        display: flex;\n        flex-direction: column;\n    }\n    @media (min-width: 500px){\n        .infos {\n            display: flex;\n        }\n    }\n    p{\n        margin:0\n    }\n    .cursor-pointer{\n        cursor: pointer;\n    }\n    .etops{\n        writing-mode: vertical-rl;\n        text-orientation: upright;\n        font-size: 6px;\n        margin-right: 5px;\n        margin-left: -1em;\n        font-weight: 700;\n        align-self: center;\n        background-color: var(--bs-warning);\n    }\n    svg {\n        width:20px;\n        height: 20px;\n        vertical-align: bottom;\n    }\n</style>","<script>\n    import {ofp, simulate, takeOffTime, showPlaneOnMap} from '../stores';\n    import blurAction from '../actions/blurAction';\n    export let name=\"take-off\";\n\n    const getOfpTakeOffTime =  (currentOfp) => {\n        const value = new Date(currentOfp.infos.ofpOFF.getTime());\n        $takeOffTime = value;\n        return value;\n    };\n\n    $: ofpTakeOff = getOfpTakeOffTime($ofp);\n\n    const hm2input = (hours, minutes) => `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n\n    const changeTime = (e) => {\n        let minutes, hours;\n        if (e.target.value == ''){\n            hours = ofpTakeOff.getUTCHours();\n            minutes = ofpTakeOff.getUTCMinutes();\n            e.target.blur();\n            e.target.value = hm2input(hours, minutes);\n        }else{\n            hours = parseFloat(e.target.value.slice(0,2));\n            minutes = parseFloat(e.target.value.slice(3));\n        }\n\n        let newTakeOff = new Date(ofpTakeOff);\n        newTakeOff.setUTCMinutes(minutes);\n        newTakeOff.setUTCHours(hours);\n        const diff = (newTakeOff.getTime() - ofpTakeOff.getTime()) / 60000;\n        if (diff < -720 ) {\n            newTakeOff = new Date(newTakeOff.getTime() + (1440 * 60000)); // +1 day\n        } else if (diff > 720 ){\n            newTakeOff = new Date(newTakeOff.getTime() - (1440 * 60000)); // -1 day\n        }\n        $takeOffTime = newTakeOff;\n        if (newTakeOff.toISOString() !== ofpTakeOff.toISOString()) {\n            e.target.classList.add(\"changed\");\n        }else{\n            e.target.classList.remove(\"changed\");\n        }\n    };\n</script>\n\n<div>\n    <svg class:show={$showPlaneOnMap || $simulate >= 0} class:hide={!($showPlaneOnMap || $simulate >= 0)} on:click={() => $showPlaneOnMap = !$showPlaneOnMap}><use xlink:href=\"#takeoff-symbol\"/></svg>\n    <label for=\"{name}\">Heure de décollage</label><!-- displayed in ios popup -->\n    <input id=\"{name}\" name=\"{name}\" type=\"time\" use:blurAction on:change={changeTime} value=\"{hm2input(ofpTakeOff.getUTCHours(), ofpTakeOff.getUTCMinutes())}\" />\n</div>\n\n<style>\n    label{\n        display: none;\n        /* position: absolute; */\n        /* top: -50px; */\n    }\n    div {\n        display: flex;\n        align-items: flex-start;\n        /* outline: 1px solid rgba(0,0,0,0.2); */\n        /* outline-style: dashed; */\n        outline: 1px solid #ced4da55;\n        margin-top: -1px;\n    }\n    svg {\n        width: 30px;\n        height: 30px;\n        display: inline-block;\n        margin-right: 5px;\n        margin-top: -1px;\n        cursor: pointer;\n    }\n    svg.show {\n        stroke: rgba(0,0,0,.9);\n        fill: var(--plane-halo-color);\n    }\n    svg.hide {\n        stroke:transparent;\n        fill: rgba(0,0,0,.5);\n    }\n    input {\n        background-color: var(--bs-light);\n        border-color: transparent;\n        color:rgba(0,0,0,.5);\n        appearance: none;\n        -webkit-appearance: none;\n        -moz-appearance: none;\n    }\n    div :global(input.changed){\n        color:rgba(0,0,0,.9);\n    }\n    @media not all and (min-resolution:.001dpcm) { /* Safari hack */\n        @media all{\n            input { \n                width: 60px;\n            }\n        }\n        div {\n            margin-right: 6px; /* just enough place for the outline */\n        }\n    }\n\n</style>","// shortcuts for easier to read formulas\nconst PI   = Math.PI,\n    sin  = Math.sin,\n    cos  = Math.cos,\n    tan  = Math.tan,\n    asin = Math.asin,\n    acos = Math.acos,\n    atan = Math.atan2,\n    deg = 180 / PI,\n    rad  = PI / 180;\n\n// date/time constants and conversions\nconst dayMs = 1000 * 60 * 60 * 24,\n    J1970 = 2440588,\n    J2000 = 2451545;\n\nconst toJulian = (date) => date.valueOf() / dayMs - 0.5 + J1970;\nconst toCenturies = (date) => (toJulian(date) - J2000) / 36525.0;\n\n// modulo is not always remainder\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Remainder\nconst modulo = (a, n) => ((a % n ) + n ) % n;\n\n\n\n//const azimuth = (H, phi, dec) => atan(sin(H), cos(H) * sin(phi) - tan(dec) * cos(phi));\nconst altitude = (H, phi, dec) => asin(sin(phi) * sin(dec) + cos(phi) * cos(dec) * cos(H));\n\nconst geomMeanLongSun = (t) => {\n    const L0 = 280.46646 + t * (36000.76983 + t*(0.0003032));\n    return modulo(L0, 360); // in degrees\n};\n\nconst geomMeanAnomalySun = (t) => {\n    const M = 357.52911 + t * (35999.05029 - 0.0001537 * t);\n    return M; // in degrees\n};\n\nconst eccentricityEarthOrbit = (t) => {\n    const e = 0.016708634 - t * (0.000042037 + 0.0000001267 * t);\n    return e; // unitless\n};\n\nconst sunEqOfCenter = (t) => {\n    const m = rad * geomMeanAnomalySun(t);\n    const C = sin(m) * (1.914602 - t * (0.004817 + 0.000014 * t)) + sin(2 * m) * (0.019993 - 0.000101 * t) + sin(3 * m) * 0.000289;\n    return C; // in degrees\n};\n\nconst sunTrueLong = (t) => {\n    return geomMeanLongSun(t) + sunEqOfCenter(t); // in degrees\n};\n\nconst sunApparentLong = (t) => {\n    const o = sunTrueLong(t);\n    const omega = 125.04 - 1934.136 * t;\n    const lambda = o - 0.00569 - 0.00478 * sin(rad * omega);\n    return lambda; // in degrees\n};\n\nconst meanObliquityOfEcliptic = (t) => {\n    const seconds = 21.448 - t*(46.8150 + t*(0.00059 - t*(0.001813)));\n    const e0 = 23.0 + (26.0 + (seconds/60.0))/60.0;\n    return e0; // in degrees\n};\n\nconst obliquityCorrection = (t) => {\n    const e0 = meanObliquityOfEcliptic(t);\n    const omega = 125.04 - 1934.136 * t; // in degrees\n    const e = e0 + 0.00256 * cos(rad * omega);\n    return e; // in degrees\n};\n\nconst sunDeclinationInRadians = (t) => {\n    const e = rad * obliquityCorrection(t);\n    const lambda = rad * sunApparentLong(t);\n    const sint = sin(e) * sin(lambda);\n    const theta = asin(sint);\n    return theta; // in radians\n};\nconst sunRtAscensionInRadians = (t) => {\n    var e = rad * obliquityCorrection(t);\n    var lambda = rad * sunApparentLong(t);\n    var tananum = cos(e) * sin(lambda);\n    var tanadenom = cos(lambda);\n    var alpha = atan(tananum, tanadenom);\n    return alpha; // in radians\n};\n\n//Equation of time in minutes\nconst eqTime = (t) => {\n    const e = eccentricityEarthOrbit(t);\n    const epsilon = rad * obliquityCorrection(t);\n    const l0 = rad * geomMeanLongSun(t);\n    const m = rad * geomMeanAnomalySun(t);\n    const y = Math.pow(tan(epsilon / 2), 2);\n\n    const Etime = y * sin(2.0 * l0) - 2.0 * e * sin(m) + 4.0 * e * y * sin(m) * cos(2 * l0) - 0.5 * y * y * sin(4 * l0) - 1.25 * e * e * sin(2 * m);\n    return deg * Etime * 4.0; // in minutes of time\n};\n\n\n\nexport const sunAzEl = (date, point) => {\n    const {longitude} = point;\n    const hours = date.getUTCHours();\n    const minutes = date.getUTCMinutes();\n    const seconds = date.getUTCSeconds();\n    const t = toCenturies(date);\n    const solarTimeFix = eqTime(t) + (4 * longitude);\n    const theta = sunDeclinationInRadians(t);\n    // True Solar Time\n    let tst = ((hours * 60) + minutes + (seconds / 60) + solarTimeFix) % 1440;\n    // Solar hour angle\n    let ha = (tst / 4) - 180;\n    if (ha < -180) {\n        ha += 360;\n    }\n    const phi = point.latitude * rad;\n    let csz = (sin(phi) * sin(theta)) + (cos(phi) * cos(theta) * cos(rad * ha));\n    if (csz > 1.0) {\n        csz = 1.0\n    } else if (csz < -1.0) { \n        csz = -1.0\n    }\n    const zenith = acos(csz);\n    // const azDenom = cos(phi) * sin(zenith);\n    // let azimuth;\n    // if (Math.abs(azDenom) > 0.001) {\n    //     var azRad = ((sin(phi) * cos(zenith)) - sin(theta)) / azDenom;\n    //     if (Math.abs(azRad) > 1.0) {\n    //         if (azRad < 0) {\n    //             azRad = -1.0\n    //         } else {\n    //             azRad = 1.0\n    //         }\n    //     }\n    //     azimuth = 180.0 - deg * acos(azRad);\n    //     if (ha > 0.0) {\n    //         azimuth = -azimuth;\n    //     }\n    // } else {\n    //     azimuth = (latitude > 0.0) ? 180 : 0;\n    // }\n    // if (azimuth < 0.0) {\n    //     azimuth += 360.0\n    // }\n    // we do not need to calculate refraction for our usage (see isNight)\n    return {elevation: 90 - (deg * zenith)};\n};\nconst sunStates = [ // order important\n    [   -15, 'night'], // used for aurora prediction real astronomical night starts at -18\n    [   -12, 'astronomical twilight'],\n    [    -6, 'nautical twilight'],\n    [-0.833, 'civil twilight']\n];\nexport const sunStateMap = new Map([\n    ['night', ([prevState, newState]) => (isSunRising(prevState, newState)) ? 'astronomicalDawn': 'nightStart'],\n    ['astronomical twilight', ([prevState, newState]) => (isSunRising(prevState, newState)) ? 'nauticalDawn': 'astronomicalDusk'],\n    ['nautical twilight', ([prevState, newState]) => (isSunRising(prevState, newState)) ? 'civilDawn': 'nauticalDusk'],\n    ['civil twilight', ([prevState, newState]) => (isSunRising(prevState, newState)) ? 'sunrise': 'civilDusk'],\n    ['day', ([prevState, newState]) => (isSunRising(prevState, newState)) ? 'dayStart': 'sunset']\n]);\nexport const sunRisingStates = Array.from(sunStateMap.keys());\nexport const isSunRising = (prevState, newState) => {\n    return sunRisingStates.indexOf(newState) >= sunRisingStates.indexOf(prevState);\n};\n\nexport const sunStateAndRising = (date, point, fl) => {\n    const {state, elevation} = sunState(date, point, fl);\n    //compare sun elevation beetween date and date + 10mn\n    const isRising =  elevation < sunAzEl(new Date(date.getTime() + 600000), point).elevation;\n    return {state, isRising};\n};\n\nexport const sunState = (date, point, fl=0) => {\n    const elevation = sunAzEl(date, point).elevation;\n    // -0.833 includes refraction at sea level\n    // formula includes altitude and altitude refraction\n    // https://en.wikipedia.org/wiki/Sunrise_equation\n    const correction = 1.15 * Math.sqrt(fl * 100) / 60;\n    for (const[value, state] of sunStates) {\n        if (elevation <= value - correction) {\n            return {state, elevation};\n        }\n    }\n    return {state: 'day', elevation};\n};\n\n/* Moon Equations from https://github.com/mourner/suncalc */\nconst toDays = (date) => toJulian(date) - J2000;\nconst e = rad * 23.4397; // obliquity of the Earth\nconst rightAscension = (l, b) => atan(sin(l) * cos(e) - tan(b) * sin(e), cos(l));\nconst declination = (l, b) => asin(sin(b) * cos(e) + cos(b) * sin(e) * sin(l));\nconst siderealTime = (d, lw) => rad * (280.16 + 360.9856235 * d) - lw;\nconst moonCoords = (d) => { // geocentric ecliptic coordinates of the moon\n    const L = rad * (218.316 + 13.176396 * d), // ecliptic longitude\n        M = rad * (134.963 + 13.064993 * d), // mean anomaly\n        F = rad * (93.272 + 13.229350 * d),  // mean distance\n\n        l  = L + rad * 6.289 * sin(M), // longitude\n        b  = rad * 5.128 * sin(F),     // latitude\n        dt = 385001 - 20905 * cos(M);  // distance to the moon in km\n    return {\n        ra: rightAscension(l, b),\n        dec: declination(l, b),\n        dist: dt\n    };\n};\nexport const getMoonIllumination = (date) => {\n\n    const t = toCenturies(date),\n        s = {dec: sunDeclinationInRadians(t), ra: sunRtAscensionInRadians(t)},\n        m = moonCoords(toDays(date)),\n\n        sdist = 149598000, // distance from Earth to Sun in km\n\n        phi = acos(sin(s.dec) * sin(m.dec) + cos(s.dec) * cos(m.dec) * cos(s.ra - m.ra)),\n        inc = atan(sdist * sin(phi), m.dist - sdist * cos(phi)),\n        angle = atan(cos(s.dec) * sin(s.ra - m.ra), sin(s.dec) * cos(m.dec) -\n                cos(s.dec) * sin(m.dec) * cos(s.ra - m.ra));\n\n    return {\n        fraction: (1 + cos(inc)) / 2,\n        phase: 0.5 + 0.5 * inc * (angle < 0 ? -1 : 1) / Math.PI,\n        angle: angle\n    };\n};\nexport const getMoonPosition = function (date, point) {\n\n    var lw  = -point.longitude * rad,\n        phi = point.latitude * rad,\n        d   = toDays(date),\n\n        c = moonCoords(d),\n        H = siderealTime(d, lw) - c.ra,\n        h = altitude(H, phi, c.dec),\n        // formula 14.1 of \"Astronomical Algorithms\" 2nd edition by Jean Meeus (Willmann-Bell, Richmond) 1998.\n        pa = atan(sin(H), tan(phi) * cos(c.dec) - sin(c.dec) * cos(H));\n\n    //h = h + astroRefraction(h); // altitude correction for refraction\n\n    return {\n        //azimuth: azimuth(H, phi, c.dec),\n        altitude: h,\n        //distance: c.dist,\n        parallacticAngle: pa\n    };\n};\nexport const moonState = (date, point, fl=0) => { // true => visible\n    // + altitude of moonrise is 8mn of arc (0.133*rad)\n    // - refraction correction at this altitude is 0.008116109187895005\n    // we apply the same altitude correction that the sun (really ?)\n    const correction = rad * 1.15 * Math.sqrt(fl * 100) / 60;\n    const altitude = getMoonPosition(date, point).altitude;\n    return  {state: altitude > -0.005794821282742547 - correction, elevation: deg * altitude};\n}\nexport const moonStateMap = new Map([\n    [false, () => 'moonrise'],\n    [true, () => 'moonset']\n]);\nexport const sun = {name: 'sun', getState: sunState, stateMap: sunStateMap};\nexport const moon = {name: 'moon', getState: moonState, stateMap: moonStateMap};\n","import {derived} from \"svelte/store\";\nimport {sun, moon} from \"./suncalc\";\nimport {ofp, takeOffTime} from \"../stores\";\n\nfunction* iterateSegment({prev, next, takeOffTime, flightTime, segmentLength, getState, stateMap, increment=30000 /* 30sec */}){\n    let prevState = prev.state;\n    const min2ms = 60000;\n    const lowerLimit = prev.sum * min2ms;\n    const upperLimit = next.sum * min2ms; \n    for(let m = lowerLimit + increment; m <= upperLimit; m= m + increment){\n        let fl = prev.fl;\n        if (m >= upperLimit) fl = next.fl;\n        const date = new Date(takeOffTime + m);\n        let pos;\n        const segmentTime = upperLimit - lowerLimit;\n        if (segmentTime === 0) {\n            pos = next.p;\n        }else{\n            const fraction = (m - lowerLimit) / segmentTime;\n            pos = prev.p.atFraction(next.p, fraction, segmentLength);\n        }\n        const {state} = getState(date, pos, fl);\n        if (state !== prevState) {\n            const relpos = Math.round(1000 * m / flightTime) / 10;\n            const type =  stateMap.get(prevState)([prevState, state]);\n            yield({position: pos, type, date, fl, relpos});\n            if (state === next.state) break;\n        }\n        prevState = state;\n    }\n}\nconst getSolarDefault = () => {\n    return {[moon.name]: [], [sun.name]: [], 'route': []};\n};\n\nexport const solar = derived(\n    [ofp, takeOffTime],\n    ([$ofp, $takeOffTime]) => {\n        if (!$takeOffTime || !$ofp || $ofp.timeMatrix.length === 0) return getSolarDefault();\n        const takeOffTime = $takeOffTime.getTime();\n        const results = getSolarDefault();\n        const timeMatrix = $ofp.timeMatrix;\n        const distanceMatrix = $ofp.distanceMatrix;\n        let last = timeMatrix.length - 1;\n        const flightTime = timeMatrix[last][1] * 60000;\n        const routeMatrix = [];\n        for (const object of [sun, moon]) {\n            const matrix = [];\n            let prev = null;\n            for (const [i, [p, sum, level]] of timeMatrix.entries()) {\n                let fl = level;\n                if (i === 0 || i === last) fl = 0;\n                const date = new Date(takeOffTime + sum * 60000);\n                const state = object.getState(date, p, fl).state;\n                const next = {p, sum, fl, state};\n                if (prev && state !== prev.state) {\n                    const segmentLength = distanceMatrix[i][1] - distanceMatrix[i-1][1];\n                    const params = {\n                        prev, \n                        next, \n                        takeOffTime,\n                        flightTime,\n                        segmentLength, \n                        getState: object.getState, \n                        stateMap: object.stateMap, \n                        increment: (object.name === 'sun') ? 30000 : 60000\n                    };\n                    for (const data of iterateSegment(params)) {\n                        matrix.push(data);\n                        if (object === sun) {\n                            routeMatrix.push(data);\n                        }\n                    }\n                }\n                prev = next;\n                if (object === sun) {\n                    routeMatrix.push({position: p, type: state, date, relpos: Math.round(1000 * sum * 60000 / flightTime) / 10});\n                }\n            }\n            results[object.name] = matrix;\n        }\n        results['route'] = routeMatrix;\n        return results;\n    },\n    getSolarDefault() // initial value\n);\n","<script context=\"module\">\n    import {derived, writable} from \"svelte/store\";\n    import {landingTime, takeOffTime} from \"../stores\";\n    import {solar} from \"./solarstore\";\n    import { binarysearch } from \"./utils\";\n\n    const devTimeDelta = (tsref) => Math.round((Date.now() - tsref)/86400000) * 86400000;\n    export const kpColor = (kp) => {\n        switch(kp){ \n            case 0:\n            case 1:\n            case 2:\n                return '#69B34C';\n            case 3:\n                return '#ACB334'; \n            case 4:\n                return '#FAB733'\n            case 5:\n                return '#FF8E15';\n            case 6:\n                return '#FF4E11';\n            case 7:\n            case 8:\n            case 9:\n                return '#FF0D0D';\n            default:\n                return 'lightgray';\n        };\n    };\n    export const noaaKp = writable();\n    const fetchNoaaKpAndSet = async () => {    \n        return fetch('CONF_NOAA_KP_JSON')\n        .then(response => response.json())\n        .then(data => {\n            try {\n                const timetable = [];\n                for (let i=data.length - 1; i>=1; i--){\n                    const [d, k] = data[i];\n                    const t = Date.parse(d.replace(' ', 'T') + 'Z'); // Safari needs the T\n                    timetable.push([t, parseFloat(k)])\n                }\n                noaaKp.set(timetable);\n            } catch (error) {\n                console.error('kp store update error', error);\n            }\n        })\n        .catch(function(error) {\n            console.log('Could not update Kp store', error);\n        });\n    };\n    export const Kp = derived([landingTime, takeOffTime, noaaKp], ([$landingTime, $takeOffTime, $noaaKp]) => {\n        if (!$landingTime || !$takeOffTime || !$noaaKp) return undefined;\n        let res = [];\n        const tots = $takeOffTime.getTime();\n        const flightTime = $landingTime - $takeOffTime;\n        let timeDelta = 0;\n        if ('process.env.NODE_ENV' === '\"development\"') {\n            timeDelta = devTimeDelta($takeOffTime);\n        }\n        //$noaaKp timetable in reverse order so end -> takeOff, start -> landing\n        const startTs = $landingTime.getTime() + timeDelta;\n        const start = binarysearch($noaaKp, a => a[0] <= startTs)\n        const endTs = tots + timeDelta;\n        const end = binarysearch($noaaKp, a => a[0] <= endTs)\n        if (end >= 0 && start >= 0) {\n            res = $noaaKp.slice(start, end + 1);\n        }\n        const timetable = res.map(a => ({\n            date: new Date(a[0] - timeDelta),\n            kp: a[1],\n            relpos: Math.round(10000 * (a[0] - timeDelta - tots) / flightTime) / 100 //relpos might be < 0 or > 100\n        }));\n        const fn = (date) => {\n            if (date) { // a linear search is fine here (0-5 entries)\n                for (let i=0; i<timetable.length; i++){\n                    if (date >= timetable[i].date) {\n                        return timetable[i].kp;\n                    }\n                }\n            }\n            return -1;\n        }\n        return {\n            timetable,\n            get: fn\n        };\n    });\n    \n    export const aurora = derived(\n        [solar, Kp],\n        ([$solar, $Kp]) => {\n            if ($solar.route.length === 0 || !$Kp) return [];\n            const segments = [];\n            let points = [];\n            for (const {position, date, type, relpos} of $solar.route) {\n                const predictedKp = $Kp.get(date);\n                if (['night', 'astronomicalDusk', 'astronomicalDawn'].includes(type) && Math.round(minKpAtPoint(position)) <= predictedKp){ //TODO Math.floor/ceil/round ?\n                    points.push({position, date, relpos, predictedKp});\n                }else if (points.length > 0) {\n                    segments.push(points);\n                    points = [];\n                }\n            }\n            if (points.length > 0) segments.push(points);\n            const periods = [];\n            const rounding = 1000 * 60 * 5; // all times rounded to 5min\n            for (const points of segments) {\n                const last = points.length - 1;\n                const start = points[0].date.getTime();\n                const end = points[last].date.getTime();\n                const offset = (points.length === 1) ? 300000 : 0; //5mn or 0\n                const roundedStart = Math.floor((start - offset) / rounding) * rounding;\n                const roundedEnd = Math.ceil((end + offset) / rounding) * rounding;\n                const relpos1 = (roundedStart / start) * points[0].relpos;\n                const relpos2 = (roundedEnd / end) * points[last].relpos;\n\n                periods.push({\n                    period: [new Date(roundedStart), new Date(roundedEnd)],\n                    relpos: [relpos1, relpos2],\n                    //points: [points[0].position, points[last].position]\n                });\n            }\n            return periods;\n        }\n    );\n\n    // export const getGeoMagneticPole = (date) => {\n    //     let year = date.getUTCFullYear();\n    //     if (year < 2016) year = 2016;\n    //     if (year > 2025) year = 2025;\n    //     // from http://wdc.kugi.kyoto-u.ac.jp/poles/polesexp.html\n    //     const poleLatLngByYear = {\n    //         '2016': [80.4, -72.6],\n    //         '2017': [80.5, -72.6],\n    //         '2018': [80.5, -72.7],\n    //         '2019': [80.6, -72.7],\n    //         '2020': [80.7, -72.7],\n    //         '2021': [80.7, -72.7],\n    //         '2022': [80.7, -72.7],\n    //         '2023': [80.8, -72.7],\n    //         '2024': [80.8, -72.6],\n    //         '2025': [80.9, -72.6]\n    //     };\n    //     return poleLatLngByYear[year.toString()];\n    // }\n    export const geoMagneticPoleLatLng = [80.7, -72.7]; // sufficent precision for us\n    export const minKpAtPoint = (p) => {\n        if (p.latitude <= 40) return [-90, 99]; // no need to compute\n        const mlat = 90 - p.distanceTo(new editolido.GeoPoint(geoMagneticPoleLatLng), editolido.rad_to_deg);\n        return (mlat > 66.5) ? 0 : (66.5 - mlat) / 2; // https://www.swpc.noaa.gov/content/tips-viewing-aurora\n    };\n</script>\n<script>\n    import {onMount} from \"svelte\";\n    import {ofp} from \"../stores\";\n\n    const predictedKpUpdated = async (event) => {\n        if (event.data.meta === 'workbox-broadcast-update' && event.data.type === 'CACHE_UPDATED') {\n            const {updatedURL} = event.data.payload;\n            if (updatedURL === 'CONF_NOAA_KP_JSON') {\n                //console.log('loading noaa kp store (sw cache updated)');\n                fetchNoaaKpAndSet();\n            }\n        }\n    };\n\n    onMount(() => {\n        if (navigator && navigator.serviceWorker){\n            navigator.serviceWorker.addEventListener('message', predictedKpUpdated);\n        }\n        const isInCache = async () => {\n            let inCache = false;\n            if (window.caches) {\n                const keys = await window.caches.open('lido-noaa').then(cache => cache.keys());\n                for (const req of keys) {\n                    if (req.url === 'CONF_NOAA_KP_JSON') {\n                        inCache = true;\n                        break;\n                    }\n                }\n            }\n            return inCache;\n        }\n\n        const unsubscribe = ofp.subscribe(async () => {\n            const inCache = await isInCache();\n            if (inCache && $Kp !== undefined) { // if offline we still need to load the predictions if not loaded yet\n                //console.log('ping noaa (ofp change)'); //predictedKpUpdate will do the real load if needed\n                fetch('CONF_NOAA_KP_JSON').catch(() => {return;});\n            }else{\n                //console.log('loading noaa kp store (ofp change)');\n                fetchNoaaKpAndSet();\n            }\n        });\n        return () => {\n            unsubscribe();\n            if (navigator && navigator.serviceWorker){\n                navigator.serviceWorker.removeEventListener('message', predictedKpUpdated);\n            }\n        }\n    });\n</script>","<script context=\"module\">\n    export const format = (date, withSeconds=false) => {\n        if (!date) return (withSeconds) ? '--:--:--' : '--:--';\n        if (withSeconds) {\n            return date.toJSON().slice(11, 19);\n        } else if (date.getUTCSeconds(date) < 30) {\n            return date.toJSON().slice(11, 16);\n        }\n        return (new Date(date.getTime() + 60000)).toJSON().slice(11, 16);\n    };\n    //xpos computes svg x coordinnate using relative position, if a fixed width is given, returns abolute position, else percent\n    export const timelineSize = 0.9;\n    export const xpos = (rel, fixed) => (fixed) ? `${fixed * (5 + (timelineSize * rel)) / 100}` : `${5 + (timelineSize * rel)}%`;\n    export const civilIcon = \"✽\";\n    export const eventColor = (stateOrEvent) => {\n        switch(stateOrEvent){\n            case 'dayStart'://↑\n            case 'day':\n            case 'sunrise': //↑\n                return '#89d4ff';\n            case 'sunset': //↓\n            case 'civil twilight':\n            case 'civilDawn': //↑\n                return '#2383C2'\n            case 'civilDusk': //↓ \n            case 'nautical twilight':\n            case 'nauticalDawn': //↑\n                return '#0052A2';\n            case 'nauticalDusk': //↓\n            case 'astronomical twilight':\n            case 'astronomicalDawn': //↑\n                //return '#02386E';\n            case 'astronomicalDusk': //↓\n            case 'night':\n            case 'nighStart': //↓\n                return '#000B18';\n            default:\n                if (stateOrEvent) console.error(`#ERREUR ${stateOrEvent}#`);\n                return 'red';\n        };\n    };\n</script>\n<script>\n    import {aurora, Kp} from \"./KpUpdater.svelte\";\n    import {flightProgress, landingTime, takeOffTime} from \"../stores\";\n    import {solar} from \"./solarstore\";\n    import {getMoonIllumination, getMoonPosition} from \"./suncalc.js\";\n\n\n    //Safari does not accept transform-origin in inline svg style\n    //SVG do not allow transform origin using % unit\n    //alternative => bind clientWidth  of the div wrapping the svg\n    let svgClientWidth = 364;\n    // const moonIconStyle =  (date, point) => { //not yet supported in safari\n    //     const mi = getMoonIllumination(date);\n    //     const iconOrientationCorrection = 132 * Math.PI / 180;\n    //     const oa = mi.angle - getMoonPosition(date, point).parallacticAngle; // observer angle\n    //     return `transform: rotate(${ -oa + iconOrientationCorrection}rad);`;\n    // }\n    const moonIconTransform =  (date, point, x0, y0) => {\n        const mi = getMoonIllumination(date);\n        const iconOrientationCorrection = 132;\n        const oa = mi.angle - getMoonPosition(date, point).parallacticAngle; // observer angle\n        return `rotate(${ (-oa * 180 / Math.PI) + iconOrientationCorrection}, ${x0}, ${y0})`;\n    }\n    export let departureSun;\n    export let arrivalSun;\n</script>\n<div>\n    {#if !$Kp}\n        <p>Les prédictions de Kp sont indisponibles.</p>\n    {/if}\n    <div bind:clientWidth={svgClientWidth}><svg width=\"100%\" height=\"60px\" xmlns=\"http://www.w3.org/2000/svg\">\n        <!-- <defs>\n            <linearGradient id=\"SunTimeLine\">\n                <stop offset=\"0%\"  stop-color=\"{eventColor(departureSun.state)}\"/>\n                {#each $solar.sun as {type, relpos}}\n                    <stop offset=\"{relpos}%\"  stop-color=\"{eventColor(type)}\"/>\n                {/each}\n                <stop offset=\"100%\"  stop-color=\"{eventColor(arrivalSun.state)}\"/>\n            </linearGradient>\n        </defs> -->\n        <rect\n            x=\"{xpos(0)}\"\n            width=\"{timelineSize * 100}%\"\n            fill=\"{eventColor(arrivalSun.state)}\"\n            y=\"20\" height=\"10px\"/>\n        {#each $solar.sun as event, i}\n            {#if ['sunrise', 'sunset', 'civilDawn', 'civilDusk', 'nauticalDawn', 'nauticalDusk'].includes(event.type)}\n                <line stroke=\"gray\" stroke-width=\"1\"\n                    x1=\"{xpos(event.relpos)}\"\n                    y1=\"30\"\n                    x2=\"{xpos(event.relpos)}\"\n                    y2=\"32\" />\n                {#if (event.type === 'civilDawn' || event.type === 'civilDusk')}\n                    <text fill=\"{(event.type === 'civilDawn') ? '#FCBF49' : '#000B18'}\" text-anchor=\"middle\"\n                        x=\"{xpos(event.relpos)}\"\n                        y=\"44\">{civilIcon}</text>\n                {/if}\n            {/if}\n            {#if (i === 0)}\n                <rect \n                    x=\"{xpos(0)}\"\n                    width=\"{timelineSize * (event.relpos)}%\"\n                    fill=\"{eventColor(departureSun.state)}\"\n                    y=\"20\" height=\"10px\"/>\n            {:else}\n                <rect \n                    x=\"{xpos($solar.sun[i-1].relpos)}\" \n                    width=\"{timelineSize * (event.relpos - $solar.sun[i-1].relpos)}%\"\n                    fill=\"{eventColor($solar.sun[i-1].type)}\"\n                    y=\"20\" height=\"10px\"/>\n            {/if}\n        {/each}\n        {#each $solar.moon as {type, relpos, date, position}}\n            <line stroke=\"gray\" stroke-width=\"1\"\n                x1=\"{xpos(relpos)}\"\n                y1=\"18\"\n                x2=\"{xpos(relpos)}\"\n                y2=\"20\" />\n            <text fill=\"{(type==='moonrise') ? '#FCBF49' : 'gray'}\" text-anchor=\"middle\" \n                x=\"{xpos(relpos)}\"\n                y=\"16\"\n                transform=\"{moonIconTransform(date, position, xpos(relpos, svgClientWidth), 9)}\"\n                >☾</text>\n        {/each}\n        {#each $aurora as {period, relpos}}\n            <rect stroke=\"lime\" stroke-opacity=\"60%\" fill=\"transparent\" stroke-width=\"2\"\n                x=\"{xpos(relpos[0])}\"\n                y=\"18\"\n                width=\"{timelineSize * (relpos[1] - relpos[0])}%\"\n                height=\"14\"/>\n            <text fill=\"green\"text-anchor=\"middle\" font-size=\"0.7em\"\n                x=\"{xpos(relpos[0] + (relpos[1] - relpos[0]) / 2)}\"\n                y=\"15\">{format(period[0])}</text>\n            <text fill=\"green\"text-anchor=\"middle\" font-size=\"0.7em\"\n                x=\"{xpos(relpos[0] + (relpos[1] - relpos[0]) / 2)}\"\n                y=\"42\">{format(period[1])}</text>\n        {/each}\n        <circle fill=\"#FCBF49\" stroke=\"black\" stroke-width=\"0.5\"\n            cx=\"{ xpos($flightProgress)}\" \n            cy=\"25\" r=\"2.5\" />\n        <text fill=\"black\"text-anchor=\"middle\"\n            x=\"5%\"\n            y=\"56\">{format($takeOffTime)}</text>\n        <text fill=\"black\" text-anchor=\"middle\"\n            x=\"95%\" \n            y=\"56\">{format($landingTime)}</text>\n    </svg></div>\n    {#if $aurora.length > 0}\n        <div class=\"aurora-legend\"><span>zone favorable aux aurores boréales</span></div>\n    {/if}\n</div>\n<style>\n    .aurora-legend {\n        margin: 0 auto;\n        width: 75%;\n        margin-top: -0.9em;\n        font-size: 0.7rem;\n        color: gray;\n        text-align: center;\n    }\n    .aurora-legend span{\n        border-bottom: 2px solid #00FF007F;\n    }\n</style>","<script>\n    import {Kp, kpColor ,aurora} from \"./KpUpdater.svelte\";\n    import {format, xpos, timelineSize} from \"./SunTimeLine.svelte\";\n    import {landingTime, takeOffTime, flightProgress} from \"../stores\";\n\n    const minmax = (v) => Math.min(100, Math.max(0, v));\n    $: flightKp = ($Kp) ? $Kp.timetable : [];\n\n</script>\n<div>\n    {#if (flightKp.length > 0)}\n        <svg width=\"100%\" height=\"53px\" xmlns=\"http://www.w3.org/2000/svg\">\n            {#each flightKp as {date, kp, relpos}, i}\n                <rect fill=\"{kpColor(kp)}\"\n                    x=\"{xpos(minmax(relpos))}\"\n                    y=\"7\"\n                    width=\"{timelineSize * (minmax((i===0) ? 100 : flightKp[i - 1].relpos - 0.2) - minmax(relpos))}%\"\n                    height=\"14px\"/>\n\n                <text fill=\"white\" stroke=\"white\" text-anchor=\"middle\" font-size=\"0.7em\"\n                    x=\"{xpos((minmax(relpos) + minmax((i===0) ? 100 : flightKp[i - 1].relpos)) / 2)}\"\n                    y=\"17\">{kp}</text>\n                {#if relpos > 5 && relpos < 95}\n                    <text fill=\"gray\"text-anchor=\"middle\" font-size=\"0.7em\"\n                        x=\"{xpos(relpos)}\"\n                        y=\"31\">{format(date)}</text>\n                {/if}\n            {/each}\n            <circle fill=\"#FCBF49\" stroke=\"black\" stroke-width=\"0.5\"\n                cx=\"{xpos($flightProgress)}\" \n                cy=\"20\" r=\"2.5\" />\n            <text fill=\"black\"text-anchor=\"middle\"\n                x=\"5%\"\n                y=\"49\">{format($takeOffTime)}</text>\n            <text fill=\"black\" text-anchor=\"middle\"\n                x=\"95%\" \n                y=\"49\">{format($landingTime)}</text>\n            {#if $aurora.length === 0 && !!$Kp}\n                <text fill=\"gray\" text-anchor=\"middle\" font-size=\"0.8em\"\n                    x=\"50%\" \n                    y=\"49\">aucune aurore boréale prévue sur la route</text>\n            {/if}\n        </svg>\n    {:else if !$Kp}\n        <p>Les prévisions de Kp sont indisponibles.</p>\n    {:else}\n        <p>Les prévisions sont disponibles de J-7 à J+2</p>\n    {/if}\n</div>\n<style>\n    p{\n        margin-left: 0.75rem;\n    }\n</style>","<script context=\"module\">\n    export const getMoonIlluminationPercent = (moonIllumination) => Math.round(moonIllumination.fraction * 100);\n    export const getMoonEmoji = (moonIllumination) => {\n        //https://fr.wikipedia.org/wiki/Phase_de_la_Lune\n        const phase = moonIllumination.phase;\n        const fraction = moonIllumination.fraction;\n        if (!phase || !fraction) return \"☽\";\n        if(fraction <= 0.02) {\n            return '🌑';\n        }else if (phase < 0.5 && fraction <= 0.34){\n            return '🌒';\n        }else if (phase < 0.5 && fraction <= 0.65){\n            return '🌓';\n        }else if (phase < 0.5 && fraction < 0.97){\n            return '🌔';\n        }else if (fraction >= 0.97){\n            return '🌕';\n        }else if (phase >= 0.5 && fraction > 0.65){\n            return '🌖';\n        }else if (phase >= 0.5 && fraction > 0.34){\n            return '🌗';\n        }else{\n            return '🌘';\n        }\n    };\n    export const getMoonName = (moonIllumination) => {\n        //https://en.wikipedia.org/wiki/Lunar_phase\n        //rounded to the nearest % integer\n        const phase = moonIllumination.phase;\n        const fraction = getMoonIlluminationPercent(moonIllumination);\n        if(fraction <= 0) {\n            return 'Nouvelle lune';\n        }else if (phase < 0.5 && fraction < 50) {\n            return 'Premier croissant';\n        }else if (phase < 0.5 && fraction === 50) {\n            return 'Premier quartier';\n        }else if ((phase < 0.5 && fraction < 100)){\n            return 'Gibbeuse croissante';\n        }else if (fraction === 100){\n            return 'Pleine Lune';\n        }else if (phase >= 0.5 && fraction > 50){\n            return 'Gibbeuse décroissante';\n        }else if (phase >= 0.5 && fraction === 50){\n            return 'Dernier quartier';\n        }else{\n            return 'Dernier croissant';\n        }\n    };\n</script>\n<script>\n    import {getMoonIllumination, getMoonPosition} from './suncalc';\n\n    export let date;\n    export let position;\n    export let type = null;\n\n    $: moonEmojiStyle = () => {\n        if (!date || !position) return 0;\n        const mi = getMoonIllumination(date);\n        const emojiOrientationCorrection = (mi.phase >= 0.5) ? Math.PI/2 : -Math.PI/2;\n        const oa = mi.angle - getMoonPosition(date, position).parallacticAngle;\n        return `transform: rotate(${ -oa + emojiOrientationCorrection}rad);`\n    };\n</script>\n<div class=\"moon\" class:rise={type==='moonrise'} style=\"{moonEmojiStyle()}\"><slot></slot></div>\n\n<style>\n    .moon {\n        display: inline-block;\n        transform-origin: center;\n    }\n    .rise {\n        color: #FCBF49;\n    }\n</style>\n","<script>\n    import {kpColor} from \"./KpUpdater.svelte\";\n    import SunTimeLine, {format, civilIcon, eventColor} from \"./SunTimeLine.svelte\";\n    import KpTimeLine from \"./KpTimeLine.svelte\";\n    import Moon, {getMoonName, getMoonIlluminationPercent} from \"./Moon.svelte\";\n    import {moonState, sunStateAndRising, sunRisingStates} from \"./suncalc\";\n    import {ofp, landingTime, position} from \"../stores\";\n    import {solar} from \"./solarstore\";\n\n    export let departureSun;\n    export let moonEmoji;\n    export let moonIllumination;\n    export let estimatedDate;\n\n    $: arrivalSun = ($ofp && $landingTime) ? sunStateAndRising($landingTime, $ofp.arrival, 0) : '';\n    $: isMoonVisible = ($position && estimatedDate) ? moonState(estimatedDate, $position.map, $position.fl).state : '';\n\n\n    const stateAsText = (point, date, {state, isRising}) => {\n        if (!point || !date) return '';\n        if (state === 'day') {\n            return  'de jour';\n        } else if (state === 'night' || state === 'astronomical twilight') {\n            return 'de nuit';\n        } else if (state === 'nautical twilight') {\n            return (isRising) ? \"durant l'aube nautique\" : \"durant le crépuscule nautique\";\n        }else if (state === 'civil twilight') {\n            return (isRising) ? \"durant l'aube civile\" : \"durant le crépuscule civil\";\n        }\n        return `#ERREUR ${state}#`;\n    };\n\n    const nightEventsFR = {\n        'astronomicalDawn': 'Aube astronomique',\n        'astronomicalDusk': 'Nuit astronomique',\n        'nauticalDawn': 'Aube nautique',\n        'nauticalDusk': 'Nuit nautique',\n        'civilDawn': 'Aube civile',\n        'civilDusk': 'Nuit civile',\n        'sunrise': 'Lever du soleil',\n        'sunset': 'Coucher du soleil',\n        'day': 'Jour',\n        'night': 'Nuit',\n        'moonrise': 'Lever de lune',\n        'moonset': 'Coucher de lune'\n    };\n    const _ = (t) =>  nightEventsFR[t] || t;\n    const states = sunRisingStates.slice(1); // night and astronomical twilight are the same color now\n</script>   \n<div class=\"card-body\">\n    <SunTimeLine {arrivalSun} {departureSun}/>\n    <table class=\"table\">\n        <thead>\n            <tr>\n                <th scope=\"col\">Soleil</th>\n                <th scope=\"col\" class=\"color\">\n                    <svg width=\"100%\" height=\"27px\" xmlns=\"http://www.w3.org/2000/svg\">\n                        {#each states as event, i}\n                        <rect fill=\"{eventColor(event)}\"\n                            y=\"{0 + i * 6}\"\n                            x=\"0\"\n                            width=\"45%\"\n                            height=\"5\"/>\n                        <rect fill=\"{eventColor(states[states.length -1 -i])}\"\n                            y=\"{0 + i * 6}\"\n                            x=\"55%\"\n                            width=\"45%\"\n                            height=\"5\"/>\n                        {/each}\n                    </svg>\n                </th>\n                <th scope=\"col\">Heure</th>\n                <th scope=\"col\">FL</th>\n            </tr>\n        </thead>\n        <tbody>\n            {#each $solar.sun.filter(e => ['sunrise', 'sunset', 'civilDawn', 'civilDusk', 'nauticalDawn', 'nauticalDusk'].includes(e.type)) as event, i}\n            <tr>\n                {#if event.fl !== 0}\n                    <td>{_(event.type)}\n                        {#if event.type.startsWith('civil')}\n                            <span class:rise={event.type==='civilDawn'}>{civilIcon}</span>\n                        {/if}\n                    </td>\n                    <td class=\"color {event.type}-color\"></td>\n                    <td>{format(event.date)}</td>\n                    <td>FL{event.fl}</td>\n                {:else if i===0}\n                    <td colspan=\"4\">{_(event.type)} en montée\n                        {#if event.type.startsWith('civil')}\n                            <span class:rise={event.type==='civilDawn'}>{civilIcon}</span>\n                        {/if}\n                    </td>\n                {:else}\n                    <td colspan=\"4\">Atterrissage {stateAsText($ofp.arrival, $landingTime, arrivalSun)}</td>\n                {/if}\n            </tr>\n            {:else}\n                <tr><td colspan=\"4\">Aucun événement</td></tr>\n            {/each}\n        </tbody>\n        <thead>\n            <tr>\n                <th scope=\"col\" colspan=\"4\">\n                    Lune <Moon date={estimatedDate} position={$position.map}>{moonEmoji}</Moon> {getMoonName(moonIllumination)} {getMoonIlluminationPercent(moonIllumination)}% {(isMoonVisible) ? '' : 'non visible'}\n                </th>\n            </tr>\n        </thead>\n        <tbody>\n            {#each $solar.moon as event, i}\n            <tr>\n                {#if event.fl !== 0}\n                    <td>{_(event.type)} <Moon position={event.position} type={event.type} date={event.date}>{moonEmoji}</Moon></td>\n                    <td class=\"color\"></td>\n                    <td>{format(event.date)}</td>\n                    <td>FL{event.fl}</td>\n                {:else}\n                    <td colspan=\"4\">{_(event.type)} en {(i === 0) ? 'montée' : 'descente'} <Moon position={event.position} type={event.type} date={event.date}>{moonEmoji}</Moon></td>\n                {/if}\n            </tr>\n            {:else}\n                <tr><td colspan=\"4\">Aucun événement</td></tr>\n            {/each}\n        </tbody>\n        <thead>\n            <tr>\n                <th scope=\"col\" colspan=\"4\" class=\"kp\">Prévisions de Kp\n                    <svg width=\"150px\" height=\"13px\" xmlns=\"http://www.w3.org/2000/svg\">\n                        {#each [0, 1, 2 ,3, 4, 5, 6, 7, 8, 9] as data}\n                        <rect stroke=\"{kpColor(data)}\" stroke-width=\"1\" fill=\"transparent\"\n                            x=\"{2 + data * 15}\"\n                            y=\"2\"\n                            width=\"12\"\n                            height=\"12\"/>\n                            <text fill=\"gray\"text-anchor=\"middle\" font-size=\"0.7em\"\n                                x=\"{8 + data * 15}\"\n                                y=\"11.5\">{data}</text>\n                    {/each}\n                    </svg>\n                </th>\n            </tr>\n        </thead>\n    </table>\n    <KpTimeLine/>\n</div>\n<style>\n    .table>:not(:last-child)>:last-child>* {\n        border-bottom-color: var(--light-grey);\n        border-bottom-width: 2px;\n    }\n    .table>tbody>:last-child>* {\n        border-bottom-color: transparent !important;\n        border-bottom-width: 0px !important;\n    }\n    .table th {\n        border-top: none;\n        text-align: left;\n    }\n    .table .color {\n        width: 0.75rem;\n        padding: 0;\n    }\n    .table :global(.sunrise-color) {\n        background: linear-gradient(#2383C2 0% 50%, lightskyblue 50% 100%);\n        border-top-color: #2383C2;\n        border-bottom-color: lightskyblue;\n    }\n    .table :global(.civilDawn-color) {\n        background: linear-gradient( #0052A2 0% 50%, #2383C2 50% 100%);\n        border-top-color: #0052A2;\n        border-bottom-color: #2383C2;\n    }\n    .table :global(.nauticalDawn-color) {\n        background: linear-gradient(/*#02386E*/#000B18 0% 50%, #0052A2 50% 100%);\n        border-top-color: /*#02386E*/#000B18;\n        border-bottom-color: #0052A2;\n    }\n    /* .table :global(.astronomicalDawn-color) {\n        background: linear-gradient(#000B18 0% 50%, #02386E 50% 100%);\n        border-top-color: #000B18;\n        border-bottom-color: #02386E;\n    }\n    .table :global(.astronomicalDusk-color) {\n        background: linear-gradient(#02386E 0% 50%, #000B18 50% 100%);\n        border-top-color: #02386E;\n        border-bottom-color: #000B18;\n    } */\n    .table :global(.nauticalDusk-color) {\n        background: linear-gradient(#0052A2 0% 50%, /*#02386E*/#000B18 50% 100%);\n        border-top-color: #0052A2;\n        border-bottom-color: /*#02386E*/#000B18;\n    }\n    .table :global(.civilDusk-color) {\n        background: linear-gradient(#2383C2 0% 50%, #0052A2 50% 100%);\n        border-top-color: #2383C2;\n        border-bottom-color: #0052A2;\n    }\n    .table :global(.sunset-color) {\n        background: linear-gradient(lightskyblue 0% 50%, #2383C2 50% 100%);\n        border-top-color: lightskyblue;\n        border-bottom-color: #2383C2;\n    }\n    .pin {\n        display: inline-block;\n        width: 10px;\n        height: 10px;\n        border-radius: 5px;\n        background-color: #000B18;\n    }\n    .pin-day {\n        background-color: #FCBF49;\n    }\n    .moon {\n        display: inline-block;\n        transform-origin: center;\n    }\n    .rise {\n        color: #FCBF49;\n    }\n    th[scope=col]{\n        padding-bottom: 5px;\n    }\n    th.kp {\n        position: relative;\n    }\n    th.kp svg{\n        right: 5%;\n        position: absolute;\n        bottom: 0;\n    }\n</style>","<script>\n    import {slide} from \"svelte/transition\";\n    import Overlay from \"svelte-overlay\";\n    import KpUpdater, {aurora} from \"./KpUpdater.svelte\";\n    import {format} from \"./SunTimeLine.svelte\";\n    import SunPopOver from \"./SunPopOver.svelte\";\n    import Moon, {getMoonEmoji} from \"./Moon.svelte\";\n    import {sun, moon, getMoonIllumination} from \"./suncalc\";\n    import {ofp, takeOffTime, position} from \"../stores\";\n    import {solar} from \"./solarstore\";\n\n    \n    const getWidgetEmojiWhenNoSunEvent = (departureSun, isMoonVisibleDuringFlight) => {\n        if (departureSun.state === 'day') return '☀️';\n        if (isMoonVisibleDuringFlight) return 'moon';\n        return '🔭';\n    };\n\n    $: departureSun = ($ofp && $takeOffTime) ? sun.getState($takeOffTime, $ofp.departure, 0) : '';\n    $: departureMoon = ($ofp && $takeOffTime) ? moon.getState($takeOffTime, $ofp.departure, 0) : '';\n    $: estimatedDate = ($takeOffTime && $position) ? new Date($takeOffTime.getTime() + $position.reltime * 60000) : $takeOffTime  || $ofp.infos.ofpOFF;\n    $: sunEvents = $solar.sun.filter(e => ['sunrise', 'sunset'].includes(e.type));\n    $: isMoonVisibleDuringFlight = $solar.moon.length > 0 || departureMoon.state;\n    $: widgetEmoji = (sunEvents.length > 0) ? '☀️': getWidgetEmojiWhenNoSunEvent(departureSun, isMoonVisibleDuringFlight); //after isMoonVisibleDuringFlight\n    $: widgetEvents = (widgetEmoji === '☀️') ? sunEvents : (widgetEmoji === 'moon') ? $solar.moon : [];\n    $: moonIllumination = (estimatedDate) ? getMoonIllumination(estimatedDate) : {};\n    $: moonEmoji = getMoonEmoji(moonIllumination);\n\n</script>\n<KpUpdater/>\n{#if $ofp && $ofp.timeMatrix.length > 0}\n    <Overlay  position=\"bottom-center\" isOpen={false}>\n        <div slot=\"parent\" class=\"sun\" class:aurora={$aurora.length > 0} let:toggle on:click={toggle}>\n            <p class=\"icon\">\n                {#if (widgetEmoji === 'moon')}\n                    <Moon position=\"{$position.map}\" date={estimatedDate}>{moonEmoji}</Moon>\n                {:else}\n                    {widgetEmoji}\n                {/if}\n            </p>\n            <div class=\"details\" class:two=\"{widgetEvents.length === 2}\" class:three=\"{widgetEvents.length>= 3}\">\n                {#each widgetEvents.slice(0, 3) as event}\n                    <p>{(event.type.includes('rise')) ? '↥' : '↧'} {format(event.date)}</p>\n                {/each}\n            </div>\n        </div>\n        <div slot=\"content\" style=\"width: 390px;\" class=\"overlay card\" let:close in:slide={{ duration: 200 }}>\n            <h6 class=\"card-header\">\n                <span>Éphémérides du vol</span>\n                <button type=\"button\" class=\"btn-close ms-auto\" aria-label=\"Close\" on:click={close}></button></h6>\n            <SunPopOver {departureSun} {moonEmoji} {estimatedDate} {moonIllumination}/>\n        </div>\n    </Overlay>\n{/if}\n<style>\n    .sun {\n        cursor: pointer;\n        display: none;\n        position: relative;\n    }\n    @media (min-width: 320px){\n        .sun {\n            display: flex;\n        }\n    }\n    .details{\n        flex-direction: column;\n        display: none;\n    }\n    @media (min-width: 1024px){\n        .details {\n            display: flex;\n        }\n    }\n    .sun p {\n        margin: 0;\n    }\n    .sun.aurora::before{\n        content: \"\";\n        position: absolute;\n        top: -8px;\n        left: -15px;\n        width: 50px;\n        height: 38px;\n        background-image: url(/images/65x70_northern-lights.webp);\n        background-size: cover;\n        background-repeat: no-repeat;\n        background-position: center;\n        filter: blur(3px) opacity(40%);\n        z-index: -1;\n    }\n    .two p {\n        font-size: small;\n    }\n    .three p {\n        font-size: xx-small;\n    }\n    .icon{\n        align-self: center;\n    }\n\n    :global(.overlay .content.bottom-bottom) { /*fix overlay misplacement*/\n        left: 50%;\n        transform: translateX(-50%);\n        top: 100%;\n    }\n\n</style>","<script>\n    import {aircraftType, ofp, route} from '../stores';\n    import GrametTrigger from './GrametTrigger.svelte';\n    import OfpInfos from './OfpInfos.svelte';\n    import TakeOffInput from './TakeOffInput.svelte';\n    import Sun from './Sun.svelte';\n    let menuCheckBox;\n    const collapse = () => menuCheckBox.checked = false;\n</script>\n<nav class=\"navbar navbar-expand-md navbar-light\">\n  <div class=\"container-fluid\">\n  <input bind:this={menuCheckBox} type=\"checkbox\" id=\"menu\">\n  <!-- following items are in reverse order to have the menu collapse nicely -->\n  <slot></slot>\n  {#if ($ofp) }\n    <OfpInfos/>\n    <TakeOffInput/>\n    {#if $route === '/map'}<GrametTrigger/><Sun/>{/if}\n  {/if}\n  <label class=\"navbar-toggler\" for=\"menu\"><span class=\"navbar-toggler-icon\"></span></label>\n  <!-- end of items in reverse order -->\n\n  <!-- collapsable menu -->\n  <ul class=\"navbar-nav collapse navbar-collapse\" id=\"navbarToggler\">\n    <li class=\"nav-item\" class:active={$route === '/'}>\n      <a class=\"nav-link\" href=\"#/\" on:click={collapse}><strong class=\"d-none\">OFP2MAP </strong><svg><use xlink:href=\"#home-symbol\"/></svg>{#if 'process.env.NODE_ENV' === '\"development\"'}<sup>dev</sup>{/if}</a>\n    </li>\n    {#if $ofp|| $aircraftType || $route === '/map'}\n    <li class=\"nav-item\" class:active={$route === '/map'}>\n      <a class=\"nav-link\" href=\"#/map\" on:click={collapse}>\n      <span>CARTE</span></a>\n    </li>\n    {/if}\n    {#if  ($ofp) || $route === '/export'}\n    <li class=\"nav-item\" class:active={$route === '/export'}>\n      <a class=\"nav-link\" href=\"#/export\" on:click={collapse}>\n      <span>EXPORT</span></a>\n    </li>\n    {/if}\n    <li class=\"nav-item\" class:active={$route === '/help'}>\n      <a class=\"nav-link\" href=\"#/help\" on:click={collapse}>\n      <span>AIDE</span></a>\n    </li>\n  </ul>\n  </div>\n</nav>\n\n<style>\n    #menu {\n      display: none;\n    }\n    sup {\n        background-color: var(--redaf);\n        color: var(--bs-white);\n        padding: 1px 3px;\n        border-radius: 3px;\n        font-weight: normal;\n        font-size: xx-small;\n        top: -10px;\n        left: -3px;\n        display: inline-block;\n        line-height: 1em;\n    }\n    svg {\n      width: 20px;\n      height: 20px;\n      margin-top: -2px;\n      fill: rgba(0,0,0,.5);\n      stroke: rgba(0,0,0,.5);\n    }\n    .active svg {\n      fill: rgba(0,0,0,.9);\n      stroke: rgba(0,0,0,.9);\n    }\n    .navbar {\n      padding-top: 0;\n      padding-bottom: 0;\n    }\n    nav > .container-fluid{\n      flex: 0 1 auto;\n      position: static; /* for no ofp prompt on home page bottom */\n      padding: 2px 10px 0px 10px;\n      background-color: var(--bs-light);\n      flex-direction: row-reverse;\n    }\n\n    li {\n      margin-right: 0px;\n      padding-left: 10px;\n    }\n    @media (min-width: 630px){\n        li {\n          margin-right: 10px;\n        }\n        :global(nav > div > div) {\n          margin-right: 0.8rem;\n        }\n    }\n    li span{\n      display: inline-block;\n    }\n    .nav-item.active {\n      border-left: 2px solid var(--bs-pink);\n    }\n    @media (min-width: 768px){\n      li {\n        padding-left: 0px;\n      }\n      .nav-item.active {\n        border-bottom: 2px solid var(--bs-pink);\n        border-left: none;\n      }\n    }\n    @media (min-width: 830px){\n      :global(nav > div > div) {\n        margin-right: 1.6rem !important;\n      }\n    }\n    input:checked ~ .collapse{\n        display: block;\n    }\n</style>","<script context=\"module\">\n    import loader from './async-script-loader.js';\n    import {Deferred} from './utils.js';\n    import {generateKML, KmlGenerator} from './kml.js';\n    const pdfjsWorkerSrc = 'CONF_PDFJS_WORKER_JS';\n    const preloadFiles = [\n        { type: 'script', url: 'CONF_PDFJS_JS' },\n        { type: 'script', url: 'CONF_LIDOJS_JS' },\n        { type: 'script', url: 'CONF_PROJ4_JS' },\n        { type: 'script', url: 'CONF_WMO_JS' },\n        { type: 'script', url: 'CONF_MAPBOXGL_JS' },\n        { type: 'script', url: 'CONF_PINCHZOOM_JS'},\n        { type: 'link', url: 'CONF_MAPBOXGL_CSS'}\n    ];\n\n    const getPageText = async (pdf, pageNo) => {\n        const page = await pdf.getPage(pageNo);\n        const tokenizedText = await page.getTextContent();\n        return tokenizedText.items.map(token => token.str).join((pageNo === 1) ? \" \": \"\");\n    };\n    const getOFPText = async (source) => {\n        const pdfjsLib = window['pdfjs-dist/build/pdf'];\n        const ofpPages = [];\n        let processedPages = 0;\n        const pdf = await pdfjsLib.getDocument(source).promise;\n        const maxPages = pdf.numPages;\n        for (let pageNo = 1; pageNo <= maxPages; pageNo += 1) {\n            const pageText = await getPageText(pdf, pageNo);\n            if (pageText.includes(\"(Long copy #1)\")) {\n                ofpPages.push(pageText);\n                processedPages += 1;\n            } else if (processedPages !== 0){\n                break;\n            } else if (pageText.includes('FPL SUMMARY')) {\n                ofpPages.push(pageText); // for ETOPS\n            } else if (pageText.includes('CREW PAIRING')) {\n                ofpPages.push(pageText); // for ROSTERING and TSV\n            }\n        }\n        return ofpPages.join(\"\\n\");\n    };\n</script>\n<script>\n    import { createEventDispatcher } from 'svelte';\n    import {showGramet, ofp as ofpStore, ofpStatus, selectedAircraftType, takeOffTime} from '../stores';\n    import {aircraftTypes, discontinuatedAircraftTypes} from '../constants';\n    export let kmlOptions;\n    let disabled = false;\n    let ready = new Deferred();\n    let name = \"file\";\n    let label = \"Choisir un OFP\";\n    let readyClass = false;\n    let pdfWorker;\n    const dispatch = createEventDispatcher();\n\n    function preload() {\n        loader(preloadFiles, () => !!window['pdfjs-dist/build/pdf'], () => {\n            const pdfjsLib = window[\"pdfjs-dist/build/pdf\"];\n            pdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorkerSrc;\n            if (!pdfWorker || pdfWorker.destroyed) {\n                    pdfWorker = new pdfjsLib.PDFWorker();\n            }\n            ready.resolve(true);\n            readyClass = true;\n        });\n    };\n    const getOFP = (file) => {\n        const reader = new FileReader();\n        return new Promise((resolve, reject) => {\n            reader.onload = (ev) => {\n                if (!pdfWorker || pdfWorker.destroyed) {\n                    const pdfjsLib = window[\"pdfjs-dist/build/pdf\"];\n                    pdfWorker = new pdfjsLib.PDFWorker();\n                }\n                getOFPText({ data: ev.target.result, verbosity: 0, worker: pdfWorker })\n                .then(\n                    (text) => {\n                        if (text) {\n                            //console.log(text);\n                            try {\n                                //console.timeLog('start');\n                                const ofp = new editolido.Ofp(\"_PDFJS_\" + text);\n                                const wmoGrid = new editolido.GeoGridIndex();\n                                wmoGrid.data = window['WMO'];\n                                const data = editolido.ogimetData(ofp, wmoGrid);\n                                data.proxyImg = `CONF_GRAMET_PROXY`;\n                                data.route.description = data.wmo.join(' ');\n                                ofp.ogimetData = data;\n                                let sum = 0;\n                                let averageFL = ofp.infos.averageFL;\n                                const distanceMatrix = ofp.route.segments.map(([p1, p2]) => {\n                                    sum += p1.distanceTo(p2);\n                                    return [p2, sum, averageFL];\n                                });\n                                distanceMatrix.unshift([ofp.route.points[0], 0]);\n                                ofp.distanceMatrix = distanceMatrix;\n                                let timeMatrix = [];\n                                try{\n                                    timeMatrix = ofp.wptNamesEET(ofp.route.points);\n                                }catch(err){\n                                    console.error(err);\n                                }\n                                if (timeMatrix.length === 0) {\n                                    document.body.style.setProperty('--plane-halo-color', 'red');\n                                } else {\n                                    document.body.style.setProperty('--plane-halo-color', 'var(--plane-color)');\n                                }\n                                ofp.timeMatrix = timeMatrix;\n                                ofp.departure =  ofp.route.points[0];\n                                ofp.arrival = ofp.route.points[ofp.route.points.length - 1];\n\n                                //console.log(timeMatrix)\n                                //console.timeLog('start');\n                                try {\n                                    KmlGenerator();\n                                    generateKML(ofp, kmlOptions);\n                                    //console.timeEnd('start')\n                                    resolve(ofp);\n                                } catch (err) {\n                                    console.log(text);\n                                    console.log(ofp.infos);\n                                    // throw(err);\n                                    reject(err);\n                                }\n                            } catch (err) {\n                                // throw(err);\n                                console.log(text);\n                                reject(err);\n                            }\n                        } else {\n                            reject(Error(\"OFP non reconnu. Attention il y a 2 OFP dans PilotMission, il faut bien choisir celui nommé « Dossier de vol OFP ».\"));\n                        }\n                    },\n                    (err) => {\n                        reject(err);\n                    }\n                );\n            };\n            reader.onerror = (err) => { reject(Error(\"Fichier illisible !\")) };\n            reader.readAsArrayBuffer(file);\n        });\n    };\n    async function process(e) {\n        disabled = true;\n        $showGramet = false; // must be set here and not in App.svelte (why ?)\n        preload(); // in case click event not supported or missed\n\n        await ready.promise.then(() => {\n            const file = e.target.files[0];\n            const form = e.target.closest('form');\n            if (file) {\n                $ofpStatus = 'loading';\n                $takeOffTime = undefined;\n                //label = e.target.value.split(/([\\\\/])/g).pop();\n                dispatch('change', label);\n                window.location.hash = '#/map'; //TODO must be here and not in the then promise below to avoid map centering issues. Why ?\n                getOFP(file).then((ofp) => {\n                    $ofpStore = ofp;\n                    $selectedAircraftType = undefined;\n                    $ofpStatus = 'success';\n                    form.blur();\n                    e.target.blur();\n                }).catch((err) => {\n                    $ofpStatus = err;\n                    $ofpStore = undefined;\n                    console.trace(err);\n                }).finally(() => {\n                    form.reset(); \n                });\n            }\n        });\n        disabled = false;\n    };\n    async function processAircraftType(e) {\n        disabled = true;\n        $ofpStatus = 'loading';\n        preload(); // in case click event not supported or missed\n        await ready.promise.then(() => {\n            $ofpStore = undefined;\n            try {\n                KmlGenerator(); // to have a minimum skeleton for map settings\n                $selectedAircraftType = e.target.value;\n                $ofpStatus = 'success';\n            } catch (err) {\n                console.log(err);\n                $ofpStatus = err;\n            }\n            window.location.hash = '#/map';\n        });\n        disabled = false;\n    }\n\n</script>\n<form class=\"form-inline\" on:submit|preventDefault>\n    {#if (!$ofpStore)}\n    <div class=\"input-group\" class:blink={!$ofpStore}>\n        <span class=\"input-group-text\">\n            <span class=\"d-block d-sm-none\">Choisir</span>\n            <span class=\"d-none d-sm-block\">Choisir un OFP</span>\n        </span>\n        <label class=\"input-group-text btn btn-primary\" for=\"{name}\">\n            <span class=\"d-block d-sm-none\">OFP…</span>\n            <span class=\"d-none d-sm-block\">Sélectionner</span>\n            <input id={name} name={name} type=\"file\" accept=\"application/pdf\" on:change={process} disabled={disabled} on:click|once={preload} hidden>\n        </label>\n    </div>\n    {:else}\n        <label class=\"btn btn-outline-secondary btn-sm\">\n            Changer<input id={name} name={name} type=\"file\" accept=\"application/pdf\" on:change={process} hidden>\n        </label>\n    {/if}\n    {#if !$ofpStore && !$selectedAircraftType}\n        <div class=\"footer\">\n        <!-- svelte-ignore a11y-no-onchange -->\n        <select class=\"form-control-sm\" on:click|once={preload} disabled={disabled} on:change={processAircraftType}>\n            <option value=\"{undefined}\">pas d'ofp ?</option>\n            {#each aircraftTypes.filter(v => !discontinuatedAircraftTypes.includes(v)) as aircraft}\n            <option value={aircraft}>{aircraft}</option>\n            {/each}\n        </select>\n        </div>\n    {/if}\n</form>\n\n<style>\n    span.input-group-text{\n        background-color: var(--bs-white);\n        padding-right: 0.5rem;\n    }\n    label {\n        font-variant-caps: all-small-caps;\n    }\n    @media (min-width: 576px){\n        span.input-group-text {\n            padding-right: 50px;\n        }\n    }\n    .blink {\n        animation: blink 3s ease infinite;\n    }\n    @keyframes blink {\n        0% { transform: scale(1.0); }\n        75% { transform: scale(1.0); }\n        80% { transform: scale(1.03); }\n        95% { transform: scale(1.03); }\n        100% { transform: scale(1.0); }\n    }\n    .footer {\n        position: absolute;\n        right: 5px;\n        top: calc( 100vh - 41px);\n        text-align: right;\n        display: none;\n        z-index: 1;\n    }\n    :global(.home .footer){\n        display: block !important;\n    }\n    select {\n        background-color: var(--blueaf);\n        border-color: var(--blueaf);\n        color: #888;\n        margin: 5px;\n        appearance: none;\n        -webkit-appearance: none;\n        -moz-appearance: none;\n    }\n</style>","export default function (urls, test, callback) {\n    let remaining = urls.length\n  \n    function maybeCallback () {\n      remaining = --remaining\n      if (remaining < 1) {\n        callback()\n      }\n    }\n  \n    if (!test()) {\n      urls.forEach(({ type, url, options = { async: true, defer: true }}) => {\n        const isScript = type === 'script'\n        const tag = document.createElement(isScript ? 'script': 'link')\n        if (url.startsWith('http') || url.startsWith('//')){\n          tag.crossOrigin = \"anonymous\";\n        }\n        let onload = true\n        if (isScript) {\n          tag.src = url\n          tag.async = options.async\n          tag.defer = options.defer\n        } else {\n            tag.href = url\n            if ('prefetch' in options){\n                tag.rel = \"prefetch\"\n                remaining -= 1\n                onload = false\n            } else if ('preload' in options) {\n                tag.rel = 'preload'\n                remaining -= 1\n                onload = false\n            } else {\n                tag.rel = 'stylesheet'\n                remaining -= 1\n                onload = false\n            }\n        }\n        if (onload) tag.onload = maybeCallback\n        document.body.appendChild(tag)\n      })\n    } else {\n      callback()\n    }\n  }","<script>\n    import { fade } from \"svelte/transition\";\n    export let hidden=undefined;\n    export let maxWidth=undefined;\n    const fadeif = (node, animation, params) => {\n        if(hidden === undefined) {\n            return fade(node, animation, params);\n        }\n    }\n</script>\n\n<page in:fadeif style=\"{(maxWidth) ? `max-width: ${maxWidth}; align-self: center;` : ``}\" class:fadein={hidden===false} class:d-none={hidden===true}>\n    <slot></slot>\n</page>\n\n<style>\n    page {\n        flex: 1 1 auto;\n        display: flex;\n        flex-direction: column;\n        position: relative;\n    }\n    :global(page.fadein) {\n        display: flex;\n        animation: fade 0.4s linear;\n    }\n    @keyframes fade {\n        0%   {opacity: 0}\n        100% {opacity: 100}\n    }\n</style>","<script>\n    import Link from '../components/Link.svelte';\n    import {ofp} from '../stores.js';\n    import plugins from \"../plugins.json\";\n    $: ogimetURL = ($ofp) ? $ofp.ogimetData.url: 'http://www.ogimet.com';\n    const cbName = window.atob(\"Q2FydGFCb3NzeQ==\");\n</script>\n\n## Préambule\n\nOFP2MAP est une application PWA (ou Web Application), elle peut être lancée soit depuis un navigateur, soit depuis l'écran d'accueil de l'iPad. Initialement, simple convertisseur de l'OFP en KML, OFP2MAP est devenu une vraie application de cartographie. OFP2MAP nécessite des navigateurs récents pour fonctionner. Safari 14 iOS/Mac est compatible, Chrome 83 fonctionne aussi.\n\nL'OFP ne transite sur aucun serveur, seule une route calculée (basée sur au plus 21 stations météo) est transmise à l'hébergeur du proxy (voir plus bas) puis à Ogimet.com pour récupérer le Gramet. L'app ne collecte aucune donnée.\n\n## Utilisation\n\n1. Dans Pilot Mission, onglet «Dossier de vol», affichez le PDF nommé \"Dossier de vol OFP\". Sur la gauche, cliquez sur le carré avec une flèche vers le haut. Choisissez «Enregistrer dans Fichiers». Dans l'app, c'est cet OFP qu'il faut ensuite sélectionner.\n\n2. La carte par défaut dépend de la distance: {cbName} 2020, puis Mercator jusqu'à 1500nm puis LAMBERT, il est possible sur la carte, en haut à gauche, de basculer sur d'autres projections&#8239;:\n    - LAMBERT NORTH (parallèles sécants N30 et N65) est recommandée au-dessus du N40\n    - LAMBERT SOUTH & PACIFIC (sécants N30 et S15 ) sont recommandées sous N30\n    - THE WORLD permet de disposer d'un Atlas off-line, c'est une projection Times\n    - MERCATOR est une Web Mercator avec un thème est inspiré des cartes VFR. Il y a 12 niveaux de zoom, dont 6 disponibles off-line\n    - =Physique= est un Atlas physique basé sur une projection Equal Earth (qui montre les continents et les pays à leur taille réelle) avec des étiquettes en français (par Tom Patterson).\n    - {cbName} 2020 est une carte VFR, elle couvre France/Belgique/Luxembourg/Suisse et {window.atob(\"VmluY2VudCBCb3NzeQ==\")} a autorisé son utilisation. Sur cette carte, déjà très dense en informations, la route Gramet, l'orthodromie et les FIR sont désactivées. La dernière version est disponible sur <Link href=\"{`https://www.${cbName.toLowerCase()}.com`}\">{cbName}.com</Link>.\n\n\n3. Navigation dans la carte: on peut avec un doigt déplacer la carte, zoomer ou orienter la carte avec deux doigts.  \n__<big>☞</big> Il est aussi possible de modifier l'angle de vue en balayant de bas en haut avec deux doigts__.\n\n## Mémo visuel\n\n<img src=\"./images/map-help.webp\" alt=\"mémo visuel\" id=\"memovisuel\"><br/>\n\n## Réglages des calques\n\n<figure>![layers settings help](./images/layers-settings.webp)<figcaption>Réglages des calques</figcaption></figure>La carte, en haut à droite, dispose d'un bouton pour personnaliser les calques et les couleurs. Un calque contient un type d'information, par exemple les cercles ETOPS, les FIR réglementées, les tracks, la route...\nIl est possible d'afficher ou de masquer chaque calque en utilisant la coche qui précède son nom. La plupart des calques permettent de choisir la couleur et l'opacité.\nPour les aéroports (le type avion est déterminé dans l'OFP), il est possible de choisir entre 3 styles: couleur du statut, vert/rouge ou médical. Si vous optez pour le second, le statut reste accessible en cliquant sur un terrain (popup). Le style médical n'affiche que les terrains de support médical.\n\nTrois boutons permettent la sauvegarde, la restauration ou un retour aux valeurs par défaut. Le bouton RESTAURER permet, après avoir fait des modifications temporaires (non sauvegardées), de revenir rapidement aux réglages précédents.\n\nPour vous entraîner, je vous recommande de modifier la couleur des terrains en vert/rouge et de sauvegarder votre choix.\n\nUn mode FOCUS est disponible, par défaut il n'affiche que la route. Il s'active en cliquant sur FOCUS dans le champ ROUTE des réglages. Pour quitter ce mode, réaffichez les réglages et cliquez à nouveau sur le bouton.\n\nLe mode FOCUS est personnalisable, devenant ainsi un deuxième jeu de réglages&#8239;: En mode FOCUS, affichez et modifiez les réglages, la sauvegarde est automatique. Dans mon usage personnel, à titre d'exemple, je modifie la couleur de la route pour une couleur rouge orangée bien plus lisible dans la projection The World.\n\nSi besoin, vous pouvez effacer vos réglages et revenir aux valeurs par défaut du mode FOCUS.\n\n## Particularités de l'iPad\n\nOFP2MAP ne peut être lancé que depuis l'écran d'accueil, l'application se lance en plein écran. On ne peut pas recharger la page comme dans un navigateur&#8239;: il faudra pour cela aller dans le menu d'aide (cet écran) ou un bouton spécifique sera affiché en haut.\n\nPour partager le lien vers OFP2MAP, utilisez le bouton situé en haut sur cette page, ou le lien situé sous le logo sur la page d'accueil, puis utilisez AirDrop. {#if navigator.standalone !== true}Pour mémoire, dans un navigateur, il suffit de partager l'url ou <Link href=\"http://flyingeek.github.io/lido-online/index.html\">ce lien</Link>.{/if}\n\nÀ noter que parfois, des bugs d'affichage peuvent apparaître&#8239;:  lorsque l'on retourne sur l'app, l'app est zoomée, il faut alors juste dézoomer en utilisant un pinch de deux doigts sur la barre de menu. Il est aussi possible de tuer l'app,  même en mode déconnecté, pour la relancer.\n\n## GRAMET\n\nLe GRAMET est un météogramme représentant le temps et l'espace. Il indique, en tout point de la route, et à l'heure de passage estimée, une coupe verticale de la météo prévue.\nLe GRAMET est réalisé par <Link href=\"{ogimetURL}\">ogimet.com</Link> à partir d'une route calculée. Il est possible d'afficher le GRAMET et sa route sur la carte. La route est particulièrement utile lors des vols océaniques car il n'y a aucune station en mer.\nPour construire la route du GRAMET, on utilise non pas les waypoints, mais au plus 21 stations météo (WMO). Il y a au total 13000 WMO dans le monde. Le GRAMET débute toujours à l'heure hh:00. Pour un decollage à 19h30, il débutera à 19h, pour un décollage à 19h31, il débutera à 20h. Pour les OFP anciens, c'est l'heure actuelle qui est envoyée. En mode déconnecté, OFP2MAP utilise la version du GRAMET qu'il a mis en cache pendant 48h. Après l'heure de décollage initialement prévue, vous pouvez forcer une mise à jour, soit en rechargeant l'ofp, soit en changeant brièvement de page.\n\nPour afficher le Gramet, cliquez sur sa miniature à gauche de l'OFP. Pour afficher la route, direction le réglage des calques de la carte. Par défaut elle est affichée en bleu. En fonction de l'heure de décollage (modifiable), le Gramet et sa miniature affichent la position avion. Avant l'horaire prévu de décollage, un bouton play permet de lancer une animation.\n\nPour mieux comprendre le GRAMET, je vous conseille son <Link href=\"http://www.ogimet.com/guia_gramet.phtml.en\">Guide d'interprétation</Link>.\n\n## Position estimée / GPS\n\nIl est possible d'afficher la position avion sur la carte (bouton en forme de mire). Si vous l'autorisez, la position GPS sera prise en compte. Si la localisation GPS semble ne pas fonctionner (au sol ou en vol avec un gps externe), vérifiez que vous n'avez pas désactivé la localisation dans iPad / Réglages / Confidentialité / Service de localisation / Sites Safari. Vous devez choisir «Lorsque l'app est active» ou «Demander la prochaine fois». Le Bouton a deux ou trois positions: OFF, ON centré, ON non centré. Si, dans la position ON centré, vous déplacez la carte, il passe en ON non centré. L'appui suivant le repassera en ON centré. Un dernier appui le mettra sur OFF.\n\nEn l'absence de GPS, l'avion dans la barre de menu (à gauche de l'heure de décollage) permet d'afficher la position estimée. Si la reconnaissance des waypoints s'est bien effectuée, les estimées de l'OFP seront prises en compte. Sinon, ce sera un simple ratio horaire, merci de me transmettre l'OFP dans ce cas (ce sera signalé par un avion rouge dans la barre de menu et par l'absence des éphémérides). L'heure de décollage est modifiable et permet toujours d'ajuster la position estimée.\n\n## ETOPS\n\nLa capacité ETOPS est determinée depuis l'OFP et les cercles sont tracés. Un drapeau ETOPS apparait dans le pavé d'information de l'OFP si le carburant est limitatif (20mn, soit environ 2T de marge sur 777). Pour avoir plus d'informations vous pouvez utiliser un plugin (voir ci-dessous).\n\n## Éphémérides / Aurore Boréale\n\nLe symbole du widget est dynamique:\n\n- ☀️ si le soleil est visible pendant le vol\n- 🌕🌖🌗🌘🌑🌒🌓🌔 si la lune est visible pendant le vol\n- 🔭 si vous restez dans le noir\n- un halo vert se superpose si les conditions sont favorables à l'observation d'aurores boréales\n\nLe widget affiche également les heures de lever ou de coucher. Un clic révèle des éphémérides avec 2 timelines. La première synthétise le jour et la nuit le long du vol ainsi que les zones favorables à l'observation des aurores boréales. La seconde montre les prévisions de Kp. Le Kp permet de prédire les aurores boréales. Entre ces deux timelines, la Lune est aussi un objet dynamique: l'angle des cornes va se modifier en fonction de la position estimée et cet angle est indiqué pour les levers et les couchers. Pour le soleil, l'aube nautique est indiquée, car ce n'est pas tout à fait la nuit: en vol l'horizon est partiellement discernable, et au sol on distingue encore le relief.\n\n__Précision des calculs&#8239;:__ si vous avez bien recalé la position estimée d'OFP2MAP sur la carte (en modifiant l'heure de décollage), la précision attendue est de ±2 min sous 72° de latitude et de 10 min au-delà. Pour la lune, on est plutôt sur une précision de ±5 min. Le calcul n'est valable que pour la croisière, reportez vous à EWAS pour un calcul précis au départ ou à destination.\n\n__Correction d'altitude&#8239;:__ Si votre niveau de vol est différent de l'OFP, appliquez une correction de 15s/1000ft pour le soleil. Exemple: FL OFP 400, FL réel 360, il faut ajouter 1min pour le lever, et soustraire 1min pour le coucher.\n\nPour rappel, la chronologie des événements pour le soleil est:\n\n<table class=\"table\">\n    <thead><tr><th>Angle</th><th>▲ Soleil levant</th><th>▼ Soleil couchant</th></tr></thead>\n    <tbody>\n        <tr><td>-0.83°</td><td>↑ Lever du soleil (fin aube civile)</td><td>↓ Coucher du soleil (début crépuscule civil)</td></tr>\n        <tr><td>-6°</td><td>↑ début aube civile (jour civil)</td><td>↓ fin du crépuscule civil (début nuit civile)</td></tr>\n        <tr><td>-12°</td><td>↑ début aube nautique (jour nautique)</td><td>↓ fin du crépuscule nautique (début nuit nautique)</td></tr>\n    </tbody>\n</table>\n\nEt pour la lune:\n\n<table class=\"table moon\">\n    <thead><tr><th>Jour</th><th>Nom</th><th>Hémisphère nord</th><th>Hémisphère sud</th></tr></thead>\n    <tbody>\n        <tr><td>1</td><td>Nouvelle lune</td><td>🌑</td><td>🌑</td></tr>\n        <tr><td></td><td>Premier croissant</td><td>🌒</td><td>🌘</td></tr>\n        <tr><td>7</td><td>Premier quartier</td><td>🌓</td><td>🌗</td></tr>\n        <tr><td></td><td>Lune gibbeuse croissante</td><td>🌔</td><td>🌖</td></tr>\n        <tr><td>14</td><td>Pleine lune</td><td>🌕</td><td>🌕</td></tr>\n        <tr><td></td><td>Lune gibbeuse décroissante</td><td>🌖</td><td>🌔</td></tr>\n        <tr><td>21</td><td>Dernier quartier</td><td>🌗</td><td>🌓</td></tr>\n        <tr><td></td><td>Dernier croissant</td><td>🌘</td><td>🌒</td></tr>\n    </tbody>\n</table>\n\n## Mode off-line / Cache\n\nUne fois un premier OFP chargé, il est possible même en mode déconnecté de charger un autre OFP pour l'exporter. Le cache de l'App vous permettra de naviguer sur les cartes déjà visualisées. Pour mettre en cache les cartes, il suffit de les consulter.\n\nIl existe aussi un bouton de mise en cache&#8239;: le pictogramme ↓ situé à droite du sélecteur de carte. Sur les cartes LAMBERT, THE WORLD, =Physique= et {cbName}, il mettra en cache la totalité de la carte. Sur la MERCATOR, seule la partie de carte incluant la route sera mise en cache.\n\nLes premières mises en cache peuvent prendre du temps&#8239;: sur la Mercator, un vol LC peut nécessiter le téléchargement de 40Mo de données. Les caches des autres projections utilisent&#8239;: 7Mo pour la NORTH, 4Mo pour la PACIFIC, 7Mo pour la SOUTH, 32Mo pour THE WORLD, 40Mo pour =Physique= et 40Mo pour {cbName}.\n\n## Export / Plugins (Raccourcis)\n\n__Page Export&#8239;:__ Elle permet d'exporter la route et les tracks au format KML, elle dispose de ses propres réglages pour générer le KML. Pour l'export il est possible d'ajouter des repères. Les repères sont utiles pour afficher des informations textuelles dans MapsMe ou__ Avenza. Le bouton « COMME CARTE » permet de récupérer les couleurs choisies pour la carte.\n\nSur iPad, l'export des fichiers KML affiche une page un peu particulière, utilisez le bouton <svg style=\"vertical-align: bottom;\"><use xlink:href=\"#share-symbol\" /></svg> pour choisir l'app qui recevra le fichier. Cliquez en haut à gauche sur OK pour revenir à OFP2MAP. Alternativement, vous pouvez utiliser « Options... » pour définir une app qui recevra les fichiers kml par défaut et utiliser Ouvrir dans « nom de l'app ».\n\n Un raccourci peut être lancé depuis la page Export, il recevra les fichiers KML, la route Lido et le Gramet. Le nom du raccourci est modifiable, il faut que le raccourci soit installé avant de le lancer.\n\n__Plugins depuis la carte&#8239;:__ Il est aussi possible de lancer des raccourcis ayant accès au contenu de l'OFP depuis le pavé d'informations du vol dans la barre de menu. Il faut autoriser les raccourcis non fiables dans Réglages/Raccourcis (après avoir lancé au moins un raccourci \"fiable\" depuis la Galerie), puis installer le(s) plugin(s).\n\n__Liste des plugins&#8239;:__\n\n{#each Object.entries(plugins) as [name, {url, description, version}]}\n    - <Link href=\"{url}\">{name} v{version}</Link> {description}\n{/each}\n\n## Mise à jour\n\nL'app détecte les mises à jour automatiquement, normalement vous n'avez rien à faire. Eventuellement un prompt peut\napparaitre vous demandant d'autoriser cette mise à jour. La version AIRAC et le type avion détecté dans l'OFP sont affichés en bas à droite de la carte dans le champ d'attribution.\n\nAprès une mise à jour, les dernières nouveautés d'OFP2MAP s'affichent. Le bouton CHANGELOG en haut de cette page permet de consulter l'historique, et vous pouvez aussi consulter la <Link href=\"https://github.com/flyingeek/lido-online/commits/master\">liste des commits</Link> sur GitHub. Je poste les nouveautés importantes dans Yammer/Mapsme et Teams/MyConcorde.\n\n## Crédits\n\n- Les données terrains/FIR sont fournies par Olivier Ravet forum Yammer/Mapsme\n- =Physique= est une carte de Tom Patterson disponible sur <Link href=\"https://equal-earth.com/physical/\">Equal Earth</Link>\n- La dernière version de la carte {cbName} est disponible sur le site <Link href=\"{`https://www.${cbName.toLowerCase()}.com`}\">{cbName}.com</Link>\n- Les autres cartes sont de Jean-Baptiste Denizot forum Yammer/QGIS & Avenza Maps\n- Le GRAMET provient du site ogimet.com\n- Le site est développé en javascript à l'aide du framework SVELTE\n- La partie serveur (un proxy pour pouvoir récupérer l'image du GRAMET) est en python.\n- Eric Delord CDB 777 est l'auteur. Le code source est disponible sur GitHub pour <Link href=\"https://github.com/flyingeek/lido-online\">l'app</Link> et <Link href=\"https://github.com/flyingeek/ofp2map-gramet\">le proxy</Link>\n\n## Hébergement\n\nL'hébergement des images est normalement fourni par alwaysdata.com (pack gratuit) mais en raison d'un blacklistage sur le réseau internet d'AF, les fonds de cartes sont à présent hébergés sur netlify. Le proxy gramet est lui dorénavant hébergé sur vercel. Le site est hébergé sur GitHub.\n\n## Liens\n\n- <Link href=\"https://flyingeek.github.io/flytax/\" rel=\"noopener\"><span class=\"flytax\">Fly<span>Tax</span></span></Link> une aide aux calculs des frais professionnels (même auteur).\n\n","<script context=\"module\">\n    import {semverCompare} from \"./utils\";\n    /**\n     * filter or slice the json changelog\n     * @param json the json changelog\n     * @param {version, limit} if version, returns entries > version, if limit returns at max limit entries\n     */\n    export const filterChangeLog = (json, {version, limit}={}) => {\n        if (!json) return [];\n        let filtered = Object.entries(json.CHANGELOG);\n        if (version) {\n            filtered = filtered.filter(([k,]) => {\n                const v = k.match(/\\[([^\\]]+)\\]/);\n                return (v) ? semverCompare(v[1], version) > 0 : false;\n            });\n        }\n        return (limit) ? filtered.slice(0, limit + 1) : filtered;\n    };\n    export function parseMarkdown(markdownText) {\n        const htmlText = markdownText\n            //.replace(/^### (.*$)/gim, '<h3>$1</h3>')\n            //.replace(/^## (.*$)/gim, '<h2>$1</h2>')\n            //.replace(/^# (.*$)/gim, '<h1>$1</h1>')\n            //.replace(/^\\> (.*$)/gim, '<blockquote>$1</blockquote>')\n            .replace(/\\*\\*(.*)\\*\\*/gim, '<b>$1</b>')\n            .replace(/_(.*)\\_/gim, '<i>$1</i>')\n            //.replace(/\\*(.*)\\*/gim, '<i>$1</i>')\n            //.replace(/!\\[(.*?)\\]\\((.*?)\\)/gim, \"<img alt='$1' src='$2' />\")\n            .replace(/\\[(.*?)\\]\\((#.*?)\\)/gim, \"<a href='$2'>$1</a>\")\n            .replace(/\\[(.*?)\\]\\((.*?)\\)/gim, \"<a href='$2' rel='noreferrer' target='_blank'>$1</a>\")\n            .replace(/^$/g, '<br />')\n\n        return htmlText.trim()\n    }\n    const translation = {\n        \"ADDED\": \"Ajouté\",\n        \"FIXED\": \"Corrigé\",\n        \"DEPRECATED\": \"Obsolète\",\n        \"CHANGED\": \"Modifié\",\n        \"REMOVED\": \"Supprimé\",\n        \"SECURITY\": \"Sécurité\"\n    };\n    export const _ = text => translation[text.toUpperCase()] || text;\n    export const versionDateRegex = /\\[([^\\]]+)\\].+(\\d{4})-(\\d{2})-(\\d{2})/;\n    export const title2html = (text) => {\n        return text.replace(/\\[([^\\]]+)\\].+(\\d{4})-(\\d{2})-(\\d{2})/, \"<span class='version'>$1</span> <span class='date'>$4/$3/$2</span>\");\n    }\n    const badgeColors = {\n        \"ADDED\": \"primary\",\n        \"FIXED\": \"success\",\n        \"DEPRECATED\": \"warning\",\n        \"CHANGED\": \"info\",\n        \"REMOVED\": \"danger\",\n        \"SECURITY\": \"secondary\"\n    }\n    const badgeTextColors = {\n        \"ADDED\": \"text-white\",\n        \"FIXED\": \"text-white\",\n        \"DEPRECATED\": \"text-dark\",\n        \"CHANGED\": \"text-dark\",\n        \"REMOVED\": \"text-white\",\n        \"SECURITY\": \"text-white\"\n    }\n    export const badgeColor = (category) => badgeColors[category.toUpperCase()] || 'light';\n    export const badgeTextColor = (category) => badgeTextColors[category.toUpperCase()] || 'text-dark';\n</script>\n<script>\n    export let data;\n    export let limit = undefined;\n    export let version = undefined;\n</script>\n\n<ul class=\"markdown\">\n{#each filterChangeLog(data, {version, limit}) as [title, section]}\n    {#if title !== \"raw\"}\n        <li>\n            {#if title.match(versionDateRegex)}\n                <h2>{@html title2html(title)}</h2>\n            {:else}\n            <h2>{title}</h2>\n            {/if}\n            {#each Object.entries(section) as [category, content]}\n                {#if category !== \"raw\"}\n                    {#each content.raw.replace(/^\\n\\n|\\n\\n$/, '').split('\\n') as item}\n                        <div class=\"item\">{@html parseMarkdown(item).replace('- ', `- <span class=\"badge bg-${badgeColor(category)} ${badgeTextColor(category)}\">${_(category)}</span>`)}</div>\n                    {/each}\n                {:else}\n                    <div class=\"item\">{@html parseMarkdown(content)}</div>\n                {/if}\n            {/each}\n        </li>\n    {/if}\n{/each}\n</ul> \n\n<style>\n    ul{\n        padding-left: 1em;\n    }\n    li{\n        list-style: square;\n    }\n    h2{\n        font-size: 1.5rem;\n        border-bottom: 1px solid #eee;\n    }\n    li:not(:first-child) h2{\n        margin-top: 1rem;\n    }\n    h2 :global(.date){\n        font-size: 1rem;\n        color: grey;\n    }\n    h2 :global(.version)::before{\n        content: \"v\";\n        font-variant: normal;\n        font-size: 1rem;\n    }\n    .item {\n        margin-bottom: 0.25rem;\n        margin-left: 0.5rem;\n        text-indent: -0.8em;\n    }\n    .item :global(.badge) {\n        text-indent: 0;\n        margin-right: 0.5rem;\n        min-width: 8ch;\n    }\n</style>","<script context=\"module\">\n    import {storage, stores} from './mapSettings/storage.js';\n    const store = stores.changelogOnUpdate;\n    export const showChangelogOnUdate = () => {\n        return (storage.getItem(store) === null) ? true : !!storage.getItem(store);\n    }\n</script>\n<script>\n    import { fade } from 'svelte/transition';\n    import ChangeLog from \"./ChangeLog.svelte\";\n    import clickOutside from '../actions/clickOutsideAction';\n    import { createEventDispatcher } from 'svelte';\n    const dispatch = createEventDispatcher();\n    export let visible = false;\n    export let title = 'CHANGELOG';\n    export let version = undefined;\n    let promise;\n    let checked = showChangelogOnUdate();\n\n    export const show = async () => {\n        visible = true;\n        promise = fetch('./CHANGELOG.json').then(response => {\n            if(response.ok) {\n                return response.json();\n            } else {\n                throw new Error('CHANGELOG.json not available');\n            }\n        });\n    };\n    export const close = () => {\n        visible = false;\n        dispatch(\"close\");\n    };\n    if (version && checked) show();\n</script>\n\n{#if visible}\n    <div class=\"modal\" tabindex=\"-1\" role=\"dialog\" in:fade>\n        <div class=\"modal-dialog modal-xl modal-dialog-centered\" role=\"document\" use:clickOutside  on:click_outside={close}>\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h5 class=\"modal-title\">{title}\n                        <small class=\"d-inline-block ms-4 form-check form-switch\">\n                            <input bind:checked id=\"display-on-update\" class=\"form-check-input\" type=\"checkbox\" on:change={() => storage.setItem(store, checked)}>\n                            <label for=\"display-on-update\"class=\"form-check-label\">Afficher lors des mises à jour</label>\n                        </small>\n                    </h5>\n                    <button type=\"button\" class=\"btn-close\" data-dismiss=\"modal\" aria-label=\"Close\" on:click={close}></button>\n                </div>\n                <div class=\"modal-body\" class:expanded={!version}>\n                    {#await promise}\n                    <p>chargement...</p>\n                    {:then data}\n                    <ChangeLog {data} {version}/>\n                    {/await}\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"modal-backdrop show\" in:fade></div>\n{/if}\n\n<style>\n    .modal {\n        display: block;\n    }\n    .modal-body {\n        overflow-y: auto;\n        max-height: calc(90vh - 3.875rem); /* h5 height * line-height = 1.875rem  h5 margin-top = 1rem margin-bottom = 1rem */\n    }\n    .expanded {\n        height: calc(90vh - 3.875rem); /* h5 height * line-height = 1.875rem  h5 margin-top = 1rem margin-bottom = 1rem */\n    }\n</style>","<script>\nimport Helpmarkup from './Help.md';\nimport ChangeLogModal from './ChangeLogModal.svelte';\nimport {wb} from '../stores';\nimport {shareAppLink} from './utils';\nimport {onMount} from \"svelte\";\nimport blurAction from '../actions/blurAction';\n\nconst version = \"APP_VERSION\";\nlet swVersion = '';\nconst updateVersion = (_wb) => {\n    return (_wb) ? _wb.messageSW({type: 'GET_VERSION'}).then(v => swVersion = v) : '';\n}\nconst reload = () => {\n    window.location.hash = '#/';\n    console.log('reload page');\n    window.location.reload();\n};\n\n$: updateVersion($wb);\nlet scrollingRoot, scrollingElement;\nconst toc = [];\nlet tocNodeList;\nlet selected;\nlet observer;\nlet modal;\n\n$: style = (selected === undefined || selected === toc[0].id) ? \"padding-top: 1rem;\" : \"padding-top: 0.25rem;\";\n\nfunction scrollTo(offset, callback) {\n    const relativeOffset = offset  - scrollingElement.offsetTop - scrollingRoot.clientHeight;\n    const fixedOffset = relativeOffset.toFixed();\n    const maxOffset = Math.floor(scrollingElement.scrollHeight - scrollingElement.clientHeight);\n    const onScroll = function () {\n        if (scrollingElement.scrollTop.toFixed() === fixedOffset || scrollingElement.scrollTop >= maxOffset) {\n            scrollingElement.removeEventListener('scroll', onScroll);\n            if (callback) callback();\n        }\n    };\n    scrollingElement.addEventListener('scroll', onScroll);\n    onScroll();\n    scrollingElement.scrollTo({\n        top: relativeOffset,\n        behavior: 'smooth' // not supported by Safari\n    })\n}\nconst jumpTo = (e) => {\n    e.target.blur();\n    observer.disconnect();\n    scrollTo(document.getElementById(selected).offsetTop, () => {\n        //console.log('scroll end')\n        tocNodeList.forEach((elt) => {\n            observer.observe(elt);\n        });\n    })\n}\n\nonMount(() => {\n    tocNodeList = scrollingElement.querySelectorAll('h2[id]');\n    observer = new IntersectionObserver((entries) => {\n        const y = scrollingElement.scrollTop;\n        const max = Math.floor(scrollingElement.scrollHeight - scrollingElement.clientHeight);\n        if (y < max) {\n            let current = toc[0].id;\n            for (const elt of tocNodeList) {\n                if (y < (elt.offsetTop - scrollingElement.offsetTop - scrollingRoot.clientHeight)) break;\n                current = elt.id;\n            }\n            selected = current;\n        }\n    }, {\n        root: scrollingElement,\n        rootMargin: `${ 0 - scrollingRoot.clientHeight}px 0px 30px 0px`,\n        threshold: 1.0\n    });\n    tocNodeList.forEach((elt) => {\n        toc.push({id: elt.id, label: elt.innerText});\n        observer.observe(elt);\n    });\n    selected = toc[0].id;\n    return () => {\n        observer.disconnect();\n        tocNodeList = undefined;\n        observer = undefined;\n    }\n});\n\n</script>\n<ChangeLogModal bind:this={modal} />\n<div class=\"help markdown\" {style}>\n    <div bind:this={scrollingElement} class=\"scrollContainer\">\n        <div><!--prevents safari sticky bug-->\n            <h1 bind:this={scrollingRoot}>\n                <div class=\"app\"><img src=\"images/ofp2map-icons/icon-128x128.png\" alt=\"logo\"></div>\n                <div class=\"infos\"><div>OFP2MAP v{version}</div><small on:click|once={() => $wb && $wb.update() && console.log('updating SW')}>ServiceWorker&#8239;: {swVersion}</small></div>\n                {#if navigator.standalone === true || 'process.env.NODE_ENV' === '\"development\"'}\n                    {#if (navigator.share || 'process.env.NODE_ENV' === '\"development\"')}<button class=\"btn btn-outline-secondary btn-sm\" on:click={shareAppLink}>Partager</button>{/if}\n                    <button class=\"btn btn-outline-secondary btn-sm\" on:click={reload}>Recharger</button>\n                {/if}\n                <button class=\"btn btn-outline-secondary btn-sm\" on:click={modal.show}>CHANGELOG</button>\n                <!-- svelte-ignore a11y-no-onchange -->\n                <select class=\"form-select form-select-sm\" bind:value=\"{selected}\" on:change={jumpTo} use:blurAction>\n                    {#each toc as {id, label}}\n                        <option value={id} selected={id === selected}>{label}</option>\n                    {/each}\n                </select>\n            </h1>\n            <Helpmarkup/>\n        </div>\n    </div>\n</div>\n\n<style>\n    h1 {\n        font-size: 1rem;\n        padding-bottom: 0.25rem;\n        display: flex;\n        top: 0;\n    }\n\n    h1 button {\n        margin-left: 1rem;\n    }\n    small {\n        font-size:x-small;\n    }\n    h1 > * {\n        align-self: center;\n    }\n    h1, .scrollContainer {\n        background-color: white;\n    }\n    .scrollContainer {\n        -webkit-overflow-scrolling: touch;\n        overflow-y: scroll;\n        flex: 1 1 auto;\n        height: 0;\n        z-index: 1;\n        padding-right: 1rem;\n    }\n    .help {\n        margin:0;\n        padding:1rem 0 0.5rem 1rem;\n        flex: 1 1 auto;\n        height: 0;\n        display: flex;\n        flex-direction: column;\n        background-color: white;\n        transition: padding-top 0.5s linear;\n    }\n    :global(.markdown h2) {\n        font-weight: 500;\n        /* text-transform: uppercase; */\n        /* font-size: 1.5rem; */\n        font-variant: all-petite-caps;\n    }\n    :global(.markdown svg) {\n        height: 24px;\n        width: 24px;\n        display: inline-block;\n    }\n    :global(span.flytax){\n        color: var(--blueaf);\n        text-transform: uppercase;\n    }\n    :global(span.flytax > span){\n        color: var(--redaf);\n    }\n    :global(.markdown img) {\n        max-width: 100%;\n        height: auto;\n    }\n    :global(img#memovisuel) {\n        max-height: calc(100vh - 80px + 15px); /* 15px is for the top black part */\n    }\n    :global(.markdown figure){\n        width: 300px;\n        margin-left: 1rem;\n        float: right;\n    }\n    :global(.markdown figcaption){\n        text-align: center;\n        font-size: small;\n        font-variant: all-small-caps;\n    }\n    .app {\n        display: none;\n        vertical-align: middle;\n        text-align: center;\n        margin-right: 0.5rem;\n    }\n    .infos {\n        display: flex;\n        flex-direction: column;\n    }\n    .app img {\n        width: 32px;\n        height: 32px;\n        border-radius: 5px;\n    }\n    select {\n        display: none;\n        width: auto;\n        margin-left: auto;\n    }\n    @media (min-width: 576px) {\n        select {\n            display: inline-block;\n        }\n        .app {\n            display: inline-block;\n        }\n    }\n    @media (min-width: 576px) and (min-height: 576px) {\n        h1 {\n            position: sticky;\n            position: -webkit-sticky;\n        }\n    }\n    :global(.markdown .table th), :global(.markdown .table td){\n        padding: 0.25rem 0.75rem;\n    }\n</style>","<script context=\"module\">\n    import {writable} from 'svelte/store';\n    import {swDismiss, swUpdated, majorUpdate} from '../stores';\n    import {isPatchUpdate} from '../components/utils';\n    export const swRegistration = writable();\n\n    export const showSkipWaitingPrompt = (nextVersion) => {\n        swUpdated.set(true);\n        swDismiss.set(false);\n        if (nextVersion) {\n            majorUpdate.set(!isPatchUpdate('APP_VERSION', nextVersion));\n        } else {\n            majorUpdate.set(true); // we consider missing version problem as major\n        }\n    };\n</script>\n<script>\n    import {wb, route} from '../stores';\n    import { fade } from 'svelte/transition';\n    import ChangeLogModal, {showChangelogOnUdate} from './ChangeLogModal.svelte';\n    import {semverCompare} from './utils'; \n    let installLabel = 'Installer';\n    const previousAppVersionKey = 'previousAppVersion';\n    const getPreviousAppVersion = () => (sessionStorage)  ? sessionStorage.getItem(previousAppVersionKey) : undefined;\n    const setPreviousAppVersion = () => (sessionStorage) ? sessionStorage.setItem(previousAppVersionKey, 'APP_VERSION') : undefined;\n    const resetPreviousAppVersion = () => (sessionStorage) ? sessionStorage.removeItem(previousAppVersionKey) : undefined;\n    const isAppUpdated = () => {\n        const previous = getPreviousAppVersion();\n        if (!previous) return false;\n        return semverCompare('APP_VERSION', previous) > 0;\n    }\n\n    $swDismiss = false;\n    export let prompt = false;\n    const install = (delay=0) => {\n        if (delay) console.debug('automatic install ')\n        // $swRegistration.waiting check is needed to the 'reload the page' fallback\n        let refreshing;\n        if ($wb && $swRegistration && $swRegistration.waiting) {\n            navigator.serviceWorker.addEventListener('controllerchange', () => {\n                //console.debug('controller change')\n                if (refreshing) return;\n                refreshing = true;\n                console.debug('SWUpdate: controllerchange reload');\n                (delay) ? setTimeout(() => window.location.reload(), delay) : window.location.reload();\n            });\n            //This does not fire when Workbox mark event as isExternal (note should be fixed now in v6.2)\n            // $wb.addEventListener('controlling', () => {\n            //     //console.debug('controlling')\n            //     if (refreshing) return;\n            //     refreshing = true;\n            //     console.debug('SWUpdate: controlling reload');\n            //     window.location.reload();\n            //     (delay) ? setTimeout(() => window.location.reload(), delay) : window.location.reload();\n            // });\n            installLabel = \"En cours...\";\n            // only set if not already set (cover multiple updates loop)\n            // or if we don't want to show update (in that case we must increase version number always)\n            if (!getPreviousAppVersion() || !showChangelogOnUdate()) setPreviousAppVersion();\n            $swRegistration.waiting.postMessage({type: 'SKIP_WAITING'});\n            console.debug('SWUpdate: SKIP_WAITING sent');\n            // in a scenario where you dismiss update and manually reload the page we need a fallback\n            setTimeout(() => {\n                console.debug('SWUpdate: fallback reload');\n                window.location.reload();\n            }, 5000);//secure a reload after 5s\n        }else{ /* update probably done in another tab */\n            console.log($wb, $swRegistration, $swRegistration.waiting);\n            console.debug('SWUpdate: no waiting reg reload');\n            window.location.reload();\n        }\n    }\n</script>\n\n{#if (($swUpdated && !$swDismiss && !prompt))}\n<div class=\"modal\" tabindex=\"-1\">\n    <div class=\"modal-dialog\" style=\"margin-top: 15%; max-width: 270px;\">\n        <div class=\"modal-content\">\n            <h6 class=\"modal-header text-center\">\n                <span class=\"modal-title\"><span>👨🏻‍✈️</span> Mise à jour détectée</span>\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\" on:click={() => $swDismiss=true}></button>\n            </h6>\n            <div class=\"modal-body text-center\">\n                <button class=\"btn\" type=\"button\" on:click|preventDefault><span>Mise à jour...</span></button>\n            </div>\n        </div>\n    </div>\n</div>{install(700) || ''}\n{:else if $swUpdated && !$swDismiss}\n    <div class=\"modal\" transition:fade tabindex=\"-1\">\n        <div class=\"modal-dialog\" transition:fade style=\"position: absolute; top:0; right: 1rem; max-width: 350px;\">\n            <div class=\"modal-content\">\n                <h6 class=\"modal-header pt-2 pb-2\">\n                    <span class=\"modal-title text-center\"><span>👨🏻‍✈️</span> Mise à jour disponible</span>\n                    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\" on:click={() => $swDismiss=true}></button>\n                </h6>\n                <div class=\"modal-body text-center\">\n                    <p>Il faudra recharger l'OFP</p>\n                    <button class=\"btn btn-primary\" type=\"button\" on:click|once={() => install()}><span class:blinking={installLabel.endsWith('...')}>{installLabel}</span></button>\n                </div>\n            </div>\n        </div>\n    </div>\n{:else if !$swUpdated && isAppUpdated() && $route !== \"/install\" && showChangelogOnUdate()}\n    <ChangeLogModal version={getPreviousAppVersion()} title=\"NOUVEAUTÉS\" on:close={resetPreviousAppVersion}/>\n{/if}\n\n<style>\n    /* The Modal (background) */\n    .modal {\n        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n        display:block;\n    }\n    .modal-header {\n        background-color: var(--bs-light);\n        padding-top: 0.5rem;\n        padding-bottom: 0.5rem;\n    }\n    .blinking{\n        animation:blink 1s infinite;\n    }\n    @keyframes blink \n    {  \n        0% { opacity: 1.0; }\n        50% { opacity: 0.0; }\n        100% { opacity: 1.0; }\n    }\n</style>","<script>\n    import Logo from './Logo.svelte';\n    import SWUpdate from './SWUpdate.svelte';\n    import {usingChromeOnIOS, usingSafari} from './utils';\n    const requiredNavigator =  usingSafari && !usingChromeOnIOS;\n</script>\n\n<Logo/>\n<div class=\"prompt-container\">\n    <div class=\"prompt\">\n        <div class=\"icon-container\">\n            <img src=\"./images/ofp2map-icons/icon-128x128.png\" alt=\"OFP2MAP\">\n        </div>\n        <div class=\"prompt-content\">\n            <h3 class=\"title\">Installez OFP2MAP</h3>\n            <p class=\"text\">Si OFP2MAP est déjà sur l'écran d'accueil, ne l'installez pas une deuxième fois. <b>Attention:</b> l'installation ne peut se faire que depuis\n                le navigateur Safari, <b>si présent, cliquez sur <svg class=\"safari\"><use xlink:href=\"#safari-symbol\"/></svg> en haut à droite</b>.\n            </p>\n            {#if !requiredNavigator}\n                <p class=\"guide error\">Merci d'ouvrir cette page dans Safari</p>\n            {:else}\n                <ol class=\"guide\">\n                    <li>Dans la barre de menu, cliquez sur <svg><use xlink:href=\"#share-symbol\" /></svg></li>\n                    <li>Faites défiler, choisir&#8239;: <em>Sur l'écran d'accueil</em> <svg style=\"width:22px;height:22px;\"><use xlink:href=\"#add2home-symbol\" /></svg></li>\n                    <li>Lancez l'application depuis l'écran d'accueil</li>\n                </ol>\n            {/if}\n        </div>\n    </div>\n</div>\n<SWUpdate/>\n<style>\n    .prompt-container {\n        align-items: center;\n        box-sizing: border-box;\n        display: flex;\n        height: 100%;\n        justify-content: center;\n        padding: 30px;\n        position: fixed;\n        width: 100%;\n        margin-top: 3em;\n    }\n    .prompt{\n        background: #FFF;\n        border-radius: 2px;\n        box-shadow: 0px 4px 8px rgba(0,0,0,0.125);\n        box-sizing: border-box;\n        color: #424242;\n        font-family: sans-serif;\n        max-width: 640px;\n        position: relative;\n        text-align: center;\n        z-index: 1;\n    }\n    .icon-container{\n        background: url(\"data:image/svg+xml,%3Csvg viewBox='0 0 70 70' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23F0F0F0' d='M65,17C65,10.377 59.623,5 53,5L17,5C10.377,5 5,10.377 5,17L5,53C5,59.623 10.377,65 17,65L53,65C59.623,65 65,59.623 65,53L65,17Z' /%3E%3C/svg%3E%0A\") center center / 70px 70px repeat-x;\n        margin: 40px 0 0;\n    }\n    .icon-container img {\n        border-radius: 12px;\n        display: block;\n        margin: 0 auto;\n        width: 64px;\n    }\n    .prompt-content{\n        padding: 10px 35px;\n    }\n    h3 {\n        font-size: 24px;\n    }\n    .text{\n        font-size: 14px;\n        line-height: 20px;\n        margin: 0 0 1em;\n        text-align: justify;\n    }\n    .guide{\n        display: flex;\n        font-size: 16px;\n        justify-content: center;\n        margin: 0;\n        line-height: 35px;\n        text-align: left;\n        flex-direction: column;\n    }\n    .guide.error{\n        font-weight: 600;\n        color: red;\n    }\n    svg{\n        margin: 0 0 5px;\n        width: 30px;\n        height: 30px;\n        fill: #007AFF;\n    }\n    svg.safari {\n        width: 20px;\n        height: 20px;\n    }\n    ol {\n        list-style: none;\n        counter-reset: guide-counter;\n        margin-left: 60px !important;\n    }\n    ol li {\n        counter-increment: guide-counter;\n        text-align: left;\n    }\n    ol li::before {\n        content: counter(guide-counter);\n        color: var(--blueaf);\n        font-weight: bold;\n        font-size: large;\n        margin-right: 10px;\n    }\n\n</style>","<script>\n  import {onMount} from 'svelte';\n  import LidoRoute from \"./components/LidoRoute.svelte\";\n  import Export from \"./components/Export.svelte\";\n  import Home from \"./components/Home.svelte\";\n  import Map from \"./components/Map.svelte\";\n  import Navbar from \"./components/Navbar.svelte\";\n  import OfpInput from './components/OfpInput.svelte';\n  import Page from \"./components/Page.svelte\";\n  import Help from \"./components/Help.svelte\";\n  import SWUpdate from \"./components/SWUpdate.svelte\";\n  import {storage, stores, validate, setHistory, storeSettingsFromURL} from \"./components/mapSettings/storage.js\";\n  import {swDismiss, sidebar, route, checkSwOnVisibilityChange, ofp, ofpStatus, aircraftType} from \"./stores.js\";\n  import HomePwaInstall from './components/HomePwaInstall.svelte';\n  import {runningOnIpad} from './components/utils';\n\n  const redirect = (requestedRoute) => {\n    console.log(`unkwnown route ${requestedRoute}, redirecting to #/`, !!$ofp, $ofpStatus); \n    window.location.hash = '#/';\n  }\n\n  if (storage.getItem(stores.optionsKML) === null) storeSettingsFromURL(window.location.search);\n  let kmlOptions = validate(storage.getItem(stores.optionsKML) || {}); //include default\n  setHistory(kmlOptions, $route);\n\n  const ofpChange = () =>{\n    $sidebar = false;\n    $swDismiss = false;\n    //$showGramet = false; // this one is set in OfpInput instead\n  };\n\n  onMount(() => {\n        document.addEventListener(\"visibilitychange\", checkSwOnVisibilityChange, false);\n        return () => document.removeEventListener(\"visibilitychange\", checkSwOnVisibilityChange);\n  });\n</script>\n\n<main class=\"container {$route.substr(1) || 'home'}\">\n  <div class=\"content\">\n    {#if ($route === '/install' || (navigator && navigator.standalone === false && runningOnIpad))}\n      <HomePwaInstall/>\n    {:else}\n      <Navbar>\n        <OfpInput {kmlOptions} on:change={ofpChange} />\n      </Navbar>\n      <SWUpdate prompt={!!$ofp}/>\n      {#if ($ofp || $aircraftType) && $ofpStatus === 'success'}\n        <Page hidden={$route !== '/map'}>\n          <Map id=\"map\" bind:kmlOptions ofp={$ofp} on:save={() => setHistory(kmlOptions, $route)}/>\n        </Page>\n      {/if}\n\n      {#if ($ofpStatus === 'loading')}\n        <Page><div style=\"margin: auto;\">traitement en cours...</div></Page>\n      {:else if $ofpStatus && $ofpStatus !== 'success' && $route === '/map'}\n        <Page><p class=\"ofpError\">😱: {$ofpStatus}</p></Page>\n      {:else if ($route === '/export') && $ofpStatus === 'success'}\n        <Page maxWidth=\"1400px\">\n          <Export {kmlOptions} on:save={() => setHistory(kmlOptions, $route)} />\n          <LidoRoute />\n        </Page>\n      {:else if $route === '/'}\n        <Page maxWidth=\"1400px\">\n          <Home />\n        </Page>\n      {:else if $route === '/help'}\n        <Page  maxWidth=\"1400px\"><Help /></Page>\n      {:else if !(($ofp || $aircraftType) && $route === '/map')}\n        <!-- redirect -->\n        { redirect($route) }\n      {/if}\n    {/if}\n  </div>\n</main>\n\n<style>\n  :global(html, body) {\n    height: 100%;\n    min-height: 100%;\n    width: 100%;\n    position: fixed;\n    --blueaf: #002157; /* --royal-blue-dark */\n    --blueaf_rgb: 9,34,84; /* rgba(var(--blueaf_rgb), 0.5) is valid */\n    --redaf:#FA3C35; /* --tart-orange */\n    --blood-red: #6B0504; /* for visited links */\n    /*--green: #2CA58D; /* #28a745 */;\n    --snow: #FFFBFF;\n    --minion-yellow: #ECD444;\n    --light-grey: #eee; /* used to print tables */\n    --maximum-yellow-red: #FCBF49; /* used for warnings in LogWindow */\n    --electric-blue: #87F1FF;\n    --gramet-inner-height: 384px;\n    --plane-color: var(--bs-yellow);\n    --plane-halo-color: var(--plane-color);\n    --bs4-cyan: #17a2b8;\n    --bs4-info: #17a2b8;\n  }\n  .content{\n    background-color: var(--blueaf);\n    background-image: url(\"../svg/worldmap.svg\");\n    background-attachment: fixed;\n    background-size: cover;\n    transition:background-position 0.3s ease;\n    width: 100%;\n    padding: 0;\n    flex-direction: column;\n    display: flex;\n  }\n  main.map > .content {\n    background-color: var(--bs-white);\n    background-image: none;\n  }\n  main.help >.content {\n    background-position-x: center;\n  }\n  main {\n    display: flex;\n    margin-left: 0;\n    margin-right: 0;\n    padding-left: 0;\n    padding-right: 0;\n    overflow-x: hidden;\n    max-width: 100%;\n    min-height: 100%;\n    position: relative;\n  }\n  @media (max-width: 575px), (max-height: 575px)  { /* allow scrolling long pages */\n    :global(html, body) {\n      position: relative;\n    }\n    main.home, main.gramet, main.export {\n      display:block;\n    }\n  }\n  @media (min-width: 1400px) {\n    main {\n      width: 100%;\n      margin-right: auto;\n      margin-left: auto;\n    }\n  }\n  .form-inline {\n    padding-bottom: 2px;\n  }\n  :global(.btn) {\n    text-transform: uppercase\n  }\n  :global(.form-control, .mapboxgl-ctrl-attrib, .btn) {\n    user-select: none; /* supported by Chrome and Opera */\n    -webkit-user-select: none; /* Safari */\n    -moz-user-select: none; /* Firefox */\n    touch-action: manipulation;\n  }\n  .ofpError {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-grow: 1;\n    background-color: var(--snow);\n  }\n  :global(.table td){\n        padding: 0.5rem 0.75rem;\n  }\n  :global(label.input-group-text, label.form-control,.input-group-sm >.btn) {\n    font-variant-caps: all-small-caps;\n  }\n  @media (hover:none), (hover:on-demand) {\n    /* suppress hover effect on devices that don't support hover fully */\n    :global(.focusmode .btn-outline-info:hover,.focusmode .btn-outline-info:active) { \n      color: var(--bs-info);\n      background-color: white;\n    }\n    :global(.mapboxgl-ctrl button.mapboxgl-ctrl-layers:not(:disabled):hover){\n      background-color: transparent;\n    }\n    :global(.btn-outline-secondary:not(:disabled):hover, .btn-outline-secondary:active){\n      background-color: transparent;\n      color: var(--bs-secondary);\n    }\n  }\n  :global(a) {\n    text-decoration: none;\n  }\n  :global(a:hover){\n    text-decoration: underline;\n  }\n  :global(.overlay .card-header) {\n    display:flex;\n    align-items: center;\n    padding: .5rem .75rem\n  }\n  :global(.overlay .card-body) {\n    padding: .5rem .75rem;\n    font-size: 0.875rem;\n  }\n\n</style>\n","try{self[\"workbox:window:6.2.4\"]&&_()}catch(n){}function n(n,t){return new Promise((function(r){var e=new MessageChannel;e.port1.onmessage=function(n){r(n.data)},n.postMessage(t,[e.port2])}))}function t(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,\"value\"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function r(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}function e(n,t){var e;if(\"undefined\"==typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(e=function(n,t){if(n){if(\"string\"==typeof n)return r(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return\"Object\"===e&&n.constructor&&(e=n.constructor.name),\"Map\"===e||\"Set\"===e?Array.from(n):\"Arguments\"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(n,t):void 0}}(n))||t&&n&&\"number\"==typeof n.length){e&&(n=e);var i=0;return function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}return(e=n[Symbol.iterator]()).next.bind(e)}try{self[\"workbox:core:6.2.4\"]&&_()}catch(n){}var i=function(){var n=this;this.promise=new Promise((function(t,r){n.resolve=t,n.reject=r}))};function o(n,t){var r=location.href;return new URL(n,r).href===new URL(t,r).href}var u=function(n,t){this.type=n,Object.assign(this,t)};function a(n,t,r){return r?t?t(n):n:(n&&n.then||(n=Promise.resolve(n)),t?n.then(t):n)}function c(){}var f={type:\"SKIP_WAITING\"};function s(n,t){if(!t)return n&&n.then?n.then(c):Promise.resolve()}var v=function(r){var e,c;function v(n,t){var e,c;return void 0===t&&(t={}),(e=r.call(this)||this).nn={},e.tn=0,e.rn=new i,e.en=new i,e.on=new i,e.un=0,e.an=new Set,e.cn=function(){var n=e.fn,t=n.installing;e.tn>0||!o(t.scriptURL,e.sn.toString())||performance.now()>e.un+6e4?(e.vn=t,n.removeEventListener(\"updatefound\",e.cn)):(e.hn=t,e.an.add(t),e.rn.resolve(t)),++e.tn,t.addEventListener(\"statechange\",e.ln)},e.ln=function(n){var t=e.fn,r=n.target,i=r.state,o=r===e.vn,a={sw:r,isExternal:o,originalEvent:n};!o&&e.mn&&(a.isUpdate=!0),e.dispatchEvent(new u(i,a)),\"installed\"===i?e.wn=self.setTimeout((function(){\"installed\"===i&&t.waiting===r&&e.dispatchEvent(new u(\"waiting\",a))}),200):\"activating\"===i&&(clearTimeout(e.wn),o||e.en.resolve(r))},e.dn=function(n){var t=e.hn,r=t!==navigator.serviceWorker.controller;e.dispatchEvent(new u(\"controlling\",{isExternal:r,originalEvent:n,sw:t,isUpdate:e.mn})),r||e.on.resolve(t)},e.gn=(c=function(n){var t=n.data,r=n.ports,i=n.source;return a(e.getSW(),(function(){e.an.has(i)&&e.dispatchEvent(new u(\"message\",{data:t,originalEvent:n,ports:r,sw:i}))}))},function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return Promise.resolve(c.apply(this,n))}catch(n){return Promise.reject(n)}}),e.sn=n,e.nn=t,navigator.serviceWorker.addEventListener(\"message\",e.gn),e}c=r,(e=v).prototype=Object.create(c.prototype),e.prototype.constructor=e,e.__proto__=c;var h,l,m,w=v.prototype;return w.register=function(n){var t=(void 0===n?{}:n).immediate,r=void 0!==t&&t;try{var e=this;return function(n,t){var r=n();if(r&&r.then)return r.then(t);return t(r)}((function(){if(!r&&\"complete\"!==document.readyState)return s(new Promise((function(n){return window.addEventListener(\"load\",n)})))}),(function(){return e.mn=Boolean(navigator.serviceWorker.controller),e.yn=e.pn(),a(e.bn(),(function(n){e.fn=n,e.yn&&(e.hn=e.yn,e.en.resolve(e.yn),e.on.resolve(e.yn),e.yn.addEventListener(\"statechange\",e.ln,{once:!0}));var t=e.fn.waiting;return t&&o(t.scriptURL,e.sn.toString())&&(e.hn=t,Promise.resolve().then((function(){e.dispatchEvent(new u(\"waiting\",{sw:t,wasWaitingBeforeRegister:!0}))})).then((function(){}))),e.hn&&(e.rn.resolve(e.hn),e.an.add(e.hn)),e.fn.addEventListener(\"updatefound\",e.cn),navigator.serviceWorker.addEventListener(\"controllerchange\",e.dn),e.fn}))}))}catch(n){return Promise.reject(n)}},w.update=function(){try{return this.fn?s(this.fn.update()):void 0}catch(n){return Promise.reject(n)}},w.getSW=function(){return void 0!==this.hn?Promise.resolve(this.hn):this.rn.promise},w.messageSW=function(t){try{return a(this.getSW(),(function(r){return n(r,t)}))}catch(n){return Promise.reject(n)}},w.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,f)},w.pn=function(){var n=navigator.serviceWorker.controller;return n&&o(n.scriptURL,this.sn.toString())?n:void 0},w.bn=function(){try{var n=this;return function(n,t){try{var r=n()}catch(n){return t(n)}if(r&&r.then)return r.then(void 0,t);return r}((function(){return a(navigator.serviceWorker.register(n.sn,n.nn),(function(t){return n.un=performance.now(),t}))}),(function(n){throw n}))}catch(n){return Promise.reject(n)}},h=v,(l=[{key:\"active\",get:function(){return this.en.promise}},{key:\"controlling\",get:function(){return this.on.promise}}])&&t(h.prototype,l),m&&t(h,m),v}(function(){function n(){this.Pn=new Map}var t=n.prototype;return t.addEventListener=function(n,t){this.Sn(n).add(t)},t.removeEventListener=function(n,t){this.Sn(n).delete(t)},t.dispatchEvent=function(n){n.target=this;for(var t,r=e(this.Sn(n.type));!(t=r()).done;){(0,t.value)(n)}},t.Sn=function(n){return this.Pn.has(n)||this.Pn.set(n,new Set),this.Pn.get(n)},n}());export{v as Workbox,n as messageSW};\n//# sourceMappingURL=workbox-window.prod.es5.mjs.map\n","import App from './App.svelte';\nimport {Workbox, messageSW} from 'workbox-window';\nimport {showSkipWaitingPrompt, swRegistration} from './components/SWUpdate.svelte';\nimport {promiseTimeout} from './components/utils';\nimport {wb} from './stores';\n\nlet app;\nlet appError = false;\nconst name = 'OFP2MAP';\ntry {\n    app = new App({\n        target: document.body\n    });\n}catch(err) {\n    appError = true;\n    try {\n        var content = document.createElement(\"p\");\n        content.innerHTML =('Erreur: ' + err.message + '<br/><br/>'\n            + name + ' a besoin de navigateurs récents: Safari 14 iOS/Mac, Firefox 86, Chrome 87 et Microsoft Edge 87 sont compatibles. <br /><br />'\n            + 'Contactez moi sur l\\'email AF (erdelord@...) en me donnant le message d\\'erreur.'\n        );\n        document.body.appendChild(content);\n    // eslint-disable-next-line no-empty\n    }catch(e){} /* catch all here we can not interrupt the startup sequence */ \n}finally{\n    // we always register the serviceWorker to be able to unregister it\n    // or to force skipWaiting and page reload\n    // this way as soon as a new serviceWorker fix the problem, the page will load\n    if ('serviceWorker' in navigator) {\n        const workbox = new Workbox('./sw.js');\n        wb.set(workbox);\n        workbox.addEventListener('installed', (event) => {\n            if (!event.isUpdate) {\n                //console.log('Service worker installed for the first time!');\n            }else{\n                //console.log('Updated Service worker installed');\n            }\n            //console.debug('Updated Service worker installed ', event.isUpdate, event.isExternal)\n        });\n        workbox.addEventListener('activated', (event) => {\n            // `event.isUpdate` will be true if another version of the service\n            // worker was controlling the page when this version was registered.\n            if (!event.isUpdate) {\n                //console.log('Service worker activated for the first time!');\n                // If your service worker is configured to precache assets, those\n                // assets should all be available now.\n                // we should be able to remove clients.claim call in sw.js\n                // but for now we have both...\n                workbox.messageSW({ type: 'CLIENTS_CLAIM' });\n            }else{\n                //console.log('Updated Service worker activated');\n            }\n            if (event.isExternal) {\n                console.warn('External Service worker activated');\n                //window.location.reload();\n            }\n        });\n        workbox.addEventListener('waiting', (event) => {\n            //console.log(`A new service worker has installed, but it can't activate` +\n            //    ` until all tabs running the current version have fully unloaded.`);\n            if (appError) {\n                workbox.addEventListener('controlling', () => {\n                    console.warn('main.js: appError reload');\n                    window.location.reload();\n                });\n                workbox.messageSkipWaiting();\n            }else{\n                if (event.isExternal) {\n                    console.warn('External Service worker waiting');\n                }\n                promiseTimeout(400, messageSW(event.sw,{type: 'GET_VERSION'}))\n                .then(v => showSkipWaitingPrompt(v))\n                .catch(e => {\n                    console.warn(\"SW GET_VERSION:\", e);\n                    showSkipWaitingPrompt();\n                });\n            }\n        });\n        workbox.register().then(reg => {\n            if (appError && reg) reg.unregister();\n            swRegistration.set(reg);\n            //console.debug(reg);\n        }, console.error);\n    }\n}\n\nexport default app;"],"names":["noop","identity","x","assign","tar","src","k","run","fn","blank_object","Object","create","run_all","fns","forEach","is_function","thing","safe_not_equal","a","b","src_url_equal_anchor","subscribe","store","callbacks","unsub","unsubscribe","get_store_value","value","_","component_subscribe","component","callback","$$","on_destroy","push","create_slot","definition","ctx","$$scope","slot_ctx","get_slot_context","slice","get_slot_changes","dirty","lets","undefined","merged","len","Math","max","length","i","update_slot_base","slot","slot_definition","slot_changes","get_slot_context_fn","slot_context","p","get_all_dirty_from_scope","exclude_internal_props","props","result","compute_rest_props","keys","rest","Set","has","null_to_empty","set_store_value","ret","set","action_destroyer","action_result","destroy","is_client","window","now","performance","Date","raf","cb","requestAnimationFrame","tasks","run_tasks","task","c","delete","f","size","loop","promise","Promise","fulfill","add","abort","append","target","node","appendChild","get_root_for_style","document","root","getRootNode","ownerDocument","host","append_empty_stylesheet","style_element","element","style","head","append_stylesheet","insert","anchor","insertBefore","detach","parentNode","removeChild","destroy_each","iterations","detaching","d","name","createElement","svg_element","createElementNS","text","data","createTextNode","space","empty","listen","event","handler","options","addEventListener","removeEventListener","prevent_default","preventDefault","call","this","attr","attribute","removeAttribute","getAttribute","setAttribute","set_attributes","attributes","descriptors","getOwnPropertyDescriptors","__proto__","key","cssText","xlink_attr","setAttributeNS","to_number","set_data","wholeText","set_input_value","input","set_style","important","setProperty","select_option","select","option","__value","selected","select_value","selected_option","querySelector","crossorigin","is_crossorigin","parent","error","toggle_class","toggle","classList","custom_event","type","detail","bubbles","e","createEvent","initCustomEvent","active_docs","current_component","active","create_rule","duration","delay","ease","uid","step","keyframes","t","rule","str","hash","charCodeAt","doc","stylesheet","__svelte_stylesheet","sheet","current_rules","__svelte_rules","insertRule","cssRules","animation","delete_rule","previous","split","next","filter","anim","indexOf","deleted","join","deleteRule","clear","set_current_component","get_current_component","Error","onMount","on_mount","onDestroy","createEventDispatcher","bubble","dirty_components","binding_callbacks","render_callbacks","flush_callbacks","resolved_promise","resolve","update_scheduled","schedule_update","then","flush","tick","add_render_callback","add_flush_callback","flushing","seen_callbacks","update","pop","fragment","before_update","after_update","wait","dispatch","direction","kind","dispatchEvent","outroing","outros","group_outros","r","check_outros","transition_in","block","local","transition_out","o","null_transition","create_in_transition","params","animation_name","config","running","cleanup","go","easing","css","start_time","end_time","started","start","invalidate","end","create_bidirectional_transition","intro","running_program","pending_program","clear_animation","init","program","abs","group","handle_promise","info","token","index","resolved","child_ctx","current","needs_flush","blocks","m","mount","catch","hasCatch","pending","globals","globalThis","global","bind","bound","create_component","mount_component","customElement","new_on_destroy","map","destroy_component","instance","create_fragment","not_equal","append_styles","parent_component","on_disconnect","context","Map","skip_bound","ready","fill","make_dirty","hydrate","nodes","Array","from","childNodes","children","l","SvelteComponent","$destroy","$on","splice","$set","$$props","obj","$$set","Deferred","constructor","reject","runningOnIpad","navigator","platform","maxTouchPoints","usingChromeOnIOS","test","userAgent","usingSafari","supportsHover","matchMedia","matches","debounce","func","immediate","timeout","args","arguments","later","apply","callNow","clearTimeout","setTimeout","folderName","clamp","num","min","isInside","intersect","edge","bbox","bitCode","code","promiseTimeout","ms","id","race","semverCompare","pa","pb","na","Number","nb","isNaN","shareAppLink","async","shareData","title","url","location","pathname","share","err","binarysearch","sortedArray","condition","ans","mid","trunc","cubicOut","fade","linear","getComputedStyle","opacity","fly","y","target_opacity","transform","od","u","slide","height","parseFloat","padding_top","paddingTop","padding_bottom","paddingBottom","margin_top","marginTop","margin_bottom","marginBottom","border_top_width","borderTopWidth","border_bottom_width","borderBottomWidth","subscriber_queue","readable","writable","stop","subscribers","new_value","run_queue","subscriber","derived","stores","initial_value","single","isArray","stores_array","auto","inited","values","sync","unsubscribers","aircraftTypes","discontinuatedAircraftTypes","wb","swDismiss","swUpdated","majorUpdate","sidebar","focusMode","showGramet","showPlaneOnMap","resetValue","reset","resetable","simulate","ofp","ofpStatus","takeOffTime","landingTime","$ofp","$takeOffTime","timeMatrix","getTime","infos","flightTime","selectedAircraftType","aircraftType","$selectedAircraftType","aircraft","swLastUpdateDate","checkSWUpdate","serviceWorker","getRegistration","reg","waiting","console","checkSwOnVisibilityChange","visibilityState","visible","changeVisibleState","online","update_network_status","onLine","route","hashchange","meta","metaContent","substr","replace","flightProgress","$simulate","$showPlaneOnMap","$visible","interval","frequency","setValue","clearInterval","setInterval","takeOff","landing","computePosition","pos","position","$flightProgress","latitude","longitude","gramet","fl","reltime","distanceMatrix","firstPoint","lastPoint","routeDistance","firstFL","lastFL","posTime","sum","segmentLength","fraction","atFraction","posDistance","copyPermission","permissions","query","state","areaDom","valueCopy","lidoRoute","timeOut","copied","success","clipboard","writeText","focus","execCommand","copyText","kmlExportDefaultOptions","routeDisplay","routePin","routeColor","alternateDisplay","alternatePin","alternateColor","natDisplay","natPin","natColor","greatCircleDisplay","greatCircleColor","skeleton","kmlGen","kmlOptions","addFolders","enabled","color","pinId","natIncompleteColor","KmlGenerator","editolido","KMLGenerator","updateKml","startsWith","endsWith","folder","changeFolderState","changeFolderPin","changeFolderColor","toUpperCase","label","swatchStyle","pickerStyle","kmlRegex","kml2mapColor","v","hex","range","kml2swatch","defaultSwatch","parseInt","g","swatch","kmlColor","colorName","pinName","debounceDispatch","toString","blur","kmlDefaultOptions","natPinPosition","ogimetDisplay","ogimetColor","airportDisplay","airportPin","airportLabel","firDisplay","etopsDisplay","etopsColor","iconTextChange","lineWidthChange","iconSizeChange","freeze","optionsKML","shortcut","downloadType","exportKML","focusKML","changelogOnUpdate","storage","getItem","localStorage","JSON","parse","removeItem","setItem","toSave","stringify","hasItem","validate","defaultOptions","validated","entries","match","toFixed","setHistory","includedStores","includes","diff","encodeURIComponent","permalink","origin","history","replaceState","defaultValue","shortcutName","disabled","trim","kml","render","kmlAvenza","template","avenzaTemplate","styleTemplate","avenzaStyleTemplate","iconTemplate","avenzaIconTemplate","icons","AVENZAICONS","kmlGoogleEarth","googleEarthStyleTemplate","grametProxyURL","ogimetData","proxyImg","blurAction","handleVisibilityChange","optionColors","cssRoot","filename","setCssColor","blobURL","blob","Blob","URL","createObjectURL","revokeObjectURL","extension","checked","displayName","labels","isMedicalStyle","selectedPin","selectedLabel","decimals","previousValue","clickOutside","handleClick","contains","defaultPrevented","CustomEvent","dashToCamelCase","camelCaseToDash","toLowerCase","compare","obj1","obj2","focusOptions","focusBackup","focusStore","storedOptions","focusOptionsDefault","reduce","updateAll","hasChange","endFocusMode","isDefault","isChanged","$focusMode","isFocusDefault","$sidebar","exportOptions","allowedOptions","mapOptions","allowedMapOptions","isLikeMap","standalone","element_src","href","jsonPoint","lngLat","properties","geometry","coordinates","featureCollection","features","jsonLine","computeIconSize","ratio","extraFactor","computeIconTextSize","computeLineWidthSize","getIconSizeExpression","iconSize","getIconColorExpression","overrideColor","getTextColorExpression","getOpacityColorExpression","overrideOpacity","minOpacity","getTextKmlColorExpression","kmlcolor","overrideKmlColor","getOpacityKmlColorExpression","addPoints","affine","prefix","folder2prefix","visibility","textSize","addSource","lngLats","newPair","geoPoints2LngLats","geoPoint","addLayer","markerLayer","addLine","affineLine","lineWidth","dashes","lineLayer","addLines","results","line","sublines","sublen","subline","ar","hexcolor","source","layout","paint","changeIconSizeGeneric","getLayer","setLayoutProperty","changeIconTextGeneric","changeLineWidthGeneric","setPaintProperty","changeLineGeneric","iconImageExpression","getLayoutProperty","iconImage","changeDisplayGeneric","adequateLayer","emergencyLayer","medicalColor","medicalCondition","getIconColor","raltNames","hexColor","ofpLoaded","isStatusStyle","statusAirportIconColor","medicalAirportIconColor","basicAirportIconColor","filterByAircraftType","is","medicalOnly","typeCondition","symbolSortKey","maxPriorityNames","getIconHaloWidth","getTextColor","styleBasedColor","getAdequateTextField","labelling","getEmergencyTextField","adequateTextSize","etopsNames","textRatio","emergencyTextSize","adequateIconSize","iconRatio","emergencyIconSize","changeAirportDisplay","getEtopsNames","ralts","epNames","concat","changeAdequatesColor","hexcolorEtops","show","hide","mapData","affineOrDrop","epPoints","raltPoints","etopsKmlColor","departure","arrival","fetch","response","json","projFeatures","feature","popup","mapboxgl","Popup","closeButton","closeOnClick","closeOnMove","addAirportPopup","icao","iata","icao2iata","get","aircraftTypeStore","lng","security","level","statusText","statusNum","html","h","charAt","setLngLat","setHTML","addTo","setCursorPointer","getCanvas","cursor","resetCursor","removeAirportPopup","remove","on","changeMarker","setFilter","change","changeIconText","changeIconSize","changeLabel","epCircleLayer","etopsCircleLayer","changeETOPSDisplay","affineAndClip","etopsTime","maxETOPS","circle","changeLine","changeETOPSCircleColor","changeLineWidth","fillLayer","changeFirDisplay","points","routeName","depICAO","destICAO","greatCircle","Route","alternateRoute","wptCoordinatesAlternate","rnatLabelLayer","changeMyTrackLabels","lines","rnat","markers","track","tracks","natLetter","natDirection","natLabel","description","point","isMine","overrideTextColor","noPin","trackPopup","entry","isARINC","arinc_normalizer","asDM","eet","flInTitle","pattern","RegExp","String","raw","highlighted","eto","toISOString","substring","activatePopup","layer","initialLoad","myTrack","entryPoint","popupData","lat","addEntryPointPopup","layers","airport","etops","fir","greatcircle","ogimet","ralt","rmain","changeEPCircleColor","TWO_PI","PI","FORTPI","adjust_lon","sign","forward","lon","dlon","long0","T","tan","S","sin","S2","x0","y0","inverse","atan","names","asin","cos","sqrt","A1","A2","A3","A4","M","lambda","phi","l2","l6","delta","createMap","onLoadCb","proj4","Proj","projections","times","eqearth","mapboxOptions","container","center","zoom","attributionControl","customAttribution","airportsAttribution","atob","affineAndClamp","_setCacheLimits","loadImage","image","addImage","pixelRatio","sdf","defs","affine2xy","xy2wgs84","xy","extent","affineTransform","mercatorBounds","x1","y1","u0","v0","u1","v1","mercatorHeight","w","dy","minX","minY","maxX","maxY","viewport","customXY","customXY2xy","XY","customXY2wgs84","X","Y","codeB","lastCode","codeA","part","lineclip","Infinity","getBounds","fitBounds","padding","top","bottom","left","right","geolocate","GeolocateControl","positionOptions","enableHighAccuracy","fitBoundsOptions","maxZoom","trackUserLocation","originalOnSuccess","_onSuccess","coords","accuracy","addControl","onAdd","_map","_container","className","_button","_focusModeUnsubscribe","innerHTML","mapControlHTML","_toggleSidebar","onRemove","tiles","tileSize","minzoom","maxzoom","loadMapLayers","TilesCache","dbName","version","dbPromise","open","indexedDB","onsuccess","onerror","onupgradeneeded","getImageIdFromURL","fetchImageFromDB","imageId","storeName","imageInStoreReq","transaction","objectStore","putImageInDB","imagePutReq","put","getCacheHandler","_cacheHandler","isNotCached","imageID","getKey","countTiles","countStoreReq","count","close","request","Response","clone","imageBlob","status","lon2tile","floor","pow","lat2tile","log","findMissingCacheTiles","tilesCaches","cacheAll","tilesCount","cacheName","tilesMax","matrix","cacheZoom","caches","sw","ne","promises","swXY","neXY","_requestManager","_skuToken","accessToken","all","progressPath","angle","path","aircraftTypeSelectElement","planeMarker","planeElement","placePlane","Marker","$position","blankStyle","metadata","js","android","ios","bearing","pitch","sources","sprite","glyphs","created","modified","owner","draft","tilesResolution","renderWorldCopies","validity","isInBounds","dep","dest","bounds","autoSelectedId","authorizedOptions","cbMapOption","find","northOption","distanceTo","rad_to_nm","grametStatus","grametResponseStatus","grametThumbAction","plane","getElementById","objectURL","img","iWidth","scale","currentOfp","viewportHeight","clientHeight","viewportWidth","clientWidth","body","gInnerHeight","getPropertyValue","position2pixel","grametMargin","imageOffsetForPosition","pixelPosX","margin","lock","planePosition","planeLevel","round","loadListener","gHeight","cloneNode","display","crossOrigin","cloneLoadListener","errorListener","objectFit","offset","createImg","ok","headers","message","setGramet","pinchZoom","maxHeight","dataset","width","iHeight","cHeight","allowImgScroll","pinchzoomChange","setTransform","setHeight","gWidth","nWidth","prop","mapResizeAction","currentMap","resizeMap","resize","observer","IntersectionObserver","intersectionRatio","threshold","observe","unobserve","disconnect","hidePlane","selectedProjection","settings","cacheMaxValue","cacheValue","cacheError","tilesMissing","afterMapLoad","attribution","module","updateMapLayers","$aircraftType","cacheButtonDisabled","supportWebP","Image","onload","canUseWebP","off","mapIsCached","showPlaneState","cache","urls","fetchCallback","queue","currentRequests","fetcher","fetchSimultaneously","RIGHT","LEFT","TOP","BOTTOM","isBrowser","getMainPosition","fitsOnTop","fitsOnBottom","fitsOnLeft","fitsOnRight","getSecondaryPosition","parentCenter","fitsCenter","positions","DEFAULT_POSITION","POSITIONS","content","isOpen","updateOnScroll","closeOnScroll","closeOnClickOutside","zIndex","onWindowKeyDown","currentPosition","topStyle","leftStyle","widthStyle","heightStyle","addListeners","updatePosition","removeListeners","prevOpen","nextOpen","hasParent","hasContent","openedState","composedPath","parentWidth","parentHeight","getBoundingClientRect","nextPosition","dimensions","documentElement","mainPosition","secondaryPosition","getNextPosition","$$restProps","levels","updates","to_null_out","accounted_for","n","rel","grametUpdateAvailable","reload","$grametStatus","$showGramet","grametSourceUpdate","updatedURL","payload","parisBase","getFlightTypePNC","destination","isBase","base","addDutyMeta","duty","lastLeg","legs","OUT","IN","TVSV","blockTime","destIATA","layover","layoverTZ","destTZ","pairingData","scheduledTSV","pairing","duties","pairingText","extract","month","year","exec","months3","depIATA","depTZ","aircraftOpsVersion","tz","flightTypePNC","flightTypePNT","matchAll","scheduledOut","UTC","scheduledIN","iata2GeoPoint","groundDistance","distanceType","distance","isOFP","ofpOUT","baseTZ","meridians","getMeridians","StringExtractException","TSV","flightNo","ofpTextDate","etopsMarkdown","altnETOPSPoints","getHours","getUTCHours","padStart","getMinutes","getUTCMinutes","runway","startWindow","endWindow","myName","ETO","fuelMargin","etopsList","currentRalt","latlng","etopsSummary","removePageFooterRegex","regex","day","ofpOFF","setUTCHours","latString","lngString","hours","minutes","fuelRequired","efob","rwy","startHours","startMinutes","endHours","endMinutes","dm_normalizer","etopsData","res","EET","raltPoint","getOfpRouteExport","tte","fuelMarginTime","minFuelMarginETOPS","tripFuel","excluded","filteredInfos","fromEntries","val","lidoFPL","realOFF","altnETOPS","registration","aircraftRegistration","etopsOutput","plugins","rawText","hm2input","ofpTakeOff","getOfpTakeOffTime","newTakeOff","setUTCMinutes","acos","atan2","deg","rad","J2000","toJulian","date","valueOf","toCenturies","geomMeanLongSun","modulo","geomMeanAnomalySun","sunTrueLong","sunEqOfCenter","sunApparentLong","obliquityCorrection","meanObliquityOfEcliptic","sunDeclinationInRadians","sint","sunRtAscensionInRadians","tananum","tanadenom","sunAzEl","seconds","getUTCSeconds","solarTimeFix","eccentricityEarthOrbit","epsilon","l0","Etime","eqTime","theta","ha","csz","zenith","elevation","sunStates","sunStateMap","prevState","newState","isSunRising","sunRisingStates","sunState","correction","toDays","rightAscension","declination","moonCoords","F","dt","ra","dec","dist","getMoonIllumination","s","sdist","inc","phase","getMoonPosition","lw","H","siderealTime","altitude","parallacticAngle","moonState","moonStateMap","sun","getState","stateMap","moon","iterateSegment","prev","increment","lowerLimit","upperLimit","segmentTime","relpos","getSolarDefault","solar","last","routeMatrix","object","kpColor","kp","noaaKp","fetchNoaaKpAndSet","timetable","Kp","$landingTime","$noaaKp","tots","startTs","endTs","aurora","$solar","$Kp","segments","predictedKp","minKpAtPoint","periods","rounding","roundedStart","roundedEnd","ceil","relpos1","relpos2","period","geoMagneticPoleLatLng","mlat","GeoPoint","rad_to_deg","predictedKpUpdated","inCache","req","isInCache","xpos","civilIcon","timelineSize","eventColor","format","iframe","tabIndex","contentWindow","withSeconds","toJSON","fixed","stateOrEvent","svgClientWidth","departureSun","arrivalSun","flightKp","getMoonIlluminationPercent","moonIllumination","getMoonName","moonEmojiStyle","mi","emojiOrientationCorrection","moonEmoji","estimatedDate","nightEventsFR","astronomicalDawn","astronomicalDusk","nauticalDawn","nauticalDusk","civilDawn","civilDusk","sunrise","sunset","night","moonrise","moonset","states","isRising","sunStateAndRising","isMoonVisible","departureMoon","sunEvents","isMoonVisibleDuringFlight","widgetEmoji","getWidgetEmojiWhenNoSunEvent","widgetEvents","getMoonEmoji","menuCheckBox","preloadFiles","getPageText","pdf","pageNo","page","getPage","getTextContent","items","pdfWorker","preload","remaining","maybeCallback","defer","isScript","tag","loader","pdfjsLib","GlobalWorkerOptions","workerSrc","destroyed","PDFWorker","getOFP","file","reader","FileReader","ev","ofpPages","processedPages","getDocument","maxPages","numPages","pageText","getOFPText","verbosity","worker","Ofp","wmoGrid","GeoGridIndex","wmo","averageFL","p1","p2","unshift","wptNamesEET","setName","wptCoordinates","natmarks","isComplete","addPoint","generateKML","readAsArrayBuffer","files","form","closest","$ofpStatus","$ofpStore","finally","hidden","maxWidth","cbName","ogimetURL","versionDateRegex","title2html","parseMarkdown","badgeColor","badgeTextColor","filterChangeLog","limit","filtered","CHANGELOG","markdownText","translation","ADDED","FIXED","DEPRECATED","CHANGED","REMOVED","SECURITY","badgeColors","badgeTextColors","category","showChangelogOnUdate","swVersion","scrollingRoot","scrollingElement","toc","tocNodeList","modal","querySelectorAll","scrollTop","scrollHeight","elt","offsetTop","rootMargin","innerText","_wb","$wb","messageSW","relativeOffset","fixedOffset","maxOffset","onScroll","scrollTo","behavior","swRegistration","showSkipWaitingPrompt","nextVersion","cParts","nParts","isPatchUpdate","previousAppVersionKey","installLabel","getPreviousAppVersion","sessionStorage","$swDismiss","prompt","install","refreshing","$swRegistration","postMessage","rawData","item","decodeURIComponent","valid","storeSettingsFromURL","search","$route","requestedRoute","self","MessageChannel","port1","onmessage","port2","Symbol","iterator","prototype","done","TypeError","nn","tn","rn","en","un","an","cn","installing","scriptURL","sn","vn","hn","ln","isExternal","originalEvent","mn","isUpdate","wn","dn","controller","gn","ports","getSW","register","readyState","Boolean","yn","pn","bn","once","wasWaitingBeforeRegister","messageSkipWaiting","enumerable","configurable","defineProperty","Pn","Sn","app","appError","App","workbox","Workbox","unregister"],"mappings":"gCAAA,SAASA,KACT,MAAMC,EAAWC,GAAKA,EACtB,SAASC,EAAOC,EAAKC,GAEjB,IAAK,MAAMC,KAAKD,EACZD,EAAIE,GAAKD,EAAIC,GACjB,OAAOF,EAUX,SAASG,EAAIC,GACT,OAAOA,IAEX,SAASC,IACL,OAAOC,OAAOC,OAAO,MAEzB,SAASC,EAAQC,GACbA,EAAIC,QAAQP,GAEhB,SAASQ,EAAYC,GACjB,MAAwB,mBAAVA,EAElB,SAASC,EAAeC,EAAGC,GACvB,OAAOD,GAAKA,EAAIC,GAAKA,EAAID,IAAMC,GAAOD,GAAkB,iBAANA,GAAgC,mBAANA,EAEhF,IAAIE,EAmBJ,SAASC,EAAUC,KAAUC,GACzB,GAAa,MAATD,EACA,OAAOtB,EAEX,MAAMwB,EAAQF,EAAMD,aAAaE,GACjC,OAAOC,EAAMC,YAAc,IAAMD,EAAMC,cAAgBD,EAE3D,SAASE,EAAgBJ,GACrB,IAAIK,EAEJ,OADAN,EAAUC,GAAOM,GAAKD,EAAQC,GAA9BP,GACOM,EAEX,SAASE,EAAoBC,EAAWR,EAAOS,GAC3CD,EAAUE,GAAGC,WAAWC,KAAKb,EAAUC,EAAOS,IAElD,SAASI,EAAYC,EAAYC,EAAKC,EAAS9B,GAC3C,GAAI4B,EAAY,CACZ,MAAMG,EAAWC,EAAiBJ,EAAYC,EAAKC,EAAS9B,GAC5D,OAAO4B,EAAW,GAAGG,IAG7B,SAASC,EAAiBJ,EAAYC,EAAKC,EAAS9B,GAChD,OAAO4B,EAAW,IAAM5B,EAClBL,EAAOmC,EAAQD,IAAII,QAASL,EAAW,GAAG5B,EAAG6B,KAC7CC,EAAQD,IAElB,SAASK,EAAiBN,EAAYE,EAASK,EAAOnC,GAClD,GAAI4B,EAAW,IAAM5B,EAAI,CACrB,MAAMoC,EAAOR,EAAW,GAAG5B,EAAGmC,IAC9B,QAAsBE,IAAlBP,EAAQK,MACR,OAAOC,EAEX,GAAoB,iBAATA,EAAmB,CAC1B,MAAME,EAAS,GACTC,EAAMC,KAAKC,IAAIX,EAAQK,MAAMO,OAAQN,EAAKM,QAChD,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAKI,GAAK,EAC1BL,EAAOK,GAAKb,EAAQK,MAAMQ,GAAKP,EAAKO,GAExC,OAAOL,EAEX,OAAOR,EAAQK,MAAQC,EAE3B,OAAON,EAAQK,MAEnB,SAASS,EAAiBC,EAAMC,EAAiBjB,EAAKC,EAASiB,EAAcC,GACzE,GAAID,EAAc,CACd,MAAME,EAAejB,EAAiBc,EAAiBjB,EAAKC,EAASkB,GACrEH,EAAKK,EAAED,EAAcF,IAO7B,SAASI,EAAyBrB,GAC9B,GAAIA,EAAQD,IAAIa,OAAS,GAAI,CACzB,MAAMP,EAAQ,GACRO,EAASZ,EAAQD,IAAIa,OAAS,GACpC,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQC,IACxBR,EAAMQ,IAAM,EAEhB,OAAOR,EAEX,OAAQ,EAEZ,SAASiB,EAAuBC,GAC5B,MAAMC,EAAS,GACf,IAAK,MAAMxD,KAAKuD,EACC,MAATvD,EAAE,KACFwD,EAAOxD,GAAKuD,EAAMvD,IAC1B,OAAOwD,EAEX,SAASC,EAAmBF,EAAOG,GAC/B,MAAMC,EAAO,GACbD,EAAO,IAAIE,IAAIF,GACf,IAAK,MAAM1D,KAAKuD,EACPG,EAAKG,IAAI7D,IAAe,MAATA,EAAE,KAClB2D,EAAK3D,GAAKuD,EAAMvD,IACxB,OAAO2D,EAkBX,SAASG,EAAczC,GACnB,OAAgB,MAATA,EAAgB,GAAKA,EAEhC,SAAS0C,EAAgB/C,EAAOgD,EAAK3C,GAEjC,OADAL,EAAMiD,IAAI5C,GACH2C,EAGX,SAASE,EAAiBC,GACtB,OAAOA,GAAiB1D,EAAY0D,EAAcC,SAAWD,EAAcC,QAAU1E,EAGzF,MAAM2E,EAA8B,oBAAXC,OACzB,IAAIC,EAAMF,EACJ,IAAMC,OAAOE,YAAYD,MACzB,IAAME,KAAKF,MACbG,EAAML,EAAYM,GAAMC,sBAAsBD,GAAMjF,EASxD,MAAMmF,EAAQ,IAAIjB,IAClB,SAASkB,EAAUP,GACfM,EAAMrE,SAAQuE,IACLA,EAAKC,EAAET,KACRM,EAAMI,OAAOF,GACbA,EAAKG,QAGM,IAAfL,EAAMM,MACNT,EAAII,GAYZ,SAASM,EAAK3D,GACV,IAAIsD,EAGJ,OAFmB,IAAfF,EAAMM,MACNT,EAAII,GACD,CACHO,QAAS,IAAIC,SAAQC,IACjBV,EAAMW,IAAIT,EAAO,CAAEC,EAAGvD,EAAUyD,EAAGK,OAEvCE,QACIZ,EAAMI,OAAOF,KA0GzB,SAASW,EAAOC,EAAQC,GACpBD,EAAOE,YAAYD,GAWvB,SAASE,EAAmBF,GACxB,IAAKA,EACD,OAAOG,SACX,MAAMC,EAAOJ,EAAKK,YAAcL,EAAKK,cAAgBL,EAAKM,cAC1D,OAAIF,EAAKG,KACEH,EAEJD,SAEX,SAASK,EAAwBR,GAC7B,MAAMS,EAAgBC,EAAQ,SAE9B,OAEJ,SAA2BV,EAAMW,GAC7Bb,EAAOE,EAAKY,MAAQZ,EAAMW,GAJ1BE,CAAkBX,EAAmBF,GAAOS,GACrCA,EA6BX,SAASK,EAAOf,EAAQC,EAAMe,GAC1BhB,EAAOiB,aAAahB,EAAMe,GAAU,MAUxC,SAASE,EAAOjB,GACZA,EAAKkB,WAAWC,YAAYnB,GAEhC,SAASoB,EAAaC,EAAYC,GAC9B,IAAK,IAAIrE,EAAI,EAAGA,EAAIoE,EAAWrE,OAAQC,GAAK,EACpCoE,EAAWpE,IACXoE,EAAWpE,GAAGsE,EAAED,GAG5B,SAASZ,EAAQc,GACb,OAAOrB,SAASsB,cAAcD,GAiBlC,SAASE,EAAYF,GACjB,OAAOrB,SAASwB,gBAAgB,6BAA8BH,GAElE,SAASI,EAAKC,GACV,OAAO1B,SAAS2B,eAAeD,GAEnC,SAASE,IACL,OAAOH,EAAK,KAEhB,SAASI,IACL,OAAOJ,EAAK,IAEhB,SAASK,EAAOjC,EAAMkC,EAAOC,EAASC,GAElC,OADApC,EAAKqC,iBAAiBH,EAAOC,EAASC,GAC/B,IAAMpC,EAAKsC,oBAAoBJ,EAAOC,EAASC,GAE1D,SAASG,EAAgBjI,GACrB,OAAO,SAAU4H,GAGb,OAFAA,EAAMM,iBAEClI,EAAGmI,KAAKC,KAAMR,IAwB7B,SAASS,EAAK3C,EAAM4C,EAAWnH,GACd,MAATA,EACAuE,EAAK6C,gBAAgBD,GAChB5C,EAAK8C,aAAaF,KAAenH,GACtCuE,EAAK+C,aAAaH,EAAWnH,GAErC,SAASuH,EAAehD,EAAMiD,GAE1B,MAAMC,EAAc1I,OAAO2I,0BAA0BnD,EAAKoD,WAC1D,IAAK,MAAMC,KAAOJ,EACS,MAAnBA,EAAWI,GACXrD,EAAK6C,gBAAgBQ,GAER,UAARA,EACLrD,EAAKW,MAAM2C,QAAUL,EAAWI,GAEnB,YAARA,EACLrD,EAAKvE,MAAQuE,EAAKqD,GAAOJ,EAAWI,GAE/BH,EAAYG,IAAQH,EAAYG,GAAKhF,IAC1C2B,EAAKqD,GAAOJ,EAAWI,GAGvBV,EAAK3C,EAAMqD,EAAKJ,EAAWI,IAiBvC,SAASE,EAAWvD,EAAM4C,EAAWnH,GACjCuE,EAAKwD,eAAe,+BAAgCZ,EAAWnH,GAanE,SAASgI,EAAUhI,GACf,MAAiB,KAAVA,EAAe,MAAQA,EA4HlC,SAASiI,EAAS9B,EAAMC,GACpBA,EAAO,GAAKA,EACRD,EAAK+B,YAAc9B,IACnBD,EAAKC,KAAOA,GAEpB,SAAS+B,EAAgBC,EAAOpI,GAC5BoI,EAAMpI,MAAiB,MAATA,EAAgB,GAAKA,EAUvC,SAASqI,EAAU9D,EAAMqD,EAAK5H,EAAOsI,GACjC/D,EAAKW,MAAMqD,YAAYX,EAAK5H,EAAOsI,EAAY,YAAc,IAEjE,SAASE,EAAcC,EAAQzI,GAC3B,IAAK,IAAIwB,EAAI,EAAGA,EAAIiH,EAAO9B,QAAQpF,OAAQC,GAAK,EAAG,CAC/C,MAAMkH,EAASD,EAAO9B,QAAQnF,GAC9B,GAAIkH,EAAOC,UAAY3I,EAEnB,YADA0I,EAAOE,UAAW,IAW9B,SAASC,EAAaJ,GAClB,MAAMK,EAAkBL,EAAOM,cAAc,aAAeN,EAAO9B,QAAQ,GAC3E,OAAOmC,GAAmBA,EAAgBH,QAO9C,IAAIK,EACJ,SAASC,IACL,QAAoB/H,IAAhB8H,EAA2B,CAC3BA,GAAc,EACd,IAC0B,oBAAX/F,QAA0BA,OAAOiG,QACnCjG,OAAOiG,OAAOxE,SAG3B,MAAOyE,GACHH,GAAc,GAGtB,OAAOA,EAsCX,SAASI,EAAanE,EAASc,EAAMsD,GACjCpE,EAAQqE,UAAUD,EAAS,MAAQ,UAAUtD,GAEjD,SAASwD,GAAaC,EAAMC,EAAQC,GAAU,GAC1C,MAAMC,EAAIjF,SAASkF,YAAY,eAE/B,OADAD,EAAEE,gBAAgBL,EAAME,GAAS,EAAOD,GACjCE,EAyEX,MAAMG,GAAc,IAAIvH,IACxB,IAiIIwH,GAjIAC,GAAS,EASb,SAASC,GAAY1F,EAAMhF,EAAGC,EAAG0K,EAAUC,EAAOC,EAAMvL,EAAIwL,EAAM,GAC9D,MAAMC,EAAO,OAASJ,EACtB,IAAIK,EAAY,MAChB,IAAK,IAAIxI,EAAI,EAAGA,GAAK,EAAGA,GAAKuI,EAAM,CAC/B,MAAME,EAAIjL,GAAKC,EAAID,GAAK6K,EAAKrI,GAC7BwI,GAAiB,IAAJxI,EAAU,KAAKlD,EAAG2L,EAAG,EAAIA,QAE1C,MAAMC,EAAOF,EAAY,SAAS1L,EAAGW,EAAG,EAAIA,SACtCuG,EAAO,YAfjB,SAAc2E,GACV,IAAIC,EAAO,KACPnJ,EAAIkJ,EAAInJ,OACZ,KAAOC,KACHmJ,GAASA,GAAQ,GAAKA,EAAQD,EAAIE,WAAWpJ,GACjD,OAAOmJ,IAAS,EAUSA,CAAKF,MAASJ,IACjCQ,EAAMpG,EAAmBF,GAC/BuF,GAAY3F,IAAI0G,GAChB,MAAMC,EAAaD,EAAIE,sBAAwBF,EAAIE,oBAAsBhG,EAAwBR,GAAMyG,OACjGC,EAAgBJ,EAAIK,iBAAmBL,EAAIK,eAAiB,IAC7DD,EAAclF,KACfkF,EAAclF,IAAQ,EACtB+E,EAAWK,WAAW,cAAcpF,KAAQ0E,IAAQK,EAAWM,SAAS7J,SAE5E,MAAM8J,EAAY9G,EAAKW,MAAMmG,WAAa,GAG1C,OAFA9G,EAAKW,MAAMmG,UAAY,GAAGA,EAAY,GAAGA,MAAgB,KAAKtF,KAAQmE,cAAqBC,aAC3FH,IAAU,EACHjE,EAEX,SAASuF,GAAY/G,EAAMwB,GACvB,MAAMwF,GAAYhH,EAAKW,MAAMmG,WAAa,IAAIG,MAAM,MAC9CC,EAAOF,EAASG,OAAO3F,EACvB4F,GAAQA,EAAKC,QAAQ7F,GAAQ,EAC7B4F,IAAsC,IAA9BA,EAAKC,QAAQ,aAErBC,EAAUN,EAAShK,OAASkK,EAAKlK,OACnCsK,IACAtH,EAAKW,MAAMmG,UAAYI,EAAKK,KAAK,MACjC9B,IAAU6B,EACL7B,IAKT3G,GAAI,KACI2G,KAEJF,GAAY3K,SAAQ0L,IAChB,MAAMC,EAAaD,EAAIE,oBACvB,IAAIvJ,EAAIsJ,EAAWM,SAAS7J,OAC5B,KAAOC,KACHsJ,EAAWiB,WAAWvK,GAC1BqJ,EAAIK,eAAiB,MAEzBpB,GAAYkC,aA0EpB,SAASC,GAAsB9L,GAC3B4J,GAAoB5J,EAExB,SAAS+L,KACL,IAAKnC,GACD,MAAM,IAAIoC,MAAM,oDACpB,OAAOpC,GAKX,SAASqC,GAAQvN,GACbqN,KAAwB7L,GAAGgM,SAAS9L,KAAK1B,GAK7C,SAASyN,GAAUzN,GACfqN,KAAwB7L,GAAGC,WAAWC,KAAK1B,GAE/C,SAAS0N,KACL,MAAMpM,EAAY+L,KAClB,MAAO,CAAC1C,EAAMC,KACV,MAAM7J,EAAYO,EAAUE,GAAGT,UAAU4J,GACzC,GAAI5J,EAAW,CAGX,MAAM6G,EAAQ8C,GAAaC,EAAMC,GACjC7J,EAAUkB,QAAQ3B,SAAQN,IACtBA,EAAGmI,KAAK7G,EAAWsG,QAoBnC,SAAS+F,GAAOrM,EAAWsG,GACvB,MAAM7G,EAAYO,EAAUE,GAAGT,UAAU6G,EAAM+C,MAC3C5J,GAEAA,EAAUkB,QAAQ3B,SAAQN,GAAMA,EAAGmI,KAAKC,KAAMR,KAItD,MAAMgG,GAAmB,GAEnBC,GAAoB,GACpBC,GAAmB,GACnBC,GAAkB,GAClBC,GAAmB5I,QAAQ6I,UACjC,IAAIC,IAAmB,EACvB,SAASC,KACAD,KACDA,IAAmB,EACnBF,GAAiBI,KAAKC,KAG9B,SAASC,KAEL,OADAH,KACOH,GAEX,SAASO,GAAoBvO,GACzB8N,GAAiBpM,KAAK1B,GAE1B,SAASwO,GAAmBxO,GACxB+N,GAAgBrM,KAAK1B,GAEzB,IAAIyO,IAAW,EACf,MAAMC,GAAiB,IAAIhL,IAC3B,SAAS2K,KACL,IAAII,GAAJ,CAEAA,IAAW,EACX,EAAG,CAGC,IAAK,IAAI9L,EAAI,EAAGA,EAAIiL,GAAiBlL,OAAQC,GAAK,EAAG,CACjD,MAAMrB,EAAYsM,GAAiBjL,GACnCyK,GAAsB9L,GACtBqN,GAAOrN,EAAUE,IAIrB,IAFA4L,GAAsB,MACtBQ,GAAiBlL,OAAS,EACnBmL,GAAkBnL,QACrBmL,GAAkBe,KAAlBf,GAIJ,IAAK,IAAIlL,EAAI,EAAGA,EAAImL,GAAiBpL,OAAQC,GAAK,EAAG,CACjD,MAAMpB,EAAWuM,GAAiBnL,GAC7B+L,GAAe/K,IAAIpC,KAEpBmN,GAAepJ,IAAI/D,GACnBA,KAGRuM,GAAiBpL,OAAS,QACrBkL,GAAiBlL,QAC1B,KAAOqL,GAAgBrL,QACnBqL,GAAgBa,KAAhBb,GAEJG,IAAmB,EACnBO,IAAW,EACXC,GAAevB,SAEnB,SAASwB,GAAOnN,GACZ,GAAoB,OAAhBA,EAAGqN,SAAmB,CACtBrN,EAAGmN,SACHvO,EAAQoB,EAAGsN,eACX,MAAM3M,EAAQX,EAAGW,MACjBX,EAAGW,MAAQ,EAAE,GACbX,EAAGqN,UAAYrN,EAAGqN,SAAS3L,EAAE1B,EAAGK,IAAKM,GACrCX,EAAGuN,aAAazO,QAAQiO,KAIhC,IAAIpJ,GACJ,SAAS6J,KAOL,OANK7J,KACDA,GAAUC,QAAQ6I,UAClB9I,GAAQiJ,MAAK,KACTjJ,GAAU,SAGXA,GAEX,SAAS8J,GAASvJ,EAAMwJ,EAAWC,GAC/BzJ,EAAK0J,cAAc1E,GAAa,GAAGwE,EAAY,QAAU,UAAUC,MAEvE,MAAME,GAAW,IAAI3L,IACrB,IAAI4L,GACJ,SAASC,KACLD,GAAS,CACLE,EAAG,EACH1K,EAAG,GACH5B,EAAGoM,IAGX,SAASG,KACAH,GAAOE,GACRpP,EAAQkP,GAAOxK,GAEnBwK,GAASA,GAAOpM,EAEpB,SAASwM,GAAcC,EAAOC,GACtBD,GAASA,EAAMhN,IACf0M,GAAStK,OAAO4K,GAChBA,EAAMhN,EAAEiN,IAGhB,SAASC,GAAeF,EAAOC,EAAOjJ,EAAQpF,GAC1C,GAAIoO,GAASA,EAAMG,EAAG,CAClB,GAAIT,GAAS1L,IAAIgM,GACb,OACJN,GAAS/J,IAAIqK,GACbL,GAAOxK,EAAEpD,MAAK,KACV2N,GAAStK,OAAO4K,GACZpO,IACIoF,GACAgJ,EAAM1I,EAAE,GACZ1F,QAGRoO,EAAMG,EAAEF,IAGhB,MAAMG,GAAkB,CAAE1E,SAAU,GACpC,SAAS2E,GAAqBtK,EAAM1F,EAAIiQ,GACpC,IAEIC,EACArL,EAHAsL,EAASnQ,EAAG0F,EAAMuK,GAClBG,GAAU,EAGV5E,EAAM,EACV,SAAS6E,IACDH,GACAzD,GAAY/G,EAAMwK,GAE1B,SAASI,IACL,MAAMhF,MAAEA,EAAQ,EAACD,SAAEA,EAAW,IAAGkF,OAAEA,EAAS9Q,EAAQ6O,KAAEA,EAAO9O,EAAIgR,IAAEA,GAAQL,GAAUJ,GACjFS,IACAN,EAAiB9E,GAAY1F,EAAM,EAAG,EAAG2F,EAAUC,EAAOiF,EAAQC,EAAKhF,MAC3E8C,EAAK,EAAG,GACR,MAAMmC,EAAapM,IAAQiH,EACrBoF,EAAWD,EAAapF,EAC1BxG,GACAA,EAAKU,QACT6K,GAAU,EACV7B,IAAoB,IAAMU,GAASvJ,GAAM,EAAM,WAC/Cb,EAAOK,GAAKb,IACR,GAAI+L,EAAS,CACT,GAAI/L,GAAOqM,EAIP,OAHApC,EAAK,EAAG,GACRW,GAASvJ,GAAM,EAAM,OACrB2K,IACOD,GAAU,EAErB,GAAI/L,GAAOoM,EAAY,CACnB,MAAM9E,EAAI4E,GAAQlM,EAAMoM,GAAcpF,GACtCiD,EAAK3C,EAAG,EAAIA,IAGpB,OAAOyE,KAGf,IAAIO,GAAU,EACd,MAAO,CACHC,QACQD,IAEJA,GAAU,EACVlE,GAAY/G,GACRnF,EAAY4P,IACZA,EAASA,IACTnB,KAAOZ,KAAKkC,IAGZA,MAGRO,aACIF,GAAU,GAEdG,MACQV,IACAC,IACAD,GAAU,KA6D1B,SAASW,GAAgCrL,EAAM1F,EAAIiQ,EAAQe,GACvD,IAAIb,EAASnQ,EAAG0F,EAAMuK,GAClBtE,EAAIqF,EAAQ,EAAI,EAChBC,EAAkB,KAClBC,EAAkB,KAClBhB,EAAiB,KACrB,SAASiB,IACDjB,GACAzD,GAAY/G,EAAMwK,GAE1B,SAASkB,EAAKC,EAAShG,GACnB,MAAMpE,EAAKoK,EAAQ1Q,EAAIgL,EAEvB,OADAN,GAAY7I,KAAK8O,IAAIrK,GACd,CACHvG,EAAGiL,EACHhL,EAAG0Q,EAAQ1Q,EACXsG,EAAAA,EACAoE,SAAAA,EACAuF,MAAOS,EAAQT,MACfE,IAAKO,EAAQT,MAAQvF,EACrBkG,MAAOF,EAAQE,OAGvB,SAASjB,EAAG3P,GACR,MAAM2K,MAAEA,EAAQ,EAACD,SAAEA,EAAW,IAAGkF,OAAEA,EAAS9Q,EAAQ6O,KAAEA,EAAO9O,EAAIgR,IAAEA,GAAQL,GAAUJ,GAC/EsB,EAAU,CACZT,MAAOvM,IAAQiH,EACf3K,EAAAA,GAECA,IAED0Q,EAAQE,MAAQjC,GAChBA,GAAOE,GAAK,GAEZyB,GAAmBC,EACnBA,EAAkBG,GAKdb,IACAW,IACAjB,EAAiB9E,GAAY1F,EAAMiG,EAAGhL,EAAG0K,EAAUC,EAAOiF,EAAQC,IAElE7P,GACA2N,EAAK,EAAG,GACZ2C,EAAkBG,EAAKC,EAAShG,GAChCkD,IAAoB,IAAMU,GAASvJ,EAAM/E,EAAG,WAC5CuE,GAAKb,IAUD,GATI6M,GAAmB7M,EAAM6M,EAAgBN,QACzCK,EAAkBG,EAAKF,EAAiB7F,GACxC6F,EAAkB,KAClBjC,GAASvJ,EAAMuL,EAAgBtQ,EAAG,SAC9B6P,IACAW,IACAjB,EAAiB9E,GAAY1F,EAAMiG,EAAGsF,EAAgBtQ,EAAGsQ,EAAgB5F,SAAU,EAAGkF,EAAQJ,EAAOK,OAGzGS,EACA,GAAI5M,GAAO4M,EAAgBH,IACvBxC,EAAK3C,EAAIsF,EAAgBtQ,EAAG,EAAIgL,GAChCsD,GAASvJ,EAAMuL,EAAgBtQ,EAAG,OAC7BuQ,IAEGD,EAAgBtQ,EAEhBwQ,MAIOF,EAAgBM,MAAM/B,GACzBpP,EAAQ6Q,EAAgBM,MAAMzM,IAG1CmM,EAAkB,UAEjB,GAAI5M,GAAO4M,EAAgBL,MAAO,CACnC,MAAM1N,EAAImB,EAAM4M,EAAgBL,MAChCjF,EAAIsF,EAAgBvQ,EAAIuQ,EAAgBhK,EAAIsJ,EAAOrN,EAAI+N,EAAgB5F,UACvEiD,EAAK3C,EAAG,EAAIA,GAGpB,SAAUsF,IAAmBC,OAIzC,MAAO,CACHnR,IAAIY,GACIJ,EAAY4P,GACZnB,KAAOZ,MAAK,KAER+B,EAASA,IACTG,EAAG3P,MAIP2P,EAAG3P,IAGXmQ,MACIK,IACAF,EAAkBC,EAAkB,OAKhD,SAASM,GAAerM,EAASsM,GAC7B,MAAMC,EAAQD,EAAKC,MAAQ,GAC3B,SAAS/C,EAAOhE,EAAMgH,EAAO5I,EAAK5H,GAC9B,GAAIsQ,EAAKC,QAAUA,EACf,OACJD,EAAKG,SAAWzQ,EAChB,IAAI0Q,EAAYJ,EAAK5P,SACTQ,IAAR0G,IACA8I,EAAYA,EAAU5P,QACtB4P,EAAU9I,GAAO5H,GAErB,MAAMwO,EAAQhF,IAAS8G,EAAKK,QAAUnH,GAAMkH,GAC5C,IAAIE,GAAc,EACdN,EAAK9B,QACD8B,EAAKO,OACLP,EAAKO,OAAO1R,SAAQ,CAACqP,EAAOhN,KACpBA,IAAMgP,GAAShC,IACfJ,KACAM,GAAeF,EAAO,EAAG,GAAG,KACpB8B,EAAKO,OAAOrP,KAAOgN,IACnB8B,EAAKO,OAAOrP,GAAK,SAGzB8M,SAKRgC,EAAK9B,MAAM1I,EAAE,GAEjB0I,EAAM7K,IACN4K,GAAcC,EAAO,GACrBA,EAAMsC,EAAER,EAAKS,QAAST,EAAKhL,QAC3BsL,GAAc,GAElBN,EAAK9B,MAAQA,EACT8B,EAAKO,SACLP,EAAKO,OAAOL,GAAShC,GACrBoC,GACA1D,KAGR,IAp1CgBlN,EAo1CDgE,IAn1CkB,iBAAVhE,GAA4C,mBAAfA,EAAMiN,KAm1CjC,CACrB,MAAMlD,EAAoBmC,KAc1B,GAbAlI,EAAQiJ,MAAKjN,IACTiM,GAAsBlC,GACtByD,EAAO8C,EAAKrD,KAAM,EAAGqD,EAAKtQ,MAAOA,GACjCiM,GAAsB,SACvB9C,IAIC,GAHA8C,GAAsBlC,GACtByD,EAAO8C,EAAKU,MAAO,EAAGV,EAAKnH,MAAOA,GAClC8C,GAAsB,OACjBqE,EAAKW,SACN,MAAM9H,KAIVmH,EAAKK,UAAYL,EAAKY,QAEtB,OADA1D,EAAO8C,EAAKY,QAAS,IACd,MAGV,CACD,GAAIZ,EAAKK,UAAYL,EAAKrD,KAEtB,OADAO,EAAO8C,EAAKrD,KAAM,EAAGqD,EAAKtQ,MAAOgE,IAC1B,EAEXsM,EAAKG,SAAWzM,EA72CxB,IAAoBhE,EA43CpB,MAAMmR,GAA6B,oBAAXlO,OAClBA,OACsB,oBAAfmO,WACHA,WACAC,OAgSV,SAASC,GAAKnR,EAAW4F,EAAM3F,GAC3B,MAAMoQ,EAAQrQ,EAAUE,GAAG6B,MAAM6D,QACnB7E,IAAVsP,IACArQ,EAAUE,GAAGkR,MAAMf,GAASpQ,EAC5BA,EAASD,EAAUE,GAAGK,IAAI8P,KAGlC,SAASgB,GAAiBhD,GACtBA,GAASA,EAAM7K,IAKnB,SAAS8N,GAAgBtR,EAAWmE,EAAQgB,EAAQoM,GAChD,MAAMhE,SAAEA,EAAQrB,SAAEA,EAAQ/L,WAAEA,EAAUsN,aAAEA,GAAiBzN,EAAUE,GACnEqN,GAAYA,EAASoD,EAAExM,EAAQgB,GAC1BoM,GAEDtE,IAAoB,KAChB,MAAMuE,EAAiBtF,EAASuF,IAAIhT,GAAK8M,OAAOtM,GAC5CkB,EACAA,EAAWC,QAAQoR,GAKnB1S,EAAQ0S,GAEZxR,EAAUE,GAAGgM,SAAW,MAGhCuB,EAAazO,QAAQiO,IAEzB,SAASyE,GAAkB1R,EAAW0F,GAClC,MAAMxF,EAAKF,EAAUE,GACD,OAAhBA,EAAGqN,WACHzO,EAAQoB,EAAGC,YACXD,EAAGqN,UAAYrN,EAAGqN,SAAS5H,EAAED,GAG7BxF,EAAGC,WAAaD,EAAGqN,SAAW,KAC9BrN,EAAGK,IAAM,IAWjB,SAASuP,GAAK9P,EAAWwG,EAASmL,EAAUC,EAAiBC,EAAW9P,EAAO+P,EAAejR,EAAQ,EAAE,IACpG,MAAMkR,EAAmBnI,GACzBkC,GAAsB9L,GACtB,MAAME,EAAKF,EAAUE,GAAK,CACtBqN,SAAU,KACVhN,IAAK,KAELwB,MAAAA,EACAsL,OAAQnP,EACR2T,UAAAA,EACAT,MAAOzS,IAEPuN,SAAU,GACV/L,WAAY,GACZ6R,cAAe,GACfxE,cAAe,GACfC,aAAc,GACdwE,QAAS,IAAIC,IAAIH,EAAmBA,EAAiB7R,GAAG+R,QAAUzL,EAAQyL,SAAW,IAErFxS,UAAWd,IACXkC,MAAAA,EACAsR,YAAY,EACZ3N,KAAMgC,EAAQrC,QAAU4N,EAAiB7R,GAAGsE,MAEhDsN,GAAiBA,EAAc5R,EAAGsE,MAClC,IAAI4N,GAAQ,EAkBZ,GAjBAlS,EAAGK,IAAMoR,EACHA,EAAS3R,EAAWwG,EAAQzE,OAAS,IAAI,CAACV,EAAGmB,KAAQL,KACnD,MAAMtC,EAAQsC,EAAKf,OAASe,EAAK,GAAKK,EAOtC,OANItC,EAAGK,KAAOsR,EAAU3R,EAAGK,IAAIc,GAAInB,EAAGK,IAAIc,GAAKxB,MACtCK,EAAGiS,YAAcjS,EAAGkR,MAAM/P,IAC3BnB,EAAGkR,MAAM/P,GAAGxB,GACZuS,GAxCpB,SAAoBpS,EAAWqB,IACI,IAA3BrB,EAAUE,GAAGW,MAAM,KACnByL,GAAiBlM,KAAKJ,GACtB6M,KACA7M,EAAUE,GAAGW,MAAMwR,KAAK,IAE5BrS,EAAUE,GAAGW,MAAOQ,EAAI,GAAM,IAAO,GAAMA,EAAI,GAmC/BiR,CAAWtS,EAAWqB,IAEvBmB,KAET,GACNtC,EAAGmN,SACH+E,GAAQ,EACRtT,EAAQoB,EAAGsN,eAEXtN,EAAGqN,WAAWqE,GAAkBA,EAAgB1R,EAAGK,KAC/CiG,EAAQrC,OAAQ,CAChB,GAAIqC,EAAQ+L,QAAS,CAEjB,MAAMC,EAhxClB,SAAkB1N,GACd,OAAO2N,MAAMC,KAAK5N,EAAQ6N,YA+wCJC,CAASpM,EAAQrC,QAE/BjE,EAAGqN,UAAYrN,EAAGqN,SAASsF,EAAEL,GAC7BA,EAAMxT,QAAQqG,QAIdnF,EAAGqN,UAAYrN,EAAGqN,SAAS/J,IAE3BgD,EAAQkJ,OACRtB,GAAcpO,EAAUE,GAAGqN,UAC/B+D,GAAgBtR,EAAWwG,EAAQrC,OAAQqC,EAAQrB,OAAQqB,EAAQ+K,eAEnExE,KAEJjB,GAAsBiG,GAkD1B,MAAMe,GACFC,WACIrB,GAAkB5K,KAAM,GACxBA,KAAKiM,SAAW7U,EAEpB8U,IAAI3J,EAAMpJ,GACN,MAAMR,EAAaqH,KAAK5G,GAAGT,UAAU4J,KAAUvC,KAAK5G,GAAGT,UAAU4J,GAAQ,IAEzE,OADA5J,EAAUW,KAAKH,GACR,KACH,MAAMoQ,EAAQ5Q,EAAUgM,QAAQxL,IACjB,IAAXoQ,GACA5Q,EAAUwT,OAAO5C,EAAO,IAGpC6C,KAAKC,GA/yDT,IAAkBC,EAgzDNtM,KAAKuM,QAhzDCD,EAgzDkBD,EA/yDG,IAA5BvU,OAAOsD,KAAKkR,GAAKhS,UAgzDhB0F,KAAK5G,GAAGiS,YAAa,EACrBrL,KAAKuM,MAAMF,GACXrM,KAAK5G,GAAGiS,YAAa,IC71D1B,MAAMmB,GACTC,cACIzM,KAAKjD,QAAU,IAAIC,SAAQ,CAAC6I,EAAS6G,KACjC1M,KAAK0M,OAASA,EACd1M,KAAK6F,QAAUA,MAIpB,MAAM8G,GAAwC,SAAvBC,UAAUC,UAA8C,aAAvBD,UAAUC,UAA2BD,UAAUE,eAAiB,EAClHC,GAAmB,SAASC,KAAKJ,UAAUK,YAAc,oBAAoBD,KAAKJ,UAAUK,WAC5FC,GAAc,YAAYF,KAAKJ,UAAUK,aAAgB,yBAAyBD,KAAKJ,UAAUK,WACjGE,GAAgBC,WAAW,kBAAkBC,QAEnD,SAASC,GAASC,EAAM3G,EAAM4G,GACjC,IAAIC,EACJ,OAAO,WACH,MAAMtC,EAAUnL,KAAM0N,EAAOC,UACvBC,EAAQ,WACVH,EAAU,KACLD,GAAWD,EAAKM,MAAM1C,EAASuC,IAElCI,EAAUN,IAAcC,EAC9BM,aAAaN,GACbA,EAAUO,WAAWJ,EAAOhH,GACxBkH,GAASP,EAAKM,MAAM1C,EAASuC,IAIlC,SAASO,GAAWxK,GACvB,MACM3E,EADI2E,EAAIc,MAAM,KACL1K,MAAM,GAAI,GAAGgL,KAAK,IACjC,OAAQ/F,GACJ,IAAK,QACD,MAAO,QACX,IAAK,YACD,MAAO,OACX,IAAK,MACD,MAAO,OACX,QACI,OAAOA,GAgBZ,SAASoP,GAAMC,EAAKC,EAAK/T,GAC5B,OAAO8T,GAAOC,EAAMA,EAAMD,GAAO9T,EAAMA,EAAM8T,EAG1C,SAASE,GAASF,EAAKC,EAAK/T,GAC/B,QAAO8T,EAAMC,MAAcD,EAAM9T,GAgBrC,SAASiU,GAAUhW,EAAGC,EAAGgW,EAAMC,GAC3B,OAAc,EAAPD,EAAW,CAACjW,EAAE,IAAMC,EAAE,GAAKD,EAAE,KAAOkW,EAAK,GAAKlW,EAAE,KAAOC,EAAE,GAAKD,EAAE,IAAKkW,EAAK,IACtE,EAAPD,EAAW,CAACjW,EAAE,IAAMC,EAAE,GAAKD,EAAE,KAAOkW,EAAK,GAAKlW,EAAE,KAAOC,EAAE,GAAKD,EAAE,IAAKkW,EAAK,IACnE,EAAPD,EAAW,CAACC,EAAK,GAAIlW,EAAE,IAAMC,EAAE,GAAKD,EAAE,KAAOkW,EAAK,GAAKlW,EAAE,KAAOC,EAAE,GAAKD,EAAE,KAClE,EAAPiW,EAAW,CAACC,EAAK,GAAIlW,EAAE,IAAMC,EAAE,GAAKD,EAAE,KAAOkW,EAAK,GAAKlW,EAAE,KAAOC,EAAE,GAAKD,EAAE,KAAO,KAUxF,SAASmW,GAAQ3T,EAAG0T,GAChB,IAAIE,EAAO,EAQX,OANI5T,EAAE,GAAK0T,EAAK,GAAIE,GAAQ,EACnB5T,EAAE,GAAK0T,EAAK,KAAIE,GAAQ,GAE7B5T,EAAE,GAAK0T,EAAK,GAAIE,GAAQ,EACnB5T,EAAE,GAAK0T,EAAK,KAAIE,GAAQ,GAE1BA,EAwDJ,SAASC,GAAeC,EAAI7R,GAE/B,IAAI0Q,EAAU,IAAIzQ,SAAQ,CAAC6I,EAAS6G,KAChC,IAAImC,EAAKb,YAAW,KAChBD,aAAac,GACbnC,EAAO,gBAAiBkC,EAAK,SAC9BA,MAGP,OAAO5R,QAAQ8R,KAAK,CAChB/R,EACA0Q,IAsDD,MAMMsB,GAAgB,CAACzW,EAAGC,KAC7B,IAAIyW,EAAK1W,EAAEiM,MAAM,KACb0K,EAAK1W,EAAEgM,MAAM,KACjB,IAAK,IAAIhK,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAI2U,EAAKC,OAAOH,EAAGzU,IACf6U,EAAKD,OAAOF,EAAG1U,IACnB,GAAI2U,EAAKE,EAAI,OAAO,EACpB,GAAIA,EAAKF,EAAI,OAAQ,EACrB,IAAKG,MAAMH,IAAOG,MAAMD,GAAK,OAAO,EACpC,GAAIC,MAAMH,KAAQG,MAAMD,GAAK,OAAQ,EAEzC,OAAO,GAGEE,GAAeC,UACxB,MAAMC,EAAY,CACdC,MAAS,UACTC,IAAO1T,OAAO2T,SAASC,UAE3B,UACUhD,UAAUiD,MAAML,GACxB,MAAMM,IAGR,OAAO,GAKEC,GAAe,CAACC,EAAaC,KACtC,IAAIzH,EAAQ,EAAGE,EAAMsH,EAAY1V,OAAS,EACtC4V,GAAO,EACX,KAAO1H,GAASE,GAChB,CACI,IAAIyH,EAAM/V,KAAKgW,OAAO5H,EAAQE,GAAO,GAChCuH,EAAUD,EAAYG,KAMvBD,EAAMC,EACNzH,EAAMyH,EAAM,GALZ3H,EAAQ2H,EAAM,EAQtB,OAAiB,IAATD,GAAeD,EAAUD,EAAYE,IAAcA,GAAJ,GClN3D,SAASG,GAAS9M,GACd,MAAM3G,EAAI2G,EAAI,EACd,OAAO3G,EAAIA,EAAIA,EAAI,ECrBvB,SAAS0T,GAAKhT,GAAM4F,MAAEA,EAAQ,EAACD,SAAEA,EAAW,IAAGkF,OAAEA,EAASoI,GAAW,IACjE,MAAM7I,GAAK8I,iBAAiBlT,GAAMmT,QAClC,MAAO,CACHvN,MAAAA,EACAD,SAAAA,EACAkF,OAAAA,EACAC,IAAK7E,GAAK,YAAYA,EAAImE,GAGlC,SAASgJ,GAAIpT,GAAM4F,MAAEA,EAAQ,EAACD,SAAEA,EAAW,IAAGkF,OAAEA,EAASkI,GAAQ/Y,EAAEA,EAAI,EAACqZ,EAAEA,EAAI,EAACF,QAAEA,EAAU,GAAM,IAC7F,MAAMxS,EAAQuS,iBAAiBlT,GACzBsT,GAAkB3S,EAAMwS,QACxBI,EAAgC,SAApB5S,EAAM4S,UAAuB,GAAK5S,EAAM4S,UACpDC,EAAKF,GAAkB,EAAIH,GACjC,MAAO,CACHvN,MAAAA,EACAD,SAAAA,EACAkF,OAAAA,EACAC,IAAK,CAAC7E,EAAGwN,IAAM,sBACPF,gBAAwB,EAAItN,GAAKjM,SAAS,EAAIiM,GAAKoN,yBACrDC,EAAkBE,EAAKC,KAGrC,SAASC,GAAM1T,GAAM4F,MAAEA,EAAQ,EAACD,SAAEA,EAAW,IAAGkF,OAAEA,EAASkI,IAAa,IACpE,MAAMpS,EAAQuS,iBAAiBlT,GACzBmT,GAAWxS,EAAMwS,QACjBQ,EAASC,WAAWjT,EAAMgT,QAC1BE,EAAcD,WAAWjT,EAAMmT,YAC/BC,EAAiBH,WAAWjT,EAAMqT,eAClCC,EAAaL,WAAWjT,EAAMuT,WAC9BC,EAAgBP,WAAWjT,EAAMyT,cACjCC,EAAmBT,WAAWjT,EAAM2T,gBACpCC,EAAsBX,WAAWjT,EAAM6T,mBAC7C,MAAO,CACH5O,MAAAA,EACAD,SAAAA,EACAkF,OAAAA,EACAC,IAAK7E,GACD,6BAAYnJ,KAAKgU,IAAQ,GAAJ7K,EAAQ,GAAKkN,aACvBlN,EAAI0N,oBACC1N,EAAI4N,uBACD5N,EAAI8N,mBACR9N,EAAIgO,sBACDhO,EAAIkO,yBACDlO,EAAIoO,4BACDpO,EAAIsO,QCpFxC,MAAME,GAAmB,GAMzB,SAASC,GAASjZ,EAAOyP,GACrB,MAAO,CACH/P,UAAWwZ,GAASlZ,EAAOyP,GAAO/P,WAQ1C,SAASwZ,GAASlZ,EAAOyP,EAAQpR,GAC7B,IAAI8a,EACJ,MAAMC,EAAc,IAAI7W,IACxB,SAASK,EAAIyW,GACT,GAAI/Z,EAAeU,EAAOqZ,KACtBrZ,EAAQqZ,EACJF,GAAM,CACN,MAAMG,GAAaN,GAAiBzX,OACpC,IAAK,MAAMgY,KAAcH,EACrBG,EAAW,KACXP,GAAiBzY,KAAKgZ,EAAYvZ,GAEtC,GAAIsZ,EAAW,CACX,IAAK,IAAI9X,EAAI,EAAGA,EAAIwX,GAAiBzX,OAAQC,GAAK,EAC9CwX,GAAiBxX,GAAG,GAAGwX,GAAiBxX,EAAI,IAEhDwX,GAAiBzX,OAAS,IAuB1C,MAAO,CAAEqB,IAAAA,EAAK4K,OAlBd,SAAgB3O,GACZ+D,EAAI/D,EAAGmB,KAiBWN,UAftB,SAAmBd,EAAK8Q,EAAarR,GACjC,MAAMkb,EAAa,CAAC3a,EAAK8Q,GAMzB,OALA0J,EAAYjV,IAAIoV,GACS,IAArBH,EAAYtV,OACZqV,EAAO1J,EAAM7M,IAAQvE,GAEzBO,EAAIoB,GACG,KACHoZ,EAAYxV,OAAO2V,GACM,IAArBH,EAAYtV,OACZqV,IACAA,EAAO,SAMvB,SAASK,GAAQC,EAAQ5a,EAAI6a,GACzB,MAAMC,GAAU/G,MAAMgH,QAAQH,GACxBI,EAAeF,EACf,CAACF,GACDA,EACAK,EAAOjb,EAAG0C,OAAS,EACzB,OAAO0X,GAASS,GAAgB9W,IAC5B,IAAImX,GAAS,EACb,MAAMC,EAAS,GACf,IAAI9I,EAAU,EACVhC,EAAU7Q,EACd,MAAM4b,EAAO,KACT,GAAI/I,EACA,OAEJhC,IACA,MAAM/M,EAAStD,EAAG8a,EAASK,EAAO,GAAKA,EAAQpX,GAC3CkX,EACAlX,EAAIT,GAGJ+M,EAAU9P,EAAY+C,GAAUA,EAAS9D,GAG3C6b,EAAgBL,EAAajI,KAAI,CAACjS,EAAO6B,IAAM9B,EAAUC,GAAQK,IACnEga,EAAOxY,GAAKxB,EACZkR,KAAa,GAAK1P,GACduY,GACAE,OAEL,KACC/I,GAAY,GAAK1P,OAIrB,OAFAuY,GAAS,EACTE,IACO,WACHhb,EAAQib,GACRhL,QCjGL,MAAMiL,GAAgB,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACrGC,GAA8B,CAAC,MAAO,OCa5C,MAAMC,GAAKnB,KACLoB,GAAYpB,IAAS,GACrBqB,GAAYrB,IAAS,GACrBsB,GAActB,IAAS,GACvBuB,GAAUvB,IAAS,GACnBwB,GAAYxB,IAAS,GAErByB,GAAazB,IAAS,GACtB0B,GAlBN,SAAmBC,GACtB,MAAMnb,UAAEA,EAASkD,IAAEA,EAAG4K,OAAEA,GAAW0L,GAAS2B,GAC5C,MAAO,CACHnb,UAAAA,EACAkD,IAAAA,EACA4K,OAAAA,EACAsN,MAAO,IAAMlY,EAA2B,iBAAfiY,EAA2B,IAAIA,GAAcjI,MAAMgH,QAAQiB,GAAc,IAAIA,GAAcA,IAY9FE,EAAU,GAE3BC,GAAW9B,IAAU,GACrB+B,GAAM/B,KACNgC,GAAYhC,KACZiC,GAAcjC,KACdkC,GAAc5B,GAAQ,CAACyB,GAAKE,KAAc,EAAEE,EAAMC,MAC3D,GAAID,GAAQC,EAAc,CACtB,GAAID,EAAKE,WAAWha,OAAS,EACzB,OAAO,IAAI6B,KAAKkY,EAAaE,UAAa,IAAQH,EAAKE,WAAWF,EAAKE,WAAWha,OAAS,GAAG,IAGlG,OADgB,IAAI6B,KAAKkY,EAAaE,UAAoC,IAAxBH,EAAKI,MAAMC,gBAOxDC,GAAuBzC,KACvB0C,GAAepC,GAAQ,CAACyB,GAAKU,KAAuB,EAAEN,EAAMQ,MACrE,IAAIC,EAMJ,GALID,EACAC,EAAWD,EACLR,IACNS,EAAWT,EAAKI,MAAMG,cAErBE,IAAiD,IAArC3B,GAAcvO,QAAQkQ,GACvC,OAAOA,KAGX,IAAIC,GAAmB,IAAI3Y,KACpB,MAAM4Y,GAAgB,KACzB,GAAI,kBAAmBnI,UAAW,CAE9B,MAAMa,EAAyD,KAC1D,IAAItR,KAAS2Y,GAAoBrH,GAClCb,UAAUoI,cAAcC,kBAAkBjP,MAAKkP,IACvCA,IACKA,EAAIC,SAIL7B,GAAU3X,KAAI,GACd4X,GAAY5X,KAAI,IAJhBuZ,EAAI3O,SAMR8M,GAAU1X,KAAI,GACdmZ,GAAmB,IAAI3Y,QAE5BiZ,QAAQlT,SAKVmT,GAA4B,KACjC5X,UAAYA,SAAS6X,iBAAgD,YAA7B7X,SAAS6X,iBACjDP,MAGKQ,GAAUvD,IAAS,GAAMrW,IAClC,MAAM6Z,EAAqB,KACnB/X,UAAYA,SAAS6X,gBACY,YAA7B7X,SAAS6X,gBAET3Z,GAAI,GAGJA,GAAI,GAIRA,GAAI,IAKZ,OAFA8B,SAASkC,iBAAiB,mBAAoB6V,GAC9CA,IACO,KACH/X,SAASmC,oBAAoB,mBAAoB4V,OAI5CC,GAASzD,GAAS,IAAIrW,IAC/B,MAAM+Z,EAAwB,KAC1B/Z,EAAIiR,UAAU+I,SAclB,MAV0B,oBAAd/I,WACR,WAAYA,WAEZ8I,IACA1Z,OAAO2D,iBAAiB,UAAW+V,GACnC1Z,OAAO2D,iBAAiB,SAAU+V,IAElC/Z,OAAI1B,GAGD,KAEuB,oBAAd2S,WACR,WAAYA,YAEZ5Q,OAAO4D,oBAAoB,UAAW8V,GACtC1Z,OAAO4D,oBAAoB,SAAU8V,QAKpCE,GAAQ5D,GAAS,KAAKrW,IAC/B,MAAMka,EAAa,KACf,MAAMC,EAAOrY,SAASqE,cAAe,uBAC/BiU,EAAc,EAASD,EAAK1V,aAAc,WAAc,GAC9D,IAAIwV,EAAQ5Z,OAAO2T,SAASjM,KAAKsS,OAAO,IAAM,IAChC,SAAVJ,GACApC,GAAQ7X,KAAI,GACRoa,GAAaD,EAAKzV,aAAa,UAAW0V,EAAc,qBAExDA,GAAaD,EAAKzV,aAAa,UAAW0V,EAAYE,QAAQ,mBAAoB,KAE1Fta,EAAIia,GACJb,MAKJ,OAHAc,IACA7Z,OAAO2D,iBAAiB,aAAckW,GAE/B,KACH7Z,OAAO4D,oBAAoB,aAAciW,OAIpCK,GAAiB3D,GAC1B,CAACyB,GAAKD,GAAUG,GAAaP,GAAgB4B,KAC7C,EAAEnB,EAAM+B,EAAW9B,EAAc+B,EAAiBC,GAAW1a,KAEzD,IAAI2a,EACJ,MAAMC,EAAY,EAAoB,IAAY,IAElD,GAAGnC,GAAQC,EAAa,CACpB,MAAMmC,EAAYzd,IACVA,EAAQ,IACR4C,EAAI5C,IAEJ4C,EAAI,KACJ8a,cAAcH,GACdA,OAAWrc,EAEX8Z,GAASpY,KAAK,KAItB,GAAIwa,GAAa,EAAG,CAEhB,IAAIpd,EAAQod,EACZG,EAAWI,aAAY,KACnBF,EAASzd,GACTA,MAnBe,SAqBhB,CACH,MAAM4d,EAAUtC,EACVuC,EAAU,IAAIza,KAAKwa,EAAQpC,UAAoC,IAAxBH,EAAKI,MAAMC,YAClDoC,EAAkB,KACpB,IAAI5a,EAAM,IAAIE,KACd,OAAIF,GAAO0a,EACA,EACA1a,GAAO2a,EACN,KAEA3a,EAAM0a,IAAoC,GAAxBvC,EAAKI,MAAMC,YAAmB,IAG1DqC,EAAMD,IACRC,EAAM,KACFT,IACAC,EAAWI,aAAY,KACnB,MAAM3d,EAAQ8d,IACdL,EAASzd,KACVwd,IAEP5a,EAAImb,IAEJnb,EAAI,WAKZA,EAAI,GAGR,MAAO,KACC2a,GAAUG,cAAcH,MAIpC,GAESS,GAAWxE,GAAQ,CAACyB,GAAKkC,KAAiB,EAAE9B,EAAM4C,MAC3D,IAAK5C,EAAM,MAAO,CAAEzJ,IAAK,CAACsM,SAAU,EAAGC,UAAW,GAAIC,OAAQH,EAAiBI,GAAI,IAAKC,QAAS,GACjG,MAAM/C,EAAaF,EAAKE,WAClBgD,EAAiBlD,EAAKkD,eACtBC,EAAaD,EAAe,GAAG,GAC/BE,EAAYF,EAAeA,EAAehd,OAAS,GAAG,GACtDmd,EAAgBH,EAAeA,EAAehd,OAAS,GAAG,GAC1Dod,EAAiC,IAAtBpD,EAAWha,OAAgBga,EAAW,GAAG,GAAKgD,EAAe,GAAG,GAC3EK,EAAgC,IAAtBrD,EAAWha,OAAgBga,EAAWA,EAAWha,OAAS,GAAG,GAAKgd,EAAeA,EAAehd,OAAS,GAAG,GAEtHsd,EAAWZ,GADwB,IAAtB1C,EAAWha,OAAgBga,EAAWA,EAAWha,OAAS,GAAG,GAAK8Z,EAAKI,MAAMC,YAChD,IAChD,GAAIuC,GAAmB,EAAG,MAAO,CAACrM,IAAK4M,EAAYJ,OAAQ,EAAGC,GAAIM,EAASL,QAASO,GACpF,GAAIZ,GAAmB,IAAK,MAAO,CAACrM,IAAK6M,EAAWL,OAAQ,IAAKC,GAAIO,EAAQN,QAASO,GAEtF,GAA0B,IAAtBtD,EAAWha,OAAc,CACzB,MAAMC,EAAIwV,GAAauE,GAAYhc,GAAKA,EAAE,IAAMsf,KACzC9c,EAAG+c,EAAKT,GAAM9C,EAAW/Z,GAChC,GAAIqd,EAAUC,GAAQ,EAClB,MAAO,CACHR,QAASO,EACTjN,IAAK7P,EACLqc,OAAQ,IAAMG,EAAe/c,GAAG,GAAKkd,EACrCL,GAAAA,GAGR,MAAM9S,EAAWgQ,EAAW/Z,EAAI,GAChC,GAAI+J,EAAU,CACV,MAAMwT,EAAgBR,EAAe/c,GAAG,GAAK+c,EAAe/c,EAAI,GAAG,GAC7Dwd,GAAYF,EAAMD,IAAYC,EAAMvT,EAAS,IACnD,MAAO,CACH+S,QAASO,EACTjN,IAAK7P,EAAEkd,WAAW1T,EAAS,GAAIyT,EAAUD,GACzCX,OAAQ,KAAQG,EAAe/c,GAAG,GAAMwd,EAAWD,GAAmBL,EACtEL,GAAI9S,EAAS,IAGrB,MAAO,CACH+S,QAASO,EACTjN,IAAK4M,EACLJ,OAAQ,EACRC,GAAIM,GAEL,GAA6B,IAA1BJ,EAAehd,OAAa,CAClC,MACM2d,EAAejB,EADCM,EAAeA,EAAehd,OAAS,GAAG,GACR,IAClDC,EAAIwV,GAAauH,GAAgBhf,GAAKA,EAAE,IAAM2f,KAC7Cnd,EAAG+c,EAAKT,GAAME,EAAe/c,GACpC,GAAI0d,EAAcJ,GAAQ,EAAG,MAAO,CAChClN,IAAK7P,EACLqc,OAAQH,EACRI,GAAAA,EACAC,QAASO,GAEb,MAAMtT,EAAWgT,EAAe/c,EAAI,GACpC,GAAI+J,EAAU,CACV,MAAMwT,EAAgBD,EAAMvT,EAAS,GACrC,MAAO,CACHqG,IAAK7P,EAAEkd,WAAW1T,EAAS,IAAKuT,EAAMI,GAAeH,EAAeA,GACpEX,OAAQH,EACRI,GAAI9S,EAAS,GACb+S,QAASO,GAGjB,MAAO,CACHjN,IAAK4M,EACLJ,OAAQ,EACRC,GAAIM,EACJL,QAASO,GAGjB,MAAO,CACHjN,IAAK6M,EACLL,OAAQ,IACRC,GAAIO,EACJN,QAASO,KAGd,CAAEjN,IAAK,CAACsM,SAAU,EAAGC,UAAW,GAAIC,OAAQ,EAAGC,GAAI,IAAKC,QAAS,4DCrOjC5d,2CAA/B2E,uCAA+B3E,sMAcf2E,2BAAmD3E,uNAFnD2E,2BAAmD3E,sJAcvD2E,kDPsjChB,SAA+Bd,EAAM1F,EAAIiQ,GACrC,IAEIC,EAFAC,EAASnQ,EAAG0F,EAAMuK,GAClBG,GAAU,EAEd,MAAMmB,EAAQjC,GAEd,SAASgB,IACL,MAAMhF,MAAEA,EAAQ,EAACD,SAAEA,EAAW,IAAGkF,OAAEA,EAAS9Q,EAAQ6O,KAAEA,EAAO9O,EAAIgR,IAAEA,GAAQL,GAAUJ,GACjFS,IACAN,EAAiB9E,GAAY1F,EAAM,EAAG,EAAG2F,EAAUC,EAAOiF,EAAQC,IACtE,MAAMC,EAAapM,IAAQiH,EACrBoF,EAAWD,EAAapF,EAC9BkD,IAAoB,IAAMU,GAASvJ,GAAM,EAAO,WAChDR,GAAKb,IACD,GAAI+L,EAAS,CACT,GAAI/L,GAAOqM,EAQP,OAPApC,EAAK,EAAG,GACRW,GAASvJ,GAAM,EAAO,SACf6L,EAAM/B,GAGTpP,EAAQmR,EAAMzM,IAEX,EAEX,GAAIT,GAAOoM,EAAY,CACnB,MAAM9E,EAAI4E,GAAQlM,EAAMoM,GAAcpF,GACtCiD,EAAK,EAAI3C,EAAGA,IAGpB,OAAOyE,KAaf,OAtCAmB,EAAM/B,GAAK,EA4BPjP,EAAY4P,GACZnB,KAAOZ,MAAK,KAER+B,EAASA,IACTG,OAIJA,IAEG,CACHQ,IAAImL,GACIA,GAAS9L,EAAO7B,MAChB6B,EAAO7B,KAAK,EAAG,GAEf8B,IACIF,GACAzD,GAAY/G,EAAMwK,GACtBE,GAAU,qGOpoCR,MAAbvO,mBAYgBkT,eAORA,kRACDvO,8BAMK3E,2ZADoBA,+TAtBrC2E,SACIhB,OACIA,cACAA,OACIA,cAIAA,gDAcJA,mDAzBU,MAAb3D,gFA0BYA,oMAvFTye,IAAiB,KACjBtL,UAAUuL,gBAENvL,UAAUuL,YAAYC,OAAOtZ,KAAM,oBAAoBkH,MAAM9K,IACrC,WAAhBA,EAAOmd,OAAsC,UAAhBnd,EAAOmd,QACpCH,IAAiB,YAGtBpI,uDAUPwI,EADAC,EAAY,WAEVC,EAAepE,EAAQA,EAAKoE,WAAU,GAAO3T,KAAK,KAAO,OAE3D4T,EADAC,GAAS,SAqCbrT,SACQoT,GAAS1K,aAAa0K,eApCf/V,UACLiW,iBAWczZ,OAChByZ,GAAU,KACVT,GACAtL,UAAUgM,UAAUC,UAAU3Z,GAAM8G,UAAW2S,GAAU,QAAYA,GAAU,aAG/EJ,EAAYrZ,SACNgH,KACNoS,EAAQQ,QACRR,EAAQ9W,aAEJmX,EAAUlb,SAASsb,YAAY,cAI1BjJ,GACL6I,GAAU,MAGdJ,EAAY,aAETI,EAhCSK,CAASR,GACpB7L,SACD+L,EAASC,GACTF,EAAUzK,2BACN0K,GAAS,GACLD,GAAS1K,aAAa0K,KAC3B,KACH/V,EAAE5C,4DAgCWwY,kFC7DlB,MAAMW,GAA0B,CACrCC,cAAgB,EAChBC,SAAY,EACZC,WAAc,WACdC,kBAAoB,EACpBC,aAAgB,EAChBC,eAAkB,WAClBC,YAAc,EACdC,OAAU,EACVC,SAAY,WACZC,oBAAsB,EACtBC,iBAAoB,YAGtB,SAASC,GAAUC,EAAQC,GACzBD,EAAOE,WACL,CAAClb,KAAQ,cAAemb,QAAWF,EAAWJ,mBAAoBO,MAASH,EAAWH,kBAEtF,CACI9a,KAAQ,OACRmb,QAAWF,EAAWV,iBACtBa,MAASH,EAAWR,eACpBY,MAASJ,EAAWT,cAExB,CAACxa,KAAQ,QAASob,MAASH,EAAWX,WAAYe,MAASJ,EAAWZ,UACtE,CAACra,KAAQ,OAAQmb,QAAWF,EAAWP,WAAYU,MAASH,EAAWL,SAAUS,MAASJ,EAAWN,QACrG,CACI3a,KAAQ,kBACRmb,QAAWF,EAAWP,WACtBU,MAASH,EAAWK,mBACpBD,MAASJ,EAAWN,SAQrB,MAAMY,GAAe,KACpBre,OAAgB,SACpBA,OAAe,OAAI,IAAIse,UAAUC,aACjCV,GAAS7d,OAAe,OAAGid,KAEtBjd,OAAe,QAIjB,SAASwe,GAAU1b,EAAM/F,GAC9B,GAAI+F,EAAK2b,WAAW,WACf3b,EAAK2b,WAAW,aAChB3b,EAAK2b,WAAW,SAChB3b,EAAK4b,SAAS,YACL,yBAAT5b,GACS,qBAATA,GACAA,EAAK2b,WAAW,WAAY,OACjC,MAAMX,EAASO,KACTM,EAAS1M,GAAWnP,GACtBA,EAAK4b,SAAS,YACdZ,EAAOc,kBAAkBD,EAAQ5hB,GAC3B+F,EAAK4b,SAAS,QACpBZ,EAAOe,gBAAgBF,EAAQ5hB,GACzB+F,EAAK4b,SAAS,WACpBZ,EAAOgB,kBAAkBH,EAAQ5hB,EAAMgiB,6GCyBkBthB,MAAOuhB,qDAA9CvhB,qCAAkBA,QAAUA,aAA5C2E,oCAAkC3E,QAAUA,+FADrCiG,wBAALpF,qQALiE,IAAbb,KAAkB,OAAQiG,GAAQjG,MAAUygB,kBAAgBxa,GAAQjG,MAAUygB,4DAIzHzgB,0CAAsBA,+DAMUwhB,GAAYxhB,sGADtByhB,GAAYzhB,KAAO,wCAZ5D2E,SACIhB,OACIA,OACIA,cAIRA,sDAAqC3D,aAKrC2D,OACIA,OACIA,WAAmB3D,KAAO,WAE9B2D,WAAmB3D,KAAO,yFAHCA,mEAbaA,6CAG2B,IAAbA,KAAkB,OAAQiG,GAAQjG,MAAUygB,uBAAgBxa,GAAQjG,MAAUygB,wBAK7Hxa,WAALpF,+HAAAA,gBAD+Bb,eAOVA,KAAO,gBADawhB,GAAYxhB,+DAA5BA,eAGRA,KAAO,gBAJOyhB,GAAYzhB,KAAO,6DAZZA,qDA/E/B0hB,GAAW,iBAYXC,GAAgBC,QACpBC,EAAKC,GAASC,GAAWH,UACtBC,EAAKC,EAAQ,MAEZE,IAAiB,UAAW,KAC5BD,GAAcH,cAEbE,EAAQG,SAASL,EAAExhB,MAAM,EAAE,GAAI,WACzB,IAAMwhB,EAAExhB,MAAM,EAAE,GAAKwhB,EAAExhB,MAAM,EAAE,GAAKwhB,EAAExhB,MAAM,EAAE,GAC7C0hB,SACVzL,UAEI2L,KAGFP,GAAeI,UACjBlU,EAAGuU,EAAGpjB,IAAM+iB,EAAIzhB,MAAM,EAAG,GAAIyhB,EAAIzhB,MAAM,EAAG,GAAIyhB,EAAIzhB,MAAM,EAAG,IAAI8Q,KAAK0Q,GAAMK,SAASL,EAAG,4BACtEjU,qBAAqBuU,oBAAoBpjB,MAEvD0iB,GAAeW,wBACIA,EAAO,gBAAgBA,EAAO,GAAG,MAE3Dlc,KACDsb,MAAO,eAAgBd,MAAO,YAC9Bc,MAAO,OAAQd,MAAO,YACtBc,MAAO,QAASd,MAAO,YACvBc,MAAO,oCAAqCd,MAAO,YACnDc,MAAO,SAAUd,MAAM,YACvBc,MAAO,4BAA6Bd,MAAO,YAC3Cc,MAAO,QAASd,MAAO,YACvBc,MAAO,OAAQd,MAAO,YACtBc,MAAO,SAAUd,MAAO,qCAKvBrT,EAAWvB,kBACNuW,EAAW,wBACXla,EAAW,WACX7C,WACLgd,EAAYhd,EAAO,SACnBid,EAAUjd,EAAO,WAEnB8c,EAASH,SAEPO,EAAyC1O,GAASzG,EAHlC,2IAIEvJ,UAEhBiJ,OAAOqV,SACIN,EAAKC,GAASK,MAErBC,GAAYN,EAAMU,SAAS,IAAMX,EAAIzhB,MAAM,EAAE,GAAKyhB,EAAIzhB,MAAM,EAAE,GAAKyhB,EAAIzhB,MAAM,EAAG,IAAIkhB,eACpFiB,EAAiB,UAAWld,KAAQgd,EAAW/iB,MAAS8iB,gBAI9Cve,cAClBse,EAASJ,GAAWK,KAEhBtV,OAAOsV,OACHD,EAASJ,GAAWK,IACpBG,EAAiB,UAAWld,KAAQgd,EAAW/iB,MAAS8iB,EAASd,gCAaxCpZ,kBAA0Ce,IAAOA,EAAErF,OAAO6e,OAAQrV,EAAS,UAAW/H,KAAMid,EAAShjB,MAAS4I,gBAOxHia,EAAO,iCAEXA,EAAO,wHC/F3B,MAAMO,GAAoB,CAC7BjD,cAAgB,EAChBE,WAAc,WACdC,kBAAoB,EACpBE,eAAkB,WAClBC,YAAc,EACd4C,eAAkB,EAClB1C,SAAY,WACZU,mBAAsB,WACtBT,oBAAsB,EACtBC,iBAAoB,WACpByC,eAAiB,EACjBC,YAAe,WACfC,gBAAkB,EAClBC,WAAc,EACdC,aAAgB,EAChBC,YAAc,EACdC,cAAgB,EAChBC,WAAc,WACdC,eAAkB,MAClBC,gBAAmB,MACnBC,eAAkB,OA8Bf,MAAMvK,GAAS1a,OAAOklB,OAAO,CAChCC,WAAc,aACdC,SAAY,WACZC,aAAgB,eAChBC,UAAa,YACbC,SAAY,WACZC,kBAAqB,sBAGZC,GAAU,IApCvB,MACI9Q,eACA+Q,QAAQ7c,GACJ,MAAM5H,EAAQ0kB,aAAaD,QAAQ7c,GACnC,GAAc,OAAV5H,EACA,IACI,OAAO2kB,KAAKC,MAAM5kB,GACpB,MAAO+W,GACL9P,KAAK4d,WAAWjd,GAIxB,OAAO,KAEXkd,QAAQld,EAAK5H,GACT,MAAM+kB,EAASJ,KAAKK,UAAUhlB,GACf,OAAX+kB,GACAL,aAAaI,QAAQld,EAAKmd,GAGlCF,WAAWjd,GACP8c,aAAaG,WAAWjd,GAE5Bqd,QAAQrd,GACJ,OAAqC,OAA9B8c,aAAaD,QAAQ7c,KAcvBsd,GAAW,CAACve,EAASwe,EAAe/B,MAC7C,MAAMgC,EAAY,GAClB,IAAK,IAAKxd,EAAK5H,KAAUjB,OAAOsmB,QAAQ1e,GAChCiB,KAAOud,IACHvd,EAAI+Z,SAAS,QACb3hB,GAAS,EACJsW,MAAMtW,KACPolB,EAAUxd,GAAO5H,IAEd4H,EAAI+Z,SAAS,UAAY3hB,EAAMslB,MAAMlD,IAC5CgD,EAAUxd,GAAO5H,EAAMgiB,cAChBpa,EAAI+Z,SAAS,WACpByD,EAAUxd,OACHA,EAAI+Z,SAAS,YACpB3hB,GAAS,EACJsW,MAAMtW,KACPolB,EAAUxd,GAAO5H,EAAMulB,QAAQ,MAK/C,MAAO,IAAIJ,KAAmBC,IAIrBI,GAAa,CAACxE,EAAYnE,EAAO9W,EAAK,iBAC/C,MAAMY,EAAU,GACV8e,EAAiB,CAAC,aAAc,WAAY,gBAClD,IAAK,MAAO7d,EAAKjI,KAAUZ,OAAOsmB,QAAQ5L,IAAS,CAC/C,IAAKgM,EAAeC,SAAS/lB,GAAQ,SACrC,IAAIK,EAAQwkB,GAAQC,QAAQ9kB,GAC5B,GAAIiI,IAAQ6R,GAAOyK,YAAclD,EAAY,CACzC,MAAM2E,EAAO,GACb,IAAK,MAAM/d,KAAO7I,OAAOsD,KAAK2e,GAAYtV,QAAO/M,GAAKqiB,EAAWriB,KAAOykB,GAAkBzkB,KACtFgnB,EAAK/d,GAAOoZ,EAAWpZ,GAE3B5H,EAAQ2lB,EAEZ,GAAc,OAAV3lB,EACA,GAAI4H,IAAQ6R,GAAOyK,WACf,IAAK,MAAMvlB,EAAG2jB,KAAMvjB,OAAOsmB,QAAQrlB,GAC/B2G,EAAQhI,GAAK2jB,OAGjB3b,EAAQiB,GAAO5H,EAI3B,MAAMqf,EAAQtgB,OAAOsmB,QAAQ1e,GACxBiL,KAAI,EAAEjT,EAAG2jB,KAAO,GAAGsD,mBAAmBjnB,MAAMinB,mBAAmBtD,OAC/DxW,KAAK,KACJ+Z,EACF5iB,OAAO2T,SAASkP,OAChB7iB,OAAO2T,SAASC,UACfwI,EAAQ,IAAMA,EAAQ,IACvB,IAAMxC,EACV5Z,OAAO8iB,QAAQC,aAAarf,EAASZ,EAAM8f,8HCrEI,wKAAvBnlB,gKAJ5B2E,SACIhB,cACAA,WAAmF3D,aACnF2D,OACAA,oDAF4G3D,kBAErEA,sCAF4CA,UAAAA,sBAE3DA,kGA3ClBulB,GAAe,iEAFfnY,EAAWvB,KACX5M,EAAQ8Z,GAAO0K,aAIjBxN,EAFAuP,EAAe1B,GAAQC,QAAQ9kB,IAAUsmB,SAGvCxG,EAAepE,EAAQA,EAAKoE,WAAU,GAAO3T,KAAK,KAAO,6CAF5Dqa,IAAaD,EAAaE,QAAUxS,sBAGxBjK,SACL5D,EAAOmgB,EAAaE,UACtBrgB,GAAQ6N,UACFmN,EAASO,KACT/N,GACWkM,UAAAA,EACb4G,IAAOtF,EAAOuF,SACdC,UAAaxF,EAAOuF,QAChBE,SAAYjF,UAAUkF,eACtBC,cAAiBnF,UAAUoF,oBAC3BC,aAAgBrF,UAAUsF,mBAC1BC,MAASvF,UAAUwF,cAEvBC,eAAkBjG,EAAOuF,QACrBI,cAAiBnF,UAAU0F,2BAE/BC,eAAkB7L,EAAK8L,WAAWC,cAEtCzQ,EAAM,iCAAmCiP,mBAAmB7f,GAAQ,oBAAsB6f,mBAAmBjB,KAAKK,UAAUzR,UAE5H5J,EAAE5C,mCAIAhB,EAAOmgB,EAAaE,OACtBrgB,IAASkgB,GACTzB,GAAQK,WAAWllB,GAEnB6kB,GAAQM,QAAQnlB,EAAOoG,GAE3B+H,EAAS,QAASnO,EAAOoG,gBAMsDmgB,wFCjDxE,SAASmB,GAAW9iB,GAS/B,MAAM+iB,EAAyB,KACvB5iB,UAAYA,SAAS6X,iBAAgD,YAA7B7X,SAAS6X,iBAC9ChY,GAAQA,EAAK4e,MAAM5e,EAAK4e,QAKnC,OAFAze,SAASkC,iBAAiB,mBAAoB0gB,GAAwB,GAE/D,CACHvkB,UAGI2B,SAASmC,oBAAoB,mBAAoBygB,8DCoEV3gB,GAAQ,QACRA,GAAQ,QACRA,GAAQ,uIAISjG,mBANjC,IAAbA,eAAwB,iCACX,IAAbA,eAAwB,iCACX,IAAbA,eAAwB,uDAHYA,qFAApCA,0EAOIA,iBAAgBA,qGAT1C2E,SAEEhB,OACEA,cACAA,cACAA,kBAHkB3D,aAKpB2D,OAEEA,6DAPyH3D,qCAOpEA,mCANtB,IAAbA,kCACa,IAAbA,kCACa,IAAbA,uDAHoCA,gDAApCA,eAO8CA,0BAA1CA,sBAAgBA,yDA7FhCiG,IAAW,aAAc,aAAc,oBACvC4gB,IAAgB,WAAY,YAAa,qCAOzCzZ,EAAWvB,eAEN0V,WACLtiB,EAAQ8Z,GAAO2K,iBAEjBxb,EAAW4b,GAAQC,QAAQ9kB,IADV,EAEG,iBAAbiJ,IAAuBA,EAAW+Z,SAAS/Z,EAAU,MAC5DA,EAAW,GAAKA,GAAYjC,GAAQpF,UAAQqH,EAAW,OAGvD4e,EAFA7Q,EAAM,GACN8Q,EAAW,SAETC,EAAe1nB,IACjBwnB,EAAQtiB,MAAMqD,YAAY,mBAAoBgf,GAAa3e,QAEzD+e,GAAWvhB,EAAMoD,EAAK,gDAClBoe,MAAWC,KAAMzhB,GAAQoD,KAAAA,WACxBse,IAAIC,gBAAgBH,WAoD/Bxb,SACIsb,SAEQ/Q,GAAOA,EAAI+K,WAAW,UAAUoG,IAAIE,gBAAgBrR,oEApDrChN,SACjBoX,EAASO,KAET2G,GADc,cAAe,cAAe,oBACrBrf,OACzB8B,EAAMqW,EAAOhb,QACZ2E,GAIDA,EAAMA,EAAI0b,WACVqB,EAAW/c,EAAIwS,QAAQ,SAAU,KAAKA,QAAQ,KAAM,IAAM+K,QAH1DR,EAAW,YAAcQ,GAKzBtR,GAAOA,EAAI+K,WAAW,UAAUoG,IAAIE,gBAAgBrR,GACvC,IAAb/N,MACA+N,EAAMgR,GAAS5G,EAAOuF,oBACF,IAAb1d,MACP+N,EAAMgR,GAAS5G,EAAOuF,QAClBE,SAAYjF,UAAUkF,eACtBC,cAAiBnF,UAAUoF,oBAC3BC,aAAgBrF,UAAUsF,mBAC1BC,MAASvF,UAAUwF,yBAEH,IAAbne,SAKPe,EAAE5C,kBACK,MALP4P,EAAMgR,GAAS5G,EAAOuF,QAClBI,cAAiBnF,UAAU0F,yCAezBtd,GACVA,EAAErF,OAAO6e,OAvDQ,IAwDbva,EACA4b,GAAQK,WAAWllB,GAEnB6kB,GAAQM,QAAQnlB,EAAOiJ,GAE3BkF,EAAS,QAASnO,EAAOiJ,IACzB8e,gBAYc9e,2DAFN4e,0NC/CmH,yLAAjE9mB,gBAAuBA,sCAAxEA,oEAEkCwhB,GAAYxhB,sGADtByhB,GAAYzhB,KAAO,uDAF5D2E,SACIhB,OAAgDA,6BAChDA,OACIA,OACIA,WAAmB3D,KAAO,WAE9B2D,WAAmB3D,KAAO,2EAHCA,mEAH4BA,8CAC0BA,kFAG1DA,KAAO,qBADawhB,GAAYxhB,gEAA5BA,eAGRA,KAAO,qBAJOyhB,GAAYzhB,KAAO,8DAFGA,4IA9BrDoN,EAAWvB,kBACNuW,EAAW,uBACXoF,WACAniB,WACLgd,EAAYhd,EAAO,SACnBoiB,EAAcpiB,EAAO,eAEvB8c,EAASH,SACPO,EAAyC1O,GAASzG,EAFlC,uKAGEvJ,UAEhBiJ,OAAOqV,SACIN,EAAKC,GAASK,MAErBC,GAAYN,EAAMU,SAAS,IAAMX,EAAIzhB,MAAM,EAAE,GAAKyhB,EAAIzhB,MAAM,EAAE,GAAKyhB,EAAIzhB,MAAM,EAAG,IAAIkhB,eACpFiB,EAAiB,UAAWld,KAAQgd,EAAW/iB,MAAS8iB,gBAI9Cve,cAClBse,EAASJ,GAAWK,KAEhBtV,OAAOsV,OACHD,EAASJ,GAAWK,IACpBG,EAAiB,UAAWld,KAAQgd,EAAW/iB,MAAS8iB,EAASd,mEAUlDa,EAAO,iCAEXA,EAAO,kRChBwCniB,KAAOuhB,qDAAjDvhB,oCAAkBA,OAAUA,aAA5C2E,oCAAkC3E,OAAUA,mEAWgBA,KAAOuhB,qDAAnDvhB,oCAAkBA,OAAUA,aAA5C2E,oCAAkC3E,OAAUA,uFAZrCiG,wBAALpF,qCAWK6mB,wBAAL7mB,4VAZgDb,iNAWEA,gMAfpE2E,SACIhB,OACIA,OAEIA,sDAAsD3D,aAKtD2D,cAGRA,OACIA,OAEIA,sDAAwD3D,aAKxD2D,qKAfWsC,WAALpF,+HAAAA,mBADgDb,uBAY3C0nB,WAAL7mB,+HAAAA,gBADkDb,4DAnC1DiG,KACDsb,MAAO,YACPA,MAAO,eACPA,MAAO,YAENmG,KACDnG,MAAO,SACPA,MAAO,SAGCoG,GAAkBnjB,GAAoB,IAAVA,2BAKnC4I,EAAWvB,qBACN+b,EAAc,oBACdC,EAAgB,+HAOmCD,kBAA6C3e,IAAOA,EAAErF,OAAO6e,OAAQrV,EAAS,UAAW/H,KAAM,cAAe/F,MAASsoB,gBAWrHC,kBAA+C5e,IAAOA,EAAErF,OAAO6e,OAAQrV,EAAS,UAAW/H,KAAM,gBAAiB/F,MAASuoB,uLCF7I7nB,8EAEnBA,sDAFdA,mRADjB2E,SACIhB,qBACAA,cACAA,qBACAA,0BAFqD3D,kBAEAA,gCAHPA,qBAAjCA,eAEcA,iEA/BrBoN,EAAWvB,cACNxG,YACAkc,YACAjiB,UACAqV,EAAM,WACN/T,EAAM,WACNgJ,EAAO,gBACPke,EAAW,WAEhBvF,EAAmB1O,GAASzG,EAAU,yOAGlC2a,EAAgBzoB,MACtBA,EAAQqB,KAAKgU,IAAIhU,KAAKC,IAAI6W,WAAWnY,GAASsK,EAAM+K,GAAM/T,GAAKikB,QAAQiD,IACnExoB,IAAUyoB,GACVxF,EAAiB,UAAWld,KAAAA,EAAM/F,MAAAA,gBAIhCyoB,EAAgBzoB,MACtBA,EAAQqB,KAAKgU,IAAIhU,KAAKC,IAAI6W,WAAWnY,GAASsK,EAAM+K,GAAM/T,GAAKikB,QAAQiD,IACnExoB,IAAUyoB,GACVxF,EAAiB,UAAWld,KAAAA,EAAM/F,MAAAA,oIC1B/B,SAAS0oB,GAAankB,GAEjC,MAAMokB,EAAcliB,KACZlC,GAASA,EAAKqkB,SAASniB,EAAMnC,SAAYmC,EAAMoiB,kBAC/CtkB,EAAK0J,cACD,IAAI6a,YAAY,gBAAiBvkB,KAQ7C,OAFAG,SAASkC,iBAAiB,QAAS+hB,GAAa,GAEzC,CACH5lB,UACI2B,SAASmC,oBAAoB,QAAS8hB,GAAa,gEC4GlDjoB,0EAqCwDA,KAA2B,mBAAQ,OAAU,sBAAgBA,YACjHA,mCAMFA,yEAHsDA,KAA2B,iCAAcA,iaA1C9DA,0DAH5BA,sBAA2BA,cAA/C2E,SAEIhB,cACAA,6BAoCIA,OACIA,4EAOJA,2IA3CK3D,kIAqCwDA,KAA2B,0BAC/EA,kIAGoDA,KAA2B,4GA1ChDA,0BAH5BA,4BAA2BA,4FAAyGwJ,SAAU,IAAK3L,EAAG,IAAKqZ,EAAG,mGAA1B1N,SAAU,IAAK3L,EAAG,IAAKqZ,EAAG,sOAU3HlX,KAAuB,mBAAYA,KAAyB,sEAAcA,YAKhHA,6DAG0CA,KAA2B,uBAAYA,KAA6B,0EAAcA,2CAGxFA,KAAqB,iBAAYA,KAAuB,oEAAcA,oDAI7DA,KAA6B,yBAAYA,KAA+B,4EAAcA,8CAG5FA,KAAwB,oBAAYA,KAA0B,uEAAcA,6CAG7EA,KAAuB,mBAAYA,KAAyB,sEAAcA,mCAKvFA,KAAuB,yBAAkBA,KAAyB,+BAAcA,0DA7BT,gYA4BQ,2EA5BtEA,KAAuB,ocA4BnBA,KAA2B,+HA9B1E2E,SACIhB,OACIA,uBAERgB,qDAQAA,+BAGAA,6BAEIhB,gBAEJgB,+BAGAA,+BAGAA,+BAGAA,SACIhB,OACIA,2DA5BwF3D,mBA4BQA,sCA5B7DA,KAAuB,wDAGnBA,KAAuB,4BAAYA,KAAyB,gEAKlGA,kFAG0CA,KAA2B,gCAAYA,KAA6B,gGAG1EA,KAAqB,0BAAYA,KAAuB,0FAI/CA,KAA6B,kCAAYA,KAA+B,kGAG9EA,KAAwB,6BAAYA,KAA0B,6FAG/DA,KAAuB,4BAAYA,KAAyB,iFAI5DA,KAA2B,+DACxCA,KAAuB,kCAAkBA,KAAyB,2oBAvBxE2E,SAAKhB,sDAAhB3D,0BAHgH,sDAGhD,wFADNA,uBAAnE2E,mDAAwG3E,sBAC/FA,sEAD0DA,yMAGvD2E,6DAGyH,mFAGlB,+EAIyB,oFAGhB,qFAGH,uIAYnE3E,KAA4B,kCAAcA,qFAA1CA,KAA4B,sKAUyB,wCAA7FA,gGAAlB2E,kCAAmG3E,sCAAjFA,2EAFZA,yCAFoF,qCACM,gDAD7EA,4FACAA,wFADnB2E,yBACAA,iEADoF3E,mBACGA,kCADpEA,mCACAA,sBACbA,iTAAU2E,2BAA4E3E,kEApDnGA,kFAAAA,8LAtHeqoB,GAAgBre,UACrBA,EAAIwS,QAAQ,sBAAuB0F,UAC/BA,EAAE,GAAGZ,0BAGJgH,GAAgBte,UACrBA,EAAIwS,QAAQ,uBAAwB,OAAO+L,uBAwD7CC,GAAQC,EAAMC,UACZzE,KAAKK,UAAUmE,KAAUxE,KAAKK,UAAUoE,8GA5C7Ctb,EAAWvB,KACX5M,EAAQ8Z,GAAOyK,eAEjBmF,EACAC,cAFOtI,WAGLuI,EAAa9P,GAAO6K,aACtBkF,EAAgBtE,OAAcV,GAAQC,QAAQ9kB,eAC5C8pB,EAAuB9iB,GAAY5H,OAAOsD,KAAKsE,GAChD+iB,SAAQnW,EAAK3L,KACV2L,EAAI3L,IAAgB,iBAARA,IAA0BA,EAAI+Z,SAAS,aAAuBhb,EAAQiB,GAC3E2L,iBAoBNoW,EAAUhjB,OACXijB,GAAY,YACJhiB,EAAK5H,KAAUjB,OAAOsmB,QAAQ1e,GAClCqa,EAAWpZ,KAAS5H,QACpBghB,EAAWpZ,GAAO5H,KAClB8N,EAAS,UAAY/H,KAAQijB,GAAgBphB,GAAM5H,MAAAA,IACnD4pB,GAAY,GAGhBA,OACA5I,MAAiBra,aAqCTkjB,SACS3oB,IAAjBmoB,IACA7E,GAAQM,QAAQyE,EAAYvI,GACxBsI,GACAK,EAAUL,QAIdD,OAAenoB,iGAxEpB4oB,EAAYZ,GAAQlI,EAAYoC,2BAChC2G,GAAab,GAAQM,EAAexI,2BACpCgJ,OAA+B9oB,IAAjBmoB,2BACdY,IAAkBX,GAAeJ,GAAQO,EAAoBH,GAActI,6BAK9DrX,SACN5D,EAAQ4D,EAAEF,OAAUE,EAAEF,OAAO1D,KAAO4D,EAAErF,OAAOyB,KAC7C/F,EAAS2J,EAAEF,OAAUE,EAAEF,OAAOzJ,MAAQ2J,EAAErF,OAAO4jB,QAC/CtgB,EAAMmhB,GAAgBhjB,GACvBib,EAAWpZ,KAAS5H,QACrBghB,EAAWpZ,GAAO5H,KAClB8N,EAAS,UAAW/H,KAAAA,EAAM/F,MAAAA,iBAoB9B2pB,EAAUvG,gBAGVuG,EAAUH,kBAGNM,EACAtF,GAAQK,WAAWllB,cAEbgH,eACKiB,KAAO7I,OAAOsD,KAAK2e,GAAYtV,QAAO/M,GAAKqiB,EAAWriB,KAAOykB,GAAkBzkB,KACtFgI,EAAQiB,GAAOoZ,EAAWpZ,GAE9B4c,GAAQM,QAAQnlB,EAAOgH,GAE3BmH,EAAS,aACT0b,MAAoBxI,cAGHrX,GACjBA,EAAErF,OAAO6e,YACYjiB,IAAjBmoB,EACAQ,UAEAP,MAAkBtI,SAClBqI,EAAenE,OAAcV,GAAQC,QAAQ8E,IAAcE,EAAoBzI,MAC/E2I,EAAUN,SAEda,GAAW,iBAcX1F,GAAQK,WAAW0E,GACfD,SACAD,EAAeI,EAAoBH,IACnCK,EAAUN,sDAUqEa,GAAYA,eAFeA,GAAS,kLC1B+B,yMAZ5GxpB,KAA0B,oBAAaA,KAAwB,2BAAcA,iDAI7EA,KAA8B,wBAAaA,KAA4B,+BAAcA,2CAI3FA,KAAwB,kBAAaA,KAAsB,yBAAcA,oDAI3DA,KAAgC,yBAAYA,KAAkC,4EAAcA,uJATrB,2FAIb,oNAQlB,qCACW,qCACQ,uCACA,8FAf5DA,KAAgC,uHAItCA,KAA0B,sKAQlDA,6FACAA,iGACDA,4GACAA,wJArB1B2E,SACIhB,OACIA,kCAGJA,OACIA,OAAQA,yCAGZA,OACIA,OAAQA,yCAERA,cAEJA,2BAGAA,OACIA,qBACAA,qBACAA,qBACAA,uCAf+G3D,mBAIZA,kBAQfA,kBACQA,kBACUA,kBACAA,mDAlB5DA,KAA0B,6BAAaA,KAAwB,qCAGxDA,KAAgC,8DACvCA,KAA8B,iCAAaA,KAA4B,yCAGtEA,KAA0B,wDACjCA,KAAwB,2BAAaA,KAAsB,8CAI7CA,KAAgC,kCAAYA,KAAkC,qFAG7GA,yCACAA,8CACDA,6BACAA,4PAxDbwoB,GAAQC,EAAMC,UACZzE,KAAKK,UAAUmE,KAAUxE,KAAKK,UAAUoE,sCAtC7CzpB,EAAQ8Z,GAAO4K,cACjBmF,EAAgBtE,OAAcV,GAAQC,QAAQ9kB,QAAeugB,IAC7DiK,MAAoBjK,MAA4BsJ,SAC9CY,GACF,eAAgB,aAChB,mBAAoB,iBACpB,aAAc,WACd,qBAAsB,mCACfC,WACLC,EAAoBvrB,OAAOsD,KAAKgoB,GACjC3e,QAAO9D,GAAOwiB,EAAe1E,SAAS9d,KACtC8hB,SAAQnW,EAAK3L,KACV2L,EAAI3L,GAAgB,iBAARA,GAAkCyiB,EAAWziB,GAClD2L,iBAGNoW,EAAUhjB,OACXijB,GAAY,YACJhiB,EAAK5H,KAAUjB,OAAOsmB,QAAQ1e,MAClCwjB,EAAcviB,KAAS5H,OACvBmqB,EAAcviB,GAAO5H,KAErByhB,GADauH,GAAgBphB,GACb5H,GAChB4pB,GAAY,EAGhBA,OACAO,MAAoBA,cAGhBviB,EAAK5H,KAAUjB,OAAOsmB,QAAQ8E,MAClCjK,GAAwBtY,KAAS5H,GAEjCyhB,GADauH,GAAgBphB,GACb5H,gGAQrB8pB,EAAYZ,GAAQhJ,GAAyBiK,yBAC7CJ,GAAab,GAAQM,EAAeW,sBACpCI,EAAYrB,OAAYiB,KAAkBG,GAAoBH,uBAGjDxgB,SACN5D,EAAQ4D,EAAEF,OAAUE,EAAEF,OAAO1D,KAAO4D,EAAErF,OAAOyB,KAC7C/F,EAAS2J,EAAEF,OAAUE,EAAEF,OAAOzJ,MAAQ2J,EAAErF,OAAO4jB,QAC/CtgB,EAAMmhB,GAAgBhjB,GACvBokB,EAAcviB,KAAS5H,QACxBmqB,EAAcviB,GAAO5H,KACrByhB,GAAU1b,EAAM/F,SAGF2pB,EAAUH,OACZG,EAAUzJ,QACVyJ,MAAcQ,KAAkBG,kBAE5CR,EACAtF,GAAQK,WAAWllB,cAEbgH,eACKiB,KAAO7I,OAAOsD,KAAK8nB,GAAeze,QAAO/M,GAAKwrB,EAAcxrB,KAAOuhB,GAAwBvhB,KAClGgI,EAAQiB,GAAOuiB,EAAcviB,GAEjC4c,GAAQM,QAAQnlB,EAAOgH,QAE3B6iB,MAAoBW,4MC9DoBzpB,y4CAPhD2E,SACEhB,OACEA,OACIA,OACIA,OACIA,OACIA,kCAKZA,OACIA,OACIA,OACIA,cACAA,OACIA,cACAA,kCAGJA,OACIA,cACAA,kIAfwB3D,iPATnCsgB,iTCGF,+JADH3b,2BAAuCkR,8EADZ,IAAzB1C,UAAU2W,YAAsE3W,UAAUiD,2BrB2BpG,IAAuB2T,EAAa9T,uDqB7BQ,+ErB6BrB8T,QAAa9T,8BAC3BlX,IACDA,EAAuBiF,SAASsB,cAAc,MAElDvG,EAAqBirB,KAAO/T,EACrB8T,IAAgBhrB,EAAqBirB,0IqBlChDrlB,SAAIhB,cACAA,wyDCAJgB,yLCHO,SAASslB,GAAUC,EAAQC,EAAW,IASzC,MARa,CACTrhB,KAAQ,UACRshB,SAAY,CACRthB,KAAQ,QACRuhB,YAAe,CAACH,EAAO,GAAIA,EAAO,KAEtCC,WAAAA,GAKD,SAASG,GAAkBC,GAC9B,MAAO,CACHzhB,KAAQ,UACRpD,KAAQ,CACJoD,KAAQ,oBACRyhB,SAAYA,IAKjB,SAASC,GAASH,EAAaF,EAAW,IAS7C,MARa,CACTrhB,KAAQ,UACRshB,SAAY,CACRthB,KAAQ,aACRuhB,YAAeA,GAEnBF,WAAAA,GCrBD,MAgBMM,GAAkB,CAACC,EAAOtnB,EAdR,EAc8BunB,EAAY,KACrE,MAAMlpB,EAASipB,EAAQtnB,GAASsnB,EAAQ,EAAKC,EAAc,GAC3D,OAAI/U,MAAMnU,GAAgB,EACnBA,GAEEmpB,GAAsB,CAACF,EAAOtnB,EArBR,GAqBkCunB,EAAY,KAC7E,MAAMlpB,EAASipB,EAAQtnB,GAASsnB,EAAQ,EAAKC,EAAc,GAC3D,OAAI/U,MAAMnU,GAvBqB,GAwBxBA,GAEEopB,GAAuB,CAACH,EAAOtnB,EAzBZ,KA0B5B,MAAM3B,EAASipB,EAAQtnB,EACvB,OAAIwS,MAAMnU,GAAgB,EACnBA,GAGEqpB,GAAyBC,GAAY,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,sBAAuBN,GAAgBM,EA9BrF,EACK,GA6BiI,GA7BjI,IAgCvBC,GAAyB,CAACvK,EAAOwK,IAAkB,EAAkB,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,sBAAuBA,EAAexK,GAASA,EAC/IyK,GAAyB,CAACzK,EAAOwK,IAAkB,EAAkB,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,sBAAuBA,EAAexK,GAASA,EAC/I0K,GAA4B,CAACnU,EAASoU,EAAiBC,EAjChC,KAkC5BD,EACO,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,sBAAuBzqB,KAAKC,IAAIwqB,EAAiBC,GAAa1qB,KAAKC,IAAIoW,EAASqU,IAE/G1qB,KAAKC,IAAIoW,EAASqU,GAEhBC,GAA4B,CAACC,EAAUC,KAChD,MAAO/K,GAAUkB,GAAa4J,IACvBN,GAAkB,EAAqBtJ,GAAa6J,GAAoB,CAAC,KAAM,MACtF,OAAON,GAAuBzK,EAAOwK,IAE5BQ,GAA8B,CAACF,EAAUC,EAAkBH,EA5CpC,MA6ChC,OAASrU,GAAW2K,GAAa4J,KACzBH,GAAmB,EAAqBzJ,GAAa6J,GAAoB,CAAC,KAAM,MACxF,OAAOL,GAA0BnU,EAASoU,EAAiBC,IAExD,SAASK,GAAUxa,EAAKkE,EAAI1P,EAAMimB,EAAQrL,GAC7C,MAAMsL,EvBrBH,SAAuB5hB,GAC1B,OAAQA,GACJ,IAAK,QACD,MAAO,QACX,IAAK,OACD,MAAO,YACX,IAAK,OACD,MAAO,MACX,QACI,OAAOA,GuBYA6hB,CAAczW,GACvB0W,EAAaxL,EAAW,GAAGsL,YAC3BL,EAAWjL,EAAW,GAAGsL,UACzBG,EAAWnB,GAAoBtK,EAA2B,gBAC1DyK,EAAWN,GAAgBnK,EAA2B,gBAC5DpP,EAAI8a,UAAU,GAAG5W,kBAAoBkV,GArDR,EAAC5kB,EAAMimB,EAAQ/oB,KAC5C,IAAIqpB,EAAU,GACd,MAAMvrB,EAAMgF,EAAK7E,OACjB,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAKI,IAAK,CAC1B,MAAMorB,EAAU,EAAWP,EAAO,CAACjmB,EAAK5E,GAAG2c,UAAW/X,EAAK5E,GAAG0c,WAAa,CAAC9X,EAAK5E,GAAG2c,UAAW/X,EAAK5E,GAAG0c,UACnG0O,GAASD,EAAQpsB,KAAK,EAAO+C,EAAGspB,EAASxmB,EAAK5E,IAAMorB,GAE5D,OAAOD,GA+CHE,CAAkBzmB,EAAMimB,GAAQ,CAACzB,EAAQkC,IAAanC,GAAUC,EAAQ,CAAClU,MAAOoW,EAAS/mB,KAAKmX,QAAQ,SAAS,UAEnHtL,EAAImb,SAASC,GAAYlX,EAAImW,EAAUO,EAAYC,EAAUhB,IAG1D,SAASwB,GAAQrb,EAAKkE,EAAI1P,EAAM8mB,EAAYjB,EAAUO,EAAYW,EAAWC,GAC5EF,EACAtb,EAAI8a,UAAU,GAAG5W,gBAAkBkV,GAAkBkC,EAAW9mB,GAAMwL,KAAIoB,GAAIkY,GAASlY,OAEvFpB,EAAI8a,UAAU,GAAG5W,gBAAkB,CAC/BtM,KAAQ,UACRpD,KAAQ8kB,GAAS9kB,EAAKwL,KAAIgR,GAAK,CAACA,EAAEzE,UAAWyE,EAAE1E,eAGvDtM,EAAImb,SAASM,GAAUvX,EAAImW,EAAUO,EAAYW,EAAWC,IAGzD,SAASE,GAAS1b,EAAKkE,EAAI1P,EAAM8mB,EAAYjB,EAAUO,EAAYW,EAAWC,GACjF,GAAIF,EAAY,CACZ,MAAM9rB,EAAMgF,EAAK7E,OACXgsB,EAAU,GAChB,IAAK,IAAIC,EAAK,EAAGA,EAAKpsB,EAAKosB,IAAQ,CAC/B,MAAMC,EAAWP,EAAW9mB,EAAKonB,IAC3BE,EAASD,EAASlsB,OACxB,IAAK,IAAIosB,EAAU,EAAGA,EAAUD,EAAQC,IACpCJ,EAAQhtB,KAAK2qB,GAASuC,EAASE,KAGvC/b,EAAI8a,UAAU,GAAG5W,gBAAkBkV,GAAkBuC,SAErD3b,EAAI8a,UAAU,GAAG5W,gBAAkBkV,GAAkB5kB,EAAKwL,KAAIgc,GAAM1C,GAAS0C,EAAGhc,KAAIgR,GAAK,CAACA,EAAEzE,UAAWyE,EAAE1E,iBAE7GtM,EAAImb,SAASM,GAAUvX,EAAImW,EAAUO,EAAYW,EAAWC,IAEzD,SAASJ,GAAapL,EAAQqK,EAAUO,EAAYC,EAAUhB,GACjE,MAAOoC,EAAUnW,GAAW2K,GAAa4J,GA2BzC,MA1Bc,CACVnW,GAAM,GAAG8L,iBACTpY,KAAQ,SACRskB,OAAU,GAAGlM,kBACbmM,OAAU,CACN,aAnEgC,eAoEhC,YAAavC,GAAsBC,GACnC,cAtEiC,SAuEjC,cAAe,CAAC,EAAG,GAEnB,sBAAsB,EACtBe,WAAc,EAAgB,UAAY,OAC1C,aAAc,CAAC,MAAO,SAEtB,YAAaC,EACb,cAAe,CAAC,EAAG,IACnB,cAAe,OAEnBuB,MAAS,CACL,aAActC,GAAuBmC,GACrC,kBAAmB,EACnB,kBAAmB,OACnB,aAAcjC,GAAuBiC,GACrC,eAAgBhC,GAA0BnU,KAK/C,SAAS2V,GAAUzL,EAAQqK,EAAUO,EAAYW,EA3HxB,EA2HoDC,GAAO,GACvF,MAAOS,EAAUnW,GAAW2K,GAAa4J,GAiBzC,MAhBc,CACVnW,GAAM,GAAG8L,eACTpY,KAAQ,OACRskB,OAAU,GAAGlM,gBACbmM,OAAU,CACN,YAAa,QACb,WAAY,QACZvB,WAAc,EAAe,UAAY,QAE7CwB,MAAS,CACL,aAAcH,EACd,eAAgBnW,EAChB,aAAcyV,EACd,iBAAkB,EAAW,CAAC,GAAI,IAAM,CAAC,KAK9C,SAASc,GAAsBrM,EAAQxb,EAAMqlB,EA9IrB,GA+I3B,MAAM7Z,IAACA,EAAG5R,MAAEA,GAASoG,EACf4mB,EAAc,GAAGpL,iBAIvB,OAHIhQ,EAAIsc,SAASlB,IACbpb,EAAIuc,kBAAkBnB,EAAa,YAAaxB,GAAsBL,GAAgBnrB,EAAOyrB,MAE1F,EAEJ,SAAS2C,GAAsBxM,EAAQxb,EAAMqmB,EAxJjB,IAyJ/B,MAAM7a,IAACA,EAAG5R,MAAEA,GAASoG,EACf4mB,EAAc,GAAGpL,iBAIvB,OAHIhQ,EAAIsc,SAASlB,IACbpb,EAAIuc,kBAAkBnB,EAAa,YAAa1B,GAAoBtrB,EAAOysB,KAExE,EAEJ,SAAS4B,GAAuBzM,EAAQxb,EAAM+mB,EA/JrB,GAgK5B,MAAMvb,IAACA,EAAG5R,MAAEA,GAASoG,EACfinB,EAAY,GAAGzL,eAIrB,OAHIhQ,EAAIsc,SAASb,IACbzb,EAAI0c,iBAAiBjB,EAAW,aAAc9B,GAAqBvrB,EAAOmtB,KAEvE,EAGJ,SAASoB,GAAkB3M,EAAQxb,GACtC,MAAMwL,IAACA,EAAG5R,MAAEA,GAASoG,EACfinB,EAAY,GAAGzL,eACfoL,EAAc,GAAGpL,kBAChBiM,EAAUnW,GAAW2K,GAAariB,GAKzC,GAJI4R,EAAIsc,SAASb,KACbzb,EAAI0c,iBAAiBjB,EAAW,aAAcQ,GAC9Cjc,EAAI0c,iBAAiBjB,EAAW,eAAgB3V,IAEhD9F,EAAIsc,SAASlB,GAAc,CAC3B,MAAMwB,EAAsB5c,EAAI6c,kBAAkBzB,EAAa,cACzD0B,EAAY9b,MAAMgH,QAAQ4U,GAAuBA,EAAoB1tB,OAAO,GAAG2M,MAAQ+gB,EAC7F5c,EAAI0c,iBAAiBtB,EAAa,aAAcpB,GAAuBiC,IACvEjc,EAAI0c,iBAAiBtB,EAAa,eAAgBnB,GAA0BnU,IAC1D,iBAAdgX,GAA8B9c,EAAI0c,iBAAiBtB,EAAa,aAActB,GAAuBmC,IAE7G,OAAO,EAEJ,SAASc,GAAqB/M,EAAQ4K,EAAYpmB,GACrD,MAAMwL,IAACA,GAAOxL,EACRinB,EAAY,GAAGzL,eACfoL,EAAc,GAAGpL,iBAOvB,OANIhQ,EAAIsc,SAASb,IACbzb,EAAIuc,kBAAkBd,EAAW,aAAc,EAAe,UAAY,QAE1Ezb,EAAIsc,SAASlB,IACbpb,EAAIuc,kBAAkBnB,EAAa,aAAc,EAAe,UAAY,SAEzE,ECtMX,MACM4B,GAAgB,gBAChBC,GAAiB,qBACjBf,GAAS,iBACTgB,GAAe,UACfC,GAAmB,CAAC,KAAM,EAAG,CAAC,MAAO,MAoBrCC,GAAe,CAAC9pB,EAAO0W,EAAcqT,EAAWC,EAAUC,IACvDA,EVxByBjqB,CAAAA,GAAoB,IAAVA,EUyBpCkqB,CAAclqB,GAbS,CAAC0W,GAAiB,CAAC,OAC9C,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,CAAC,KAAM,EAAG,CAAC,MAAO,GAAGA,MAAkB,UACvC,QAKWyT,CAAuBzT,GACvByM,GAAenjB,GAlBE,EAAC+pB,EAAWC,IAAa,CAAC,OACtD,CAAC,KAAM,CAAC,MAAO,QAAS,CAAC,UAAWD,IAAaC,EACjD,CAAC,KAAM,EAAG,CAAC,MAAO,UAAWJ,GAAa,QAiB/BQ,CAAwBL,EAAWC,GAtBpB,EAACD,EAAWC,IAAa,CAAC,OACpD,CAAC,KAAM,CAAC,MAAO,QAAS,CAAC,UAAWD,IAAaC,EACjD,CAAC,KAAM,EAAG,CAAC,MAAO,UAAW,OAAO,QAsB7BK,CAAsBN,EAAWC,GANjB,OASrBM,GAAuB,CAAC5T,EAAc6T,GAAG,EAAMC,GAAY,KAC7D,MAAMC,EAAgB,CAAC,IAAK,CAAC,MAAO,GAAG/T,KAAiB,IACxD,OAAI8T,EACID,EACO,CAAC,MAAOV,GAAkBY,GAE1B,CAAC,cAAc,GAGtBF,EACOE,EAEA,CAAC,IAAKA,IAKnBC,GAAgB,CAAChU,EAAciU,IAI1B,CAAC,OACR,CAAC,KAAM,CAAC,MAAO,QAAS,CAAC,UAAWA,IAAoB,EACxD,CAAC,OAAQd,GAAkB,EAAG,CAAC,MAAO,GAAGnT,OAGvCkU,GAAmB,CAAC5qB,EAAOiqB,IAAyB,IAAVjqB,GAAeiqB,EAAa,EAAI,EAC1EY,GAAe,CAAC7qB,EAAO+pB,EAAWC,EAAUC,KAC9C,MAAMa,EAAoB3H,GAAenjB,GAA6D,OAAnD,CAAC,OAAQ6pB,GAAkBD,GAAc,QAC5F,OAAKK,EACE,CAAC,OACR,CAAC,KAAM,CAAC,MAAO,QAAS,CAAC,UAAWF,IAAaC,EACjD,CAAC,KAAM,EAAG,CAAC,MAAO,UAAWc,EAC7B,QAJuBA,GAMrBC,GAAuB,CAAC/qB,EAAOgrB,KACjC,MAAMjO,EAAuB,IAAdiO,EAAmB,CAAC,MAAO,QAAU,CAAC,MAAO,QAC5D,OAAK7H,GAAenjB,GACb+c,EAD4B,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,MAAO,CAAC,SAAUA,EAAO,MAAYA,IAGjGkO,GAAyBD,GACE,IAAdA,EAAmB,CAAC,MAAO,QAAU,CAAC,MAAO,QAG1DE,GAAmB,CAACC,EAAYC,IAC3B,CAAC,OACR,CAAC,KAAM,CAAC,MAAO,QAAS,CAAC,UAAWD,IAAc/E,GAAoBgF,EAAW,IACjFhF,GAAoBgF,EAAW,EAAG,OAEhCC,GAAqBD,GAChBhF,GAAoBgF,EAAW,EAAG,MAEvCE,GAAmB,CAACH,EAAYI,IAC3B,CAAC,OACR,CAAC,KAAM,CAAC,MAAO,QAAS,CAAC,UAAWJ,IAAclF,GAAgBsF,EAAW,GAC7EtF,GAAgBsF,EAAW,KAEzBC,GAAoB,CAACD,EAAWtB,IAC3B,EAAc,CAAC,OACtB,CAAC,KAAM,EAAG,CAAC,MAAO,UAAWhE,GAAgBsF,EAAW,GAAK,KAC7DtF,GAAgBsF,EAAW,GAAK,MAAQtF,GAAgBsF,EAAW,GAAK,KAgMrE,SAASE,GAAqBvqB,EAAMoW,GACvC,MAAM5K,IAACA,GAAOxL,EACVwL,EAAIsc,SAASU,KACbhd,EAAIuc,kBAAkBS,GAAe,aAAc,EAAY,UAAW,QAE1Ehd,EAAIsc,SAASW,KACbjd,EAAIuc,kBAAkBU,GAAgB,aAAc,EAAY,UAAW,QAenF,MAAM+B,GAAiB3V,IACnB,MAAMgU,EAAY,EAAQhU,EAAIQ,MAAMoV,MAAQ,GAC5C,IAAIC,EAAU,GAId,OAHI7V,GAAOA,EAAIQ,MAAW,KAAKR,EAAIQ,MAAW,KAAKR,EAAIQ,MAAkB,WAAEla,OAAS,IAChFuvB,EAAU,CAAC7V,EAAIQ,MAAW,IAAE1V,KAAMkV,EAAIQ,MAAW,IAAE1V,OAEhD,CAACkpB,EAAW6B,EAAQC,OAAO9B,KAYtC,MAoBa+B,GAAwB5qB,IACjC,MAAMwL,IAACA,EAAGoP,WAAEA,EAAU/F,IAAEA,EAAGW,aAAEA,GAAgBxV,EACvClB,EAAQ8b,EAAWyC,YAClBwN,GAAkB5O,GAAarB,EAAW6C,aAC1CoL,GAAc2B,GAAc3V,GAC/BrJ,EAAIsc,SAASU,MACbhd,EAAI0c,iBAAiBM,GAAe,aAAcI,GAAa9pB,EAAO0W,EAAcqT,EAAWgC,IAAiBhW,IAChHrJ,EAAI0c,iBAAiBM,GAAe,aAAcmB,GAAa7qB,EAAO+pB,EAAWgC,IAAiBhW,aAY3F,CACXiW,KAAO9qB,GAASuqB,GAAqBvqB,GAAM,GAC3C+qB,KAAO/qB,GAASuqB,GAAqBvqB,GAAM,GAC3CjC,IA/QwBiC,IACxB,MAAMwL,IAACA,EAAGwf,QAAEA,EAAOnW,IAAEA,EAAG+F,WAAEA,eAAYpF,GAAgBxV,GAChDirB,aAACA,GAAgBD,EACjB/E,EAASgF,EACf,IAAIC,EAAW,GACXrW,GAAOA,EAAIQ,MAAW,KAAKR,EAAIQ,MAAW,KAAKR,EAAIQ,MAAkB,WAAEla,OAAS,IAChF+vB,EAAW,CAACrW,EAAIQ,MAAW,IAAGR,EAAIQ,MAAW,MAEjD,MAAM8V,EAAa,EAAQtW,EAAIQ,MAAkB,WAAI,GAC/C+V,EAAgBxQ,EAAW6C,WAC3B3e,EAAQ8b,EAAWyC,WACnB+I,EAAaxL,EAAWwC,gBACvByN,GAAkB5O,GAAamP,GAChCV,EAAUQ,EAAS1f,KAAIgR,GAAKA,EAAE7c,OAC9BkpB,EAAYsC,EAAW3f,KAAIgR,GAAKA,EAAE7c,OAClCsqB,EAAaS,EAAQC,OAAO9B,GAC5BY,EAAmB,EAAQ,CAAC5U,EAAIwW,UAAU1rB,KAAMkV,EAAIyW,QAAQ3rB,MAAMgrB,OAAOV,GAAcA,EAC7FsB,MAAM,+BACL1kB,MAAK2kB,GAAYA,EAASC,SAC1B5kB,MAAK7G,IACF,GAAIimB,EAAQ,CACR,MAAMyF,EAAe,GACrB,IAAK,IAAIC,KAAW3rB,EAAK6kB,SACrB8G,EAAQjH,SAASC,YAAcsB,EAAO0F,EAAQjH,SAASC,kBACnB7pB,IAAjC6wB,EAAQjH,SAASC,aAA2B+G,EAAavxB,KAAKwxB,GAErE3rB,EAAK6kB,SAAW6G,EAEpBlgB,EAAI8a,UAAUoB,GAAQ,CAClBtkB,KAAM,UACNpD,KAAMA,IAGVwL,EAAImb,SAAS,CACTjX,GAAM+Y,GACNrlB,KAAQ,SACRskB,OAAUA,GACVC,OAAU,CACN,aAAc,EAAQ,CAAC,OACnB,CAAC,KAAM,EAAG,CAAC,MAAO,UAAW,WAC7B,eAAiB,cACrB,YAAa2C,GAAkB1P,EAA2B,iBAAK/F,GAC/D,cAAe,SACf,cAAe,CAAC,EAAG,GAEnB,sBAAsB,EACtB,yBAAyB,EACzBuR,WAAc,EAAe,UAAY,OACzC,aAAc2D,GAAsBnP,EAAyB,cAE7D,YAAauP,GAAkBvP,EAA2B,gBAC1D,cAAe,CAAC,EAAG,IACnB,cAAe,MACf,sBAAsB,EACtB,yBAAyB,GAG7BgN,MAAS,CACL,aAAc,EAAQ,CAAC,OAAO,CAAC,KAAM,EAAG,CAAC,MAAO,UAAW,OAAQ,QAAU,OAC7E,kBAAmB,EACnB,kBAAmB,OACnB,aAAc,OACd,eAAgB,IAEpBtiB,OAAU8jB,GAAqB5T,GAAc,EAAe,IAAR1W,KAExD0M,EAAImb,SAAS,CACTjX,GAAM8Y,GACNplB,KAAQ,SACRskB,OAAUA,GACVC,OAAU,CACN,aAAc,CAAC,OACX,CAAC,KAAM,CAAC,MAAO,QAAS,CAAC,UAAWsC,IAAc,eAClD,eACJ,YAAaG,GAAiBH,EAAYrP,EAA2B,gBACrE,cAAe,SACf,cAAe,CAAC,EAAG,GAEnB,sBAAsB,EACtB,yBAAyB,EACzBwL,WAAc,EAAe,UAAY,OACzC,aAAcyD,GAAqB/qB,EAAO8b,EAAyB,cAEnE,YAAaoP,GAAiBC,EAAYrP,EAA2B,gBACrE,cAAe,CAAC,EAAG,IACnB,cAAe,MACf,sBAAsB,EACtB,yBAAyB,EACzB,kBAAkB4O,GAAchU,EAAciU,IAElD7B,MAAS,CACL,kBAAkB,EAAQ,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,UAAW,OAAO,QAAU,OACjF,kBAAmB8B,GAAiB5qB,IAAS+V,GAC7C,aAAc+T,GAAa9pB,EAAO0W,EAAcqT,EAAWgC,IAAiBhW,GAC5E,aAAc8U,GAAa7qB,EAAO+pB,EAAWgC,IAAiBhW,GAC9D,kBAAmB,OACnB,kBAAmB,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,UAAW,EAAG,GAC5D,eAAgB,IAEpBvP,OAAU8jB,GAAqB5T,GAAc,EAAc,IAAR1W,KAEvD,MAAM8sB,EAAQ,IAAIC,SAASC,MAAM,CAC7BC,aAAa,EAIbC,cAAc,EAGdC,aAAcje,KAEZke,EAAkB,SAAU3oB,GAC9B,MAAMohB,EAAcphB,EAAEshB,SAAS,GAAGH,SAASC,YAAYjqB,QACjD4V,EAAQ/M,EAAEshB,SAAS,GAAGJ,WAAWnU,MACjC6b,EAAO5oB,EAAEshB,SAAS,GAAGJ,WAAW9kB,KAChCysB,EAAOjR,UAAUkR,UAAUF,GAC3B3W,EAAe8W,EAAIC,IAIzB,KAAOtxB,KAAK8O,IAAIxG,EAAEihB,OAAOgI,IAAM7H,EAAY,IAAM,KAC7CA,EAAY,IAAMphB,EAAEihB,OAAOgI,IAAM7H,EAAY,GAAK,KAAO,IAG7D,MAAM8H,EAAWlpB,EAAEshB,SAAS,GAAGJ,WAAWiI,MAG1C,IAAIC,EAAa,GACbC,EAAY,IAChB,OAJcrpB,EAAEshB,SAAS,GAAGJ,WAAWjP,IAKnC,KAAK,EACL,KAAK,EACDmX,EAAa,oBACbC,EAAY,IACZ,MACJ,KAAK,EACL,KAAK,EACDD,EAAa,2BACbC,EAAY,IACZ,MACJ,KAAK,EACL,KAAK,EACDD,EAAa,sBACbC,EAAY,QACZ,MACJ,KAAK,EACL,KAAK,EACDD,EAAa,4BACbC,EAAY,IAIpB,IAAIC,EAAO,4BAA4BV,OAAUC,aAAgB9b,IADhB,IAA/B/M,EAAEshB,SAAS,GAAGJ,WAAWqI,GAAyB,MAAdF,EACiC,aAAe,UAClG/X,IACAgY,GAAS,2BAA2BD,EAAUG,OAAO,cAAcH,QAChEH,EAAW,IAAGI,GAAQ,sBAAsBJ,MAAwB,GAAVA,EAAe,SAAW,aACpFE,IAAYE,GAAQ,0BAA0BF,UAErDE,GAAQ,SACRjB,EAAMoB,UAAUrI,GAAasI,QAAQJ,GAAMK,MAAM1hB,IAE/C2hB,EAAmB,IAAM3hB,EAAI4hB,YAAYtuB,MAAMuuB,OAAS,UACxDC,EAAc,IAAM9hB,EAAI4hB,YAAYtuB,MAAMuuB,OAAS,GACnDE,EAAqB,WACvBD,IACA1B,EAAM4B,UAENxf,IACAxC,EAAIiiB,GAAG,aAAcjF,IAAgBjlB,IACjC4pB,IACAjB,EAAgB3oB,MAEpBiI,EAAIiiB,GAAG,aAAchF,IAAiBllB,IAClC4pB,IACAjB,EAAgB3oB,MAEpBiI,EAAIiiB,GAAG,aAAcjF,GAAe+E,GACpC/hB,EAAIiiB,GAAG,aAAchF,GAAgB8E,KAErC/hB,EAAIiiB,GAAG,aAAcjF,GAAe2E,GACpC3hB,EAAIiiB,GAAG,aAAchF,GAAgB0E,GACrC3hB,EAAIiiB,GAAG,QAASjF,GAAe0D,GAC/B1gB,EAAIiiB,GAAG,QAAShF,GAAgByD,GAChC1gB,EAAIiiB,GAAG,aAAcjF,GAAe8E,GACpC9hB,EAAIiiB,GAAG,aAAchF,GAAgB6E,QAwF7CI,aAxEG,SAA4B1tB,GAC/B,MAAMwL,IAACA,EAAGoP,WAAEA,EAAU/F,IAAEA,EAAGW,aAAEA,GAAgBxV,EACvClB,EAAQ8b,EAAWyC,WACrB7R,EAAIsc,SAASU,MACboC,GAAqB5qB,GACrBwL,EAAI0c,iBAAiBM,GAAe,kBAAmBkB,GAAiB5qB,IAAS+V,IACjFrJ,EAAIuc,kBAAkBS,GAAe,aAAcqB,GAAqB/qB,IACxE0M,EAAImiB,UAAUnF,GAAeY,GAAqB5T,GAAc,EAAc,IAAR1W,KAEtE0M,EAAIsc,SAASW,KAAiBjd,EAAImiB,UAAUlF,GAAgBW,GAAqB5T,GAAc,EAAe,IAAR1W,KAgE1G8uB,OAtDG,SAA4B5tB,GAC/B,MAAMwL,IAACA,EAAGoP,WAAEA,EAAUpF,aAAEA,EAAYX,IAAEA,GAAO7U,IACpCiqB,GAAcO,GAAc3V,GAC/B/V,EAAQ8b,EAAWyC,WACnBoM,EAAmB,EAAQ,CAAC5U,EAAIwW,UAAU1rB,KAAMkV,EAAIyW,QAAQ3rB,MAAMgrB,OAAOV,GAAcA,EAC7Fze,EAAImiB,UAAUnF,GAAeY,GAAqB5T,GAAc,EAAc,IAAR1W,IACtE8rB,GAAqB5qB,GACrBwL,EAAIuc,kBAAkBS,GAAe,kBAAmBgB,GAAchU,EAAciU,IACpFje,EAAImiB,UAAUlF,GAAgBW,GAAqB5T,GAAc,EAAe,IAAR1W,KA+CxE+uB,eA7CoB7tB,IACpB,MAAMwL,IAACA,EAAGoP,WAAEA,EAAU/F,IAAEA,GAAO7U,IACtBiqB,GAAcO,GAAc3V,GACjCrJ,EAAIsc,SAASU,KACbhd,EAAIuc,kBAAkBS,GAAe,YAAawB,GAAiBC,EAAYrP,EAA2B,iBAE1GpP,EAAIsc,SAASW,KACbjd,EAAIuc,kBAAkBU,GAAgB,YAAa0B,GAAkBvP,EAA2B,kBAuCpGkT,eApCoB9tB,IACpB,MAAMwL,IAACA,EAAGoP,WAAEA,EAAU/F,IAAEA,GAAO7U,IACtBiqB,GAAcO,GAAc3V,GACjCrJ,EAAIsc,SAASU,KACbhd,EAAIuc,kBAAkBS,GAAe,YAAa4B,GAAiBH,EAAYrP,EAA2B,iBAE1GpP,EAAIsc,SAASW,KACbjd,EAAIuc,kBAAkBU,GAAgB,YAAa6B,GAAkB1P,EAA2B,kBA8BpGmT,YAjBiB/tB,IACjB,MAAMwL,IAACA,EAAGoP,WAAEA,EAAUhhB,MAAEA,GAASoG,EAC7BwL,EAAIsc,SAASU,KACbhd,EAAIuc,kBAAkBS,GAAe,aAAcqB,GAAqBjP,EAAWyC,WAAYzjB,IAE/F4R,EAAIsc,SAASW,KACbjd,EAAIuc,kBAAkBU,GAAgB,aAAcsB,GAAsBnwB,MC9WlF,MAEMo0B,GAAgB,6BAChBC,GAAmB,gCAiCzB,SAASC,GAAmBluB,EAAMoW,GAC9B,MAAM5K,IAACA,GAAOxL,EACVwL,EAAIsc,SAASmG,KACbziB,EAAIuc,kBAAkBkG,GAAkB,aAAc,EAAY,UAAW,QAE7EziB,EAAIsc,SAASkG,KACbxiB,EAAIuc,kBAAkBiG,GAAe,aAAc,EAAY,UAAW,eAcnE,CACXlD,KAAO9qB,GAASkuB,GAAmBluB,GAAM,GACzC+qB,KAAO/qB,GAASkuB,GAAmBluB,GAAM,GACzCjC,IAvDJ,SAAkBiC,GACd,MAAMwL,IAACA,EAAGwf,QAAEA,EAAOnW,IAAEA,EAAG+F,WAAEA,GAAc5a,EACxC,IAAK6U,EAAK,OACV,MAAMkS,EAAY5B,GAAqBvK,EAA4B,gBANhD,GAOnB,GAAI/F,EAAIQ,MAAW,KAAKR,EAAIQ,MAAW,KAAKR,EAAIQ,MAAkB,WAAEla,OAAS,EAAG,CAC5E,MAAMgzB,cAACA,GAAiBnD,EAClBoD,EAAYvZ,EAAIQ,MAAMgZ,SACtBjI,EAAaxL,EAAW4C,aAC9B0J,GAAS1b,EAAK,kBAAuB,CAACqJ,EAAIQ,MAAW,IAAEiZ,OAAO,IAAK,IAAKzZ,EAAIQ,MAAW,IAAEiZ,OAAO,IAAK,KAAOH,EAAevT,EAAWX,WAAYmM,EAAYW,GAAW,GACzKG,GAAS1b,EAAK,qBAA0BqJ,EAAIQ,MAAkB,WAAE7J,KAAI9L,GAAKA,EAAE4uB,OAAO,EAAIF,KAAaD,EAAevT,EAAW6C,WAAY2I,EAAYW,GAAW,KA+CpKwH,WAAavuB,GAlCjB,SAAgCA,GAC5B,MAAMwL,IAACA,GAAOxL,GACPynB,EAAUnW,GAAW2K,GAAajc,EAAKpG,OAC1C4R,EAAIsc,SAASmG,MACbziB,EAAI0c,iBAAiB+F,GAAkB,aAAcxG,GACrDjc,EAAI0c,iBAAiB+F,GAAkB,eAAgB3c,IAE3DsZ,GAAqB5qB,GA2BCwuB,CAAuBxuB,GAC7CyuB,gBAhBJ,SAAyBzuB,GACrB,MAAMwL,IAACA,EAAG5R,MAAEA,GAASoG,EACf+mB,EAAY5B,GAAqBvrB,EA9CpB,GAqDnB,OANI4R,EAAIsc,SAASmG,KACbziB,EAAI0c,iBAAiB+F,GAAkB,aAAclH,GAErDvb,EAAIsc,SAASkG,KACbxiB,EAAI0c,iBAAiB8F,GAAe,aAAcjH,IAE/C,IC1DX,MACME,GAAY,qBACZyH,GAAY,gBACZhH,GAAS,iBA6CR,SAASiH,GAAiB3uB,EAAMoW,GACnC,MAAM5K,IAACA,GAAOxL,EACVwL,EAAIsc,SAAS4G,KACbljB,EAAIuc,kBAAkB2G,GAAW,aAAc,EAAY,UAAW,QAEtEljB,EAAIsc,SAASb,KACbzb,EAAIuc,kBAAkBd,GAAW,aAAc,EAAY,UAAW,eAI/D,CACX6D,KAAO9qB,GAAS2uB,GAAiB3uB,GAAM,GACvC+qB,KAAO/qB,GAAS2uB,GAAiB3uB,GAAM,GACvCjC,IAxDsBiC,IACtB,MAAM6U,IAACA,EAAGrJ,IAAEA,EAAGwf,QAAEA,EAAOpQ,WAAEA,EAAUqJ,WAAEA,GAAcjkB,EACpD,GAAsB,eAAlBikB,EAAWvU,IAAuBuU,EAAWvU,GAAG4L,WAAW,OAAQ,OACvE,IAAKzG,EAAK,OACV,MAAMoR,OAACA,GAAU+E,EACX5E,EAAaxL,EAAW2C,WAC9BgO,MAAM,8BACL1kB,MAAK2kB,GAAYA,EAASC,SAC1B5kB,MAAK7G,IACF,GAAIimB,EACA,IAAK,IAAI7qB,EAAI,EAAGA,EAAE4E,EAAK6kB,SAAS1pB,OAAQC,IAAI,CACxC,MAAMwzB,EAAS5uB,EAAK6kB,SAASzpB,GAAGspB,SAASC,YAAY,GACrD3kB,EAAK6kB,SAASzpB,GAAGspB,SAASC,YAAc,CAACiK,EAAOpjB,KAAI0Q,GAAK+J,EAAO/J,MAGxE1Q,EAAI8a,UAAUoB,GAAQ,CAClBtkB,KAAM,UACNpD,KAAMA,IAEVwL,EAAImb,SAAS,CACTjX,GAAMgf,GACNtrB,KAAQ,OACRskB,OAAUA,GACVC,OAAU,CAACvB,WAAc,EAAe,UAAY,QACpDwB,MAAS,CACL,aAAc,CAAC,OAAQ,CAAC,KAAM,UAAW,CAAC,MAAO,SAAU,oBAAqB,2BAIxFpc,EAAImb,SAAS,CACTjX,GAAMuX,GACN7jB,KAAQ,OACRskB,OAAUA,GACVC,OAAU,CAACvB,WAAc,EAAe,UAAY,QACpDwB,MAAS,CACL,aAAc,CAAC,OAAQ,CAAC,KAAM,UAAW,CAAC,MAAO,SAAU,eAAgB,kBAC3E,aAAc,EACd,eAAgB,CAAC,OAAQ,CAAC,KAAM,UAAW,CAAC,MAAO,SAAU,GAAK,YCvClF,MAAMpM,GAAS,sBAeA,CACXsP,KAAMvC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9CuP,KAAMxC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9Czd,IAfoBiC,IACpB,MAAM6U,IAACA,EAAG+F,WAAEA,EAAUoQ,QAAEA,EAAOxf,IAAEA,EAAGyY,WAAEA,GAAcjkB,EACpD,GAAIikB,EAAWvU,GAAG4L,WAAW,OAAQ,OACrC,IAAKzG,EAAK,OACV,MAAMsZ,cAACA,GAAiBnD,EAClB6D,EAAY,GAAGha,EAAIQ,MAAMyZ,WAAWja,EAAIQ,MAAM0Z,WAC9CtY,EAAQ5B,EAAI4B,MACZuY,EAAc,IAAI7T,UAAU8T,MAAM,CAACxY,EAAMmY,OAAO,GAAInY,EAAMmY,OAAOnY,EAAMmY,OAAOzzB,OAAS,KAAKiK,MAAM,IAAK,CAACzF,KAAQ,SAASkvB,MACzH9H,EAAY5B,GAAqBvK,EAA4B,gBAV1C,KAWzBiM,GAAQrb,EAAKgQ,GAAQwT,EAAYJ,OAAQT,EAAevT,EAAWH,iBAAkBG,EAAWJ,mBAAoBuM,IAOpHwH,WAAYpG,GAAkBjd,KAAK,KAAMsQ,IACzCiT,gBAAkBzuB,GAASioB,GAAuBzM,GAAQxb,EAnBjC,MCF7B,MAAMwb,GAAS,gBAYA,CACXsP,KAAMvC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9CuP,KAAMxC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9Czd,IAZeiC,IACf,MAAMwL,IAACA,EAAGqJ,IAAEA,EAAG+F,WAAEA,EAAUoQ,QAAEA,EAAO/G,WAAEA,GAAcjkB,EACpD,GAAIikB,EAAWvU,GAAG4L,WAAW,OAAQ,OACrC,IAAKzG,EAAK,OACV,MAAMsZ,cAACA,GAAiBnD,EAClBjE,EAAY5B,GAAqBvK,EAA4B,gBAP/C,KAQpBiM,GAAQrb,EAAKgQ,GAAQ3G,EAAIkM,WAAWtK,MAAMmY,OAAQT,EAAevT,EAAWuC,YAAavC,EAAWsC,cAAe6J,IAOnHwH,WAAYpG,GAAkBjd,KAAK,KAAMsQ,IACzCiT,gBAAkBzuB,GAASioB,GAAuBzM,GAAQxb,EAhBtC,MCAxB,MAAMwb,GAAS,cAYA,CACXsP,KAAMvC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9CuP,KAAMxC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9Czd,IAbaiC,IACb,MAAMwL,IAACA,EAAGqJ,IAAEA,EAAG+F,WAAEA,EAAUoQ,QAAEA,GAAWhrB,EACxC,IAAK6U,EAAK,OACV,MAAMsZ,cAACA,EAAalD,aAAEA,GAAgBD,EAChCkE,EAAiB,IAAI/T,UAAU8T,MAAMpa,EAAIsa,0BAA2B,CAACxvB,KAAQ,qBAC7EonB,EAAY5B,GAAqBvK,EAA4B,iBACnEiM,GAAQrb,EAAKgQ,GAAQ0T,EAAeN,OAAQT,EAAevT,EAAWR,eAAgBQ,EAAWV,iBAAkB6M,GACnHf,GAAUxa,EAAKgQ,GAAQ0T,EAAeN,OAAQ3D,EAAcrQ,IAO5D2T,WAAYpG,GAAkBjd,KAAK,KAAMsQ,IACzCqS,eAAgB7F,GAAsB9c,KAAK,KAAMsQ,IACjDiT,gBAAiBxG,GAAuB/c,KAAK,KAAMsQ,IACnDsS,eAAgBjG,GAAsB3c,KAAK,KAAMsQ,KCjBrD,MAAMA,GAAS,OAIT4T,GAAiB,CAAC1f,EAAImW,EAAUO,EAAYC,KACvC,CACH3W,GAAM,GAAGA,iBACTtM,KAAQ,SACRskB,OAAU,GAAGhY,EAAGoH,QAAQ,UAAW,kBACnC6Q,OAAU,CACNvB,WAAc,EAAgB,UAAY,OAC1C,aAAc,CAAC,MAAO,SACtB,YAAaC,EACb,cAAe,CAAC,GAAI,IACpB,cAAe,SACf,yBAAyB,EACzB,sBAAsB,EACtB,mBAAoB,eAExBuB,MAAS,CACL,kBAAmB,OACnB,aAAchC,GAA0BC,GACxC,eAAgBE,GAA6BF,EAAU,KApBtC,OA0LtB,SAASwJ,GAAoBrvB,GAChC,MAAMwL,IAACA,EAAGoP,WAAEA,GAAc5a,EACpB4mB,EAAc,oBAKpB,OAJIpb,EAAIsc,SAASlB,KACbpb,EAAI0c,iBAAiBtB,EAAa,aAAchB,GAA0BhL,EAAqB,SAAGA,EAAuB,aACzHpP,EAAI0c,iBAAiBtB,EAAa,eAAgBb,GAA6BnL,EAAqB,SAAGA,EAAuB,WA/LzG,OAiMlB,SAEI,CACXkQ,KAAO9qB,GAAS,CAACwb,GAAQ,kBAAmB,cAAe,0BAA0BziB,SAAQyiB,GAAU+M,GAAqB/M,GAAQ,EAAMxb,KAC1I+qB,KAAO/qB,GAAS,CAACwb,GAAQ,kBAAmB,cAAe,0BAA0BziB,SAAQyiB,GAAU+M,GAAqB/M,GAAQ,EAAOxb,KAC3IjC,IA9KG,SAAmBiC,GACtB,MAAMwL,IAACA,EAAGqJ,IAAEA,EAAGmW,QAAEA,EAAOpQ,WAAEA,GAAc5a,EACxC,IAAK6U,EAAK,OACV,MAAMoW,aAACA,EAAYkD,cAAEA,GAAiBnD,EAChC/E,EAASgF,EACTnE,EAAaqH,EACbtI,EAAWjL,EAAWL,SACtB6L,EAAaxL,EAAWP,WAExBiV,EAAQ,CACVC,KAAQ,GACR,kBAAmB,IAEjBC,EAAU,CACZD,KAAQ,GACR,kBAAmB,IAEvB,IAAK,IAAIE,KAAS5a,EAAI6a,OAAQ,CAC1B,MAAMlU,EAAUiU,EAAgB,WAAI,OAAS,kBACvCE,EAAYF,EAAM9vB,KAAKjF,OAAO,GAC9Bk1B,EAAeH,EAAMpa,MAAM1N,UAC3BkoB,EAA6B,SAAjBD,EAA2B,KAAUD,IAAgC,SAAjBC,EAA2B,GAAGD,MAAqBA,EACzH,GAAI7I,EAAY,CACZ,MAAMO,EAAWP,EAAW2I,EAAMb,QAC5BtH,EAASD,EAASlsB,OACxB,IAAK,IAAIC,EAAE,EAAGA,EAAEksB,EAAOlsB,IACnBk0B,EAAM9T,GAAQrhB,KAAK2qB,GAASuC,EAASjsB,GAAI,CAACkV,MAAOuf,UAGrDP,EAAM9T,GAAQrhB,KAAK2qB,GAAS2K,EAAMb,OAAOpjB,KAAIgR,GAAK,CAACA,EAAEzE,UAAWyE,EAAE1E,YAAY,CAACxH,MAAOmf,EAAM9vB,KAAKjF,OAAO,MAE5G,MAAM0d,EAAaqX,EAAMb,OAAO,GAChC,IAAIpK,EAAS,EAAWyB,EAAO,CAAC7N,EAAWL,UAAWK,EAAWN,WAAa,CAACM,EAAWL,UAAWK,EAAWN,UAC5G0M,GAAQgL,EAAQhU,GAAQrhB,KAAKoqB,GAAUC,EAAQ,CAC/ClU,MAAO,GAAImf,EAAY,OAAIA,EAAM9vB,KAAO,KAAO,KAAKyY,EAAWzY,OAC/DmwB,YAAaL,EAAMK,YACnBL,MAAOA,EAAM9vB,KACbowB,MAAO3X,EAAWzY,KAClBqwB,OAAQP,EAAMO,OACdroB,UAAWioB,EACXK,kBAAoBR,EAAY,OAAI,EAAI,KAE5C,MAAMpX,EAAYoX,EAAMb,OAAOa,EAAMb,OAAOzzB,OAAS,GACrDqpB,EAAS,EAAWyB,EAAO,CAAC5N,EAAUN,UAAWM,EAAUP,WAAa,CAACO,EAAUN,UAAWM,EAAUP,UACpG0M,GAAQgL,EAAQhU,GAAQrhB,KAAKoqB,GAAUC,EAAO,CAC9ClU,MAAO,GAAImf,EAAY,OAAIA,EAAM9vB,KAAO,KAAO,KAAK0Y,EAAU1Y,OAC9DmwB,YAAcL,EAAMK,YACpBL,MAAOA,EAAM9vB,KACbowB,MAAO1X,EAAU1Y,KACjBqwB,OAAQP,EAAMO,OACdroB,UAAWioB,EACXM,MAAO,EACPD,kBAAoBR,EAAY,OAAI,EAAI,KAGhDjkB,EAAI8a,UAAU,qBAAsB1B,GAAkB4K,EAAc,OACpEhkB,EAAI8a,UAAU,gCAAiC1B,GAAkB4K,EAAQ,qBACzEhkB,EAAI8a,UAAU,mBAAoB1B,GAAkB0K,EAAY,OAChE9jB,EAAI8a,UAAU,8BAA+B1B,GAAkB0K,EAAM,qBACrE,MAAMjJ,EAAWnB,GAAoBtK,EAA2B,gBAC1DmM,EAAY5B,GAAqBvK,EAA4B,gBArF/C,GAsFdyK,EAAWN,GAAgBnK,EAA2B,gBAC5DpP,EAAImb,SAASM,GAAU,OAAQpB,EAAUO,EAAYW,IACrDvb,EAAImb,SAASM,GAAU,kBAAmBrM,EAAWK,mBAAoBmL,EAAYW,IACrFvb,EAAImb,SAASC,GAAY,OAAQf,EAAUO,EAAYC,EAAUhB,IACjEgK,GAAoBrvB,GACpBwL,EAAIuc,kBAAkB,oBAAqB,kBAAmB,CAAC,OAAQ,CAAC,KAAM,EAAG,CAAC,MAAO,sBAAuB,EAAG,IACnHvc,EAAImb,SAASC,GAAY,kBAAmBf,EAAUO,EAAYC,EAAUhB,IAC5E7Z,EAAImb,SAASyI,GAAe,cAAevJ,EAAUO,EAAYC,IACjE7a,EAAImb,SAASyI,GAAe,yBAA0BxU,EAAWK,mBAAoBmL,EAAYC,IAEjG,MAAMuF,EAASroB,IACX,MAAMohB,EAAcphB,EAAEshB,SAAS,GAAGH,SAASC,YAAYjqB,QAIvD,KAAOO,KAAK8O,IAAIxG,EAAEihB,OAAOgI,IAAM7H,EAAY,IAAM,KACjDA,EAAY,IAAMphB,EAAEihB,OAAOgI,IAAM7H,EAAY,GAAK,KAAO,IAEzD,MAAM7oB,EAAQyH,EAAEshB,SAAS,GAAGJ,WAEtB0L,GAAa,IAAItE,SAASC,OAC3BkB,UAAUrI,GACVuI,MAAM1hB,GACL9R,EAAcqb,GAAYzb,WAAU4b,IACtC,IAAI4a,EAAch0B,EAAMg0B,YAAYhZ,QAAQhb,EAAMi0B,MAAO,MAAMj0B,EAAMi0B,aACjEK,EAAQ,MAACt1B,OAAWA,OAAWA,GAC/BgB,EAAMk0B,SAAQI,EAAQvb,EAAIM,WAAW7P,QAAO,EAAE3J,KAAQwf,UAAUkV,QAAQv0B,EAAMi0B,OAAS5U,UAAUmV,iBAAiBx0B,EAAMi0B,OAAOQ,OAAS50B,EAAEgE,KAAM7D,EAAMi0B,QAAUp0B,EAAEgE,OAAM0H,OAAS+oB,GACrL,OAASI,EAAKvY,GAAMmY,EACpB,IAAIK,EAAY,EAAO,QAAQxY,IAAO,GACtC,MAAMtQ,EAAiC,SAApB7L,EAAM6L,UAAwB,KAA4B,SAApB7L,EAAM6L,UAAwB,KAAO,GAC9F,GAAIsQ,GACItQ,EAAW,CACX,MAAM+oB,EAAU,IAAIC,OAAOC,OAAOC,GAAG,SAASlpB,gBAAwBsQ,MAAQ,KACxE6Y,EAAchB,EAAYhZ,QAAQ4Z,EAAS,mDAE7CZ,EADAA,GAAegB,EACDA,EAEAhB,EAAYhZ,QAAQ,QAAQnP,IAAa,8BAA8BA,cAIjG,MAAMopB,EAAOP,GAAOtb,EAAgB,WAAa,IAAKlY,KAAKkY,EAAaE,UAAY,IAAQob,GAAMQ,cAAcC,UAAU,GAAG,IAAM,IAAM,GACzI,IAAIpE,EAAO,0BAA0B/wB,EAAM2zB,QAAQsB,IAAMN,YAAoBX,QAC7EK,EAAWlD,QAAQJ,MAEvBsD,EAAW1C,GAAG,SAAS,KACnB/zB,QAGFw3B,EAAiB1V,IACnB,MAAM2V,EAAQ3V,EAAS,gBACvBhQ,EAAIiiB,GAAG,QAAS0D,EAAOvF,GACvBpgB,EAAIiiB,GAAG,aAAc0D,GAAO,WACxB3lB,EAAI4hB,YAAYtuB,MAAMuuB,OAAS,aAEnC7hB,EAAIiiB,GAAG,aAAc0D,GAAO,WACxB3lB,EAAI4hB,YAAYtuB,MAAMuuB,OAAS,OAGvC6D,EAAc,QACdA,EAAc,mBAiCVlG,EAAQoG,aAhCe,MACvB,MAAMC,EAAUxc,EAAI6a,OAAOpqB,QAAOlB,GAAKA,EAAE4rB,SAAQ3oB,MACjD,GAAIgqB,GAAWA,EAAQzC,OAAOzzB,OAAS,EAAG,CACtC,MAAMm2B,EAAaD,EAAQzC,OAAO,GAC5B3I,EAAS+E,EAAQC,aACjBzG,EAAS,EAAWyB,EAAO,CAACqL,EAAWvZ,UAAWuZ,EAAWxZ,WAAa,CAACwZ,EAAWvZ,UAAWuZ,EAAWxZ,UAClH,GAAI0M,EAAQ,CACR,MAAOzM,EAAWD,GAAY0M,EACxB+M,EAAY,CACd/M,OAAO,CACHgI,IAAOzU,EACPyZ,IAAO1Z,GAEX+M,SAAU,CACN,CACIJ,WAAc,CACVgL,MAAS4B,EAAQ1xB,KACjBowB,MAASuB,EAAW3xB,KACpBqwB,QAAU,EACVF,YAAeuB,EAAQvB,YACvBnoB,UAAa0pB,EAAQhc,MAAM1N,WAE/B+c,SAAY,CACRC,YAAe,CAAC5M,EAAWD,OAK3C8T,EAAM2F,MAIOE,eAG7B,SAAoBzxB,GAGhB,OAFAmoB,GAAkB3M,GAAQxb,IAASmoB,GAAkB,cAAenoB,GACpEqvB,GAAoBrvB,IACb,GAgBP6tB,eAAiB7tB,GAAS,CAACwb,GAAQ,kBAAmB,cAAe,0BAA0BziB,SAAQyiB,GAAUwM,GAAsBxM,EAAQxb,KAC/IyuB,gBAAkBzuB,GAAS,CAACwb,GAAQ,mBAAmBziB,SAAQyiB,GAAUyM,GAAuBzM,EAAQxb,EA1MpF,KA2MpB8tB,eAAiB9tB,GAAS,CAACwb,GAAQ,mBAAmBziB,SAAQyiB,GAAUqM,GAAsBrM,EAAQxb,MC7M1G,MAAMwb,GAAS,QCMf,MAAMkW,GAAS,CACXC,QAAWA,GACXC,MAASA,GACTC,IAAOA,GACPC,YAAe9C,GACf+C,OAAUA,GACVC,KAAQA,GACRC,MDQW,CACXnH,KAAMvC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9CuP,KAAMxC,GAAqBrd,KAAK,KAAMsQ,IAAQ,GAC9Czd,IAtBciC,IACd,MAAMwL,IAACA,EAAGqJ,IAAEA,EAAG+F,WAAEA,EAAUoQ,QAAEA,GAAWhrB,EACxC,IAAK6U,EAAK,OACV,MAAMsZ,cAACA,EAAalD,aAAEA,GAAgBD,EAChCvU,EAAQ5B,EAAI4B,MAClBA,EAAM9W,KAAO,GAAGkV,EAAIQ,MAAMyZ,WAAWja,EAAIQ,MAAM0Z,WAC/CtY,EAAMqZ,YAAcjb,EAAIib,YACxB,MAAM/I,EAAY5B,GAAqBvK,EAA4B,iBACnEiM,GAAQrb,EAAKgQ,GAAQ/E,EAAMmY,OAAQT,EAAevT,EAAWX,YAAY,EAAM8M,GAC/Ef,GAAUxa,EAAKgQ,GAAQ/E,EAAMmY,OAAQ3D,EAAcrQ,IAcnD2T,WAXgBvuB,IAChBmoB,GAAkB3M,GAAQxb,GNEvB,SAA6BA,GAChC,MAAMwL,IAACA,EAAGoP,WAAEA,GAAc5a,GACnBynB,EAAUnW,GAAW2K,GAAarB,EAAWX,YAChDzO,EAAIsc,SAASkG,MACbxiB,EAAI0c,iBAAiB8F,GAAe,aAAcvG,GAClDjc,EAAI0c,iBAAiB8F,GAAe,eAAgB1c,IMNxD4gB,CAAoBlyB,GACpBqvB,GAAoBrvB,IACb,GAQP6tB,eAAgB7F,GAAsB9c,KAAK,KAAMsQ,IACjDiT,gBAAiBxG,GAAuB/c,KAAK,KAAMsQ,IACnDsS,eAAgBjG,GAAsB3c,KAAK,KAAMsQ,KCdjD+T,KAAQG,IClBNyC,GAAmB,EAAVl3B,KAAKm3B,GACdC,GAASp3B,KAAKm3B,GAAK,EAKnBE,GAAa,SAASn6B,GAC1B,OAAQ8C,KAAK8O,IAAI5R,IALP,cAKoBA,EAAKA,EAJxB,SAASA,GAClB,OAAOA,EAAE,GAAK,EAAI,EAGoBo6B,CAAKp6B,GAAKg6B,IA+C7C,OACQ,CACXtoB,KAtCG,aAuCH2oB,QAjCG,SAAiB72B,GACpB,IAAI82B,EAAM92B,EAAExD,EACRq5B,EAAM71B,EAAE6V,EACRkhB,EAAOJ,GAAWG,EAAM5xB,KAAK8xB,OAC7BC,EAAI33B,KAAK43B,IAAIrB,EAAI,GACjBsB,EAAI73B,KAAK83B,IAAIV,GAASO,GACtBI,EAAKF,EAAEA,EACP36B,EAAI0I,KAAKoyB,GAAMpyB,KAAK1H,EAAIu5B,GAAS,OAAU,OAAQM,GACnDxhB,EAAI3Q,KAAKqyB,GAAe,QAATryB,KAAK1H,EAAey5B,EAGvC,OAFAj3B,EAAExD,EAAIA,EACNwD,EAAE6V,EAAIA,EACC7V,GAuBPw3B,QAlBG,SAAiBx3B,GACpBA,EAAExD,GAAK0I,KAAKoyB,GACZt3B,EAAE6V,GAAK3Q,KAAKqyB,GACZ,IAAIN,EAAIj3B,EAAE6V,EAAI,QAAU3Q,KAAK1H,EACzB25B,EAAI73B,KAAK83B,IAAIV,GAASO,GACtBI,EAAKF,EAAEA,EACPL,EAAMH,GAAWzxB,KAAK8xB,MAASh3B,EAAExD,EAAI0I,KAAK1H,GAAK,OAAU,OAAU65B,IACnExB,EAAM,EAAIv2B,KAAKm4B,KAAKR,GAIxB,OAFAj3B,EAAExD,EAAIs6B,EACN92B,EAAE6V,EAAIggB,EACC71B,GAQP03B,MALe,CAAC,YAAa,UCrDjC,MACMtpB,GAAM9O,KAAK8O,IACXupB,GAAOr4B,KAAKq4B,KACZC,GAAMt4B,KAAKs4B,IACXR,GAAM93B,KAAK83B,IACXS,GAAOv4B,KAAKu4B,KAMRC,GAAK,SACXC,IAAM,QACNC,GAAK,OACLC,GAAK,QACLC,GAAIL,GAAK,GAAK,EAyCX,OACQ,CACX3pB,KArCG,aAsCH2oB,QA/BG,SAAiB72B,GACpB,MAAMm4B,EAASn4B,EAAExD,EACX47B,EAAMp4B,EAAE6V,EACR5E,EAAI0mB,GAAKO,GAAId,GAAIgB,IAAOC,EAAKpnB,EAAIA,EAAGqnB,EAAKD,EAAKA,EAAKA,EAGzD,OAFAr4B,EAAExD,EAAI0I,KAAK1H,EAAI26B,EAASP,GAAI3mB,IAAMinB,IAAKJ,GAAK,EAAIC,GAAKM,EAAKC,GAAM,EAAIN,GAAK,EAAIC,GAAKI,KAClFr4B,EAAE6V,EAAI3Q,KAAK1H,EAAIyT,GAAK6mB,GAAKC,GAAKM,EAAKC,GAAMN,GAAKC,GAAKI,IAC5Cr4B,GA0BPw3B,QArBG,SAAiBx3B,GACpB,MAAM6V,EAAI7V,EAAE6V,EAAI3Q,KAAK1H,EACfhB,EAAIwD,EAAExD,EAAI0I,KAAK1H,EAErB,IAAIyT,EAAI4E,EAAGwiB,EAAKpnB,EAAIA,EAAGqnB,EAAKD,EAAKA,EAAKA,EACtC,IAAK,IAAWE,EAAP94B,EAAI,EAAmBA,EA5BnB,KA+BTwR,GAAKsnB,GAFAtnB,GAAK6mB,GAAKC,GAAKM,EAAKC,GAAMN,GAAKC,GAAKI,IAAOxiB,IAC1CiiB,GAAK,EAAIC,GAAKM,EAAKC,GAAM,EAAIN,GAAK,EAAIC,GAAKI,IAC1BA,EAAKpnB,EAAIA,EAAGqnB,EAAKD,EAAKA,EAAKA,IAC9CjqB,GAAImqB,GAhDC,UA4CqC94B,GASlD,OAFAO,EAAExD,EAAK07B,GAAI17B,GAAKs7B,GAAK,EAAIC,GAAKM,EAAKC,GAAM,EAAIN,GAAK,EAAIC,GAAKI,IAAOT,GAAI3mB,GACtEjR,EAAE6V,EAAI8hB,GAAKP,GAAInmB,GAAKinB,IACbl4B,GAQP03B,MALe,CAAC,cAAe,YCxC5B,SAASc,GAAUzkB,EAAIuU,EAAYpP,EAAK+F,EAAYpF,EAAc4e,EAAUhD,GAAY,GACtFv0B,OAAOw3B,MAAMC,KAAKC,YAAYjI,IAAI,UAAUzvB,OAAOw3B,MAAMC,KAAKC,YAAYx2B,IAAIy2B,IAC9E33B,OAAOw3B,MAAMC,KAAKC,YAAYjI,IAAI,YAAYzvB,OAAOw3B,MAAMC,KAAKC,YAAYx2B,IAAI02B,IAarF,IAAIC,EAAgB,CAChBC,UAAYjlB,EACZklB,OAAU,CAAC,EAAG,IACdC,KAAQ,EACRC,oBAAsB,EACtBC,kBAjBsB,MACtB,MAAMC,EAAsB,+BAC5B,OAAI/Q,EAAWvU,GAAG4L,WAAW,UAClB,uBAAuB0Z,IACvB/Q,EAAWvU,GAAG4L,WAAW,QAAU2I,EAAWvU,GAAG4L,WAAW,OAC5D,+BAA+B0Z,IAC/B/Q,EAAWvU,GAAG4L,WAAW,OACzB,KAAKze,OAAOo4B,KAAK,qDAEjB,oBAAoBD,KAQVD,IAEzB,MAAMvpB,EAAM,IAAIqgB,SAAS5f,IAAI,IAAIgY,EAAWyQ,iBAAkBA,IAmC9D,IAAIzO,EAAQiP,EAAgBjK,EAAckD,EAlC1C3iB,EAAI2pB,gBAAgB,IAAK,IACzB3pB,EAAI4pB,UAAU,2BAA2B,SAASryB,EAAOsyB,GACjDtyB,GAGAyI,EAAI8pB,SAAS,gBAAiBD,EAAO,CAAEE,WAAY,EAAGC,KAAK,OAGnEhqB,EAAI4pB,UAAU,4BAA4B,SAASryB,EAAOsyB,GAClDtyB,GAGAyI,EAAI8pB,SAAS,eAAgBD,EAAO,CAAEE,WAAY,EAAGC,KAAK,OAGlEhqB,EAAI4pB,UAAU,0BAA0B,SAASryB,EAAOsyB,GAChDtyB,GAGAyI,EAAI8pB,SAAS,cAAeD,EAAO,CAAEE,WAAY,EAAGC,KAAK,OAGjEhqB,EAAI4pB,UAAU,wBAAwB,SAASryB,EAAOsyB,GAC9CtyB,GAGAyI,EAAI8pB,SAAS,WAAYD,EAAO,CAAEE,WAAY,EAAGC,KAAK,OAK9D34B,OAAOw3B,MAAMoB,KAAK,QAAS,8BAE3B54B,OAAOw3B,MAAMoB,KAAK,YAAY,6HAE9B,IAsDIpmB,EAtDAqmB,EAAalR,GAAW3nB,OAAOw3B,MAAM,QAAS,YAAa7P,GAC3DmR,EAAYC,GAAO/4B,OAAOw3B,MAAM,YAAa,QAASuB,GAE1D,GAAI3R,EAAW4R,OAAQ,CAEnB,IAAI18B,EAAGC,EAAGmE,EAAGmC,EACb,GAFA7C,OAAOw3B,MAAMoB,KAAK,SAAUxR,EAAWoQ,OAEnCpQ,EAAW6R,iBACV38B,EAAGC,EAAGmE,EAAGmC,GAAKukB,EAAW6R,oBACzB,CACD,MAAMC,EAAiB,EAAE,aAAc,WAAa,YAAa,aAC1D9C,EAAIC,EAAI8C,EAAIC,GAAMhS,EAAW4R,OACpC,IAAKK,EAAIC,EAAIC,EAAIC,GAAMN,EACvB,GAAI9R,EAAWe,MAAO,CAClB,MAAMsR,EAAiBP,EAAe,GAAKA,EAAe,IACnDQ,EAAGzJ,GAAK7I,EAAWe,MACpBwR,EAAM1J,EAAIyJ,EAAKD,GACpBJ,EAAIC,EAAIC,EAAIC,GAAM,CAACN,EAAe,GAAIA,EAAe,GAAKS,EAAIT,EAAe,GAAKA,EAAe,IAEtG58B,GAAKi9B,EAAKF,IAAOF,EAAK/C,GACtB75B,EAAI88B,EAAM/8B,EAAI85B,EACd11B,GAAK84B,EAAKF,IAAOF,EAAK/C,GACtBxzB,EAAIy2B,EAAM54B,EAAI21B,EAGlB,MAAOuD,EAAMC,EAAMC,EAAMC,GAAS3S,EAAmB,SAAIA,EAAW4S,SAAW5S,EAAW4R,OACpFiB,EAAYtS,GAAW3nB,OAAOw3B,MAAM,QAAS,SAAU7P,GAEvDuS,EAAeC,GAAO,CAAE79B,EAAI69B,EAAG,GAAM59B,EAAImE,EAAIy5B,EAAG,GAAMt3B,GACtDu3B,EAAkBD,GAA0DrB,EAASoB,EAAYC,IAEvGtB,EAAalR,GACFuS,EAAYD,EAAStS,IAEhCyB,EAAUzB,GACCmR,EAASD,EAAUlR,IAE9B0Q,EAAkB1Q,IACd,IAAK0S,EAAGC,GAAKL,EAAStS,GAGtB,OAFA0S,EAAInoB,GAAMmoB,EAAGT,EAAME,GACnBQ,EAAIpoB,GAAMooB,EAAGT,EAAME,GACZK,EAAe,CAACC,EAAGC,KAE9BlM,EAAgBzG,IACZ,IAAK0S,EAAGC,GAAKL,EAAStS,GACtB,GAAItV,GAASgoB,EAAGT,EAAME,IAASznB,GAASioB,EAAGT,EAAME,GAC7C,OAAOK,EAAe,CAACC,EAAGC,KAGlChJ,EAAiBnuB,IACb,GAAoB,IAAhBA,EAAK7E,OAAc,MAAO,GAE9B,OnCxBL,SAAkByzB,EAAQvf,EAAMtT,GAEnC,IAGIX,EAAGjC,EAAGC,EAAGg+B,EAAOC,EAHhBr8B,EAAM4zB,EAAOzzB,OACbm8B,EAAQhoB,GAAQsf,EAAO,GAAIvf,GAC3BkoB,EAAO,GAKX,IAFKx7B,IAAQA,EAAS,IAEjBX,EAAI,EAAGA,EAAIJ,EAAKI,IAAK,CAMtB,IALAjC,EAAIy1B,EAAOxzB,EAAI,GAEfg8B,EAAQC,EAAW/nB,GADnBlW,EAAIw1B,EAAOxzB,GACmBiU,KAGjB,CAET,KAAMioB,EAAQF,GAAQ,CAClBG,EAAKp9B,KAAKhB,GAENi+B,IAAUC,GACVE,EAAKp9B,KAAKf,GAENgC,EAAIJ,EAAM,IACVe,EAAO5B,KAAKo9B,GACZA,EAAO,KAEJn8B,IAAMJ,EAAM,GACnBu8B,EAAKp9B,KAAKf,GAEd,MAEG,GAAIk+B,EAAQF,EACf,MAEOE,EAEPA,EAAQhoB,GADRnW,EAAIgW,GAAUhW,EAAGC,EAAGk+B,EAAOjoB,GACRA,GAInB+nB,EAAQ9nB,GADRlW,EAAI+V,GAAUhW,EAAGC,EAAGg+B,EAAO/nB,GACRA,GAI3BioB,EAAQD,EAKZ,OAFIE,EAAKp8B,QAAQY,EAAO5B,KAAKo9B,GAEtBx7B,EmC1BQy7B,CADQx3B,EAAKwL,KAAIgR,GAAKsa,EAAS,CAACta,EAAEzE,UAAWyE,EAAE1E,aAC9BmM,EAAW4R,QAAQrqB,KAAIoB,GAAKA,EAAEpB,KAAIwrB,GAAMC,EAAeD,QAIvF,IAAIpI,EAAS,GACb,GAAI/Z,EAAK,CACL,IAAK,MAAM4a,KAAS5a,EAAI6a,OACpBd,EAASA,EAAOjE,OAAO8E,EAAMb,QAEjCA,EAASA,EAAOjE,OAAO9V,EAAI4B,MAAMmY,OAAQ/Z,EAAIsa,2BAC7C9f,EnCmCiB,EAACuf,EAAQsG,EAAgBn5B,EAAO,CAAC07B,EAAAA,EAAUA,EAAAA,GAAU,EAAA,GAAW,EAAA,MACrF,IAAK,MAAOjL,EAAKgF,KAAQ5C,EAAOpjB,KAAIgR,GAAK,EAAmB0Y,EAAe,CAAC1Y,EAAEzE,UAAWyE,EAAE1E,WAAa,CAAC0E,EAAEzE,UAAWyE,EAAE1E,YAChH/b,EAAO,GAAKywB,IAAOzwB,EAAO,GAAKywB,GAC/BzwB,EAAO,GAAKy1B,IAAOz1B,EAAO,GAAKy1B,GAC/Bz1B,EAAO,GAAKywB,IAAOzwB,EAAO,GAAKywB,GAC/BzwB,EAAO,GAAKy1B,IAAOz1B,EAAO,GAAKy1B,GAMvC,OAJAz1B,EAAO,IAAM,EACbA,EAAO,IAAM,EACbA,EAAO,IAAM,EACbA,EAAO,IAAM,EACNA,GmC9CI27B,CAAU9I,EAAQsG,GAEzB1pB,EAAImsB,UAAUtoB,EAAM,CAACuoB,QAAS,CAACC,IAAK,GAAIC,OAAO,GAAIC,KAAM,GAAIC,MAAO,MAGxE,MAAMC,EAAY,IAAIpM,SAASqM,iBAAiB,CAC5CC,gBAAiB,CACbC,oBAAoB,GAExBC,iBAAkB,CAACC,QAAS,GAC5BC,mBAAmB,IAEvB,GAAItS,EAAQ,CACR,MAAMuS,EAAoBP,EAAUQ,WACpCR,EAAUQ,WAAa,SAAS7gB,GAC5B,MAAO4U,EAAKgF,GAAOvL,EAAO,CAACrO,EAAS8gB,OAAO3gB,UAAWH,EAAS8gB,OAAO5gB,WACtE,OAAO0gB,EAAkB9pB,MAAM7N,KAAM,CAAC,CAAC63B,OAAU,CAAC3gB,UAAayU,EAAK1U,SAAY0Z,EAAKmH,SAAY/gB,EAAS8gB,OAAOC,cAIzH,MAAM3N,EAAU,CAACxf,IAAAA,EAAKya,OAAAA,EAAQiP,eAAAA,EAAgB/G,cAAAA,EAAelD,aAAAA,EAAc5b,KAAAA,EAAM4U,WAAAA,EAAYgU,UAAAA,EAAW7G,YAAAA,GA0FxG,OAlEA5lB,EAAIotB,WAAW,IAtBf,MACIC,MAAMrtB,GAYN,OAXA3K,KAAKi4B,KAAOttB,EACZ3K,KAAKk4B,WAAaz6B,SAASsB,cAAc,OACzCiB,KAAKk4B,WAAWC,UAAY,qCAC5Bn4B,KAAKo4B,QAAU36B,SAASsB,cAAc,UACtCiB,KAAKo4B,QAAQD,UAAY,uBACzBn4B,KAAKo4B,QAAQ/3B,aAAa,OAAQ,UAClCL,KAAKo4B,QAAQ/3B,aAAa,QAAS,0BACnCL,KAAKq4B,sBAAwB5kB,GAAUhb,WAAUsqB,GAAc/iB,KAAKo4B,QAAQE,UA3JtD7kB,CAAAA,GAC1B,EACE,sDACA,gDAwJ0F8kB,CAAexV,KACvG/iB,KAAKk4B,WAAW36B,YAAYyC,KAAKo4B,SACjCp4B,KAAKw4B,eAAiB,IAAMhlB,GAAQjN,QAAQxN,IAAWA,IACvDiH,KAAKo4B,QAAQz4B,iBAAiB,QAASK,KAAKw4B,gBACrCx4B,KAAKk4B,WAEZO,WACAz4B,KAAKo4B,QAAQx4B,oBAAoB,QAASI,KAAKw4B,gBAC/Cx4B,KAAKq4B,wBACLr4B,KAAKk4B,WAAW15B,WAAWC,YAAYuB,KAAKk4B,YAC5Cl4B,KAAKi4B,UAAOh+B,KAIhB0Q,EAAIotB,WAAWX,GAsCfzsB,EAAIiiB,GAAG,QAAQ,WHvMU,CAACztB,IAC1B,MAAMwL,IAACA,EAAGyY,WAAEA,GAAcjkB,EACtBikB,EAAWsV,QACX/tB,EAAI8a,UAAU,YAAY,CACtBljB,KAAQ,SACRm2B,MAAStV,EAAWsV,MACpBC,SAAYvV,EAAWuV,WAE3BhuB,EAAImb,SAAS,CACTjX,GAAM,WACNtM,KAAQ,SACRskB,OAAU,YACV+R,QAAW,EACXC,QAAW,GACX9R,MAAM,CACF,iBAAkB,MAI9BjvB,OAAOib,OAAO8d,IAAQ34B,SAAQo4B,GAASA,EAAMpzB,KAAOozB,EAAMpzB,IAAIiC,MGsL1D25B,CAAc,CACV9kB,IAAAA,EACA+F,WAAAA,EACAoQ,QAAAA,EACAxf,IAAAA,EACAyY,WAAAA,EACAzO,aAAAA,IAKA4e,GAAUA,EAAS5oB,EAAKyY,MAOhCzY,EAAIiiB,GAAG,UAAU,eAOVzC,ECrPJ,MAAM4O,GACTtsB,YAAYusB,EAAQC,EAAS9/B,GACzB6G,KAAKg5B,OAASA,EAEdh5B,KAAKk5B,UAAY,IAAIl8B,SAAQ,CAAC6I,EAAS6G,KACnC,MAAMysB,EAAOC,UAAUD,KAAKH,EAAQC,GACpCE,EAAKE,UAAY,KACbxzB,EAAQszB,IAEZA,EAAKG,QAAU,KACX5sB,EAAO,2BAEXysB,EAAKI,gBAAkB,EAAapgC,EAASkR,KAAK,KAAM8uB,GAAO,UAIvEK,kBAAkB9pB,GACd,OAAOA,EAAIE,SAASqG,QAAQ,QAAQ,KAExCwjB,uBAAwBC,EAASC,GAC7B,MAAMR,QAAan5B,KAAKk5B,UACxB,OAAO,IAAIl8B,SAAQ,CAAC6I,EAAS6G,KACzB,MAEMktB,EAFMT,EAAKj+B,OAAO2+B,YAAYF,EAAW,YAC9BG,YAAYH,GACClO,IAAIiO,GAClCE,EAAgBP,UAAY,KACxBxzB,EAAQ+zB,EAAgB1+B,SAE5B0+B,EAAgBN,QAAU,KACtB5sB,EAAO,0DAInBqtB,mBAAmBL,EAASC,EAAWhZ,GACnC,MAAMwY,QAAan5B,KAAKk5B,UACxB,OAAO,IAAIl8B,SAAQ,CAAC6I,EAAS6G,KACzB,MACMhU,EADKygC,EAAKj+B,OAAO2+B,YAAYF,EAAW,aAC7BG,YAAYH,GACvBK,EAActhC,EAAMuhC,IAAItZ,EAAM+Y,GACpCM,EAAYX,UAAY,KACpB,MAAMO,EAAkBlhC,EAAM+yB,IAAIiO,GAClCE,EAAgBP,UAAY,KACxBxzB,EAAQ+zB,EAAgB1+B,UAGhC8+B,EAAYV,QAAU,KAClB5sB,EAAO,uDAInBwtB,gBAAgBP,GACZ,OAAO35B,KAAKm6B,cAAc9vB,KAAKrK,KAAM25B,GAEzCS,kBAAkBT,EAAWjqB,GACzB,MAAM2qB,EAAUr6B,KAAKw5B,kBAAkB9pB,GACjCypB,QAAan5B,KAAKk5B,UACxB,OAAO,IAAIl8B,SAAQ,CAAC6I,EAAS6G,KACzB,MAEMktB,EAFMT,EAAKj+B,OAAO2+B,YAAYF,EAAW,YAC9BG,YAAYH,GACCW,OAAOD,GACrCT,EAAgBP,UAAY,KACxBxzB,OAAoC5L,IAA3B2/B,EAAgB1+B,OAAwBwU,EAAM,OAE3DkqB,EAAgBN,QAAU,KACtB5sB,EAAO,8DAInB6tB,iBAAiBZ,GACb,MAAMR,QAAan5B,KAAKk5B,UACxB,OAAO,IAAIl8B,SAAQ,CAAC6I,EAAS6G,KACzB,MAEM8tB,EAFMrB,EAAKj+B,OAAO2+B,YAAYF,EAAW,YAC9BG,YAAYH,GACDc,QAC5BD,EAAcnB,UAAY,IAAMxzB,EAAQ20B,EAAct/B,QACtDs/B,EAAclB,QAAU,IAAM5sB,EAAO,0DAG7CguB,qBACuB16B,KAAKk5B,WACnBh+B,OAAOw/B,QAEhBP,oBAAoBR,GAAWgB,QAAEA,EAAOjrB,IAAEA,IACtC,MAAM2qB,EAAUr6B,KAAKw5B,kBAAkB9pB,GACvC,OAAO1P,KAAKy5B,iBAAiBY,EAASV,GAAW3zB,MAAM2a,GAC/CA,EAEO,IAAIia,SAASja,GAGb+J,MAAMiQ,GAAS30B,MAAK2kB,GACLA,EAASkQ,QACVla,SAClB3a,MAAK80B,GACAA,EAAUv4B,KAAKkY,WAAW,WAA8B,2BAAnBqgB,EAAUv4B,KACxCvC,KAAK+5B,aAAaM,EAASV,EAAWmB,GAAW90B,MAAM2a,GACnD,IAAIia,SAASja,KAGjB,IAAIia,SAAS,GAAI,CAAEG,OAAW,IAAMjP,WAAe,kCAOlF,SAASkP,GAASpJ,EAAIoC,GAAQ,OAAQ55B,KAAK6gC,OAAOrJ,EAAI,KAAK,IAAIx3B,KAAK8gC,IAAI,EAAElH,IAC1E,SAASmH,GAASxK,EAAIqD,GAAS,OAAQ55B,KAAK6gC,OAAO,EAAE7gC,KAAKghC,IAAIhhC,KAAK43B,IAAIrB,EAAIv2B,KAAKm3B,GAAG,KAAO,EAAEn3B,KAAKs4B,IAAI/B,EAAIv2B,KAAKm3B,GAAG,MAAMn3B,KAAKm3B,IAAI,EAAGn3B,KAAK8gC,IAAI,EAAElH,IACvI,MAAMqH,GAAwB9rB,MAAOyE,EAAKmW,KAC7C,MAAMxf,IAACA,EAAGyY,WAAEA,EAAU5U,KAAEA,GAAQ2b,EAChC,IAAKxf,EAAK,MAAO,GACjB,MAAM2wB,EAAc,IAAIvC,GAAW,cAEnC,GAAI3V,EAAWmY,SAAU,CACrB,MAAMC,QAAmBF,EAAYf,WAAWnX,EAAWqY,WAE3D,IAAIC,EAMJ,GAJIA,EADAtY,EAAWuY,OACAvY,EAAWuY,OAAOhxB,KAAI,EAAE+qB,EAAGzJ,KAAOyJ,EAAIzJ,IAEtC,IAAItgB,MAAMyX,EAAWwY,UAAY,GAAGxgC,QAAQuP,KAAI0Q,GAAKjhB,KAAK8gC,IAAI,EAAG7f,GAAKjhB,KAAK8gC,IAAI,EAAG7f,KAE7FmgB,GAAcE,EAASjZ,QAAO,CAACnqB,EAAGC,IAAMD,EAAIC,GAAG,GAI/C,OAHA+iC,EAAYZ,QAEZmB,OAAOzY,EAAWvU,KAAM,EACjB,GAIf,MAAOitB,EAAIC,GAAM,CAAC,CAACvtB,EAAK,GAAIA,EAAK,IAAK,CAACA,EAAK,GAAIA,EAAK,KAC/CwtB,EAAW,GACjB,IAAK,IAAIhI,EAAK,EAAGA,GAAQ5Q,EAAWwY,UAAW5H,IAAQ,CACnD,IAAIiI,EAAMC,EACV,MAAM7hC,EAAMD,KAAK8gC,IAAI,EAAElH,GAQvB,IAAI8B,EAAMC,EAPN3S,EAAWmY,UACXU,EAAK,CAAC3kC,EAAG,EAAGqZ,EAAGtW,EAAM,GACrB6hC,EAAK,CAAC5kC,EAAG+C,EAAM,EAAGsW,EAAG,KAErBsrB,EAAK,CAAC3kC,EAAG0jC,GAASc,EAAG,GAAI9H,GAAOrjB,EAAGwqB,GAASW,EAAG,GAAI9H,IACnDkI,EAAK,CAAC5kC,EAAG0jC,GAASe,EAAG,GAAI/H,GAAOrjB,EAAGwqB,GAASY,EAAG,GAAI/H,KAGnD5Q,EAAWuY,QACV7F,EAAMC,GAAQ3S,EAAWuY,OAAO3H,IAEhC8B,EAAMC,GAAQ,CAAC17B,EAAKA,GAGzB,IAAK,IAAI/C,EAAE2kC,EAAK3kC,EAAGA,GAAG4kC,EAAK5kC,EAAGA,IAC1B,IAAK,IAAIqZ,EAAEurB,EAAKvrB,EAAGA,GAAGsrB,EAAKtrB,EAAGA,IAC1B,GAAGrZ,GAAG,GAAKqZ,GAAG,GAAKrZ,EAAEw+B,GAAQnlB,EAAEolB,EAAK,CAChC,IAAIrmB,EACD0T,EAAWsV,OACVhpB,EAAM,IAAImR,IAAIuC,EAAWsV,MAAM,GAAGziB,QAAQ,MAAO+d,GAAM/d,QAAQ,MAAO3e,GAAG2e,QAAQ,MAAOtF,IACxFqrB,EAAS1iC,KAAKgiC,EAAYlB,YAAYhX,EAAWqY,UAAW/rB,MAE5DA,EAAM,IAAImR,IAAI,gDAAgDmT,KAAQ18B,KAAKqZ,iBAAiBhG,EAAIwxB,gBAAgBC,0BAA0BpR,SAASqR,eACnJL,EAAS1iC,KAAKgiC,EAAYlB,YAAYhX,EAAWqY,UAAW/rB,IAC5DA,EAAM,IAAImR,IAAI,iMAAiMmT,KAAQ18B,KAAKqZ,oBAAoBhG,EAAIwxB,gBAAgBC,0BAA0BpR,SAASqR,eACvSL,EAAS1iC,KAAKgiC,EAAYlB,YAAYhX,EAAWqY,UAAW/rB,MAMhF,MAAM4W,QAAgBtpB,QAAQs/B,IAAIN,GAElC,OADAV,EAAYZ,QACLpU,EAAQ7hB,QAAOiL,GAAe,OAARA,kVChJnBjW,yIAHd2E,SACIhB,OACAA,OACAA,4DAAU3D,8NAxBCV,EAAQ,UACRsB,EAAM,kJACdkiC,UACKxjC,GAAS,QACF,MACAA,GAASsB,QACT,qCAEDmiC,EAAkB,EAAVpiC,KAAKm3B,IAAUx4B,EAAQsB,GAC/B/C,EAAI,GAAqC,GAAhC8C,KAAKs4B,IAAI8J,EAAQpiC,KAAKm3B,GAAK,GACpC5gB,EAAI,GAAqC,GAAhCvW,KAAK83B,IAAIsK,EAAQpiC,KAAKm3B,GAAK,OACtCkL,EAAO,eACPD,EAAQpiC,KAAKm3B,KACbkL,GAAQ,sBAEZA,mBAAwBnlC,KAAKqZ,IACtB8rB,+MCPiC,sBAA5BxiC,kCAAsB,UAAtCmE,iEAI8D3E,oDAA1CA,oCAAiBA,OAASA,aAA1C2E,oCAAiC3E,OAASA,6DADxCA,OAASA,OAAkB0Z,GAA4BsL,SAAShlB,wFAAhEA,OAASA,OAAkB0Z,GAA4BsL,SAAShlB,mIAJnEA,aAGAyZ,wBAAL5Y,8KAJwEb,qCAA9E2E,sFAA8E3E,0FACnEA,4EAGAyZ,WAAL5Y,+HAAAA,gBAJwEb,wKAJ/DijC,EAA4B,+KAIxBA,0BAA2D9nB,4ICJtE+nB,oCACOxS,WAELyS,EAAe5gC,OAAOyB,SAASsB,cAAc,OACnD69B,EAAav6B,UAAUnF,IAAI,6BAA8B,mBACnD2/B,EAAchX,OACZ8W,SACMvX,EAAS+E,EAAQ/E,QAChBuG,EAAKgF,GAAOvL,EACbA,GAAQS,EAAS3O,UAAW2O,EAAS5O,YACpC4O,EAAS3O,UAAW2O,EAAS5O,UACpC0lB,EAAYxQ,WAAWR,EAAKgF,aAMpCxrB,SACIw3B,MAAkB3R,SAAS8R,OAAOF,GAClCC,EAAWE,EAAUpyB,KACrBgyB,EAAYtQ,MAAMlC,EAAQxf,QAG9BtF,SACQs3B,IACAA,EAAYhQ,SACZgQ,OAAc1iC,kFAXnB4iC,EAAWE,EAAUpyB,yFCnB5B,MAAMqyB,GAAa,CACf/D,QAAW,EACXn6B,KAAQ,iBACRm+B,SAAY,CACR,wBAAwB,EACxB,cAAe,WACf,qBAAsB,CAClBC,GAAM,QACNC,QAAW,QACXC,IAAO,SAEX,gBAAiB,GACjB,oBAAqB,UAEzBrJ,OAAU,CAAC,EAAG,GACdC,KAAQ,mBACRqJ,QAAW,EACXC,MAAS,EACTC,QAAW,GACXC,OAAU,iFACVC,OAAU,mDACV5M,OAAU,GACV6M,QAAW,2BACX7uB,GAAM,4BACN8uB,SAAY,2BACZC,MAAS,YACTrY,WAAc,SACdsY,OAAS,GCjBPC,GAAmB1wB,WADX,8FACoC,QAAI,IAAM,IACtD1N,GAAU,CACZ,CACIsb,MAAS,WACTnM,GAAM,WACNglB,cAAiB,CAGb51B,MAAS,sDACT8/B,mBAAqB,EACrBtG,QAAW,IAEfgE,UAAa,cACbG,UAAa,GAEjB,CACI5gB,MAAS,gBACTnM,GAAM,WACNmmB,OAAU,EAAE,iBAAmB,gBAAkB,iBAAkB,kBAEnExB,MAAS,yHACTK,cAAiB,CACb51B,MAAS++B,GACTe,mBAAqB,EACrBtG,QAAW,GAEfiB,MAAS,CAAC,+DACVkD,UAAa,EACbH,UAAa,UACbF,UAAY,EACZ5C,SAAYmF,IAEhB,CACI9iB,MAAS,gBACTnM,GAAM,WACNmmB,OAAU,EAAE,mBAAoB,kBAAmB,kBAAmB,mBACtEgJ,SAAY,EAAE,mBAAoB,gBAAiB,kBAAmB,kBACtExK,MAAS,yHACTK,cAAiB,CACb51B,MAAS++B,GACTe,mBAAqB,EACrBtG,QAAW,GAEfiB,MAAS,CAAC,+DACVkD,UAAa,EACbH,UAAa,UACbF,UAAY,EACZ5C,SAAYmF,IAEhB,CACI9iB,MAAS,kBACTnM,GAAM,aACNmmB,OAAU,EAAE,kBAAmB,iBAAkB,iBAAkB,kBACnExB,MAAS,4HACTK,cAAiB,CACb51B,MAAS++B,GACTe,mBAAqB,EACrBtG,QAAW,GAEfiB,MAAS,CAAC,mEACV+C,UAAa,YACbG,UAAa,EACbL,UAAY,EACZ5C,SAAYmF,IAEhB,CACI9iB,MAAS,YACTnM,GAAM,cAMNomB,gBAAmB,CAAC,mBAAoB,mBAAoB,MAAO,OACnED,OAAU,EAAE,mBAAoB,iBAAkB,kBAAmB,mBAOrExB,MAAS,oEAETK,cAAiB,CACb51B,MAAS++B,GACTe,mBAAqB,EACrBtG,QAAW,GAEfiB,MAAS,CAAC,sEACViD,OAAU,CAAC,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,GAAI,IAAK,CAAC,GAAI,IAAK,CAAC,GAAI,KACpEC,UAAa,EACbH,UAAa,aACbF,UAAY,EACZ5C,SAAYmF,IAEhB,CACI9iB,MAAS,aACTnM,GAAM,qBAMNomB,gBAAmB,CAAC,OAAQ,kBAAmB,IAAM,OAKrDD,OAAU,EAAE,eAAoB,kBAAmB,kBAAmB,cACtExB,MAAS,qCAETK,cAAiB,CACb51B,MAAS++B,GACTe,mBAAqB,EACrBtG,QAAW,GAEfiB,MAAS,CAAC,gFACViD,OAAU,CAAC,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,GAAI,GAAI,CAAC,GAAI,IAAK,CAAC,GAAI,KACnEC,UAAa,EACbH,UAAa,kBACbF,UAAY,EACZ5C,SAAYmF,IAgCf,CACG9iB,MAASoZ,KAAK,oBAAsB,QACpCvlB,GAAM,UACNsV,MAAS,CAAC,MAAO,OACjB6Q,OAAU,CAAC,gBAAiB,gBAAiB,iBAAkB,iBAC/DxB,MAAS,oJAETK,cAAiB,CACb51B,MAAS++B,GACTe,mBAAqB,EACrBtG,QAAW,GAEfiB,MAAS,CAAC,kEACViD,OAAU,CAAC,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,GAAI,IAAK,CAAC,GAAI,IAAK,CAAC,GAAI,KACpEF,UAAa,WACbG,UAAa,EACbL,UAAY,EACZ5C,SAAYmF,kGC7HgDrkC,KAAOoV,KAAOpV,QAAqBA,KAAOuhB,MAAMD,gBAAiBthB,KAAOuhB,sDAAxHvhB,oCAAmBA,KAAOoV,KAAOpV,KAASoV,WAA1DzQ,qCAAgE3E,KAAOoV,KAAOpV,QAAqBA,KAAOuhB,MAAMD,gBAAiBthB,KAAOuhB,+BAArGvhB,KAAOoV,KAAOpV,KAASoV,iEADnDpV,0BAALa,mHADSb,wEAAmBA,gEAFlC2E,SAEAhB,sDAAkC3D,4GACvBA,aAALa,+HAAAA,uBADSb,eAAmBA,wDA1CrBwkC,GAAWx8B,EAAQy8B,EAAKC,OACxB18B,EAAO+xB,aAAc,YAEhB4K,EAAU38B,EAAOu8B,SAAYv8B,EAAOu8B,SAAWv8B,EAAOuzB,eACnDl6B,KAAMojC,EAAKC,UACT7mC,EAAGqZ,GAAK3U,OAAOw3B,MAAM/xB,EAAO+xB,OAAQ14B,EAAEoc,UAAWpc,EAAEmc,cACtD3f,EAAI8mC,EAAO,IAAO9mC,EAAI8mC,EAAO,IAAMztB,EAAIytB,EAAO,IAAMztB,EAAIytB,EAAO,UACxD,SAGZtuB,UAEI,SAEJ,8BApBAhR,EAAO,oBACPkV,eACArS,EAAWjC,GAAQ,MAC1B2+B,EAAiB18B,EAASkN,SACxByvB,EAAqBtqB,EAAOtU,GAAUA,GAAQ+E,QAAOiD,IAAOA,EAAEmH,GAAG4L,WAAW,QAAmB,gBAAT/S,EAAEmH,YAmB9F1J,YACQxD,EAASkN,KAAOnP,GAAQ,GAAGmP,IAAMmF,SAC3BkqB,EAAMlqB,EAAI4B,MAAMmY,OAAO,GACvBoQ,EAAOnqB,EAAI4B,MAAMmY,OAAO/Z,EAAI4B,MAAMmY,OAAOzzB,OAAS,GAClDikC,EAAc7+B,GAAQ8+B,MAAK92B,GAAc,YAATA,EAAEmH,KAClC4vB,EAAc/+B,GAAQ8+B,MAAK92B,GAAc,aAATA,EAAEmH,KACpCovB,GAAWM,EAAaL,EAAKC,OAC7Bx8B,EAAW48B,GACLL,EAAIQ,WAAWP,EAAM7jB,UAAUqkB,YAAa,OAE5CR,EAAKlnB,SAAW,IAAMinB,EAAIjnB,SAAW,OAC3CtV,EAAW88B,GACLN,EAAKjnB,WAAa,IAAMgnB,EAAIhnB,WAAa,OAC/CvV,EAAWjC,GAAQ8+B,MAAK92B,GAAc,eAATA,EAAEmH,OACxBsvB,EAAKlnB,SAAW,IAAMinB,EAAIjnB,SAAW,KAAQinB,EAAIlmB,WAAWmmB,EAAM,IAAMlnB,UAAY,IAAMgnB,GAAWQ,EAAaP,EAAKC,OAC9Hx8B,EAAW88B,OAEX98B,EAAWjC,GAAQ8+B,MAAK92B,GAAc,aAATA,EAAEmH,WAGvCwvB,EAAiB18B,EAASkN,6JAKAlN,sJCzCMlI,MAAa,EAAK,KAAM,kEAChCA,yCAAgCA,MAAW,0CAD9DA,4CAAb2E,uBACAhB,mCAAyF3D,kBAD3DA,mCAAUA,MAAa,EAAK,KAAM,8BAChCA,kBAAgCA,MAAW,iCAD9DA,sGATL0H,QADOrC,EAAO,6EAGdqC,EAAM8f,SAAW9f,EAAM8f,gBACvB9K,EAAahV,EAAM8f,QAAW,GAAK,+CAOzB9f,wFCVX,MAAMy9B,GAAe3sB,KACf4sB,GAAuB5sB,GAAS,IAItC,SAAS6sB,GAAkBhL,GAAW9f,IAACA,EAAG8C,IAAEA,EAAGM,GAAEA,IACpD,MAAM2nB,EAAQthC,SAASuhC,eAAe,YACtC,IAAIC,EAGAC,EACArE,EACAsE,EACAC,EALAroB,EAAW7F,WAAW4F,GACtBuoB,EAAarrB,EAKb6X,EAAQzU,EACZ,MAAMkoB,EAAiBxL,EAAUyL,aAC3BC,EAAgB1L,EAAU2L,YAC1BxhC,EAAQuS,iBAAiB/S,SAASiiC,MAClCC,EAAezuB,WAAWjT,EAAM2hC,iBAAiB,wBAAyB,SAAS/lC,MAAM,GAAI,IAC7FgmC,EAAkB9oB,GAjBP,GAkBWqoB,GAAWD,EAAUW,IAAmBV,GAAUroB,EAAW,IAEnFgpB,EAA0BhpB,IAC5B,MAAMipB,EAAYH,EAAe9oB,GAC3BkpB,EAtBO,GAsBiBb,EAExBc,EAAOV,EAAe,EACtBpxB,EAAM6xB,EAASC,EACf7lC,EAHK8kC,EAGOc,GAAWT,EAAgBU,GAC7C,OAAIF,KAAqBA,EAAY3lC,EAC1B6lC,EAAOF,EACTA,GAAa5xB,EACX8xB,EAAO9xB,EAEP8xB,EAAM7lC,GAGfwiC,EAAa,CAACkC,EAAOoB,EAAe7oC,EAAG8oC,KACtCrB,IACCA,EAAM9gC,MAAMi5B,KAAQ5/B,GAAKuoC,EAAeM,GAAkBpB,EAAMU,YAAc,GAAO,KACrFV,EAAM9gC,MAAM+4B,KAAS2I,EAAevlC,KAAKimC,OAAQ,KAASD,EAAaA,EAAe,MAASA,EAAc,SAAWhB,EAAUL,EAAMQ,aAAe,EAAM,OAG/Je,EAAe,KACjB,MAAMC,EAAUrB,EAAIjuB,QAAU,IAC9B4pB,EAAQqE,EAAIsB,YACZ3F,EAAMhsB,GAAK,YACXgsB,EAAM58B,MAAMwiC,QAAU,OACtB5F,EAAM6F,YAAc,YACpB7F,EAAMl7B,iBAAiB,OAAQghC,GAC/B9F,EAAMl7B,iBAAiB,QAASihC,GAChCnjC,SAASiiC,KAAKniC,YAAYs9B,GAC1BqE,EAAIjhC,MAAMgT,OAAasvB,EAAQZ,EAAgBL,EAA5B,KACnBJ,EAAIjhC,MAAM4iC,UAAY,UACtB3B,EAAIjhC,MAAM8Y,SAAY,WACtBmoB,EAAIjhC,MAAMwS,QAAU,IACpBqjB,EAAUv2B,YAAY2hC,GACtBC,EAAQD,EAAIO,YACZ,MACMtb,EADI+a,EAAIK,aACIgB,EAClBnB,EAAQjb,EACR,MAAM2c,EAASf,EAAuBhpB,GACtCmoB,EAAIjhC,MAAM+4B,IAAM,IA3DN,GA2DsB7S,MAChC+a,EAAIjhC,MAAMi5B,KAAO,GAAG4J,OAElBH,EAAoB,KACtB/B,GAAajjC,IAAI,WACjBojC,EAAM9gC,MAAMwiC,QAAU,QACtBvB,EAAIjhC,MAAMwS,QAAU,EACpB,MAAMqwB,EAASf,EAAuBhpB,GACtC8lB,EAAWkC,EAAOhoB,EAAU+pB,EAAQjV,IAElC+U,EAAgB,KAClB7B,EAAM9gC,MAAMwiC,QAAU,OACtB7B,GAAajjC,IAAI,UAEfsM,EAAU,KACRi3B,GAAKA,EAAIt/B,oBAAoB,OAAQ0gC,GACrCpB,GAAKA,EAAIt/B,oBAAoB,QAASghC,GACtC1B,GAAKA,EAAIvS,SACbjZ,GAAW/X,KAAI,GACXk/B,GAAOA,EAAMj7B,oBAAoB,OAAQ+gC,GACzC9F,GAAOA,EAAMj7B,oBAAoB,QAASghC,GAC1C/F,GAAOA,EAAMlO,SACjBkO,OAAQ5gC,EACRilC,OAAMjlC,EACHglC,GAAWpe,IAAIE,gBAAgBke,GAClCA,OAAYhlC,GAEV8mC,EAAYxxB,MAAOyE,IACrBkrB,EAAMzhC,SAASsB,cAAc,OAC7B6/B,GAAajjC,IAAI,WACjBojC,EAAM9gC,MAAMwiC,QAAU,OACtB/V,MAAM1W,EAAIkM,WAAWC,UAAUna,MAAK,SAAS2kB,GACtCA,EAASqW,IACRnC,GAAqBljC,IAAI,CAACo/B,OAAQpQ,EAASoQ,OAAQ77B,KAAMyrB,EAASmB,YAAc,OAChFnB,EAAShK,OAAO3a,MAAM2a,IACdue,IACAD,EAAYpe,IAAIC,gBAAgBH,GAChCue,EAAIv/B,iBAAiB,OAAQ2gC,GAC7BpB,EAAIv/B,iBAAiB,QAASihC,GAC9B1B,EAAIznC,IAAMwnC,QAIlB2B,IACIjW,EAASsW,QACTpC,GAAqBljC,IAAI,CAACo/B,OAAQpQ,EAASoQ,OAAQ77B,KAAKyrB,EAASmB,YAAanB,EAASsW,QAAQxV,IAAI,sBAEnGoT,GAAqBljC,IAAI,CAACo/B,OAAQpQ,EAASoQ,OAAQ77B,KAAKyrB,EAASmB,YAAc,SAI1F/hB,OAAM,SAAS7H,GACR0+B,IAEA/B,GAAqBljC,IAAI,CAACo/B,OAAQ,EAAG77B,KAAMgD,EAAMg/B,cAK7D,OAFAH,EAAU/sB,GAEH,CACHzN,QAAOyN,IAACA,EAAG8C,IAAEA,EAAGM,GAAEA,IAEd,GADAL,EAAW7F,WAAW4F,GAClB9C,IAAQqrB,EACRA,EAAarrB,EACb/L,IACA84B,EAAU/sB,OACT,CACD,MAAM8sB,EAASf,EAAuBhpB,GACtCmoB,EAAIjhC,MAAMi5B,KAAO4J,EAAU,KAC3BjV,EAAQzU,EACRylB,EAAWkC,EAAOhoB,EAAU+pB,EAAQ1pB,KAG5Ctb,UACImM,MASL,MAAMk5B,GAAY,CAACC,GAAYtqB,IAAAA,EAAKM,GAAAA,MACvC,MAAM2nB,EAAQqC,EAAU5iC,WAAWsD,cAAc,OAC3Co9B,EAAMzhC,SAASuhC,eAAe,aAC9B/gC,EAAQuS,iBAAiB/S,SAASiiC,MAClCC,EAAezuB,WAAWjT,EAAM2hC,iBAAiB,wBAAyB,SAAS/lC,MAAM,GAAI,IAC7FwnC,EAAYnwB,WAAWkwB,EAAU5iC,WAAW8iC,QAAQD,WAAa,OACjElC,EAASD,EAAIqC,MACbC,EAAUtC,EAAIjuB,OAEduuB,EADM/hC,SAASqE,cAAc,OACT29B,YAC1B,IAAIgC,EAEAA,EADW,IAAXtC,EACU/kC,KAAKgU,IAAKoxB,EAAgBL,EAAUqC,EAASH,GAE7CjnC,KAAKgU,IAAIozB,EAASH,GAEhC,IACIjC,EAGAsC,EAJA3qB,EAAW7F,WAAW4F,GAEtBxf,EAAI,EACJqZ,EAAI,EAEJkb,EAAQzU,EACZ,MAAMyoB,EAAkB9oB,IArKP,IAsKYooB,OAA+BpoB,EAAW,KAAQqoB,EAEzEvC,EAAa,CAACkC,EAAOoB,EAAeC,KAEtCrB,EAAM9gC,MAAMi5B,KAAQ5/B,GAAKuoC,EAAeM,GAAkBpB,EAAMU,YAAY,EAAK,GAAM,KACvFV,EAAM9gC,MAAM+4B,KAAS2I,EA1KX,GA0KuC,EAAIvlC,KAAKimC,OAAQ,KAASD,EAAaA,EAAe,MAASA,EAAc,SAAWhB,EAAUL,EAAMQ,aAAe,EAAM5uB,EAAI,MAEhLovB,EAA0BhpB,IAC5B,MAAMipB,EAAYH,EAAe9oB,GAE3BmpB,EAAOV,EAAe,EACtBpxB,EAFS,EAEM8xB,EAEf7lC,EADK8kC,EAASC,EAHL,GAIcI,EAAgBU,GAC7C,OAAIF,EAAY5xB,GAAO4xB,EAAY3lC,EACxB6lC,EAAOF,EACTA,GAAa5xB,EACX8xB,EAAO9xB,EAEP8xB,EAAO7lC,GAGhBsnC,EAAkB,KACpBrqC,EAAI8pC,EAAU9pC,EACdqZ,EAAIywB,EAAUzwB,EACdyuB,EAAQgC,EAAUhC,MAClBsC,EAAkBlC,GAAiBL,EAASC,EAC5CvC,EAAWkC,EAAOhoB,EAAU8U,IA6BhC,OA1BI9U,GAAY,GAAKA,GAAY,KAGzBqoB,EADW,IAAXD,EACQkC,GAAa1B,EAAe,IAE5BvlC,KAAKgU,IAAIoxB,EAAcL,EAAQsC,GAAW9B,EAAe,KAErEhvB,EAAI,IAGJyuB,EAAQqC,IACR9wB,GA9MU,GA8MQyuB,GAElBI,EAAgBL,EAASC,GACzB9nC,GAAKkoC,EAAiBL,EAASC,GAAU,EACzCsC,GAAiB,IAEjBpqC,EAAIyoC,EAAuBhpB,GAC3B2qB,GAAiB,GAErB7E,EAAWkC,EAAOhoB,EAAU8U,GAC5BqT,EAAIjhC,MAAMwiC,QAAU,QACpBW,EAAUnjC,MAAMojC,UAAY,GAAGA,MAC/BD,EAAU7jC,YAAY2hC,GACtBkC,EAAUQ,aAAa,CAACxC,MAAAA,EAAO9nC,EAAAA,EAAGqZ,EAAAA,IAClCywB,EAAUzhC,iBAAiB,SAAUgiC,GAC9B,CACHp7B,QAAOuQ,IAACA,EAAGM,GAAEA,IACTL,EAAW7F,WAAW4F,GACtB+U,EAAQzU,EACJsqB,IACApqC,EAAIyoC,EAAuBhpB,GAC3BqqB,EAAUQ,aAAa,CAACtqC,EAAAA,KAE5BulC,EAAWkC,EAAOhoB,EAAUK,IAEhCtb,UACIojC,EAAIjhC,MAAMwiC,QAAU,OACpBhjC,SAASiiC,KAAKniC,YAAY2hC,GAC1BkC,EAAUxhC,oBAAoB,SAAU+hC,MAOvCE,GAAa/N,IACtB,MAAMoL,EAAMzhC,SAASuhC,eAAe,aAC9B8C,EAAS5C,EAAIqC,MACbhB,EAAUrB,EAAIjuB,QAAU,IACxBowB,EAAYnwB,WAAW4iB,EAAUwN,QAAQD,WAAa,OAEtDU,EADMtkC,SAASqE,cAAc,OAChB29B,YACnB,IAAItb,EAAQ,EACG,IAAX2d,IACA3d,EAAQ4d,EAASD,GAErB,MAAM7wB,EAAS7W,KAAKgU,IAAI+V,EAAQoc,EAASc,GACzCvN,EAAU71B,MAAMgT,OAAS,GAAGA,+NCrPA,IAArBxX,KAAU0d,QAAqC,MAArB1d,KAAU0d,QAAkB1d,MAAW,oB9C4c5E,IAAiC6D,EAAM0kC,EAAMjpC,0EAAAA,SAANipC,iBAAN1kC,KAEzBA,EAAK0kC,GAA8B,kBAAf1kC,EAAK0kC,IAAiC,KAAVjpC,GAAsBA,EAGtEkH,EAAK3C,EAAM0kC,EAAMjpC,uI8CvdyDsoC,YAAlFjjC,SACIhB,cACAA,OAAKA,6DADuB0Z,IAAKrd,KAAU0d,OAAQC,GAAI3d,KAAU2d,uFAArCN,IAAKrd,KAAU0d,OAAQC,GAAI3d,KAAU2d,KAKrC,IAArB3d,KAAU0d,QAAqC,MAArB1d,KAAU0d,QAAkB1d,MAAW,oIAN3BkX,EAAG0wB,sDAAH1wB,EAAG0wB,8EAH1CA,GAAY,0JCLP,SAASY,GAAgB3kC,EAAMqN,GAC1C,IAAIu3B,EAAav3B,EACjB,MAAMw3B,EAAY,IAAMD,GAAcA,EAAWE,SAC3CC,EAAW,IAAIC,sBAAqB,CAAClkB,EAASikB,KAChDjkB,EAAQlmB,SAAQq3B,IACa,IAA1BA,EAAMgT,mBACLJ,SAGL,CAACK,UAAW,IACfH,EAASI,QAAQnlC,GACjB,MAAM+iB,EAAyB,KACvB5iB,UAAYA,SAAS6X,iBAAgD,YAA7B7X,SAAS6X,iBACjD6sB,KAMR,OAHA1kC,SAASkC,iBAAiB,mBAAoB0gB,GAAwB,GACtErkB,OAAO2D,iBAAiB,oBAAqBwiC,GAEtC,CACH57B,OAAOoE,GACHu3B,EAAav3B,GAEjB7O,UACIumC,EAASK,UAAUplC,GACnB+kC,EAASM,aACT3mC,OAAO4D,oBAAoB,oBAAqBuiC,GAChD1kC,SAASmC,oBAAoB,mBAAoBygB,GAC7C6hB,GAAYA,EAAWvV,sECsJPlzB,MAAY,EAAKA,KAAa,MAAQA,qGAJ5CA,0BACGA,MAAc,GAAGA,KAAgB,iBACvCA,MAAOA,QAAeA,QAA2C,IAAhCA,MAAOA,KAAmBoV,aAH9EzQ,2DAIe3E,SAAqCA,SAArCA,SAAqCA,gFACxBA,MAAY,EAAKA,KAAa,oBAAQA,2CAJ5CA,oCACGA,MAAc,GAAGA,KAAgB,6BACvCA,MAAOA,QAAeA,QAA2C,IAAhCA,MAAOA,KAAmBoV,qRAO1EzQ,4fADG3E,OAAeA,MAAWA,KAAQ2pB,YAAc3pB,KAAQ2pB,WAAWsV,OAASj/B,KAAQ2pB,WAAWsV,MAAM,GAAGhe,SAAS,2CAX3DjhB,eAAzBA,kBAAAA,2EAAyCA,aACvEA,MAAsBuC,OAAOo9B,6BAcjC3/B,QAAaA,OAASA,OAAmBA,OAAa,yMACJA,mIACMA,iCACzDA,2MArBIA,2HAAT2E,kBACAA,SACIhB,uLAF8B3D,4CAAzBA,iDAAyBA,gCAG+BA,oCAAzBA,+BAC9BA,MAAsBuC,OAAOo9B,mIAU5B3/B,OAAeA,MAAWA,KAAQ2pB,YAAc3pB,KAAQ2pB,WAAWsV,OAASj/B,KAAQ2pB,WAAWsV,MAAM,GAAGhe,SAAS,6DAItHjhB,MAAaA,OAASA,OAAmBA,OAAa,2RAGvDA,scAtLKmpC,GAAalgC,IACfiR,GAAehY,KAAI,YAyKqB,8JArJtCkL,EAAWvB,SAGbqF,EACAwf,EACA0Y,EACAnG,EAKAoG,cAVO/oB,UACA/F,KAKP+uB,EAAgB,EAChBC,GAAc,EACdC,GAAa,EACbC,WAGErH,YAGKhtB,EAAK,wBAEDs0B,OACLnvB,WAEEkvB,QAAqB7H,GAAsBrnB,EAAKmW,UAC3Cra,QACLozB,gBAIJA,YAGEE,EAAc3lC,SAASqE,kBAAkB+M,iCAC3Cu0B,IACAA,EAAY7lC,YAAYE,SAAS2B,eAAe,QAChDgkC,EAAY7lC,YAAYm/B,GACxB0G,EAAY7lC,YAAYE,SAAS2B,0BAA+BgxB,UAAU,EAAE,cAAmBA,UAAU,EAAE,cAgC7G7pB,EAAU7D,IfpDW,CAACvD,IAC5B,MAAML,KAACA,EAAI/F,MAAEA,GAASoG,EAChBwb,EAAS1M,GAAWnP,GAC1B,GAAe,aAAX6b,EACA,OAAO7iB,OAAOib,OAAO8d,IAAQ34B,SAAQo4B,GAASA,EAAMtD,gBAAkBsD,EAAMtD,eAAe7tB,KACzF,GAAe,cAAXwb,EACN,OAAO7iB,OAAOib,OAAO8d,IAAQ34B,SAAQo4B,GAASA,EAAM1C,iBAAmB0C,EAAM1C,gBAAgBzuB,KAC3F,GAAe,aAAXwb,EACN,OAAO7iB,OAAOib,OAAO8d,IAAQ34B,SAAQo4B,GAASA,EAAMrD,gBAAkBqD,EAAMrD,eAAe9tB,KAE/F,MAAMkkC,EAASxS,GAAOlW,GAClB0oB,IACIvkC,EAAK4b,SAAS,YACd,EAAU2oB,EAAOpZ,MAAQoZ,EAAOpZ,KAAK9qB,GAAQkkC,EAAOnZ,MAAQmZ,EAAOnZ,KAAK/qB,GAClEL,EAAK4b,SAAS,UACpB2oB,EAAOnW,aAAemW,EAAOnW,YAAY/tB,GACnCL,EAAK4b,SAAS,QACpB2oB,EAAOxW,cAAgBwW,EAAOxW,aAAa1tB,GACrCL,EAAK4b,SAAS,UACpB2oB,EAAO3V,YAAc2V,EAAO3V,WAAWvuB,GACjCL,EAAK4b,SAAS,YACpB2oB,EAAOtW,QAAUsW,EAAOtW,OAAO5tB,KegCnCmkC,EACI34B,IAAAA,EACAwf,QAAAA,EACArrB,KAAM4D,EAAEF,OAAO1D,KACf/F,MAAO2J,EAAEF,OAAOzJ,MACXib,IAAAA,EACL+F,WAAAA,EACApF,aAAc4uB,IAElB18B,EAAS,aAGT28B,GAAsB,MA8BtBC,GAAc,yBAERhkC,EAAWD,SACbikC,KAAcjkC,GAAwB,SAAfA,EAAM+C,OAAiC,GAAfiyB,EAAM+M,QAEnD/M,MAAYkP,MAClBlP,EAAM8E,QAAU75B,EAChB+0B,EAAMmP,OAASlkC,EACf+0B,EAAM/8B,IAAM,uFAEhBmsC,GAEAz+B,SACI6lB,SAASqR,YZ9II,mGY+IblS,EAAUmJ,GAAUzkB,EAAIg0B,EAAoB7uB,EAAK+F,EAAYwpB,EAAeJ,GAAc,IAC1FP,KACAjvB,GAAeE,YACflJ,EAAMwf,EAAQxf,KACdwf,EAAQiN,UAAUxK,GAAG,yBAA0BgW,OAInDv9B,SACI8kB,EAAQiN,UAAUyM,IAAI,yBAA0BjB,IAEhDE,EAASlgB,mBACTjY,OAAM1Q,OACNkwB,OAAUlwB,oJA5HX6pC,EAAsC,IAAxBZ,EAAa5oC,yDA0BJoI,GACtBA,EAAErF,OAAO6e,OACLvR,GAAKA,EAAIgiB,aACbqW,GAAc,OACdC,GAAa,QACbC,UACAH,EAAgB,GACZ5Y,GAAWA,EAAQiN,WACnBjN,EAAQiN,UAAUyM,IAAI,yBAA0BjB,UAG9CmB,EAAiBtY,EAAI9X,IAC3BivB,SACAzY,EAAUmJ,GAAUzkB,EAAIg0B,EAAoB7uB,EAAK+F,EAAYwpB,EAAeJ,QAC5Ex4B,EAAMwf,EAAQxf,KACdwf,EAAQiN,UAAUxK,GAAG,yBAA0BgW,IAE/C50B,4BACU9H,GACNyN,GAAehY,IAAIooC,KACpB,aAGiBrhC,GACpBA,EAAErF,OAAO6e,OACT3V,GAAQ/D,QAASzJ,MAAOwqC,EAAezkC,KAAM,oCAkBzC0kC,SAA4B,OAChCA,GAAsB,OACtBR,EAAa,WAETD,EAAgBG,EAAa5oC,YAC7B2oC,GAAa,aAEHt0B,GAAe,IAAM+b,+BAA+BvuB,KAAKF,SAAU+nC,MAAO,oBAC3El0B,eAEL0zB,GAAsB,OACtBP,GAAa,OACbD,GAAc,IACP,Q/C+DhBzzB,eAAmC00B,EAAMC,GAC5C,MAAMC,EAAQF,EAEd,IAAIG,EAAkB,EAClB7pC,EAAI,EAER,aAAa,IAAIyC,SAAQ6I,IAErB,MAAMw+B,EAAU3tB,aAAYnH,UAMxB,GALwC,IAApC40B,EAAM1/B,QAAOiL,GAAOA,IAAKpV,SACzBmc,cAAc4tB,GACdx+B,KAGAu+B,GAZsB,GAY0B7pC,EAAI4pC,EAAM7pC,OAAS,EACnE,OAIJ,MAAMiP,EAAQhP,IACRmV,EAAMy0B,EAAM56B,GAElB66B,IACA,UACU1Z,MAAMhb,GACRw0B,GAAeA,IACrB,MAAMp0B,IACRs0B,WAGOD,EAAM56B,KACd,Q+C5FO+6B,CAAoBpB,WAAoBF,SAC1CA,GAAYD,SACZlH,EAAOgH,EAAmBh0B,KAAM,kBAEhCq0B,UACAH,EAAgB,OAChBC,GAAc,iBAGlBQ,GAAsB,OACtBR,GAAc,mBAqCcH,6EAiBfC,qLC5LV,CACb,eACA,gBACA,cACA,YACA,aACA,WACA,eACA,eACA,YACA,cACA,cACA,YCZF,MAAMyB,GAAQ,QACRC,GAAO,OACPC,GAAM,MAENC,GAAS,SAGR,SAASC,KACd,MAAyB,oBAAX3oC,QAA8C,oBAAbyB,SAG1C,MAYDmnC,GAAkB,CACtB7tB,GAEEigB,IAAAA,EACAC,OAAAA,EACAC,KAAAA,EACAC,MAAAA,EACAlmB,OAAAA,EACAswB,MAAAA,EACA9B,YAAAA,EACAF,aAAAA,MAIF,MAAMsF,EAAY7N,EAAM/lB,EAClB6zB,EAAe7N,EAAShmB,EAASsuB,EAEjCwF,EAAa7N,EAAOqK,EACpByD,EAAc7N,EAAQoK,EAAQ9B,EASpC,MAPkB,CAChBzI,IAAK,KAAO6N,GAAaC,EAAeJ,GAASD,GACjDxN,OAAQ,IAAM4N,IAAcC,EAAeL,GAAMC,GACjDxN,KAAM,KAAO6N,GAAcC,EAAcT,GAAQC,GACjDrN,MAAO,KAAO6N,GAAeD,EAAaP,GAAOD,IAGlCxtB,MAGbkuB,GAAuB,CAC3BluB,GAEEigB,IAAAA,EACAC,OAAAA,EACAC,KAAAA,EACAC,MAAAA,EACAlmB,OAAAA,EACAswB,MAAAA,EACA9B,YAAAA,EACAF,aAAAA,MAGF,MACM2F,EAAelO,GADAC,EAASD,GACY,EAEpC6N,EAAY5N,EAAShmB,EACrB6zB,EAAe9N,EAAM/lB,EAASsuB,EAC9B4F,EAAcD,EAAej0B,EAAS,EAAK,GAAMi0B,EAAej0B,EAAS,EAAKsuB,EAC9EwF,EAAa5N,EAAQoK,EACrByD,EAAc9N,EAAOqK,EAAQ9B,EAE7B2F,EAAY,CAChBpO,IAAK,KAAO6N,GAAaC,EAAeJ,GAASD,GACjD1Q,OAAQ,IAAMoR,EA1EH,SA0EyBC,EAAUpO,MAC9CC,OAAQ,KAAO6N,GAAgBD,EAAYJ,GAAMC,GACjDxN,KAAM,KAAO6N,GAAcC,EAAcT,GAAQC,GACjDrN,MAAO,KAAO6N,GAAeD,EAAaP,GAAOD,IAGnD,OAAOa,EAAUruB,4ECyEwBtd,sFARJA,0JAObA,MAAmB,gCAA1C2E,0JAAuB3E,MAAmB,8MADtCA,iLAFUA,iBAAqBA,kBAAuBA,mBAAyBA,mBAA0BA,oCANtEA,oDAA+BA,SAAWA,gBAApF2E,SACChB,sCAGAA,4DAPc3D,sBACFA,gGAUNA,gJAFUA,iBAAqBA,kBAAuBA,mBAAyBA,mBAA0BA,8DANtEA,2EAA+BA,SAAWA,0VAxI7EoN,EAAWvB,KAEX+/B,EAAmBC,GAAU,OAc/BrjC,EACAsjC,EACAloC,UAdOmoC,GAAS,qBACTC,GAAiB,oBACjBC,GAAgB,eAChB3uB,EAAWsuB,0BACXM,GAAsB,aACtBC,EAAS,sBACTC,qBACA5nC,EAAQ,MAIf6nC,EAAkB,KAKlBC,EAAW,EACXC,EAAY,EACZC,EAAa,EACbC,EAAc,WAUTC,IACHxB,OACL3oC,OAAO2D,iBAAiB,SAAUymC,GAC9BV,EAAe1pC,OAAO2D,iBAAiB,SAAU+6B,GAC5C+K,GAAgBzpC,OAAO2D,iBAAiB,SAAUymC,aAGnDC,IACH1B,OACL3oC,OAAO4D,oBAAoB,SAAUwmC,GACrCpqC,OAAO4D,oBAAoB,SAAUwmC,GACrCpqC,OAAO4D,oBAAoB,SAAU86B,InD+2BvC,IAAsB9iC,WmD91BZwK,EAAOrJ,SACTutC,EAAWd,EACXe,GAAqB,IAAVxtC,IAA4B,IAAVA,EAAkBA,GAASysC,GAE1De,GAAYC,GAAaC,IAAeF,SAAUf,EAASe,GAE5DD,IAAad,IACf3+B,EAAS,SAAU2+B,GACfA,GACHW,IACAt/B,EAAS,UAETA,EAAS,SACTw/B,eAMMlN,IACHuN,GAAatkC,GAAO,YAGjBs4B,IACJgM,GAAatkC,GAAO,YAGhBuf,EAAUniB,SACZi9B,EAAOj9B,EAAMi9B,MAAQj9B,EAAMmnC,sBAC1BlK,EAAKhe,SAASxc,IAAWw6B,EAAKhe,SAAS8mB,kBAahCa,aACRlgC,MACDwgC,SACApB,GAAU7mB,SAAS1H,SAAWA,EAAWsuB,aAG7CrO,EAAGC,OACHA,EAAMC,KACNA,EAAIC,MACJA,EACAoK,MAAOqF,EACP31B,OAAQ41B,GACL5kC,EAAO6kC,gCACH71B,EAAMswB,MAAEA,GAAUgE,EAAQuB,wBAG5BC,EDtHuB,EAAChwB,EAAUiwB,KACxC,MAAMzH,EAAenlC,KAAKgU,IAAI3Q,SAASiiC,KAAKH,aAAc9hC,SAASwpC,gBAAgB1H,cAC7EE,EAAcrlC,KAAKgU,IAAI3Q,SAASiiC,KAAKD,YAAahiC,SAASwpC,gBAAgBxH,aACjF3nC,OAAOP,OAAOyvC,EAAY,CAAEvH,YAAAA,EAAaF,aAAAA,IAEzC,MAAO2H,EAAcC,GAAqBpwB,EAASxS,MAAM,KAIzD,MAAO,GAHkBqgC,GAAgBsC,EAAcF,MACzB/B,GAAqBkC,EAAmBH,MC+GjDI,CAAgBrwB,GADhBigB,IAAAA,EAAKC,OAAAA,EAAQC,KAAAA,EAAMC,MAAAA,EAAOlmB,OAAAA,EAAQswB,MAAAA,IAGnDuE,IAAoBiB,OACvBjB,EAAkBiB,OAGnBhB,EAAW/O,OACXgP,EAAY9O,OACZ+O,EAAaW,OACbV,EAAcW,UAjFf1hC,SACKuhC,GACHP,OAIF9gC,SACMs/B,MACL0B,OnDo2BoBzuC,EmDh2BRwuC,EnDi2BVnhC,KAAwB7L,GAAGsN,cAAcpN,KAAK1B,6amD/4B9CugC,EAAYkP,EAAmB,OAAK,0BAYpCb,GAAavkC,KAAYA,EAAO4J,WAAWvR,8BAC3CmsC,GAAclB,KAAaA,EAAQ15B,WAAWvR,iCAE1CksC,YAAqBthC,MAAM,sDAC3BuhC,YAAsBvhC,MAAM,yDAEhCwhC,EAAclB,GAAUgB,GAAaC,4CA8DbjnC,GACrBmmC,GAAwBe,IAAe/kB,EAASniB,IACrDk7B,cAG4Bl7B,GACvBqmC,GAAoBa,GACzBb,EAAgBrmC,GAASgmC,OAAQkB,EAAavN,KAAAA,EAAMuB,MAAAA,EAAOt4B,OAAAA,EAAQuf,SAAAA,kEAqCpD1f,wDAQ6CsjC,wDAT9CloC,oSC5IF5D,+FAAd2E,8GpD2+CA,SAA2BkpC,EAAQC,GAC/B,MAAMhhC,EAAS,GACTihC,EAAc,GACdC,EAAgB,CAAE/tC,QAAS,GACjC,IAAIa,EAAI+sC,EAAOhtC,OACf,KAAOC,KAAK,CACR,MAAMmN,EAAI4/B,EAAO/sC,GACXmtC,EAAIH,EAAQhtC,GAClB,GAAImtC,EAAG,CACH,IAAK,MAAM/mC,KAAO+G,EACR/G,KAAO+mC,IACTF,EAAY7mC,GAAO,GAE3B,IAAK,MAAMA,KAAO+mC,EACTD,EAAc9mC,KACf4F,EAAO5F,GAAO+mC,EAAE/mC,GAChB8mC,EAAc9mC,GAAO,GAG7B2mC,EAAO/sC,GAAKmtC,OAGZ,IAAK,MAAM/mC,KAAO+G,EACd+/B,EAAc9mC,GAAO,EAIjC,IAAK,MAAMA,KAAO6mC,EACR7mC,KAAO4F,IACTA,EAAO5F,QAAO1G,GAEtB,OAAOsM,6BoD1gDG9M,+JALCgqB,WAELxoB,EADawoB,IAASA,EAAKhJ,WAAW,KACf3iB,OAAOP,QAAQowC,IAAK,aAActqC,OAAQ,UAAWgqC,GAAcA,iYC0FhGjpC,weAhDU3E,uGAIqEA,qZARrCA,cAA1C2E,SACIhB,OACIA,gFAFuE4W,IAAKva,KAAMqd,IAAKrd,KAAU0d,OAAQC,GAAI3d,KAAU2d,kBAAe3d,qBAIpIA,gGAJqEua,IAAKva,KAAMqd,IAAKrd,KAAU0d,OAAQC,GAAI3d,KAAU2d,qBAArF3d,gCAQqCA,sYAgB3E2E,yCAAiE3E,QAAAA,8GAWoG,sEAQnH,IAAjCA,KAAsBshC,uMAD3B38B,+CACsC,IAAjC3E,KAAsBshC,iTAH3B38B,4DAHqD3E,KAAsByF,gCAAxE,sEAAoF,wJAAvFd,gBAA8ChB,0CAAO3D,KAAsByF,+DAOtBzF,KAAsByF,MAAQzF,KAAsBshC,mCAAlG,sEAAH38B,gBAA0ChB,oCAAO3D,KAAsByF,MAAQzF,KAAsBshC,gHARvE,MAAjCthC,KAAsBshC,UAGc,iBAA/BthC,KAAsByF,iCAJwFzF,KAAKymB,WAAWxQ,0RAA1C,wCAA4E,+QAPlLtR,SACIhB,OACIA,OACIA,cACAA,cAEJA,OACAA,OAAGA,2FAH8E3D,QAAAA,+FAGuCA,KAAKymB,WAAWxQ,wWA9B5ItR,SAA0BhB,qHAI9BgB,8lBACAA,SACIhB,OACIA,OACIA,cACAA,cAEJA,OACIA,OAA4BA,wCAHiD3D,QAAAA,2CAGPA,4HAlBnE,UAAlBA,MAA+C,WAAlBA,OAuBL,WAAlBA,OA6BkB,WAAlBA,8eAtFHmuC,GAAwB,QAKtBC,iBACFC,EAAgB,iBAChBC,GAAc,SACdH,GAAwB,SAClB1hC,QACN4hC,EAAgB,cAEdE,eACsB,6BAApBxoC,EAAML,KAAK2W,MAA2D,kBAApBtW,EAAML,KAAKoD,uBAClD0lC,GAAczoC,EAAML,KAAK+oC,QAC5BD,IAAe7zB,EAAK8L,WAAWC,WAC3B4nB,MACAH,GAAwB,GAExBC,OAKhBj7B,WAAaA,UAAUoI,eACnBpI,UAAUoI,cAAcrV,iBAAiB,UAAWqoC,GAE5D3iC,SAEQuH,WAAaA,UAAUoI,eACvBpI,UAAUoI,cAAcpV,oBAAoB,UAAWooC,8BA3BrC,YAAlBF,QAA6BC,GAAeA,iBAmEMD,EAAgB,6mCC3E9E,MAAMK,GAAY,CAAC,MAAO,OACpBC,GAAmB,CAAC5d,EAAW6d,IAC7B7d,EAAUtT,YAAc,IAAMsT,EAAUtT,WAAa,IAAMsT,EAAUvT,UAAW,IAC7EoxB,EAAYnxB,YAAc,IAAMmxB,EAAYnxB,WAAa,IAAMmxB,EAAYpxB,UAAW,GAClF,KAEJ,KAULqxB,GAAS,CAACC,EAAMhd,IACL,QAATgd,EAAuBJ,GAAU1pB,SAAS8M,GACvCgd,IAAShd,EAedid,GAAc,CAACC,GAAOF,KAAAA,MACxB,MAAMG,EAAUD,EAAKE,KAAKF,EAAKE,KAAKruC,OAAS,GAU7C,OATIouC,IACAD,EAAKG,IAAMH,EAAKE,KAAK,GAAGC,IACxBH,EAAKI,GAAKH,EAAQG,GAClBJ,EAAKK,KAAOL,EAAKE,KAAKlmB,QAAO,CAACnqB,EAAG+iB,IAAMA,EAAE0tB,UAAYzwC,GAAG,GACnDgwC,GAAOC,EAAMG,EAAQM,YACtBP,EAAKQ,QAAUP,EAAQM,SACvBP,EAAKS,UAAYR,EAAQS,SAG1BV,GAGEW,GAAep1B,IACxB,MAAMsS,EAAU,GAChB,IAAKtS,EAAK,OAAOsS,EACjB,IAEI+iB,EACAxZ,EAASxR,EAHTirB,EAAU,GACVC,EAAS,GAGb,IACI,MAAMC,EAAclvB,UAAUmvB,QAAQz1B,EAAI9U,KAAM,eAAgB,aAMhE,IAAIwqC,EAAOC,EACX,GANA9Z,EAAU,6BACVxR,EAAQwR,EAAQ+Z,KAAKJ,GACrBH,EAAe,EAAU3tB,SAAS2C,EAAM,GAAI,IAA+B,GAAzB3C,SAAS2C,EAAM,GAAI,IAAW,EAChFwR,EAAU,oCACVxR,EAAQwR,EAAQ+Z,KAAKJ,IAEjBnrB,EAKA,MAAM,IAAInZ,MAAM,wCAFhB,GAFAykC,EAAOjuB,SAAS2C,EAAM,GAAI,IAC1BqrB,EAAQpvB,UAAUuvB,QAAQllC,QAAQ0Z,EAAM,IAAM,EAC1CqrB,GAAS,EAAG,MAAM,IAAIxkC,MAAM,mCAIpC2qB,EAAU,IAAIC,OAAOC,OAAOC,GAAG,MAAMhc,EAAIQ,MAAMs1B,2BAA4B,KAC3EzrB,EAAQwR,EAAQ+Z,KAAKJ,GACrBljB,EAAQyjB,MAAQ,EAAU1rB,EAAM,GAAK,GACrCwR,EAAU,IAAIC,OAAOC,OAAOC,GAAG,MAAMhc,EAAIQ,MAAMw0B,4BAA6B,KAC5E3qB,EAAQwR,EAAQ+Z,KAAKJ,GACrBljB,EAAQ6iB,OAAS,EAAU9qB,EAAM,GAAK,GACtCwR,EAAU,yCACVxR,EAAQwR,EAAQ+Z,KAAKJ,GACrBljB,EAAQ0jB,mBAAqB,EAAU3rB,EAAM,GAAK,GAClDwR,EAAU,kHAEV,IAII0Y,EAJA0B,EAAK,EACLxB,EAAO,CAACE,KAAQ,IAChBuB,EAAgB,KAChBC,EAAgB,MAEpB,IAAK9rB,KAASmrB,EAAYY,SAASva,GAAU,CACzC,MAAMhmB,EAAI6R,SAAS2C,EAAM,GAAI,IACvBxf,EAAI6c,SAAS2C,EAAM,GAAI,IACvB1N,EAAK9G,EAAI6/B,EAASC,EAAO,EAAIA,EAC7BU,EAAe,IAAIluC,KAAKA,KAAKmuC,IAAI35B,EAAG9G,EAAI,EAAGhL,EAAG6c,SAAS2C,EAAM,GAAI,IAAK3C,SAAS2C,EAAM,GAAI,MACzF0qB,EAAYrtB,SAAS2C,EAAM,GAAI,IAA+B,GAAzB3C,SAAS2C,EAAM,GAAI,IACxDksB,EAAc,IAAIpuC,KAAKkuC,EAAa91B,UAAY,IAAQw0B,GACxDe,EAAUzrB,EAAM,GAChBmM,EAAYlQ,UAAUkwB,cAAcV,GACrCvB,IAAMA,EAAQJ,GAAU1pB,SAASqrB,GAAY,MAAQA,GAC1D,MAAMrf,EAAUnQ,UAAUkwB,cAAcnsB,EAAM,IACxCosB,EAAiBrwC,KAAKimC,MAAM7V,EAAUkU,WAAWjU,EAASnQ,UAAUqkB,YAI1E,GAHsB,OAAlBuL,GAAmE,OAAzC9B,GAAiB5d,EAAWC,KACtDyf,EAAgB,MAEE,OAAlBC,EAAwB,CACxB,MAAMO,GA7FIC,EA6F4BF,IA5FlC,KACL,MACAE,GAAW,IACX,MAEJ,MAwF0B,OAAjBD,GAA2C,QAAjBA,GAA4C,QAAlBP,KACpDA,EAAgBO,GAGC,IAArBjC,EAAKE,KAAKruC,QAAgB+vC,EAAe5B,EAAKE,KAAKF,EAAKE,KAAKruC,OAAS,GAAGuuC,GAAK,OAC9EU,EAAOjwC,KAAKkvC,GAAYC,EAAM,CAACF,KAAAA,KAC/BE,EAAO,CAACE,KAAQ,KAEpBF,EAAKE,KAAKrvC,KAAK,CAEX20B,QAAWzD,EAAU1rB,KACrBgrC,QAAWA,EAEXd,SAAY3qB,EAAM,GAClB6P,SAAYzD,EAAQ3rB,KAEpBqqC,OAAU9qB,EAAM,GAChB0rB,MAASE,EACTrB,IAAOyB,EACPxB,GAAM0B,EACNxB,UAAaA,EACb6B,MAAUP,EAAala,gBAAkBnc,EAAIQ,MAAMq2B,OAAO1a,gBAE9D8Z,EAAK5rB,EAAM,GAEXoqB,EAAKE,KAAKruC,OAAS,GAAGivC,EAAOjwC,KAAKkvC,GAAYC,EAAM,CAACF,KAAAA,KACzDe,EAAQwB,OAASb,EACjBX,EAAQf,KAAOA,EACXgB,EAAOjvC,OAAS,IAChBivC,EAAO,GAAGZ,KAAK,GAAGoB,MAAQE,GAE9BX,EAAQa,cAAmC,QAAlBA,GAhHZ,EAAC5B,EAAMuC,EAAQvB,KAChC,MAAMwB,EAAY,GAClB,IAAK,MAAMtC,KAAQc,EAAQ,CACvB,MAAMb,EAAUD,EAAKE,KAAKF,EAAKE,KAAKruC,OAAS,GAExCguC,GAAOC,EAAMG,EAAQM,WACtB+B,EAAUzxC,KAAKc,KAAK8O,IAAIgI,WAAWw3B,EAAQS,QAAU2B,IAG7D,OAAO1wC,KAAKC,IAAI0wC,IAuGwCC,CAAazC,EAAMr3B,WAAWo4B,EAAQwB,QAASvB,IAAW,EAAK,KAAOY,EAC1Hb,EAAQY,cAAgBA,EAG1B,MAAOp6B,GACgBwK,UAAU2wB,uBAG/B1B,EAAS,GArIQ,IAACoB,EAuItBrkB,EAAQgjB,QAAUA,EAClBhjB,EAAQgjB,QAAQC,OAASA,EACzB,MAAMd,EAAOc,EAAO9kC,QAAOgkC,GAAQA,EAAKE,KAAKlmB,QAAO,CAACnqB,EAAG+iB,IAAMA,EAAEuvB,OAAStyC,IAAG,KAAQkO,MAEpF,GADA8f,EAAQ+iB,aAAeA,EACnBZ,IACAA,EAAKyC,IAAM7B,EACPZ,EAAKE,KAAKruC,OAAS,GAAG,CACtB,MAAMouC,EAAUD,EAAKE,KAAKF,EAAKE,KAAKruC,OAAS,GACxCguC,GAAOgB,EAAQf,KAAMG,EAAQM,YAC9BP,EAAKQ,QAAUP,EAAQM,SACvBP,EAAKS,UAAYR,EAAQS,QAKrC,OADA7iB,EAAQmiB,KAAOA,EACRniB,6GCdoBloB,oFAEpB3E,KAAK+a,MAAM22B,cAAe1xC,KAAK+a,MAAMyZ,aAAUx0B,KAAK+a,MAAM0Z,cAC7Dz0B,KAAK+a,MAAM42B,iBAAe3xC,KAAK+a,MAAMR,IAAIyK,SAAS,KAAQ,GAAK,UAAShlB,KAAK+a,MAAMR,SAHjFva,KAAiB,WAIbmT,WAAaA,UAAUiD,mIAAOzR,SAAKhB,oHAFO,4NAHdwP,WAAaA,UAAUiD,eAAjEzR,+BAEIhB,OACAA,OAAGA,iDACHA,2EAJgFwP,WAAaA,UAAUiD,MAASpW,KAAW,sBACrHA,KAAiB,6DAEhBA,KAAK+a,MAAM22B,iCAAe1xC,KAAK+a,MAAMyZ,gCAAUx0B,KAAK+a,MAAM0Z,iCAC7Dz0B,KAAK+a,MAAM42B,oCAAe3xC,KAAK+a,MAAMR,IAAIyK,SAAS,KAAQ,GAAK,6BAAShlB,KAAK+a,MAAMR,kJAjHjFq3B,EAAiBC,UACbhlB,KACAilB,EAAYpsC,GAASA,EAAKqsC,cAAcvvB,WAAWwvB,SAAS,EAAG,KAC/DC,EAAcvsC,GAASA,EAAKwsC,gBAAgB1vB,WAAWwvB,SAAS,EAAG,eAC9DtsC,KAAQmsC,KACU,UAArBnsC,EAAK8vB,YACL3I,EAAQhtB,qBAAqB6F,EAAKL,QAAQK,EAAKysC,qBAAqBL,EAASpsC,EAAK0sC,eAAeH,EAAWvsC,EAAK0sC,gBAAgBN,EAASpsC,EAAK2sC,aAAaJ,EAAWvsC,EAAK2sC,yBAExKC,EAEAA,EADA5sC,EAAK8vB,YAAYxU,WAAW,YACdtb,EAAK8vB,iBAAiB9vB,EAAKL,YAE3BK,EAAK8vB,YAAYmB,UAAU,EAAE,OAAOjxB,EAAK8vB,YAAYmB,UAAU,KAEjF9J,EAAQhtB,UAAUyyC,cAAmBR,EAASpsC,EAAK6sC,QAAQN,EAAWvsC,EAAK6sC,qBAAqB7sC,EAAK8sC,yBAGtG3lB,GAEL4lB,GAAal4B,EAAK2C,SAChBw1B,EAAc,SACZ7lB,eACKtL,EAAOkV,IAAS+b,EAAY9a,EAAMya,EAAQC,EAAaC,EAAWM,EAAQzc,eApDrE3b,EAAK2C,OAChB3C,IAAQ2C,eACT01B,EAAe,SACbziB,EAAQ5V,EAAIQ,MAAa,SAC5BoV,EAAMtvB,OAAS,MAEV+xC,EAAer4B,EAAI9U,KAAKuqC,QAAQ,gBAAiB,YAAYxzB,QAAQjC,EAAIs4B,sBAAsB,UAC3Fx8B,UAIN+f,EAAUE,OAAOC,GAAG,8HAA8HpG,EAAM/kB,KAAK,wDAC7J0nC,MAAYzc,OAAOD,EAAS,MAC5B2c,MAAUrwC,KAAKwa,GACf0c,EAAQ1c,EAAU3C,EAAIQ,MAAMi4B,OAClCD,EAAIE,YAAY,EAAG,SACbr/B,EAAUg/B,EAAajC,SAASmC,YAC3BztC,EAAM6tC,EAAWC,EAAWC,EAAOC,EAASC,EAAcC,EAAM7b,EAAM8b,EAAKC,EAAYC,EAAcC,EAAUC,KAAehgC,SAC/H++B,EAAS9xB,UAAUgzB,eAAeX,EAAWC,IAC7Cjd,EAA4B,GAAtBjU,SAASmxB,EAAO,IAAWnxB,SAASoxB,EAAS,IACnD5c,MAAU/zB,KAAKwa,EAAQpC,UAAkB,IAANob,GACnCsc,EAAa7xC,KAAKimC,MAAsD,IAA/CnvB,WAAW87B,GAAQ97B,WAAW67B,KAAuB,GAC9ElB,OAA8B5xC,IAAfizC,QAA6CjzC,IAAjBkzC,MAAkChxC,KAAKqwC,EAAIj4B,UAAwC,KAA3BmH,SAASwxB,EAAY,IAA+C,IAA7BxxB,SAASyxB,EAAc,IAAe9Z,QAASp5B,EACzL6xC,OAA0B7xC,IAAbmzC,QAAyCnzC,IAAfozC,MAAgClxC,KAAKqwC,EAAIj4B,UAAsC,KAAzBmH,SAAS0xB,EAAU,IAA6C,IAA3B1xB,SAAS2xB,EAAY,IAAeha,QAASp5B,QAC9K6E,EAAMoxB,EAAKhf,WAAW67B,GAAe77B,WAAW87B,GAAOf,EAAY9a,EAAM8b,EAAKpB,EAAaC,EAAWM,EAAQzc,IA4B5B4d,CAAUv5B,EAAK2C,UAClG62B,GACFv2B,SAAYm1B,EAAOn1B,SACnBC,UAAak1B,EAAOl1B,UACpBu2B,IAAO9d,EACPqc,IAAO9b,EACP+b,WAAcA,EAAW3tB,QAAQ,OAEjCtD,EAAMP,WAAW,QACjB+yB,EAAI1uC,QAAUqtC,KAAehb,IAC7Bqc,EAAIve,YAAcjU,IAElBwyB,EAAI1uC,KAAOkc,EAAMoV,UAAU,EAAE,GAC7Bod,EAAIve,YAAcjU,EAAMoV,UAAU,EAAE,IAExC9J,EAAQhtB,KAAKk0C,GACVrc,SACOuc,EAAY15B,EAAIQ,MAAkB,WAAE/P,QAAO3J,GAAKA,EAAEgE,OAASqyB,IAAM3qB,UACnEyQ,EAAUC,EACVw2B,IACAz2B,EAAWy2B,EAAUz2B,SACrBC,EAAYw2B,EAAUx2B,WAE1BoP,EAAQhtB,MACJwF,KAAQqyB,EACRlC,YAAe,QACfhY,SAAAA,EACAC,UAAAA,EACA00B,OAAAA,EACAC,YAAAA,EACAC,UAAAA,IAEJK,EAAchb,UAGf7K,GAELqnB,EAAqB35B,GACnBA,EAAIM,WAAWha,OAAS,EACjB0Z,EAAIM,WAAW3J,OAAM7P,EAAG+c,EAAKT,OAChCtY,KAAQhE,EAAEgE,KACV8uC,IAAO/1B,EACPT,GAAAA,EACAH,SAAanc,EAAEmc,SAASqH,QAAQ,GAChCpH,UAAcpc,EAAEoc,UAAUoH,QAAQ,OAEnCtK,EAAI4B,MAAMmY,OAAOpjB,KAAI7P,KACxBgE,KAAQhE,EAAEgE,KACVmY,SAAanc,EAAEmc,SAASqH,QAAQ,GAChCpH,UAAcpc,EAAEoc,UAAUoH,QAAQ,iDAzEvCuvB,EAAiBz5B,EAAKI,MAAMs5B,oBAAsB15B,EAAKI,MAAMu5B,SAAS35B,EAAKI,MAAMC,+BA4E1ET,EAAMI,EACNF,EAAcG,EACd25B,GAAY,MAAO,MAAO,aAAc,SAAU,gBAAiB,oBACnEC,EAAgBn2C,OAAOo2C,YACzBp2C,OAAOsmB,QAAQpK,EAAIQ,OAAO/P,UAAS9D,EAAKwtC,MAASH,EAASvvB,SAAS9d,MAEjE6O,GACFC,MAAS,UACTvQ,KAAQwe,KAAKK,cACNkwB,EACHG,QAASp6B,EAAIwE,WAAU,GAAO3T,KAAK,KACnCwpC,QAAWn6B,EACXo6B,UAAat6B,EAAIQ,MAAMoV,MACvBhU,MAAS+3B,EAAkB35B,MACxBo1B,GAAYp1B,GAEfu6B,aAAgBv6B,EAAIQ,MAAMg6B,qBAC1B5kB,MAAS5V,EAAIQ,MAAMoV,MACnB6kB,YAAepD,EAAca,EAAUl4B,EAAKE,IAC5C,kBAAmBA,EAEnBw6B,QAAAA,GACAC,QAAS36B,EAAI9U,kBAIX0N,UAAUiD,MAAML,SAClBM,WAGD,qOC5FS,sHADHrW,MAAmBA,MAAa,gBAAiBA,MAAmBA,MAAa,cACrFA,6CACDA,iBAAcA,mCAAiEA,KAASA,KAAW+xC,cAAe/xC,KAAWkyC,qFAH7IvtC,SACIhB,OAA0JA,cAC1JA,qBACAA,gEAAuE3D,wCAFtDA,MAAmBA,MAAa,sBAAiBA,MAAmBA,MAAa,mBACrFA,oBACDA,sBAAcA,kBAAiEA,KAASA,KAAW+xC,cAAe/xC,KAAWkyC,mMA7C9H7sC,EAAK,oBAUV8vC,GAAY/B,EAAOC,OAAeD,EAAM5wB,WAAWwvB,SAAS,EAAG,QAAQqB,EAAQ7wB,WAAWwvB,SAAS,EAAG,yFAFzGoD,EANyBxP,CAAAA,UAClBtmC,MAAYoD,KAAKkjC,EAAW7qB,MAAMi4B,OAAOl4B,uBAC/CF,EAAetb,KACRA,GAGK+1C,CAAkB16B,gBAId1R,QACZoqC,EAASD,EACS,IAAlBnqC,EAAErF,OAAOtE,OACT8zC,EAAQgC,EAAWrD,cACnBsB,EAAU+B,EAAWlD,gBACrBjpC,EAAErF,OAAO6e,OACTxZ,EAAErF,OAAOtE,MAAQ61C,EAAS/B,EAAOC,KAEjCD,EAAQ37B,WAAWxO,EAAErF,OAAOtE,MAAMc,MAAM,EAAE,IAC1CizC,EAAU57B,WAAWxO,EAAErF,OAAOtE,MAAMc,MAAM,SAG1Ck1C,MAAiB5yC,KAAK0yC,GAC1BE,EAAWC,cAAclC,GACzBiC,EAAWrC,YAAYG,SACjBnuB,GAAQqwB,EAAWx6B,UAAYs6B,EAAWt6B,WAAa,IACzDmK,GAAQ,IACRqwB,MAAiB5yC,KAAK4yC,EAAWx6B,UAAa,OACvCmK,EAAO,MACdqwB,MAAiB5yC,KAAK4yC,EAAWx6B,UAAa,aAElDF,EAAe06B,KACXA,EAAW5e,gBAAkB0e,EAAW1e,cACxCztB,EAAErF,OAAOgF,UAAUnF,IAAI,WAEvBwF,EAAErF,OAAOgF,UAAUsqB,OAAO,uBAMoFvW,GAAmBA,8EC7C7I,MAAMmb,GAAOn3B,KAAKm3B,GACdW,GAAO93B,KAAK83B,IACZQ,GAAOt4B,KAAKs4B,IACZV,GAAO53B,KAAK43B,IACZS,GAAOr4B,KAAKq4B,KACZwc,GAAO70C,KAAK60C,KACZ1c,GAAOn4B,KAAK80C,MACZC,GAAM,IAAM5d,GACZ6d,GAAO7d,GAAK,IAKZ8d,GAAQ,QAENC,GAAYC,GAASA,EAAKC,UAJlB,MAIsC,GAHxC,QAINC,GAAeF,IAAUD,GAASC,GAAQF,IAAS,MAWnDK,GAAmBnsC,GAPV,EAACjL,EAAGovC,KAAQpvC,EAAIovC,EAAMA,GAAMA,EAShCiI,CADI,UAAYpsC,GAAK,oBAAcA,GACxB,KAGhBqsC,GAAsBrsC,GACd,UAAYA,GAAK,YAAc,QAAYA,GAenDssC,GAAetsC,GACVmsC,GAAgBnsC,GAPL,CAACA,IACnB,MAAMsG,EAAIulC,GAAMQ,GAAmBrsC,GAEnC,OADU2uB,GAAIroB,IAAM,SAAWtG,GAAK,QAAW,MAAWA,IAAM2uB,GAAI,EAAIroB,IAAM,QAAW,OAAWtG,GAAkB,OAAb2uB,GAAI,EAAIroB,IAKrFimC,CAAcvsC,GAGxCwsC,GAAmBxsC,GACXssC,GAAYtsC,GAEH,OAAU,OAAU2uB,GAAIkd,IAD7B,OAAS,SAAW7rC,IAWhCysC,GAAuBzsC,GANG,CAACA,GAElB,IAAQ,IADH,OAASA,GAAG,OAAUA,GAAG,cAAUA,KAChB,IAAO,GAK/B0sC,CAAwB1sC,GAEpB,OAAUmvB,GAAI0c,IADf,OAAS,SAAW7rC,IAKhC2sC,GAA2B3sC,IAC7B,MAAMb,EAAI0sC,GAAMY,GAAoBzsC,GAC9B0vB,EAASmc,GAAMW,GAAgBxsC,GAC/B4sC,EAAOje,GAAIxvB,GAAKwvB,GAAIe,GAE1B,OADcR,GAAK0d,IAGjBC,GAA2B7sC,IAC7B,IAAIb,EAAI0sC,GAAMY,GAAoBzsC,GAC9B0vB,EAASmc,GAAMW,GAAgBxsC,GAC/B8sC,EAAU3d,GAAIhwB,GAAKwvB,GAAIe,GACvBqd,EAAY5d,GAAIO,GAEpB,OADYV,GAAK8d,EAASC,IAkBjBC,GAAU,CAAChB,EAAMrgB,KAC1B,MAAMhY,UAACA,GAAagY,EACd2d,EAAQ0C,EAAK/D,cACbsB,EAAUyC,EAAK5D,gBACf6E,EAAUjB,EAAKkB,gBACfltC,EAAIksC,GAAYF,GAChBmB,EAnBK,CAACntC,IACZ,MAAMb,EArDqB,CAACa,GAClB,WAAcA,GAAK,SAAc,SAAeA,GAoDhDotC,CAAuBptC,GAC3BqtC,EAAUxB,GAAMY,GAAoBzsC,GACpCstC,EAAKzB,GAAMM,GAAgBnsC,GAC3BsG,EAAIulC,GAAMQ,GAAmBrsC,GAC7BoN,EAAIvW,KAAK8gC,IAAIlJ,GAAI4e,EAAU,GAAI,GAE/BE,EAAQngC,EAAIuhB,GAAI,EAAM2e,GAAM,EAAMnuC,EAAIwvB,GAAIroB,GAAK,EAAMnH,EAAIiO,EAAIuhB,GAAIroB,GAAK6oB,GAAI,EAAIme,GAAM,GAAMlgC,EAAIA,EAAIuhB,GAAI,EAAI2e,GAAM,KAAOnuC,EAAIA,EAAIwvB,GAAI,EAAIroB,GAC7I,OAAOslC,GAAM2B,EAAQ,GAWAC,CAAOxtC,GAAM,EAAI2T,EAChC85B,EAAQd,GAAwB3sC,GAEtC,IAEI0tC,GAFgB,GAARpE,EAAcC,EAAW0D,EAAU,GAAME,GAAgB,KAErD,EAAK,IACjBO,GAAM,MACNA,GAAM,KAEV,MAAM/d,EAAMhE,EAAMjY,SAAWm4B,GAC7B,IAAI8B,EAAOhf,GAAIgB,GAAOhB,GAAI8e,GAAWte,GAAIQ,GAAOR,GAAIse,GAASte,GAAI0c,GAAM6B,GACnEC,EAAM,EACNA,EAAM,EACCA,GAAO,IACdA,GAAO,GAEX,MAAMC,EAASlC,GAAKiC,GAuBpB,MAAO,CAACE,UAAW,GAAMjC,GAAMgC,IAE7BE,GAAY,CACd,EAAK,GAAI,SACT,EAAK,GAAI,yBACT,EAAM,EAAG,qBACT,EAAE,KAAO,mBAEAC,GAAc,IAAIlmC,IAAI,CAC/B,CAAC,QAAS,EAAEmmC,EAAWC,KAAeC,GAAYF,EAAWC,GAAa,mBAAoB,cAC9F,CAAC,wBAAyB,EAAED,EAAWC,KAAeC,GAAYF,EAAWC,GAAa,eAAgB,oBAC1G,CAAC,oBAAqB,EAAED,EAAWC,KAAeC,GAAYF,EAAWC,GAAa,YAAa,gBACnG,CAAC,iBAAkB,EAAED,EAAWC,KAAeC,GAAYF,EAAWC,GAAa,UAAW,aAC9F,CAAC,MAAO,EAAED,EAAWC,KAAeC,GAAYF,EAAWC,GAAa,WAAY,YAE3EE,GAAkB/lC,MAAMC,KAAK0lC,GAAYl2C,QACzCq2C,GAAc,CAACF,EAAWC,IAC5BE,GAAgB/sC,QAAQ6sC,IAAaE,GAAgB/sC,QAAQ4sC,GAU3DI,GAAW,CAACpC,EAAMrgB,EAAO9X,EAAG,KACrC,MAAMg6B,EAAYb,GAAQhB,EAAMrgB,GAAOkiB,UAIjCQ,EAAa,KAAOx3C,KAAKu4B,KAAU,IAALvb,GAAY,GAChD,IAAK,MAAMre,EAAOsf,KAAUg5B,GACxB,GAAID,GAAar4C,EAAQ64C,EACrB,MAAO,CAACv5B,MAAAA,EAAO+4B,UAAAA,GAGvB,MAAO,CAAC/4B,MAAO,MAAO+4B,UAAAA,IAIpBS,GAAUtC,GAASD,GAASC,GAAQF,GACpC3sC,GAAU,QAAN0sC,GACJ0C,GAAiB,CAAC/lC,EAAGxT,IAAMg6B,GAAKL,GAAInmB,GAAK2mB,GAAIhwB,IAAKsvB,GAAIz5B,GAAK25B,GAAIxvB,IAAIgwB,GAAI3mB,IACvEgmC,GAAc,CAAChmC,EAAGxT,IAAMk6B,GAAKP,GAAI35B,GAAKm6B,GAAIhwB,IAAKgwB,GAAIn6B,GAAK25B,GAAIxvB,IAAKwvB,GAAInmB,IAErEimC,GAAcnzC,IAChB,MACIm0B,EAAIoc,IAAO,QAAU,UAAYvwC,GACjCozC,EAAI7C,IAAO,OAAS,SAAYvwC,GAEhCkN,EAJMqjC,IAAO,QAAU,UAAYvwC,GAIpB,MAANuwC,GAAcld,GAAIc,GAC3Bz6B,EAAW,MAAN62C,GAAcld,GAAI+f,GACvBC,EAAK,OAAS,MAAQxf,GAAIM,GAC9B,MAAO,CACHmf,GAAIL,GAAe/lC,EAAGxT,GACtB65C,IAAKL,GAAYhmC,EAAGxT,GACpB85C,KAAMH,IAGDI,GAAuB/C,IAEhC,MAAMhsC,EAAIksC,GAAYF,GAClBgD,EAAI,CAACH,IAAKlC,GAAwB3sC,GAAI4uC,GAAI/B,GAAwB7sC,IAClEsG,EAAImoC,GAAWH,GAAOtC,IAEtBiD,EAAQ,SAERtf,EAAM+b,GAAK/c,GAAIqgB,EAAEH,KAAOlgB,GAAIroB,EAAEuoC,KAAO1f,GAAI6f,EAAEH,KAAO1f,GAAI7oB,EAAEuoC,KAAO1f,GAAI6f,EAAEJ,GAAKtoC,EAAEsoC,KAC5EM,EAAMlgB,GAAKigB,EAAQtgB,GAAIgB,GAAMrpB,EAAEwoC,KAAOG,EAAQ9f,GAAIQ,IAClDsJ,EAAQjK,GAAKG,GAAI6f,EAAEH,KAAOlgB,GAAIqgB,EAAEJ,GAAKtoC,EAAEsoC,IAAKjgB,GAAIqgB,EAAEH,KAAO1f,GAAI7oB,EAAEuoC,KACvD1f,GAAI6f,EAAEH,KAAOlgB,GAAIroB,EAAEuoC,KAAO1f,GAAI6f,EAAEJ,GAAKtoC,EAAEsoC,KAEnD,MAAO,CACHp6B,UAAW,EAAI2a,GAAI+f,IAAQ,EAC3BC,MAAO,GAAM,GAAMD,GAAOjW,EAAQ,GAAK,EAAI,GAAKpiC,KAAKm3B,GACrDiL,MAAOA,IAGFmW,GAAkB,SAAUpD,EAAMrgB,GAE3C,IAAI0jB,GAAO1jB,EAAMhY,UAAYk4B,GACzBlc,EAAMhE,EAAMjY,SAAWm4B,GACvBvwC,EAAMgzC,GAAOtC,GAEb7yC,EAAIs1C,GAAWnzC,GACfg0C,EAzCa,EAACh0C,EAAG+zC,IAAOxD,IAAO,OAAS,YAAcvwC,GAAK+zC,EAyCvDE,CAAaj0C,EAAG+zC,GAAMl2C,EAAEy1C,GAOhC,MAAO,CAEHY,SA1NS,EAACF,EAAG3f,EAAKkf,IAAQ3f,GAAKP,GAAIgB,GAAOhB,GAAIkgB,GAAO1f,GAAIQ,GAAOR,GAAI0f,GAAO1f,GAAImgB,IAkN3EE,CAASF,EAAG3f,EAAKx2B,EAAE01C,KAUvBY,iBARKzgB,GAAKL,GAAI2gB,GAAI7gB,GAAIkB,GAAOR,GAAIh2B,EAAE01C,KAAOlgB,GAAIx1B,EAAE01C,KAAO1f,GAAImgB,MAWtDI,GAAY,CAAC1D,EAAMrgB,EAAO9X,EAAG,KAItC,MAAMw6B,EAAmB,KAANxC,GAAah1C,KAAKu4B,KAAU,IAALvb,GAAY,GAChD27B,EAAWJ,GAAgBpD,EAAMrgB,GAAO6jB,SAC9C,MAAQ,CAAC16B,MAAO06B,GAAY,oBAAuBnB,EAAYR,UAAWjC,GAAM4D,IAEvEG,GAAe,IAAI9nC,IAAI,CAChC,EAAC,EAAO,IAAM,YACd,EAAC,EAAM,IAAM,aAEJ+nC,GAAM,CAACr0C,KAAM,MAAOs0C,SAAUzB,GAAU0B,SAAU/B,IAClDgC,GAAO,CAACx0C,KAAM,OAAQs0C,SAAUH,GAAWI,SAAUH,IClQlE,SAAUK,IAAeC,KAACA,EAAIhvC,KAAEA,EAAI0P,YAAEA,EAAWO,WAAEA,EAAUqD,cAAEA,EAAas7B,SAAEA,EAAQC,SAAEA,EAAQI,UAAEA,EAAU,MACxG,IAAIlC,EAAYiC,EAAKn7B,MACrB,MACMq7B,EADS,IACIF,EAAK37B,IAClB87B,EAFS,IAEInvC,EAAKqT,IACxB,IAAI,IAAIhO,EAAI6pC,EAAaD,EAAW5pC,GAAK8pC,EAAY9pC,GAAO4pC,EAAU,CAClE,IAAIr8B,EAAKo8B,EAAKp8B,GACVvN,GAAK8pC,IAAYv8B,EAAK5S,EAAK4S,IAC/B,MAAMm4B,EAAO,IAAIpzC,KAAK+X,EAAcrK,GACpC,IAAIiN,EACJ,MAAM88B,EAAcD,EAAaD,EACjC,GAAoB,IAAhBE,EACA98B,EAAMtS,EAAK1J,MACV,CACD,MAAMid,GAAYlO,EAAI6pC,GAAcE,EACpC98B,EAAM08B,EAAK14C,EAAEkd,WAAWxT,EAAK1J,EAAGid,EAAUD,GAE9C,MAAMO,MAACA,GAAS+6B,EAAS7D,EAAMz4B,EAAKM,GACpC,GAAIiB,IAAUk5B,EAAW,CACrB,MAAMsC,EAASz5C,KAAKimC,MAAM,IAAOx2B,EAAI4K,GAAc,GAC7ClS,EAAQ8wC,EAAS5nB,IAAI8lB,EAAb8B,CAAwB,CAAC9B,EAAWl5B,IAElD,SADOtB,SAAUD,EAAKvU,KAAAA,EAAMgtC,KAAAA,EAAMn4B,GAAAA,EAAIy8B,OAAAA,GAClCx7B,IAAU7T,EAAK6T,MAAO,MAE9Bk5B,EAAYl5B,GAGpB,MAAMy7B,GAAkB,KACb,CAAC,CAACR,GAAKx0C,MAAO,GAAI,CAACq0C,GAAIr0C,MAAO,GAAI8W,MAAS,KAGzCm+B,GAAQxhC,GACjB,CAACyB,GAAKE,KACN,EAAEE,EAAMC,MACJ,IAAKA,IAAiBD,GAAmC,IAA3BA,EAAKE,WAAWha,OAAc,OAAOw5C,KACnE,MAAM5/B,EAAcG,EAAaE,UAC3B+R,EAAUwtB,KACVx/B,EAAaF,EAAKE,WAClBgD,EAAiBlD,EAAKkD,eAC5B,IAAI08B,EAAO1/B,EAAWha,OAAS,EAC/B,MAAMma,EAAmC,IAAtBH,EAAW0/B,GAAM,GAC9BC,EAAc,GACpB,IAAK,MAAMC,IAAU,CAACf,GAAKG,IAAO,CAC9B,MAAM3X,EAAS,GACf,IAAI6X,EAAO,KACX,IAAK,MAAOj5C,GAAIO,EAAG+c,EAAKgU,MAAWvX,EAAW8J,UAAW,CACrD,IAAIhH,EAAKyU,EACC,IAANtxB,GAAWA,IAAMy5C,IAAM58B,EAAK,GAChC,MAAMm4B,EAAO,IAAIpzC,KAAK+X,EAAoB,IAAN2D,GAC9BQ,EAAQ67B,EAAOd,SAAS7D,EAAMz0C,EAAGsc,GAAIiB,MACrC7T,EAAO,CAAC1J,EAAAA,EAAG+c,IAAAA,EAAKT,GAAAA,EAAIiB,MAAAA,GAC1B,GAAIm7B,GAAQn7B,IAAUm7B,EAAKn7B,MAAO,CAC9B,MACMxQ,EAAS,CACX2rC,KAAAA,EACAhvC,KAAAA,EACA0P,YAAAA,EACAO,WAAAA,EACAqD,cANkBR,EAAe/c,GAAG,GAAK+c,EAAe/c,EAAE,GAAG,GAO7D64C,SAAUc,EAAOd,SACjBC,SAAUa,EAAOb,SACjBI,UAA4B,QAAhBS,EAAOp1C,KAAkB,IAAQ,KAEjD,IAAK,MAAMK,KAAQo0C,GAAe1rC,GAC9B8zB,EAAOriC,KAAK6F,GACR+0C,IAAWf,IACXc,EAAY36C,KAAK6F,GAI7Bq0C,EAAOhvC,EACH0vC,IAAWf,IACXc,EAAY36C,KAAK,CAACyd,SAAUjc,EAAGyH,KAAM8V,EAAOk3B,KAAAA,EAAMsE,OAAQz5C,KAAKimC,MAAM,IAAOxoB,EAAM,IAAQpD,GAAc,KAGhH6R,EAAQ4tB,EAAOp1C,MAAQ68B,EAG3B,OADArV,EAAe,MAAI2tB,EACZ3tB,IAEXwtB,MC7EaK,GAAWC,WACbA,QACE,OACA,OACA,QACM,eACN,QACM,eACN,QACM,eACN,QACM,eACN,QACM,eACN,OACA,OACA,QACM,wBAEA,cAGNC,GAASpiC,KAChBqiC,YACK5pB,MAAM,gFACZ1kB,MAAK2kB,GAAYA,EAASC,SAC1B5kB,MAAK7G,cAEQo1C,aACGh6C,EAAE4E,EAAK7E,OAAS,EAAGC,GAAG,EAAGA,WACvBsE,EAAGnH,GAAKyH,EAAK5E,GACdgJ,EAAIpH,KAAKwhB,MAAM9e,EAAEoX,QAAQ,IAAK,KAAO,KAC3Cs+B,EAAUj7C,MAAMiK,EAAG2N,WAAWxZ,KAElC28C,GAAO14C,IAAI44C,SACNryC,QAIZ6H,gBAAe7H,OAIPsyC,GAAKjiC,IAAS4B,GAAaD,GAAamgC,OAAWI,EAAcpgC,EAAcqgC,UACnFD,IAAiBpgC,IAAiBqgC,aACnClH,WACEmH,EAAOtgC,EAAaE,UACpBE,EAAaggC,EAAepgC,QAM5BugC,EAAUH,EAAalgC,UALb,EAMV/L,EAAQuH,GAAa2kC,GAASp8C,GAAKA,EAAE,IAAMs8C,IAC3CC,EAAQF,EAPE,EAQVjsC,EAAMqH,GAAa2kC,GAASp8C,GAAKA,EAAE,IAAMu8C,IAC3CnsC,GAAO,GAAKF,GAAS,IACrBglC,EAAMkH,EAAQ76C,MAAM2O,EAAOE,EAAM,UAE/B6rC,EAAY/G,EAAI7iC,KAAIrS,KACtBi3C,SAAUpzC,KAAK7D,EAAE,GAbL,GAcZ87C,GAAI97C,EAAE,GACNu7C,OAAQz5C,KAAKimC,MAAM,KAAS/nC,EAAE,GAflB,EAemCq8C,GAAQlgC,GAAc,eAarE8/B,UAAAA,EACA9oB,IAZQ8jB,OACJA,UACSh1C,EAAE,EAAGA,EAAEg6C,EAAUj6C,OAAQC,OAC1Bg1C,GAAQgF,EAAUh6C,GAAGg1C,YACdgF,EAAUh6C,GAAG65C,UAIxB,OAQHU,GAASviC,IACjBwhC,GAAOS,OACNO,EAAQC,SACsB,IAAxBD,EAAOn/B,MAAMtb,SAAiB06C,iBAC5BC,SACFlnB,wBACQhX,EAAQw4B,KAAEA,EAAIhtC,KAAEA,EAAIsxC,OAAEA,KAAWkB,EAAOn/B,aAC1Cs/B,EAAcF,EAAIvpB,IAAI8jB,IACvB,QAAS,mBAAoB,oBAAoB9wB,SAASlc,IAASnI,KAAKimC,MAAM8U,GAAap+B,KAAcm+B,EAC1GnnB,EAAOz0B,MAAMyd,SAAAA,EAAUw4B,KAAAA,EAAMsE,OAAAA,EAAQqB,YAAAA,IAC/BnnB,EAAOzzB,OAAS,IACtB26C,EAAS37C,KAAKy0B,GACdA,MAGJA,EAAOzzB,OAAS,GAAG26C,EAAS37C,KAAKy0B,SAC/BqnB,KACAC,EAAW,cACNtnB,KAAUknB,SACXjB,EAAOjmB,EAAOzzB,OAAS,EACvBkO,EAAQulB,EAAO,GAAGwhB,KAAKh7B,UACvB7L,EAAMqlB,EAAOimB,GAAMzE,KAAKh7B,UACxBusB,EAA4B,IAAlB/S,EAAOzzB,OAAgB,IAAS,EAC1Cg7C,EAAel7C,KAAK6gC,OAAOzyB,EAAQs4B,GAAUuU,GAAYA,EACzDE,EAAan7C,KAAKo7C,MAAM9sC,EAAMo4B,GAAUuU,GAAYA,EACpDI,EAAWH,EAAe9sC,EAASulB,EAAO,GAAG8lB,OAC7C6B,EAAWH,EAAa7sC,EAAOqlB,EAAOimB,GAAMH,OAElDuB,EAAQ97C,MACJq8C,YAAax5C,KAAKm5C,OAAmBn5C,KAAKo5C,IAC1C1B,QAAS4B,EAASC,YAInBN,KAuBFQ,IAAyB,MAAO,MAChCT,GAAgBr6C,OACrBA,EAAEmc,UAAY,WAAa,GAAI,UAC7B4+B,EAAO,GAAK/6C,EAAE4jC,eAAepkB,UAAUw7B,SAASF,IAAwBt7B,UAAUy7B,mBAChFF,EAAO,KAAQ,GAAK,KAAOA,GAAQ,4FAOzCG,eACsB,6BAApBx2C,EAAML,KAAK2W,MAA2D,kBAApBtW,EAAML,KAAKoD,uBACtD0lC,GAAczoC,EAAML,KAAK+oC,QACb,iFAAfD,GAEAqM,cAKZnvC,SACQyH,WAAaA,UAAUoI,eACvBpI,UAAUoI,cAAcrV,iBAAiB,UAAWq2C,SAgBlDn9C,EAAcmb,GAAIvb,yCAbhBw9C,GAAU,KACVj6C,OAAO6/B,cACDzgC,QAAaY,OAAO6/B,OAAO1C,KAAK,aAAanzB,MAAKg+B,GAASA,EAAM5oC,mBAC5D86C,KAAO96C,KACE,iFAAZ86C,EAAIxmC,KACJumC,GAAU,gBAKfA,GAIeE,SACCl8C,IAAR+6C,EAEXtqB,MAAM,gFAAqB3gB,gBAG3BuqC,mBAIJz7C,IACI+T,WAAaA,UAAUoI,eACvBpI,UAAUoI,cAAcpV,oBAAoB,UAAWo2C,gcC/H/D53C,uDAwB6B,cAAf3E,MAAM8I,MAAuC,cAAf9I,MAAM8I,2GAJjC6zC,GAAK38C,MAAMo6C,mCAEXuC,GAAK38C,MAAMo6C,gCAHpBz1C,mDACSg4C,GAAK38C,MAAMo6C,mCAEXuC,GAAK38C,MAAMo6C,sBAEC,cAAfp6C,MAAM8I,MAAuC,cAAf9I,MAAM8I,+JAG1B8zC,iBAFiB,cAAf58C,MAAM8I,KAAwB,UAAY,iDAChD6zC,GAAK38C,MAAMo6C,+BADnBz1C,qCAA6B,cAAf3E,MAAM8I,KAAwB,UAAY,uCAChD6zC,GAAK38C,MAAMo6C,iGAYfuC,GAAK38C,KAAO05C,IAAI15C,MAAE,GAAGo6C,uBACjByC,IAAgB78C,MAAMo6C,OAASp6C,KAAO05C,IAAI15C,MAAE,GAAGo6C,0BAChD0C,GAAW98C,KAAO05C,IAAI15C,MAAE,GAAG8I,kDAHtCnE,8BACQg4C,GAAK38C,KAAO05C,IAAI15C,MAAE,GAAGo6C,kCACjByC,IAAgB78C,MAAMo6C,OAASp6C,KAAO05C,IAAI15C,MAAE,GAAGo6C,0CAChD0C,GAAW98C,KAAO05C,IAAI15C,MAAE,GAAG8I,8FAR9B6zC,GAAK,kBACDE,GAAgB78C,MAAMo6C,yBACvB0C,GAAW98C,KAAa4e,mDAHnCja,8BAEYk4C,GAAgB78C,MAAMo6C,wCACvB0C,GAAW98C,KAAa4e,iEAhBjC,UAAW,SAAU,YAAa,YAAa,eAAgB,gBAAgBoG,SAAShlB,MAAM8I,4CAYxF,IAAN9I,0HAZA,UAAW,SAAU,YAAa,YAAa,eAAgB,gBAAgBglB,SAAShlB,MAAM8I,uMAoC/F,6DARI6zC,GAAK38C,kCAEL28C,GAAK38C,oCAEO,aAAPA,MAAqB,UAAY,8CACvC28C,GAAK38C,wCAEGA,KAAkBA,MAAMA,MAAU28C,GAAK38C,MAAQA,MAAiB,YARhF2E,SAKAA,qCAJSg4C,GAAK38C,kCAEL28C,GAAK38C,kCAEO,aAAPA,MAAqB,UAAY,oCACvC28C,GAAK38C,iCAEGA,KAAkBA,MAAMA,MAAU28C,GAAK38C,MAAQA,MAAiB,uFAWpE+8C,GAAO/8C,MAAO,SAGd+8C,GAAO/8C,MAAO,iLATlB28C,GAAK38C,MAAO,iCAER68C,IAAgB78C,MAAO,GAAKA,MAAO,+GAGvC28C,GAAK38C,MAAO,IAAMA,MAAO,GAAKA,MAAO,IAAM,qGAG3C28C,GAAK38C,MAAO,IAAMA,MAAO,GAAKA,MAAO,IAAM,0BATnD2E,SAKAA,gBAGAA,qCAPQg4C,GAAK38C,MAAO,8BAER68C,IAAgB78C,MAAO,GAAKA,MAAO,sCAInC+8C,GAAO/8C,MAAO,6BADlB28C,GAAK38C,MAAO,IAAMA,MAAO,GAAKA,MAAO,IAAM,6BAIvC+8C,GAAO/8C,MAAO,6BADlB28C,GAAK38C,MAAO,IAAMA,MAAO,GAAKA,MAAO,IAAM,qOAcvD2E,8EANYo4C,GAAO/8C,WAGP+8C,GAAO/8C,YA9EjBA,aAkBKA,KAAO05C,yBAAZ74C,qCA2BKb,KAAO65C,0BAAZh5C,qCAYKb,0BAALa,qCAuBDb,KAAQa,OAAS,qRAlEV87C,GAAK,gBACc,IAAfE,qBACDC,GAAW98C,KAAW4e,4HAuDvB+9B,GAAK38C,iTAxEvB2E,+BAIIhB,OAAuCA,OAUnCA,sJAyDAA,OAGAA,cAGAA,gB5DshBR,SAA6BE,EAAM1F,GAEC,WADT4Y,iBAAiBlT,GACrByZ,WACfzZ,EAAKW,MAAM8Y,SAAW,YAE1B,MAAM0/B,EAASz4C,EAAQ,UACvBy4C,EAAOp2C,aAAa,QAAS,+JAE7Bo2C,EAAOp2C,aAAa,cAAe,QACnCo2C,EAAOC,UAAY,EACnB,MAAM30C,EAAcC,IACpB,IAAInJ,EAeJ,OAdIkJ,GACA00C,EAAOh/C,IAAM,kFACboB,EAAc0G,EAAOvD,OAAQ,WAAYwD,IACjCA,EAAMqnB,SAAW4vB,EAAOE,eACxB/+C,SAIR6+C,EAAOh/C,IAAM,cACbg/C,EAAO9S,OAAS,KACZ9qC,EAAc0G,EAAOk3C,EAAOE,cAAe,SAAU/+C,KAG7DwF,EAAOE,EAAMm5C,GACN,MACC10C,GAGKlJ,GAAe49C,EAAOE,gBAF3B99C,IAKJ0F,EAAOk4C,yD4DnoBLh9C,+DAgBS88C,GAAW98C,KAAW4e,yCAE1B5e,KAAO05C,YAAZ74C,4HAAAA,6BA2BKb,KAAO65C,aAAZh5C,4HAAAA,4BAYKb,aAALa,4HAAAA,oBAcQ87C,GAAK38C,kCAIH+8C,GAAO/8C,gCAGP+8C,GAAO/8C,kBAElBA,KAAQa,OAAS,4HApJTk8C,IAAUjH,EAAMqH,GAAY,IAChCrH,EACDqH,EACOrH,EAAKsH,SAASh9C,MAAM,GAAI,IACxB01C,EAAKkB,cAAclB,GAAQ,GAC3BA,EAAKsH,SAASh9C,MAAM,GAAI,QAEvBsC,KAAKozC,EAAKh7B,UAAY,KAAQsiC,SAASh9C,MAAM,GAAI,IAN1C+8C,EAAe,WAAa,QAStCN,GAAe,GACfF,IAAQzO,EAAKmP,IAAWA,KAAYA,GAAS,EAAKR,GAAe3O,GAAQ,IAAW,EAAK2O,GAAe3O,MACxG0O,GAAY,IACZE,GAAcQ,WAChBA,OACE,eACA,UACA,gBACM,cACN,aACA,qBACA,kBACM,cACN,gBACA,wBACA,qBACM,cACN,mBACA,4BACA,uBAEA,uBACA,YACA,kBACM,wBAGA,mLAcfC,EAAiB,qBAaVC,iBACAC,6HAPiB3H,EAAMrgB,EAAOkD,EAAIC,cAIhB,MAHdigB,GAAoB/C,GAEjB/S,MAAQmW,GAAgBpD,EAAMrgB,GAAO8jB,kBACpB54C,KAAKm3B,GAFF,QAEsCa,MAAOC,gBAS5D2kB,wWC1BnB54C,qKAFAA,gEAXgBo4C,GAAO/8C,WAGP+8C,GAAO/8C,WAxBZA,0BAALa,qCAyBsB,IAAnBb,KAAQa,UAAkBb,oNARtB28C,GAAK38C,yRAlBlB2E,oDAiBIhB,OAGAA,cAGAA,0DAtBO3D,aAALa,4HAAAA,mBAiBO87C,GAAK38C,gCAIF+8C,GAAO/8C,+BAGP+8C,GAAO/8C,kBACK,IAAnBA,KAAQa,QAAkBb,iHAZX+8C,GAAO/8C,yHADX28C,GAAK38C,6BADb2E,oCAEYo4C,GAAO/8C,8BADX28C,GAAK38C,wEAHLA,UACPA,KAAS,GAAKA,KAAS,gFATf06C,GAAQ16C,iBACb28C,GAAK38C,KAAOA,mCAER68C,IAAgB78C,KAAY,IAAJA,MAAS,IAAMA,KAASA,MAAI,GAAGo6C,OAAS,IAAOp6C,KAAOA,0IAIlF28C,IAAM38C,KAAOA,MAAUA,KAAY,IAAJA,MAAS,IAAMA,KAASA,MAAI,GAAGo6C,SAAW,0BAPjFz1C,SAMAA,yDANa+1C,GAAQ16C,kCACb28C,GAAK38C,KAAOA,gCAER68C,IAAgB78C,KAAY,IAAJA,MAAS,IAAMA,KAASA,MAAI,GAAGo6C,OAAS,IAAOp6C,KAAOA,wCAK9EA,6BADJ28C,IAAM38C,KAAOA,MAAUA,KAAY,IAAJA,MAAS,IAAMA,KAASA,MAAI,GAAGo6C,SAAW,gBAE5Ep6C,KAAS,GAAKA,KAAS,iKAkBjB,0JAFX2E,4EA5BN3E,KAASa,OAAS,KAiCbb,iEAlCf2E,wTAHO+4C,EAAYnC,EAAOA,EAAIT,4BADVl5B,GAAMjhB,KAAKgU,IAAI,IAAKhU,KAAKC,IAAI,EAAGghB,wNC2DK5hB,mBAApB,aAAPA,cAA9B2E,0HAAyD3E,yCAApB,aAAPA,iFA/Db29C,GAA8BC,GAAqBj9C,KAAKimC,MAAkC,IAA5BgX,EAAiBt/B,UAwB/Eu/B,GAAeD,UAGlB3E,EAAQ2E,EAAiB3E,MACzB36B,EAAWq/B,GAA2BC,UACzCt/B,GAAY,EACJ,gBACD26B,EAAQ,IAAO36B,EAAW,GACzB,oBACD26B,EAAQ,IAAoB,KAAb36B,EACd,mBACA26B,EAAQ,IAAO36B,EAAW,IAC1B,sBACY,MAAbA,EACC,cACD26B,GAAS,IAAO36B,EAAW,GAC1B,wBACD26B,GAAS,IAAoB,KAAb36B,EACf,mBAEA,+EAOJw3B,eACAx4B,WACAxU,EAAO,sLAEfg1C,WACMhI,IAASx4B,SAAiB,QACzBygC,EAAKlF,GAAoB/C,GACzBkI,EAA8BD,EAAG9E,OAAS,GAAOt4C,KAAKm3B,GAAG,GAAKn3B,KAAKm3B,GAAG,+BACjEimB,EAAGhb,MAAQmW,GAAgBpD,EAAMx4B,GAAUi8B,kBACnByE,+bCHNlB,GAAW98C,kBAChB,EAAQ,EAAJA,sEAIC88C,GAAW98C,MAAOA,MAAOa,OAAQ,EAAGb,mBACzC,EAAQ,EAAJA,mEANZ2E,SAKAA,6LAmCRA,oDAJkC3E,MAAYA,KAAKgxB,QAAShxB,KAAcA,kCAAtD,gFAAhB2E,6CAA8B3E,MAAYA,KAAKgxB,QAAShxB,KAAcA,6DANrDA,MAAEA,MAAM8I,WAChB9I,MAAM8I,KAAKkY,WAAW,oDADA,yGAA/Brc,4DAAiB3E,MAAEA,MAAM8I,4BAChB9I,MAAM8I,KAAKkY,WAAW,8IAV1BhhB,MAAEA,MAAM8I,WACJ9I,MAAM8I,KAAKkY,WAAW,WAK1B+7B,GAAO/8C,MAAM81C,WACX91C,MAAM2d,uHAAT,iEAFc3d,MAAM8I,+FALxBnE,+CAKAA,kBACAA,yBACAA,6CAPK3E,MAAEA,MAAM8I,4BACJ9I,MAAM8I,KAAKkY,WAAW,6FAIbhhB,MAAM8I,2DACnBi0C,GAAO/8C,MAAM81C,gCACX91C,MAAM2d,qJAIwCi/B,6CAAd,cAAb58C,MAAM8I,cAAxBnE,mCAA+B,cAAb3E,MAAM8I,mFATqB8zC,6CAAd,cAAb58C,MAAM8I,cAAxBnE,mCAA+B,cAAb3E,MAAM8I,oEAHlB,IAAb9I,MAAM2d,MASG,IAAJ3d,oGAVd2E,2JA2BkE3E,wCAAAA,8KAiB9D2E,4DAJqB3E,MAAEA,MAAM8I,WAAkB,IAAN9I,MAAW,SAAW,4CAA4BA,MAAMsd,cAAgBtd,MAAM8I,UAAY9I,MAAM81C,yEAAtG,+FAA/BnxC,mFAAiB3E,MAAEA,MAAM8I,gDAA8D9I,MAAMsd,yBAAgBtd,MAAM8I,qBAAY9I,MAAM81C,iMALhI91C,MAAEA,MAAM8I,WAERi0C,GAAO/8C,MAAM81C,WACX91C,MAAM2d,uCAHuB3d,MAAMsd,cAAgBtd,MAAM8I,UAAY9I,MAAM81C,wJAG9E,+IAHJnxC,6CACAA,kBACAA,yBACAA,wDAHK3E,MAAEA,MAAM8I,gDAAuB9I,MAAMsd,yBAAgBtd,MAAM8I,qBAAY9I,MAAM81C,2EAE7EiH,GAAO/8C,MAAM81C,sCACX91C,MAAM2d,4LAE+H3d,wCAAAA,0DALnDA,wCAAAA,+FAD3E,IAAbA,MAAM2d,oGADfhZ,wTA0B8B3E,sBAPH06C,GAAQ16C,oEACf,EAAW,GAAPA,2IAKA,EAAW,GAAPA,+BANhB2E,SAKIA,+IA9BqEk5C,GAAY79C,WAAoB29C,GAA2B39C,WAAsBA,KAAiB,GAAK,0EA/CzKA,4BAALa,uCAmBPb,KAAO05C,IAAI1uC,kCAAhBnK,gDAAAA,wCA4BuBb,cAAyBA,KAAUkR,qDAKrDlR,KAAO65C,4BAAZh5C,6FAAAA,0BAmBkB,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,gbAzBf,yDACkI,6HAsBvH,46BA7EvD8D,6BAEIhB,OACIA,OACIA,OACIA,cACAA,OACIA,2DAeJA,cACAA,cAGRA,4EA0BAA,OACIA,OACIA,4EAKRA,4EAgBAA,OACIA,OACIA,cACIA,kLAtEW3D,cAALa,uIAAAA,+BAmBPb,KAAO05C,IAAI1uC,oBAAhBnK,yIAAAA,UAAAA,0FA4BuBb,wBAAyBA,KAAUkR,wEAAyB2sC,GAAY79C,oCAAoB29C,GAA2B39C,sCAAsBA,KAAiB,GAAK,4CAKrLA,KAAO65C,cAAZh5C,mIAAAA,sCAAAA,qFAmBkB,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,iMAnB7CA,qRAjCuBoI,IAAM,UAAW,SAAU,YAAa,YAAa,eAAgB,gBAAgB+b,SAAS/b,EAAEH,kJAnEtH00C,gBACAS,uBACAL,oBACAM,WAoBLC,GACFC,iBAAoB,oBACpBC,iBAAoB,oBACpBC,aAAgB,gBAChBC,aAAgB,gBAChBC,UAAa,cACbC,UAAa,cACbC,QAAW,kBACXC,OAAU,oBACV5L,IAAO,OACP6L,MAAS,OACTC,SAAY,gBACZC,QAAW,mBAGTC,EAAS9G,GAAgB73C,MAAM,uOAjClCq9C,EAAc9iC,GAAQqgC,EN0JI,EAAClF,EAAMrgB,EAAO9X,KAC3C,MAAMiB,MAACA,EAAK+4B,UAAEA,GAAaO,GAASpC,EAAMrgB,EAAO9X,GAGjD,MAAO,CAACiB,MAAAA,EAAOogC,SADGrH,EAAYb,GAAQ,IAAIp0C,KAAKozC,EAAKh7B,UAAY,KAAS2a,GAAOkiB,YM7JvCsH,CAAkBjE,EAAcrgC,EAAKqW,QAAS,GAAK,uBACzFkuB,EAAiB5b,GAAa4a,EAAiB1E,GAAU0E,EAAe5a,EAAUpyB,IAAKoyB,EAAU3lB,IAAIiB,MAAQ,2BAG3F6W,EAAOqgB,GAAOl3B,MAAAA,EAAOogC,SAAAA,KACjCvpB,GAAUqgB,EACD,QAAVl3B,EACQ,UACS,UAAVA,GAA+B,0BAAVA,EACrB,UACU,sBAAVA,EACCogC,EAAY,yBAA2B,gCAC/B,mBAAVpgC,EACEogC,EAAY,uBAAyB,wCAE/BpgC,KAVU,GA2BrB9U,GAAOq0C,EAAcr0C,IAAMA,6QCfK,6XAM1B9J,wCAAAA,sFAFgBA,KAAUkR,SAAYlR,kIAAtBA,KAAUkR,kBAAYlR,8KAAgBA,yCAAAA,mDAOlDA,MAAM8I,KAAKkc,SAAS,QAAW,IAAM,MAAM+3B,GAAO/8C,MAAM81C,sFAA7DnxC,oDAAK3E,MAAM8I,KAAKkc,SAAS,QAAW,IAAM,2BAAM+3B,GAAO/8C,MAAM81C,kHAR3C,SAAhB91C,qCAOCA,KAAaI,MAAM,EAAG,wBAA3BS,2MADmD,IAAxBb,KAAaa,oBAA6Bb,KAAaa,QAAS,sEARxDb,KAAQa,OAAS,WAA9D8D,SACIhB,6BAOAA,uFARkF3D,QAAAA,8MASvEA,KAAaI,MAAM,EAAG,WAA3BS,+HAAAA,wBADmD,IAAxBb,KAAaa,2BAA6Bb,KAAaa,QAAS,uBARxDb,KAAQa,OAAS,ghBAc9D8D,SACIhB,OACIA,cACAA,gEAA6E3D,QAAAA,0OAHAwJ,SAAU,qIAhBlGxJ,MAAQA,KAAK6a,WAAWha,OAAS,0HAAjCb,MAAQA,KAAK6a,WAAWha,OAAS,0bAZ/B28C,EAAgB7iC,GAAQC,EAAgB8+B,GAAIC,SAAS/+B,EAAcD,EAAKoW,UAAW,GAAK,0BACxFouB,EAAiBxkC,GAAQC,EAAgBi/B,GAAKF,SAAS/+B,EAAcD,EAAKoW,UAAW,GAAK,yBAC1FmtB,EAAiBtjC,GAAgB0oB,MAAiB5gC,KAAKkY,EAAaE,UAAgC,IAApBwoB,EAAU1lB,SAAmBhD,GAAiBD,EAAKI,MAAMi4B,6BACzIoM,EAAY9D,EAAO5B,IAAI1uC,QAAO/B,IAAM,UAAW,UAAU+b,SAAS/b,EAAEH,+BACpEu2C,EAA4B/D,EAAOzB,KAAKh5C,OAAS,GAAKs+C,EAAcvgC,4BACpE0gC,EAAeF,EAAUv+C,OAAS,EAAK,OAXJ28C,EAAc6B,IACrB,QAAvB7B,EAAa5+B,MAAwB,KACrCygC,EAAkC,OAC/B,KAQqCE,CAA6B/B,EAAc6B,yBACxFG,EAAgC,OAAhBF,EAAwBF,EAA6B,SAAhBE,EAA0BhE,EAAOzB,2BACtF+D,EAAoBM,EAAiBrF,GAAoBqF,yBACzDD,EFxB0BL,CAAAA,UAEnB3E,EAAQ2E,EAAiB3E,MACzB36B,EAAWs/B,EAAiBt/B,gBAC7B26B,GAAU36B,EACZA,GAAY,IACJ,KACD26B,EAAQ,IAAO36B,GAAY,IAC1B,KACD26B,EAAQ,IAAO36B,GAAY,IAC1B,KACD26B,EAAQ,IAAO36B,EAAW,IACzB,KACDA,GAAY,IACX,KACD26B,GAAS,IAAO36B,EAAW,IAC1B,KACD26B,GAAS,IAAO36B,EAAW,IAC1B,KAEA,KAhBqB,KEoBrBmhC,CAAa7B,oKCTZ,SAAX59C,qKAAW,SAAXA,gvBAWyC,SAAXA,cAAnC2E,SACEhB,yBAA2C3D,sCADC,SAAXA,oPAMW,YAAXA,cAAnC2E,SACEhB,yBAA8C3D,sCADF,YAAXA,4IApB/BA,eAaCA,MAAOA,MAA4B,SAAXA,gBAMtBA,MAAoB,YAAXA,0pBAT8B,MAAXA,uGAeW,UAAXA,2NA9BvC2E,SACEhB,OACAA,kEAQAA,cAIAA,OACEA,OACEA,OAAkDA,OAAwCA,OAAKA,0DAcjGA,OACEA,+BAfwC3D,kBAeIA,yFA1B1CA,0HAU0C,MAAXA,MAG9BA,MAAOA,MAA4B,SAAXA,4DAMtBA,MAAoB,YAAXA,8EAM8B,UAAXA,0OAjC/B0/C,kGACmBA,EAAal4B,SAAU,kDAI9Bk4B,oMCoMoC,iCAC1Br6C,eAAYA,yIADlCV,gBACWhB,0BAA6E3D,oeALzEqF,eAAYA,kEAAyErF,yFAH9CqF,0DALnBrF,cAAvC2E,SACIhB,cAIAA,OACIA,cACAA,cACAA,2BAA6E3D,kBAA4CA,gDAAzBA,wBARjEA,iEAqBxByZ,GAAczO,kCAAnBnK,qFAD0B,mEAAZL,4EAD8CR,iDAFlE2E,SAEAhB,OACIA,4EAD2C3D,6BAAwCA,yCAE5EyZ,GAAczO,qBAAnBnK,+HAAAA,wBAF4Db,kEAGpCA,qDAAXA,gCAAf2E,sFAvBD3E,gCAiBDA,OAAcA,2FAlBxB2E,oJAkBU3E,MAAcA,qHA9Md2/C,KACA72C,KAAM,SAAUmN,IAAK,qEACrBnN,KAAM,SAAUmN,IAAK,8BACrBnN,KAAM,SAAUmN,IAAK,sEACrBnN,KAAM,SAAUmN,IAAK,2BACrBnN,KAAM,SAAUmN,IAAK,yDACrBnN,KAAM,SAAUmN,IAAK,yEACrBnN,KAAM,OAAQmN,IAAK,0DAGnB2pC,SAAqBC,EAAKC,WACtBC,QAAaF,EAAIG,QAAQF,gBACHC,EAAKE,kBACZC,MAAMhvC,KAAIrB,GAASA,EAAM7F,MAAKoB,KAAiB,IAAX00C,EAAgB,IAAK,SA+B9Ez6C,GAAO,6JAGP86C,cANO7/B,KACPmF,GAAW,EACX5T,MAAYkB,SAKV3F,EAAWvB,cAERu0C,KCvDE,SAAU5V,EAAMj3B,EAAM7T,GACjC,IAAI2gD,EAAY7V,EAAK3pC,OAErB,SAASy/C,IACPD,IAAcA,EACVA,EAAY,GACd3gD,IAIC6T,IAgCH7T,IA/BA8qC,EAAK/rC,SAAQ,EAAGqK,KAAAA,EAAMmN,IAAAA,EAAKhQ,QAAAA,EAAU,CAAE6P,OAAO,EAAMyqC,OAAO,OACzD,MAAMC,EAAoB,WAAT13C,EACX23C,EAAMz8C,SAASsB,cAAck7C,EAAW,SAAU,SACpDvqC,EAAI+K,WAAW,SAAW/K,EAAI+K,WAAW,SAC3Cy/B,EAAIxZ,YAAc,aAEpB,IAAIiD,GAAS,EACTsW,GACFC,EAAIziD,IAAMiY,EACVwqC,EAAI3qC,MAAQ7P,EAAQ6P,MACpB2qC,EAAIF,MAAQt6C,EAAQs6C,QAElBE,EAAIz2B,KAAO/T,EACP,aAAchQ,GACdw6C,EAAIvS,IAAM,WACVmS,GAAa,EACbnW,GAAS,GACF,YAAajkC,GACpBw6C,EAAIvS,IAAM,UACVmS,GAAa,EACbnW,GAAS,IAETuW,EAAIvS,IAAM,aACVmS,GAAa,EACbnW,GAAS,IAGbA,IAAQuW,EAAIvW,OAASoW,GACzBt8C,SAASiiC,KAAKniC,YAAY28C,MDiB1BC,CAAOf,UAAsBp9C,OAAO,qCAC1Bo+C,EAAWp+C,OAAO,wBACxBo+C,EAASC,oBAAoBC,UAtDd,0EAuDVV,IAAaA,EAAUW,YACpBX,MAAgBQ,EAASI,WAEjClvC,EAAMzF,SAAQ,YAIhB40C,EAAUC,UACNC,MAAaC,sBACR59C,UAAS6I,EAAS6G,KACzBiuC,EAAOhX,OAAUkX,QACRjB,GAAaA,EAAUW,iBAClBH,EAAWp+C,OAAO,wBACxB49C,MAAgBQ,EAASI,2BAnD/BJ,EAAWp+C,OAAO,wBAClB8+C,SACFC,EAAiB,QACfzB,QAAYc,EAASY,YAAYn0B,GAAQ9pB,QACzCk+C,EAAW3B,EAAI4B,iBACZ3B,EAAS,EAAGA,GAAU0B,EAAU1B,GAAU,SACzC4B,QAAiB9B,GAAYC,EAAKC,MACpC4B,EAAS18B,SAAS,kBAClBq8B,EAASxhD,KAAK6hD,GACdJ,GAAkB,UACQ,IAAnBA,SAEAI,EAAS18B,SAAS,gBAElB08B,EAAS18B,SAAS,kBADzBq8B,EAASxhD,KAAK6hD,WAKfL,EAASj2C,KAAK,OAmCbu2C,EAAaj8C,KAAM07C,EAAGx9C,OAAOnC,OAAQmgD,UAAW,EAAGC,OAAQ1B,IAC1D5zC,MACI9G,OACOA,YAIU8U,MAAUsG,UAAUihC,IAAI,UAAYr8C,GACpCs8C,MAAclhC,UAAUmhC,aAC9BD,EAAQr8C,KAAOnD,OAAY,UACrBmD,EAAOmb,UAAU4F,WAAWlM,EAAKwnC,GACvCr8C,EAAKghB,gHACLhhB,EAAKyW,MAAMqZ,YAAc9vB,EAAKu8C,IAAI72C,KAAK,KACvCmP,EAAIkM,WAAa/gB,MACb0Y,EAAM,EACN8jC,EAAY3nC,EAAIQ,MAAMmnC,gBACpBrkC,EAAiBtD,EAAI4B,MAAMq/B,SAAStqC,OAAMixC,EAAIC,MAChDhkC,GAAO+jC,EAAGld,WAAWmd,IACbA,EAAIhkC,EAAK8jC,MAErBrkC,EAAewkC,SAAS9nC,EAAI4B,MAAMmY,OAAO,GAAI,IAC7C/Z,EAAIsD,eAAiBA,MACjBhD,SAEAA,EAAaN,EAAI+nC,YAAY/nC,EAAI4B,MAAMmY,cACpCje,IAGmB,IAAtBwE,EAAWha,OACXmD,SAASiiC,KAAKzhC,MAAMqD,YAAY,qBAAsB,OAEtD7D,SAASiiC,KAAKzhC,MAAMqD,YAAY,qBAAsB,sBAE1D0S,EAAIM,WAAaA,EACjBN,EAAIwW,UAAaxW,EAAI4B,MAAMmY,OAAO,GAClC/Z,EAAIyW,QAAUzW,EAAI4B,MAAMmY,OAAO/Z,EAAI4B,MAAMmY,OAAOzzB,OAAS,OAKrD+f,K1DrC7B,SAAqBrG,EAAKtU,GAC7B,IAAIqa,EAAa,IAAId,MAA4BvZ,GACjD,MAAMoa,EAASO,KACfR,GAASC,EAAQC,GACjB,MAAMkV,EAAcjb,EAAIib,YAExB,GADAnV,EAAOkiC,QAAQ/sB,IACVjb,EAAK,OACV,MAAMga,EAAY,GAAGha,EAAIQ,MAAMyZ,WAAWja,EAAIQ,MAAM0Z,WAC9CtY,EAAQ,IAAI0E,UAAU8T,MAAMpa,EAAIioC,iBAAkB,CAACn9C,KAAQkvB,EAAWiB,YAAeA,IACrFZ,EAAiB,IAAI/T,UAAU8T,MAAMpa,EAAIsa,0BAA2B,CAACxvB,KAAQ,qBAC7EqvB,EAAc,IAAI7T,UAAU8T,MAAM,CAACxY,EAAMmY,OAAO,GAAInY,EAAMmY,OAAOnY,EAAMmY,OAAOzzB,OAAS,KAAKiK,MAAM,IAAK,CAACzF,KAAQ,SAASkvB,MAC/H,IAAIkuB,EAAW,GACf,IAAK,IAAIttB,KAAS5a,EAAI6a,OAAQ,CAC5B,IAAIlU,EAASiU,EAAMutB,WAAa,OAAS,kBACzCriC,EAAOkM,QAAQrL,EAAQiU,GACvB,IAAI9zB,EAAI,IAAIwf,UAAUw7B,SAASlnB,EAAMb,OAAO,GAAI,CAACjvB,KAAQ8vB,EAAM9vB,KAAMmwB,YAAeL,EAAMK,cAC1FnV,EAAOsiC,SAASzhC,EAAQ7f,GACpB8zB,EAAMO,SACR+sB,EAAS5iD,KAAKwB,GACdA,EAAI,IAAIwf,UAAUw7B,SAASlnB,EAAMb,OAAOa,EAAMb,OAAOzzB,OAAS,GAAI,CAACwE,KAAQ8vB,EAAM9vB,KAAMmwB,YAAeL,EAAMK,cAC5GitB,EAAS5iD,KAAKwB,GACdgf,EAAOsiC,SAASzhC,EAAQ7f,IAG5Bgf,EAAOkM,QAAQ,cAAemI,GAC9BrU,EAAOkM,QAAQ,QAASpQ,GACxBkE,EAAOqL,UAAU,QAASvP,EAAO,CAACo4B,SAAYkO,IAC9CpiC,EAAOkM,QAAQ,OAAQqI,GAEvBvU,EAAOqL,UAAU,OAAQkJ,G0DSOguB,CAAYroC,EAAK+F,GAEjBlU,EAAQmO,SACHlE,GAILpD,EAAOoD,UAENA,GAGLpD,EAAOoD,QAGXpD,EAAOxH,MAAM,2HAGpB4K,IACGpD,EAAOoD,OAInB6qC,EAAOrhB,QAAWxpB,IAAUpD,EAAOxH,MAAM,yBACzCy1C,EAAO2B,kBAAkB5B,yFAGVh4C,OACnBwc,GAAW,QACX6oB,GAAc,KACd8R,UAEMvuC,EAAMvO,QAAQiJ,iBACV00C,EAAOh4C,EAAErF,OAAOk/C,MAAM,GACtBC,EAAO95C,EAAErF,OAAOo/C,QAAQ,QAC1B/B,SACAgC,EAAa,kBACbroC,OAAepa,KAEf4M,EAAS,SAxGT,kBAyGA7K,OAAO2T,SAASjM,KAAO,QACvB+2C,EAAOC,GAAM10C,MAAMgO,SACf2oC,EAAY3oC,UACZY,OAAwB3a,UACxByiD,EAAa,aACbF,EAAKtgC,OACLxZ,EAAErF,OAAO6e,UACVnS,OAAO+F,SACN4sC,EAAa5sC,UACb6sC,OAAY1iD,QAEb2iD,cACCJ,EAAK3oC,mBAIjBqL,GAAW,mBAEoBxc,OAC/Bwc,GAAW,QACXw9B,EAAa,aACb7C,UACMvuC,EAAMvO,QAAQiJ,gBAChB22C,OAAY1iD,SAERogB,UACAzF,EAAwBlS,EAAErF,OAAOtE,cACjC2jD,EAAa,mBACR5sC,QAEL4sC,EAAa5sC,KAEjB9T,OAAO2T,SAASjM,KAAO,eAE3Bwb,GAAW,qCA2BqB7D,IAAMlI,GAA4BsL,SAASpD,mME7M1D5hB,mBAA0BA,4EAA8D,IAATA,oBAAuC,IAATA,cAAtI2E,yHAAyB3E,mBAA0BA,oEAA8D,IAATA,yBAAuC,IAATA,6KATvHojD,eACAC,+HACKx/C,EAAM8G,EAAWyD,aACf5N,IAAX4iD,SACQvsC,GAAKhT,EAAM8G,8PCQ6U3K,UAAO,kGAoBnC,gFAI5R,mFAG+D,sFAgD1FA,UAAQA,8BAAH,qHAAoBA,qCAAhCA,2GAAjB2E,6OAOyQ,0FAI7J,sFACsB3E,UAAO,kGAKK,8EAA6E,yJAMvJ2E,qhBAlGmBpC,OAAOo4B,KAAK,gEAA0O36B,KAAOuoB,sEAoB9I,IAAzBpV,UAAU2W,wKAAoB,2FAAkJ,4KAItT9pB,oKAkDhC3B,OAAOsmB,QAAQswB,2BAApBp0C,2VAakGb,KAAOuoB,whDA9FxDvoB,w2BAO9CA,UAAO,0FAA+G,4MAAkQ,00FAoB1X,8iBAGA,uOACiE,mrCAGjE,mFAAgJ,i1KAsCYA,gdAC0JA,ylEAgBtT,iNAA8R,yRAI7R,uGACA,yCAAiCA,WAAO,keAKxC,4GAA0J,0eAMpC,2lBAhH1H2E,kBACAA,kBACAA,kBACAA,kBACAA,SACAhB,cAEAA,OAAIA,cACJA,OACAA,cACAA,cACAA,cACAA,cACAA,cACAA,gEAIAgB,kBAGAA,kBACAA,kBACAA,kBACAA,kBAGAA,kBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,+CACAA,oBACAA,oBACAA,qDAGAA,oBACAA,qDACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBAMAA,oBACAA,oBACAA,oBACAA,oBACAA,oBAMAA,oBACAA,oBAWAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,oBACAA,kEAMAA,oBACAA,oBAEAA,qDACAA,oBACAA,UACAhB,kBACAA,0CACAA,4DACAA,kBACAA,kBACAA,kBACAA,kBACAA,mEAEAgB,oBACAA,oBACAA,oBACAA,UACAhB,iIA1EuC3D,kIAkDhC3B,OAAOsmB,QAAQswB,aAApBp0C,oIAAAA,6dAAAA,4iDAiCQyiD,EAAS/gD,OAAOo4B,KAAK,8DADxB4oB,EAAa5oC,EAAQA,EAAK8L,WAAWxQ,IAAK,mXC5ChCjW,KAAM4kB,MAAM4+B,oCAKVnlD,OAAOsmB,QAAQ3kB,2BAApBa,iJANN8D,yKAMWtG,OAAOsmB,QAAQ3kB,cAApBa,4HAAAA,8DAFGb,0EAAL2E,oCAAK3E,wDAFUyjD,GAAWzjD,oEAAtB2E,2CAAW8+C,GAAWzjD,kEAUO0jD,GAAc1jD,0EAAvC2E,2CAAyB++C,GAAc1jD,kEAJhCA,KAAQu2B,IAAI/Z,QAAQ,cAAe,IAAI1R,MAAM,2BAAlDjK,0KAAKb,KAAQu2B,IAAI/Z,QAAQ,cAAe,IAAI1R,MAAM,cAAlDjK,uIAAAA,sDAC2B6iD,GAAc1jD,OAAMwc,QAAQ,gCAAiCmnC,GAAW3jD,SAAa4jD,GAAe5jD,UAAcT,GAAES,oFAA7I2E,2CAAyB++C,GAAc1jD,OAAMwc,QAAQ,gCAAiCmnC,GAAW3jD,SAAa4jD,GAAe5jD,UAAcT,GAAES,gGAFnI,QAAbA,4MARF,QAAVA,2EAAU,QAAVA,wHADF6jD,GAAgB7jD,MAAOw/B,QAAAx/B,KAAS8jD,MAAA9jD,4BAArCa,wIADF8D,kFACOk/C,GAAgB7jD,MAAOw/B,QAAAx/B,KAAS8jD,MAAA9jD,eAArCa,+HAAAA,6CAlEegjD,IAAmB1yB,GAAOqO,QAAAA,EAASskB,MAAAA,aACvC3yB,eACD4yB,EAAW1lD,OAAOsmB,QAAQwM,EAAK6yB,kBAC/BxkB,IACAukB,EAAWA,EAAS/4C,UAAS/M,YACnB2jB,EAAI3jB,EAAE2mB,MAAM,wBACVhD,GAAKtM,GAAcsM,EAAE,GAAI4d,GAAW,MAG5CskB,EAASC,EAAS3jD,MAAM,EAAG0jD,EAAQ,GAAKC,YAEpCL,GAAcO,UACTA,EAKZznC,QAAQ,kBAAmB,aAC3BA,QAAQ,aAAc,aAGtBA,QAAQ,yBAA0B,uBAClCA,QAAQ,wBAAyB,wDACjCA,QAAQ,MAAO,UAEJkJ,aAEdw+B,IACFC,MAAS,SACTC,MAAS,UACTC,WAAc,WACdC,QAAW,UACXC,QAAW,WACXC,SAAY,YAEHjlD,GAAIkG,GAAQy+C,GAAYz+C,EAAK6b,gBAAkB7b,EAC/C+9C,GAAmB,wCACnBC,GAAch+C,GAChBA,EAAK+W,QAAQ,wCAAyC,sEAE3DioC,IACFN,MAAS,UACTC,MAAS,UACTC,WAAc,UACdC,QAAW,OACXC,QAAW,SACXC,SAAY,aAEVE,IACFP,MAAS,aACTC,MAAS,aACTC,WAAc,YACdC,QAAW,YACXC,QAAW,aACXC,SAAY,cAEHb,GAAcgB,GAAaF,GAAYE,EAASrjC,gBAAkB,QAClEsiC,GAAkBe,GAAaD,GAAgBC,EAASrjC,gBAAkB,wCAG5E5b,YACAo+C,cACAtkB,gYCnBax/B,uEATiBA,2kBAQYA,6OAZrD2E,SACIhB,OACIA,OACIA,OACIA,qBACIA,OACIA,6BACAA,cAGRA,cAEJA,uEAUZgB,uEAZ0G3E,+CATOA,wCAGxEA,kDASjBA,gBvEs0C5B,SAAmC4P,EAAM5P,EAAKM,GAC1C,MAAM0P,EAAYhQ,EAAII,SAChB2P,SAAEA,GAAaH,EACjBA,EAAKK,UAAYL,EAAKrD,OACtByD,EAAUJ,EAAKtQ,OAASyQ,GAExBH,EAAKK,UAAYL,EAAKU,QACtBN,EAAUJ,EAAKnH,OAASsH,GAE5BH,EAAK9B,MAAMzM,EAAE2O,EAAW1P,gCuEh1C6BN,4nBAErC2E,8DAff3E,kFAAAA,0LAlCKf,GAAQ8Z,GAAO8K,kBACR+gC,OAC0B,OAA3B9gC,GAAQC,QAAQ9kB,OAA4B6kB,GAAQC,QAAQ9kB,6BAQlEmO,EAAWvB,SAIbvI,WAHOwY,GAAU,YACV9F,EAAQ,wBACRwpB,KAEPhY,EAAUo9B,WAEDp0B,gBACT1U,GAAU,OACVxY,EAAU2tB,MAAM,oBAAoB1kB,MAAK2kB,OAClCA,EAASqW,UACDrW,EAASC,iBAEN1lB,MAAM,qCAQxB+zB,GAAWhY,GAASgJ,oIAHpB1U,GAAU,GACV1O,EAAS,sDAYgH0W,GAAQM,QAAQnlB,GAAOuoB,+RCqD9HrU,UAAUiD,sJAAqDzR,2BAA2DkR,wMAChIlR,2BAA2D3E,oBADrDmT,UAAUiD,wFAOmCpW,qDAAhCA,qCAAcA,QAAOA,aAApC2E,sCAA6B3E,QAAOA,4IARd,IAAzBmT,UAAU2W,oBAOJ9pB,0BAALa,+RAR4B2+B,sBAA6F,wBAAuBx/B,yXAO9FA,mMAZxE2E,SACIhB,OACIA,OACIA,OACIA,cACAA,OAAmBA,OAA6BA,kDAKhDA,cAEAA,sDAAwD3D,+GAFGA,KAAMwwB,OAANxwB,KAAMwwB,+DAEaxwB,2EAPwEA,OACxH,IAAzBmT,UAAU2W,wCAOJ9pB,aAALa,+HAAAA,kBADkDb,yPA7FlEw/B,GAAU,8DACZqlB,EAAY,OAWZC,EAAeC,QACbC,SACFC,EACA/8C,EACA0gC,EACAsc,EAgCJx5C,SACIu5C,EAAcF,EAAiBI,iBAAiB,UAChDvc,MAAeC,sBAAsBlkB,UAC3BzN,EAAI6tC,EAAiBK,aAEvBluC,EADQvW,KAAK6gC,MAAMujB,EAAiBM,aAAeN,EAAiBjf,mBAEhE71B,EAAU+0C,EAAI,GAAG5vC,aACVkwC,KAAOL,MACV/tC,EAAKouC,EAAIC,UAAYR,EAAiBQ,UAAYT,EAAchf,mBACpE71B,EAAUq1C,EAAIlwC,OAElBlN,EAAW+H,OAGfhM,KAAM8gD,EACNS,WAAgB,EAAIV,EAAchf,+BAClCiD,UAAW,IAEfkc,EAAYxmD,SAAS6mD,IACjBN,EAAInlD,MAAMuV,GAAIkwC,EAAIlwC,GAAImM,MAAO+jC,EAAIG,YACjC7c,EAASI,QAAQsc,UAErBp9C,EAAW88C,EAAI,GAAG5vC,SAEdwzB,EAASM,aACT+b,OAAczkD,EACdooC,OAAWpoC,8BAzEIklD,IAAAA,iBAAAA,EASNC,IARED,EAAIE,WAAW98C,KAAM,gBAAgByD,MAAKqV,OAAKijC,EAAYjjC,uBAgB3Epd,OAAsBhE,IAAb0H,GAA0BA,IAAa88C,EAAI,GAAG5vC,GAAM,qBAAuB,8CAbnF7S,OAAO2T,SAASjM,KAAO,KAEvB1H,OAAO2T,SAASk4B,YA8BJnlC,IACZA,EAAErF,OAAO6e,OACTmmB,EAASM,sBAnBK7B,EAAQ3nC,SAChBmmD,EAAiBxe,EAAU0d,EAAiBQ,UAAYT,EAAchf,aACtEggB,EAAcD,EAAehhC,UAC7BkhC,EAAYplD,KAAK6gC,MAAMujB,EAAiBM,aAAeN,EAAiBjf,cACxEkgB,cACEjB,EAAiBK,UAAUvgC,YAAcihC,GAAef,EAAiBK,WAAaW,KACtFhB,EAAiB5+C,oBAAoB,SAAU6/C,GAC3CtmD,GAAUA,MAGtBqlD,EAAiB7+C,iBAAiB,SAAU8/C,GAC5CA,IACAjB,EAAiBkB,UACb1oB,IAAKsoB,EACLK,SAAU,WAMdD,CAASjiD,SAASuhC,eAAer9B,GAAUq9C,gBAEvCN,EAAYxmD,SAAS6mD,IACjB1c,EAASI,QAAQsc,mDAoCFJ,mBAMiES,GAAOA,EAAI74C,eAAY6O,aAO3CzT,kEAT7C48C,wDAFPC,yICcS/kD,2CAAsDA,4bANoEA,oPAA/BA,KAAaihB,SAAS,kTAT1Itc,SACIhB,OACIA,OACIA,OACIA,cACAA,cAEJA,OACIA,cACAA,OAA8EA,wGAAqD3D,0BAA/BA,KAAaihB,SAAS,+RAXvIjhB,KAAQ,MAAQ,2pBAZvB2E,SACIhB,OACIA,OACIA,OACIA,cACAA,cAEJA,OACIA,uMATT3D,MAAeA,MAAeA,KAc3BA,OAAeA,mBAedA,OAAcA,QAA6B,aAAXA,OAAyB4kD,6WAnGnDuB,GAAiB3tC,KAEjB4tC,GAAyBC,IAClCxsC,GAAU3X,KAAI,GACd0X,GAAU1X,KAAI,GACVmkD,EACAvsC,GAAY5X,KxEkNK,EAAC+N,EAASlF,KACnC,MAAMu7C,EAASr2C,EAAQnF,MAAM,KACvBy7C,EAASx7C,EAAKD,MAAM,KAC1B,OAAOw7C,EAAOlmD,MAAM,GAAI,GAAGgL,KAAK,OAASm7C,EAAOnmD,MAAM,GAAI,GAAGgL,KAAK,MwErNzCo7C,CAAc,SAAeH,IAE9CvsC,GAAY5X,KAAI,IAUlBukD,GAAwB,8MAD1BC,EAAe,kBAEbC,MAA+BC,eAAmBA,eAAe7iC,QAAQ0iC,SAAyBjmD,OASxGqmD,GAAa,gBACFC,GAAS,WACdC,GAAWt9C,EAAM,SAGfu9C,EACArB,GAAOsB,GAAmBA,EAAgBvrC,SAC1CvI,UAAUoI,cAAcrV,iBAAiB,yBAEjC8gD,IACJA,GAAa,EAEZv9C,EAAS8K,gBAAiBhS,OAAO2T,SAASk4B,UAAU3kC,GAASlH,OAAO2T,SAASk4B,iBAWlFsY,EAAe,eAGVC,KAA4B/B,MAlCJgC,gBAAkBA,eAAexiC,QAAQqiC,GAAuB,UAmC7FQ,EAAgBvrC,QAAQwrC,aAAap+C,KAAM,iBAG3CyL,iBAEIhS,OAAO2T,SAASk4B,WACjB,MAIH7rC,OAAO2T,SAASk4B,6EA5CewY,eAAkBA,eAAeziC,WAAWsiC,SAAyBjmD,aAElGqK,EAAW87C,YACZ97C,GACEyK,GAAc,SAAezK,GAAY,6CAmD2Dg8C,GAAW,cAcPA,GAAW,SAI3CE,6oBC7EvEpiD,yKAFAA,gHADE3E,y5BAVlB2E,SACIhB,OACIA,cAGAA,OACIA,cACAA,6OAXmB8P,KAAgBH,gMCyCrBtT,eACdA,MAAQA,OAAiC,YAAfA,mEAMX,YAAfA,OAEIA,MAA6B,YAAfA,MAAuC,SAAXA,OAE9B,YAAXA,MAAwC,YAAfA,OAKf,MAAXA,OAIW,UAAXA,QAEGA,OAAQA,MAA6B,SAAXA,6TAtBnBA,iBACdA,MAAQA,OAAiC,YAAfA,8uBAHIA,mPAIT,SAAXA,+HAAW,SAAXA,0MACuBA,wMAAAA,2KAqBnCA,KAASA,gEAATA,KAASA,gvEAde,YAAKA,qDAAzB2E,wCAAyB3E,qIAFzB2E,mGAdO,aAAX3E,MAA0BmT,YAAsC,IAAzBA,UAAU2W,YAAwB5W,wIAF3DlT,KAAOuc,OAAO,IAAM,mCAA5C5X,SACEhB,6MADsB3D,KAAOuc,OAAO,IAAM,qRAhBC,OAAvCuH,GAAQC,QAAQhL,GAAOyK,ajEsGO,CAACvN,IACjC,MAAMkxC,EAAU,GACVziC,EAAY,GACdzO,EAAIpV,OAAS,IACCoV,EAAIsG,OAAO,IAAM,IACzBzR,MAAM,KAAKrM,SAAQ,SAASw+B,GAC9B,MAAMmqB,EAAOnqB,EAAKnyB,MAAM,KACxBq8C,EAAQE,mBAAmBD,EAAK,KAAOC,mBAAmBD,EAAK,OAGvE,IAAK,IAAKlgD,EAAK5H,KAAUjB,OAAOsmB,QAAQwiC,GACpC,GAAIjgD,KAAOwb,GAAmB,CAC1B,IAAI4kC,EACApgD,EAAI+Z,SAAS,QACb3hB,GAAS,EACJsW,MAAMtW,KACPgoD,EAAQhoD,IAEL4H,EAAI+Z,SAAS,UAAY3hB,EAAMslB,MAAMlD,IAC5C4lC,EAAQhoD,EAAMgiB,cACPpa,EAAI+Z,SAAS,WACpBqmC,MACOpgD,EAAI+Z,SAAS,YACpB3hB,GAAS,EACJsW,MAAMtW,KACPgoD,EAAQhoD,EAAMulB,QAAQ,UAGhBrkB,IAAV8mD,IACA5iC,EAAUxd,GAAOogD,OAEP,iBAARpgD,GACN5H,GAAS,EACJsW,MAAMtW,IACPwkB,GAAQM,QAAQrL,GAAO2K,aAAcpkB,IAE3B,aAAR4H,IACN5H,EAAQA,EAAMomB,OACVpmB,GACAwkB,GAAQM,QAAQrL,GAAO0K,SAAUnkB,IAI7CwkB,GAAQM,QAAQrL,GAAOyK,WAAYkB,IiEjJY6iC,CAAqBhlD,OAAO2T,SAASsxC,YAClFlnC,EAAakE,GAASV,GAAQC,QAAQhL,GAAOyK,iBACjDsB,GAAWxE,EAAYmnC,GAQvB/7C,SACM1H,SAASkC,iBAAiB,mBAAoB0V,IAA2B,OAC5D5X,SAASmC,oBAAoB,mBAAoByV,wBAjBlD8rC,IAEhBnlD,OAAO2T,SAASjM,KAAO,gBAQvBuf,GAAW,UACXq9B,GAAa,kCAqBiD/hC,GAAWxE,EAAYmnC,OAU3C3iC,GAAWxE,EAAYmnC,sEC1DrE,IAAIE,KAAK,yBAAyBpoD,IAAI,MAAM0uC,KAAI,SAASA,GAAEA,EAAEnkC,GAAG,OAAO,IAAIvG,kBAAkBoK,GAAG,IAAI1E,EAAE,IAAI2+C,eAAe3+C,EAAE4+C,MAAMC,UAAU,SAAS7Z,GAAGtgC,EAAEsgC,EAAEvoC,OAAOuoC,EAAEiZ,YAAYp9C,EAAE,CAACb,EAAE8+C,WAAiL,SAASp6C,GAAEsgC,EAAEnkC,IAAI,MAAMA,GAAGA,EAAEmkC,EAAEptC,UAAUiJ,EAAEmkC,EAAEptC,QAAQ,IAAI,IAAI8M,EAAE,EAAE1E,EAAE,IAAIiJ,MAAMpI,GAAG6D,EAAE7D,EAAE6D,IAAI1E,EAAE0E,GAAGsgC,EAAEtgC,GAAG,OAAO1E,EAAE,SAASA,GAAEglC,EAAEnkC,GAAG,IAAIb,EAAE,GAAG,oBAAoB++C,QAAQ,MAAM/Z,EAAE+Z,OAAOC,UAAU,CAAC,GAAG/1C,MAAMgH,QAAQ+0B,KAAKhlC,EAAE,SAASglC,EAAEnkC,GAAG,GAAGmkC,EAAE,CAAC,GAAG,iBAAiBA,EAAE,OAAOtgC,GAAEsgC,EAAEnkC,GAAG,IAAIb,EAAE5K,OAAO6pD,UAAU1lC,SAASlc,KAAK2nC,GAAG7tC,MAAM,GAAG,GAAG,MAAM,WAAW6I,GAAGglC,EAAEj7B,cAAc/J,EAAEglC,EAAEj7B,YAAY3N,MAAM,QAAQ4D,GAAG,QAAQA,EAAEiJ,MAAMC,KAAK87B,GAAG,cAAchlC,GAAG,2CAA2CsK,KAAKtK,GAAG0E,GAAEsgC,EAAEnkC,QAAG,GAApR,CAA6RmkC,KAAKnkC,GAAGmkC,GAAG,iBAAiBA,EAAEptC,OAAO,CAACoI,IAAIglC,EAAEhlC,GAAG,IAAInI,EAAE,EAAE,OAAO,WAAW,OAAOA,GAAGmtC,EAAEptC,OAAO,CAACsnD,MAAK,GAAI,CAACA,MAAK,EAAG7oD,MAAM2uC,EAAEntC,OAAO,MAAM,IAAIsnD,UAAU,yIAAyI,OAAOn/C,EAAEglC,EAAE+Z,OAAOC,aAAal9C,KAAK6F,KAAK3H,GAAG,IAAI0+C,KAAK,uBAAuBpoD,IAAI,MAAM0uC,KAAI,IAAIntC,GAAE,WAAW,IAAImtC,EAAE1nC,KAAKA,KAAKjD,QAAQ,IAAIC,kBAAkBuG,EAAE6D,GAAGsgC,EAAE7hC,QAAQtC,EAAEmkC,EAAEh7B,OAAOtF,MAAM,SAASM,GAAEggC,EAAEnkC,GAAG,IAAI6D,EAAEuI,SAAS8T,KAAK,OAAO,IAAI5C,IAAI6mB,EAAEtgC,GAAGqc,OAAO,IAAI5C,IAAItd,EAAE6D,GAAGqc,KAAK,IAAI1S,GAAE,SAAS22B,EAAEnkC,GAAGvD,KAAKuC,KAAKmlC,EAAE5vC,OAAOP,OAAOyI,KAAKuD,IAAI,SAASjL,GAAEovC,EAAEnkC,EAAE6D,GAAG,OAAOA,EAAE7D,EAAEA,EAAEmkC,GAAGA,GAAGA,GAAGA,EAAE1hC,OAAO0hC,EAAE1qC,QAAQ6I,QAAQ6hC,IAAInkC,EAAEmkC,EAAE1hC,KAAKzC,GAAGmkC,GAAG,SAAShrC,MAAK,IAAIE,GAAE,CAAC2F,KAAK,gBAAgB,SAASgwC,GAAE7K,EAAEnkC,GAAG,IAAIA,EAAE,OAAOmkC,GAAGA,EAAE1hC,KAAK0hC,EAAE1hC,KAAKtJ,IAAGM,QAAQ6I,UAAU,IAAIwV,GAAE,SAASjU,GAAG,IAAI1E,EAAEhG,EAAE,SAAS2e,EAAEqsB,EAAEnkC,GAAG,IAAIb,EAAEhG,EAAE,YAAO,IAAS6G,IAAIA,EAAE,KAAKb,EAAE0E,EAAErH,KAAKC,OAAOA,MAAM8hD,GAAG,GAAGp/C,EAAEq/C,GAAG,EAAEr/C,EAAEs/C,GAAG,IAAIznD,GAAEmI,EAAEu/C,GAAG,IAAI1nD,GAAEmI,EAAEkqB,GAAG,IAAIryB,GAAEmI,EAAEw/C,GAAG,EAAEx/C,EAAEy/C,GAAG,IAAI7mD,IAAIoH,EAAE0/C,GAAG,WAAW,IAAI1a,EAAEhlC,EAAE9K,GAAG2L,EAAEmkC,EAAE2a,WAAW3/C,EAAEq/C,GAAG,IAAIr6C,GAAEnE,EAAE++C,UAAU5/C,EAAE6/C,GAAGtmC,aAAa/f,YAAYD,MAAMyG,EAAEw/C,GAAG,KAAKx/C,EAAE8/C,GAAGj/C,EAAEmkC,EAAE9nC,oBAAoB,cAAc8C,EAAE0/C,MAAM1/C,EAAE+/C,GAAGl/C,EAAEb,EAAEy/C,GAAGjlD,IAAIqG,GAAGb,EAAEs/C,GAAGn8C,QAAQtC,MAAMb,EAAEq/C,GAAGx+C,EAAE5D,iBAAiB,cAAc+C,EAAEggD,KAAKhgD,EAAEggD,GAAG,SAAShb,GAAG,IAAInkC,EAAEb,EAAE9K,GAAGwP,EAAEsgC,EAAErqC,OAAO9C,EAAE6M,EAAEiR,MAAM3Q,EAAEN,IAAI1E,EAAE8/C,GAAGlqD,EAAE,CAACwjC,GAAG10B,EAAEu7C,WAAWj7C,EAAEk7C,cAAclb,IAAIhgC,GAAGhF,EAAEmgD,KAAKvqD,EAAEwqD,UAAS,GAAIpgD,EAAEsE,cAAc,IAAI+J,GAAExW,EAAEjC,IAAI,cAAciC,EAAEmI,EAAEqgD,GAAG3B,KAAKpzC,uBAAuB,cAAczT,GAAGgJ,EAAE4R,UAAU/N,GAAG1E,EAAEsE,cAAc,IAAI+J,GAAE,UAAUzY,MAAM,KAAK,eAAeiC,IAAIwT,aAAarL,EAAEqgD,IAAIr7C,GAAGhF,EAAEu/C,GAAGp8C,QAAQuB,KAAK1E,EAAEsgD,GAAG,SAAStb,GAAG,IAAInkC,EAAEb,EAAE+/C,GAAGr7C,EAAE7D,IAAIqJ,UAAUoI,cAAciuC,WAAWvgD,EAAEsE,cAAc,IAAI+J,GAAE,cAAc,CAAC4xC,WAAWv7C,EAAEw7C,cAAclb,EAAE5L,GAAGv4B,EAAEu/C,SAASpgD,EAAEmgD,MAAMz7C,GAAG1E,EAAEkqB,GAAG/mB,QAAQtC,IAAIb,EAAEwgD,IAAIxmD,EAAE,SAASgrC,GAAG,IAAInkC,EAAEmkC,EAAEvoC,KAAKiI,EAAEsgC,EAAEyb,MAAM5oD,EAAEmtC,EAAE7gB,OAAO,OAAOvuB,GAAEoK,EAAE0gD,oBAAoB1gD,EAAEy/C,GAAG5mD,IAAIhB,IAAImI,EAAEsE,cAAc,IAAI+J,GAAE,UAAU,CAAC5R,KAAKoE,EAAEq/C,cAAclb,EAAEyb,MAAM/7C,EAAE00B,GAAGvhC,SAAS,WAAW,IAAI,IAAImtC,EAAE,GAAGnkC,EAAE,EAAEA,EAAEoK,UAAUrT,OAAOiJ,IAAImkC,EAAEnkC,GAAGoK,UAAUpK,GAAG,IAAI,OAAOvG,QAAQ6I,QAAQnJ,EAAEmR,MAAM7N,KAAK0nC,IAAI,MAAMA,GAAG,OAAO1qC,QAAQ0P,OAAOg7B,MAAMhlC,EAAE6/C,GAAG7a,EAAEhlC,EAAEo/C,GAAGv+C,EAAEqJ,UAAUoI,cAAcrV,iBAAiB,UAAU+C,EAAEwgD,IAAIxgD,EAAEhG,EAAE0K,GAAG1E,EAAE2Y,GAAGsmC,UAAU7pD,OAAOC,OAAO2E,EAAEilD,WAAWj/C,EAAEi/C,UAAUl1C,YAAY/J,EAAEA,EAAEhC,UAAUhE,EAAK,IAAGqP,EAAI2pB,EAAEra,EAAEsmC,UAAU,OAAOjsB,EAAE2tB,SAAS,SAAS3b,GAAG,IAAInkC,QAAG,IAASmkC,EAAE,GAAGA,GAAGl6B,UAAUpG,OAAE,IAAS7D,GAAGA,EAAE,IAAI,IAAIb,EAAE1C,KAAK,OAAO,SAAS0nC,EAAEnkC,GAAG,IAAI6D,EAAEsgC,IAAI,OAAGtgC,GAAGA,EAAEpB,KAAYoB,EAAEpB,KAAKzC,GAAUA,IAA7D,aAA+E,IAAI6D,GAAG,aAAa3J,SAAS6lD,WAAW,OAAO/Q,GAAE,IAAIv1C,kBAAkB0qC,GAAG,OAAO1rC,OAAO2D,iBAAiB,OAAO+nC,qBAAqB,OAAOhlC,EAAEmgD,GAAGU,QAAQ32C,UAAUoI,cAAciuC,YAAYvgD,EAAE8gD,GAAG9gD,EAAE+gD,KAAKnrD,GAAEoK,EAAEghD,eAAehc,GAAGhlC,EAAE9K,GAAG8vC,EAAEhlC,EAAE8gD,KAAK9gD,EAAE+/C,GAAG//C,EAAE8gD,GAAG9gD,EAAEu/C,GAAGp8C,QAAQnD,EAAE8gD,IAAI9gD,EAAEkqB,GAAG/mB,QAAQnD,EAAE8gD,IAAI9gD,EAAE8gD,GAAG7jD,iBAAiB,cAAc+C,EAAEggD,GAAG,CAACiB,MAAK,KAAM,IAAIpgD,EAAEb,EAAE9K,GAAGud,QAAQ,OAAO5R,GAAGmE,GAAEnE,EAAE++C,UAAU5/C,EAAE6/C,GAAGtmC,cAAcvZ,EAAE+/C,GAAGl/C,EAAEvG,QAAQ6I,UAAUG,iBAAiBtD,EAAEsE,cAAc,IAAI+J,GAAE,UAAU,CAAC+qB,GAAGv4B,EAAEqgD,0BAAyB,QAAS59C,sBAAsBtD,EAAE+/C,KAAK//C,EAAEs/C,GAAGn8C,QAAQnD,EAAE+/C,IAAI//C,EAAEy/C,GAAGjlD,IAAIwF,EAAE+/C,KAAK//C,EAAE9K,GAAG+H,iBAAiB,cAAc+C,EAAE0/C,IAAIx1C,UAAUoI,cAAcrV,iBAAiB,mBAAmB+C,EAAEsgD,IAAItgD,EAAE9K,SAAS,MAAM8vC,GAAG,OAAO1qC,QAAQ0P,OAAOg7B,KAAKhS,EAAEnvB,OAAO,WAAW,IAAI,OAAOvG,KAAKpI,GAAG26C,GAAEvyC,KAAKpI,GAAG2O,eAAU,EAAO,MAAMmhC,GAAG,OAAO1qC,QAAQ0P,OAAOg7B,KAAKhS,EAAE0tB,MAAM,WAAW,YAAO,IAASpjD,KAAKyiD,GAAGzlD,QAAQ6I,QAAQ7F,KAAKyiD,IAAIziD,KAAKgiD,GAAGjlD,SAAS24B,EAAE2pB,UAAU,SAAS97C,GAAG,IAAI,OAAOjL,GAAE0H,KAAKojD,kBAAkBh8C,GAAG,OAAOsgC,GAAEtgC,EAAE7D,MAAM,MAAMmkC,GAAG,OAAO1qC,QAAQ0P,OAAOg7B,KAAKhS,EAAEmuB,mBAAmB,WAAW7jD,KAAKpI,IAAIoI,KAAKpI,GAAGud,SAASuyB,GAAE1nC,KAAKpI,GAAGud,QAAQvY,KAAI84B,EAAE+tB,GAAG,WAAW,IAAI/b,EAAE96B,UAAUoI,cAAciuC,WAAW,OAAOvb,GAAGhgC,GAAEggC,EAAE4a,UAAUtiD,KAAKuiD,GAAGtmC,YAAYyrB,OAAE,GAAQhS,EAAEguB,GAAG,WAAW,IAAI,IAAIhc,EAAE1nC,KAAK,OAAO,SAAS0nC,EAAEnkC,GAAG,IAAI,IAAI6D,EAAEsgC,IAAI,MAAMA,GAAG,OAAOnkC,EAAEmkC,GAAG,OAAGtgC,GAAGA,EAAEpB,KAAYoB,EAAEpB,UAAK,EAAOzC,GAAU6D,EAA7F,aAA4G,OAAO9O,GAAEsU,UAAUoI,cAAcquC,SAAS3b,EAAE6a,GAAG7a,EAAEoa,cAAcv+C,GAAG,OAAOmkC,EAAEwa,GAAGhmD,YAAYD,MAAMsH,iBAAiBmkC,GAAG,MAAMA,KAAK,MAAMA,GAAG,OAAO1qC,QAAQ0P,OAAOg7B,MAAU37B,EAAE,CAAC,CAACpL,IAAI,SAAS8qB,IAAI,WAAW,OAAOzrB,KAAKiiD,GAAGllD,UAAU,CAAC4D,IAAI,cAAc8qB,IAAI,WAAW,OAAOzrB,KAAK4sB,GAAG7vB,aAA7mJ,SAAW2qC,EAAEnkC,GAAG,IAAI,IAAI6D,EAAE,EAAEA,EAAE7D,EAAEjJ,OAAO8M,IAAI,CAAC,IAAI1E,EAAEa,EAAE6D,GAAG1E,EAAEohD,WAAWphD,EAAEohD,aAAY,EAAGphD,EAAEqhD,cAAa,EAAG,UAAUrhD,IAAIA,EAAEuP,UAAS,GAAIna,OAAOksD,eAAetc,EAAEhlC,EAAE/B,IAAI+B,IAAw9Ia,CAA1H8X,EAA8HsmC,UAAU51C,GAAasP,EAA5tG,CAA+tG,WAAW,SAASqsB,IAAI1nC,KAAKikD,GAAG,IAAI74C,IAAI,IAAI7H,EAAEmkC,EAAEia,UAAU,OAAOp+C,EAAE5D,iBAAiB,SAAS+nC,EAAEnkC,GAAGvD,KAAKkkD,GAAGxc,GAAGxqC,IAAIqG,IAAIA,EAAE3D,oBAAoB,SAAS8nC,EAAEnkC,GAAGvD,KAAKkkD,GAAGxc,GAAG/qC,OAAO4G,IAAIA,EAAEyD,cAAc,SAAS0gC,GAAGA,EAAErqC,OAAO2C,KAAK,IAAI,IAAIuD,EAAE6D,EAAE1E,GAAE1C,KAAKkkD,GAAGxc,EAAEnlC,SAASgB,EAAE6D,KAAKw6C,OAAO,EAAGr+C,EAAExK,OAAO2uC,IAAKnkC,EAAE2gD,GAAG,SAASxc,GAAG,OAAO1nC,KAAKikD,GAAG1oD,IAAImsC,IAAI1nC,KAAKikD,GAAGtoD,IAAI+rC,EAAE,IAAIpsC,KAAK0E,KAAKikD,GAAGx4B,IAAIic,IAAIA,EAAxW,ICMx1J,IAAIyc,GACAC,IAAW,EAEf,IACID,GAAM,IAAIE,GAAI,CACVhnD,OAAQI,SAASiiC,OAExB,MAAM5vB,GACHs0C,IAAW,EACX,IACI,IAAI7e,GAAU9nC,SAASsB,cAAc,KACrCwmC,GAAQjN,UAAY,WAAaxoB,EAAIoxB,wOAIrCzjC,SAASiiC,KAAKniC,YAAYgoC,IAE7B,MAAM7iC,MACV,QAIG,GAAI,kBAAmBkK,UAAW,CAC9B,MAAM03C,EAAU,IAAIC,GAAQ,WAC5BnxC,GAAGzX,IAAI2oD,GACPA,EAAQ3kD,iBAAiB,aAAcH,IAC9BA,EAAMsjD,YAOfwB,EAAQ3kD,iBAAiB,aAAcH,IAG9BA,EAAMsjD,UAMPwB,EAAQjF,UAAU,CAAE98C,KAAM,kBAI1B/C,EAAMmjD,cAKd2B,EAAQ3kD,iBAAiB,WAAYH,IAG7B4kD,IACAE,EAAQ3kD,iBAAiB,eAAe,KAEpC3D,OAAO2T,SAASk4B,YAEpByc,EAAQT,uBAEJrkD,EAAMmjD,WAGVh0C,GAAe,IAAK0wC,GAAU7/C,EAAMs8B,GAAG,CAACv5B,KAAM,iBAC7CyD,MAAKqV,GAAKwkC,GAAsBxkC,KAChCtR,OAAMrH,IAEHm9C,YAIZyE,EAAQjB,WAAWr9C,MAAKkP,IAChBkvC,IAAYlvC,GAAKA,EAAIsvC,aACzB5E,GAAejkD,IAAIuZ,KAEpBE,QAAQlT,eAIJiiD"}